import{r as u,u as _t,a as It,R as D,c as h,b as A,_ as ee,d as O,e as G,l as We,f as Ut,g as zt,s as Bt,z as Ft,h as Wt,i as Ht,j as Yt,k as qt,m as Xt,n as a,o as we,E as te,p as Kt,q as He,t as Qt,P as Zt,v as Jt,w as es,x as ts}from"./vendor-43906885.js";import{u as ss,a as Ze,S as os,d as Ye,M as ns,A as rs,b as as,B as $,T as Z,c as is,I as _,e as J,f as cs,g as ds,h as ls,i as us,j as Je,P as et,s as ps,D as gs,k as se,l as oe,G as z,m as B,n as fs,o as hs,p as ms,q as xs,r as ys,t as ws,v as Cs,w as Ms,x as bs,y as Ss,z as vs,C as $s,E as js,F as Es,H as tt,J as F,K as ks,L as Rs,N as Vs,O as As,Q as Ls,R as Ds,U as Ts,V as Os,W as Ns,X as Gs,Y as Ps}from"./material-a6ffb072.js";import{m as _s}from"./system/Converter-79db4bf0.js";import{m as Is}from"./system/Materials-8a00fe9c.js";import{m as Us}from"./system/Composer-83fae569.js";const zs="modulepreload",Bs=function(e,t){return new URL(e,t).href},qe={},Fs=function(t,s,o){if(!s||s.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(s.map(r=>{if(r=Bs(r,o),r in qe)return;qe[r]=!0;const i=r.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!o)for(let p=n.length-1;p>=0;p--){const x=n[p];if(x.href===r&&(!i||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${l}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":zs,i||(d.as="script",d.crossOrigin=""),d.href=r,document.head.appendChild(d),i)return new Promise((p,x)=>{d.addEventListener("load",p),d.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())};function Ws(e={}){const{immediate:t=!1,onNeedRefresh:s,onOfflineReady:o,onRegistered:n,onRegisteredSW:r,onRegisterError:i}=e;let l,c;const d=async(x=!0)=>{await c};async function p(){if("serviceWorker"in navigator){const{Workbox:x}=await Fs(()=>import("./vendor-43906885.js").then(f=>f.V),["./vendor-43906885.js","./material-a6ffb072.js"],import.meta.url);l=new x("./sw.js",{scope:"./",type:"classic"}),l.addEventListener("activated",f=>{(f.isUpdate||f.isExternal)&&window.location.reload()}),l.addEventListener("installed",f=>{f.isUpdate||o?.()}),l.register({immediate:t}).then(f=>{r?r("./sw.js",f):n?.(f)}).catch(f=>{i?.(f)})}}return c=p(),d}function Hs(e={}){const{immediate:t=!0,onNeedRefresh:s,onOfflineReady:o,onRegistered:n,onRegisteredSW:r,onRegisterError:i}=e,[l,c]=u.useState(!1),[d,p]=u.useState(!1),[x]=u.useState(()=>Ws({immediate:t,onOfflineReady(){p(!0),o?.()},onNeedRefresh(){c(!0),s?.()},onRegistered:n,onRegisteredSW:r,onRegisterError:i}));return{needRefresh:[l,c],offlineReady:[d,p],updateServiceWorker:x}}const st="Store",Ys="0.0.1",ot=u.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),qs=()=>{const{loadReducers:e,registerMiddleware:t}=u.useContext(ot);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},nt=()=>_t(),Xs=It,rt=u.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>D.memo(()=>null),registerComponents:()=>null}),Ks=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=u.useContext(rt);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},K={name:st,version:Ys,depends_on:[],managers:{store:qs,componentRegistry:Ks},hooks:{useAppDispatch:nt,useAppSelector:Xs},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},Ce=u.createContext({modules:{},setModules:()=>null}),m={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},E="Graph",Qs="0.0.1",Zs=h(`[${E}:Instance:${m.EVENT}] Graph loaded`),Js=h(`[${E}:Instance:${m.EVENT}] Node added`),eo=h(`[${E}:Instance:${m.EVENT}] Node removed`),to=h(`[${E}:Instance:${m.EVENT}] Node updated`),so=h(`[${E}:Instance:${m.EVENT}] Edge added`),oo=h(`[${E}:Instance:${m.EVENT}] Edge removed`),xe=h(`[${E}:Instance:${m.EVENT}] Search finished`),no=h(`[${E}:Instance:${m.EVENT}] Search invalidated`),at=h(`[${E}:Instance:${m.COMMAND}] Load Graph`),it=h(`[${E}:Instance:${m.COMMAND}] Reset Graph`),ne=h(`[${E}:Instance:${m.COMMAND}] Add node`),re=h(`[${E}:Instance:${m.COMMAND}] Remove node`),ae=h(`[${E}:Instance:${m.COMMAND}] Update node`),ie=h(`[${E}:Instance:${m.COMMAND}] Add edge`),ce=h(`[${E}:Instance:${m.COMMAND}] Remove edge`),ct=h(`[${E}:Instance:${m.COMMAND}] Search`),dt=h(`[${E}:Instance:${m.COMMAND}] Invalidate Search`),R=e=>{const{modules:t}=u.useContext(Ce),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},lt={inputs:{},outputs:{}},de=(e,t)=>{const s=R("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,r=A(c=>c?.Graph&&c.Graph.graphs[e],t),i=n(r),l=n(c=>c?.Graph&&c.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(c,d)=>{const p={...c,position:{x:0,y:0}};o(ne({graphId:e,node:p,edges:d??lt}))},removeNode:c=>{o(re({graphId:e,nodeId:c}))},updateNode:c=>{o(ae({graphId:e,nodeId:c.id,changes:c}))},addEdge:c=>{o(ie({graphId:e,edge:c}))},removeEdge:c=>{o(ce({graphId:e,edgeId:c}))},nodeExists:c=>l?c in l.nodes:!1,search:(c,d,p,x,f,M,k)=>{const y=k??ee.uniqueId("search");return o(ct({id:y,graphId:e,strategy:c,nodeStart:d,validate:p,stopCriteria:x,depth:f,label:M??y})),y}}}},Me={nodes:{},edges:{},adjacencyList:{},searchResults:{}},ut={graphs:{}};h(`[${E}:${m.EVENT}:Init] Graph Module loaded`);const ro=h(`[${E}:GraphsManager:${m.EVENT}] Graph created`),ao=h(`[${E}:GraphsManager:${m.EVENT}] Graph destroyed`),be=h(`[${E}:GraphsManager:${m.COMMAND}] Create graph`),pt=h(`[${E}:GraphsManager:${m.COMMAND}] Destroy graph`),io=O({name:E,initialState:ut,reducers:{},extraReducers:e=>{e.addCase(at,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ne,(t,{payload:{graphId:s,node:o,edges:n}})=>{const r=t.graphs[s];if(!r)throw Error("Graph does not exist");if(r.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...r,nodes:{...r.nodes,[o.id]:o},edges:{...r.edges,...Object.entries(n.inputs).reduce((l,[c,d])=>({...l,[c]:d}),{}),...Object.entries(n.outputs).reduce((l,[c,d])=>({...l,[c]:d}),{})},adjacencyList:{...r.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((l,[c,d])=>({...l,[d.sourceId]:{...r.adjacencyList[d.sourceId],outputs:[...r.adjacencyList[d.sourceId].outputs,c]}}),{}),...Object.entries(n.outputs).reduce((l,[c,d])=>({...l,[d.targetId]:{...r.adjacencyList[d.targetId],inputs:[...r.adjacencyList[d.targetId].inputs,c]}}),{})}}}}}).addCase(re,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([r,i])=>i.sourceId===o||i.targetId===o).map(([r,i])=>r);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((r,i)=>i.id!==o?{...r,[i.id]:i}:r,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((r,[i,l])=>i!==o?{...r,[i]:{inputs:l.inputs.filter(c=>!n.includes(c)),outputs:l.outputs.filter(c=>!n.includes(c))}}:r,{}),edges:Object.entries(t.graphs[s].edges).reduce((r,[i,l])=>n.includes(i)?r:{...r,[i]:l},{})}}}}).addCase(ae,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const r=t.graphs[s],i=r.nodes[o];if(i===null)throw Error("Node does not exist");return r.nodes[o]={...i,...n},t}).addCase(ie,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(ce,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s],r=n.edges[o];if(!r)throw Error("Edge does not exist");return delete n.edges[o],n.adjacencyList[r.sourceId].outputs=n.adjacencyList[r.sourceId].outputs.filter(i=>i!==r.id),n.adjacencyList[r.targetId].inputs=n.adjacencyList[r.targetId].inputs.filter(i=>i!==r.id),t}).addCase(it,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...Me}}})).addCase(xe,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(dt,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),co=O({name:E,initialState:ut,reducers:{},extraReducers:e=>{e.addCase(be,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...Me,id:s},t}).addCase(pt,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(io.reducer)}}),Se=G();Se.startListening({actionCreator:be,effect:async(e,t)=>{const{dispatch:s}=t;s(ro(e.payload))}});Se.startListening({actionCreator:pt,effect:async(e,t)=>{const{dispatch:s}=t;s(ao(e.payload))}});const lo=(e,t,s,o,n)=>{const r=[],i=[];let l=0;const c=[t];for(;c.length;){const d=c.shift();if(!d)break;const p=e.nodes[d];if(r.push(p),s(p,e,i,r)&&i.push(p),o(p,e,i,r))break;if(n&&l>=n)continue;const f=e.adjacencyList[d];c.push(...f.outputs.map(M=>e.edges[M].targetId)),c.push(...f.inputs.map(M=>e.edges[M].sourceId)),l+=1}return{findings:i,visited:r}},uo=(e,t,s,o,n)=>({findings:[],visited:[]}),N=G();N.startListening({actionCreator:at,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(Zs({graphId:e,graph:t}))}});N.startListening({actionCreator:ne,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(Js({graphId:e,node:t,edges:s}))}});N.startListening({actionCreator:re,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(eo({graphId:e,nodeId:t}))}});N.startListening({actionCreator:ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(to(e))}});N.startListening({actionCreator:ie,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(so(e))}});N.startListening({actionCreator:ce,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(oo(e))}});N.startListening({actionCreator:ct,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),r=n[e.graphId];if(r.searchResults&&e.id in r.searchResults&&!r.searchResults[e.id].outdated){s(xe({graphId:e.graphId,searchId:e.id,results:r.searchResults[e.id]}));return}let i={findings:[],visited:[]};switch(e.strategy){case"dfs":i={...uo(r,e.nodeStart,e.validate,e.stopCriteria,e.depth)};break;case"bfs":i=lo(r,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(xe({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});N.startListening({actionCreator:dt,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(no(e))}});const C="Layout",po="0.0.1",ve="ribbonMenuSections",I="viewportTypes",gt="settings-panel",ft="details-panel",ht="viewport-notifications-tray";function go(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const fo=({width:e,height:t,nodeBorder:s})=>{const o=We().domain([-1,e+1]).range([-1,e+1]),n=We().domain([-1,t+1]).range([-1,t+1]),r=Ut(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=zt(n).ticks(10).tickSize(e).tickPadding(8-e);function l(x){x.append("circle").attr("r",f=>f.radius).attr("fill",f=>go(f.group??"")).attr("stroke",s),x.append("text").text(f=>f.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function c(x){function f(y){y.active||x.alphaTarget(.3).restart(),y.subject.fx=y.subject.x,y.subject.fy=y.subject.y}function M(y){y.subject.fx=y.x,y.subject.fy=y.y}function k(y){y.active||x.alphaTarget(0),y.subject.fx=null,y.subject.fy=null}return Xt().on("start",f).on("drag",M).on("end",k)}function d(x){x.append("line").attr("stroke-width","1em").attr("stroke","gray")}function p(x){x.each(f=>{x.attr("viewBox",[0,0,e,t]),x.selectAll("*").remove(),x.append("defs");const k=x.append("g").attr("role","grid"),y=x.append("g").attr("role","container"),g=k.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(r),S=k.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),b=Ft().scaleExtent([-10,40]).filter(w=>(w.preventDefault(),(!w.ctrlKey||w.type==="wheel")&&!w.button)).on("zoom",({transform:w})=>{y.attr("transform",w),g.call(r.scale(w.rescaleX(o))),S.call(i.scale(w.rescaleY(n)))});x.call(b);const j=Wt(f.nodes).force("links",Ht(f.links).id(w=>w.id).distance(300).strength(1)).force("charge",Yt().strength(w=>w.strength)).force("colide",qt(w=>w.radius)),L=y.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(f.links).join(w=>w.append("g").attr("role","link").attr("id",T=>T.id).call(d),w=>w,w=>w.remove()),v=y.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(f.nodes).join(w=>w.append("g").attr("role","node").attr("id",T=>T.id).call(c(j)).call(l),w=>w.select("circle").attr("cx",T=>T.x).attr("cy",T=>T.y),w=>w.remove());j.on("tick",()=>{v.attr("transform",w=>`translate(${w.x}, ${w.y})`),L.selectAll("line").attr("x1",w=>w.source.x).attr("y1",w=>w.source.y).attr("x2",w=>w.target.x).attr("y2",w=>w.target.y)}),j.alpha(1)})}return{render(x,f){Bt(f).datum(x).call(p)}}},ho=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=R("Layout"),s=u.useRef(null),o=u.useRef(null),n=t(o),r=de(e,d=>d),i=u.useMemo(()=>!r.state||!r.state.nodes?{nodes:[],links:[]}:{nodes:Object.values(r.state.nodes).map(d=>({id:d.id,group:d.type,nodeLabel:d?.label||d.id,strength:-400,x:d.position.x,y:d.position.y,radius:50})),links:Object.values(r.state.edges).map(d=>({id:d.id,type:d.type,source:d.sourceId,target:d.targetId,value:5}))},[r]),l=ss(),c=fo({nodeBorder:l.palette.getContrastText(l.palette.background.default),width:n?.width??0,height:n?.height??0});return u.useEffect(()=>{!n||!s.current||c.render(i,s.current)},[i,n]),r.state?a.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:a.jsx("svg",{ref:s,id:`${r.id}`,width:"100%",height:"100%"})}):a.jsx(a.Fragment,{})},mt=D.memo(ho),mo=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(E,co.reducer),e.functions.registerMiddleware(Se),e.functions.registerMiddleware(N),t.functions.createRegistries({[ve]:{},[I]:{graph:mt}})},xo=()=>{const e=nt();return{functions:{createGraph(t){return e(be({graphId:t})),{id:t,state:{id:t,...Me},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ne({graphId:t,node:n,edges:o??lt}))},removeNode:s=>{e(re({graphId:t,nodeId:s}))},updateNode:s=>{e(ae({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(ie({graphId:t,edge:s}))},removeEdge:s=>{e(ce({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(it({graphId:t}))}}}},yo=(e,t)=>{const o=t??(n=>n);return A(n=>n.Graph,n=>n&&o(n.graphs[e]))},wo=(e,t)=>{const s=R("Graph"),{useGraph:o}=s.hooks,n=o(e,l=>l?.nodes[t]),r=o(e,l=>l?.adjacencyList[t]),i=o(e,l=>Object.values(l?.edges??{}).filter(c=>r.state?.inputs?.includes(c.id)||r.state?.outputs?.includes(c.id)).reduce((c,d)=>({...c,[d.id]:d}),{}));return{node:n.state,edges:i.state??{},adjacencyList:r.state??{inputs:[],outputs:[]}}},xt=(e,t)=>de(e,o=>o?.searchResults&&o.searchResults[t]).state,Co=(e,t,s)=>{u.useEffect(()=>{s()},[]);const o=xt(e,t);return u.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},Xe={name:E,version:Qs,depends_on:["Store"],components:{GraphViewer:mt},managers:{graphs:xo},hooks:{useGraph:de,useNodeInfo:wo,useSearch:Co,useSearchResult:xt},store:{selectors:{getGraphState:yo}},kernelCalls:{startModule:mo,restartModule(){},shutdownModule(){}}},le=h(`[${C}:Theme:${m.COMMAND}] Switch theme`),Mo=h(`[${C}:Theme:${m.EVENT}] Theme switched`),yt=G();yt.startListening({actionCreator:le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Mo(e))}});const $e=h(`[${C}:Ribbon:${m.COMMAND}] Add tab`),je=h(`[${C}:Ribbon:${m.COMMAND}] Select tab`),bo=h(`[${C}:Ribbon:${m.EVENT}] tab added`),So=h(`[${C}:Ribbon:${m.EVENT}] tab selected`),Ee=G();Ee.startListening({actionCreator:$e,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(bo({tab:n[e.name]}))}});Ee.startListening({actionCreator:je,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(So({tab:n[e]}))}});const ke=h(`[${C}:Viewports:${m.COMMAND}] Add viewport`),Re=h(`[${C}:Viewports:${m.COMMAND}] Select viewport`),Ve=h(`[${C}:Viewports:${m.COMMAND}] Close viewport`),wt=h(`[${C}:Viewports:${m.COMMAND}] Rename viewport`),Ae=h(`[${C}:Viewports:${m.COMMAND}] Add viewport to group`),ye=h(`[${C}:Viewports:${m.COMMAND}] Viewport removed from group`),vo=h(`[${C}:Viewports:${m.EVENT}] Viewport added`),$o=h(`[${C}:Viewports:${m.EVENT}] Viewport selected`),jo=h(`[${C}:Viewports:${m.EVENT}] Viewport closed`);h(`[${C}:Viewports:${m.EVENT}] Viewport renamed`);const Eo=h(`[${C}:Viewports:${m.EVENT}] Viewport added to group`);h(`[${C}:Viewports:${m.EVENT}] Viewport removed from group`);const U=G();U.startListening({actionCreator:ke,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(vo(n[e]))}});U.startListening({actionCreator:Re,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s($o(n[e]))}});U.startListening({actionCreator:Ve,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(jo({name:e}))}});U.startListening({actionCreator:Ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Eo(e))}});U.startListening({actionCreator:ye,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ye(e))}});const Le=h(`[${C}:Viewports:${m.COMMAND}] Create group`),ko=h(`[${C}:Viewports:${m.EVENT}] Group created`),Ct=G();Ct.startListening({actionCreator:Le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ko(e))}});const De=h(`[${C}:Panels:${m.COMMAND}] Expand settings panel`),Te=h(`[${C}:Panels:${m.COMMAND}] Collapse settings panel`),Oe=h(`[${C}:Panels:${m.COMMAND}] Open details panel`),Ne=h(`[${C}:Panels:${m.COMMAND}] Close details panel`),Ro=h(`[${C}:Panels:${m.EVENT}] Settings panel expanded`),Vo=h(`[${C}:Panels:${m.EVENT}] Settings panel collapsed`),Ao=h(`[${C}:Panels:${m.EVENT}] Details panel opened`),Lo=h(`[${C}:Panels:${m.EVENT}] Details panel closed`),H=G();H.startListening({actionCreator:De,effect:async(e,t)=>{const{dispatch:s}=t;s(Ro())}});H.startListening({actionCreator:Te,effect:async(e,t)=>{const{dispatch:s}=t;s(Vo())}});H.startListening({actionCreator:Oe,effect:async(e,t)=>{const{dispatch:s}=t;s(Ao())}});H.startListening({actionCreator:Ne,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(Lo({viewportName:n}))}});const Do=O({name:`${C}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(Le,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),To=O({name:`${C}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(ke,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(Ve,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,r])=>n===s.name?o:{...o,[n]:r},{})})),e.addCase(Re,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(wt,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[r,i])=>r===s?{...n,[s]:{...i,title:o}}:{...n,[r]:i},{})})),e.addCase(Ae,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(ye,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:Do.reducer(t.groups,s)}))}}),Oo=O({name:`${C}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase($e,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(je,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),Mt={settings:{state:"expanded"},details:{state:"closed"}},No=O({name:C,initialState:Mt,reducers:{},extraReducers:e=>{e.addCase(De,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Te,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(Oe,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(Ne,t=>({...t,details:{...t.details,state:"closed"}}))}}),Go={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:Mt,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Po=O({name:C,initialState:Go,reducers:{},extraReducers:e=>{e.addCase(le,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:No.reducer(t.panels,s),ribbonMenu:Oo.reducer(t.ribbonMenu,s),viewportManager:To.reducer(t.viewportManager,s)}))}}),Q=({name:e,icon:t,summary:s,expanded:o,state:n,children:r,sx:i,...l})=>{const c=Ze("(min-width:1024px)");return n==="collapsed"?a.jsx(os,{children:t??a.jsx(Ye,{})}):a.jsxs(ns,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...l,children:[a.jsx(rs,{expandIcon:a.jsx(as,{}),"aria-controls":`accordion-${e}-content`,children:a.jsxs($,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??a.jsx(Ye,{}),a.jsx(Z,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&c&&a.jsx(Z,{component:"div",sx:{color:"text.secondary"},children:s})]})}),a.jsx(is,{children:r})]})};function Ge(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(De())},collapseSettings(){s(Te())},openDetails(){s(Oe())},closeDetails(){s(Ne())}}}}A(e=>e.Layout,e=>e&&e.panels);const _o=A(e=>e.Layout,e=>e&&e.panels.settings),Io=A(e=>e.Layout,e=>e&&e.panels.details),bt=({title:e,display:t,children:s})=>{const o=document.getElementById(ft),n=Ze("(orientation: portrait)"),r=R("Store"),{useAppSelector:i}=r.hooks,l=Ge(),c=i(Io),d=u.useCallback(p=>{p.stopPropagation(),c&&c.state==="opened"&&l.functions.closeDetails()},[c?.state]);return!o||!c?null:we.createPortal(a.jsxs($,{role:"details-panel","aria-label":"details panel",display:c.state==="opened"?"flex":"none",sx:{flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},children:[a.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!n&&a.jsx(_,{size:"small",component:"span",onClick:d,children:c.state==="opened"&&a.jsx(J,{})}),a.jsx("span",{children:e??"Detalhes"})]}),a.jsx($,{role:"panel-content",children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),o)},St=({title:e,children:t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=Ge(),r=o(_o),i=document.getElementById(gt),l=u.useCallback(c=>{c.stopPropagation(),r&&r.state==="collapsed"&&n.functions.expandSettings(),r&&r.state==="expanded"&&n.functions.collapseSettings()},[r?.state]);return!i||!r?null:we.createPortal(a.jsx($,{sx:{position:"relative"},children:a.jsxs($,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:r.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:r.state==="collapsed"?"8vw":"100%"}},children:[a.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.state==="expanded"&&a.jsxs(a.Fragment,{children:[a.jsx(cs,{}),a.jsx("span",{children:e??"Configurações"})]}),a.jsx(_,{size:"small",component:"span",onClick:l,children:r.state==="collapsed"?a.jsx(ds,{sx:{transform:"rotate(90deg)"}}):a.jsx(ls,{sx:{transform:"rotate(90deg)"}})})]}),a.jsx($,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:r.state==="collapsed"?2:0,marginTop:4},children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:t.map((c,d)=>u.cloneElement(c,{state:r.state,key:d}))})})]})}),i)},Uo=({name:e,title:t,type:s,group:o})=>a.jsxs(a.Fragment,{children:[a.jsxs(St,{children:[a.jsx(Q,{name:"Agenda",icon:a.jsx(us,{}),expanded:!0,children:a.jsx(a.Fragment,{})}),a.jsx(Q,{name:"Recebimentos",summary:"Recebimentos do mês",children:a.jsx(a.Fragment,{})}),a.jsx(Q,{name:"Andamento",summary:"Pedidos em produção",children:a.jsx(a.Fragment,{})})]}),a.jsx(bt,{children:a.jsx(a.Fragment,{children:"Detalhes"})})]}),zo=D.memo(Uo),Bo=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(C,Po.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(le({theme:"dark"})),t.functions.registerMiddleware(yt),t.functions.registerMiddleware(Ee),t.functions.registerMiddleware(U),t.functions.registerMiddleware(Ct),t.functions.registerMiddleware(H),s.functions.createRegistries({[ve]:{},[I]:{home:zo}})};function vt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(le({theme:o}))}}}}const $t=u.createContext({sections:{},setSections:()=>null}),Fo=({children:e,default_sections:t})=>{const[s,o]=u.useState(t??{});function n(i,l){o({...s,[i]:l})}const r=u.useMemo(()=>({sections:s,setSections:n}),[s]);return a.jsx($t.Provider,{value:r,children:e})},jt=e=>e&&e.Layout?.ribbonMenu,Et=A(jt,e=>e&&e.tabs),Wo=A(jt,e=>e&&e.activeTab);function kt(){const e=R("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),r=t(Et);return u.useContext($t),o(),{functions:{tabExists(i){return r!=null&&i in r},addNewTab(i){const l=ee.uniqueId("tab-"),c={...i,name:l,active:!1};n($e({tab:c}))},selectTab(i){n(je({name:i}))}}}}function Rt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(r){n.functions.registerComponents({[I]:r})},getViewportTypeComponent(r){const i=n.functions.getComponent(I,r);if(!i)throw Error("Unknown viewport type");return i},addViewport(r,i,l,c="viewport"){if(!n.functions.getComponent(I,i))throw Error("Unknown viewport type");const p=ee.uniqueId(c);return o(ke({name:p,title:r,type:i,group:l})),p},renameViewport(r,i){o(wt({oldName:r,newName:i}))},selectViewport(r){o(Re({name:r}))},closeViewport(r){o(Ve({name:r}))},createGroup(r,i){o(Le({name:r,color:i}))},addToGroup(r,i){o(Ae({viewportName:r,groupName:i}))}}}}const Pe=A(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Vt=e=>e.Layout.viewportManager,Ho=A(Vt,e=>e&&e.viewports),At=(e,t)=>{const o=t??(n=>n);return A(Vt,n=>n&&o(n.viewports[e]))},Yo=({children:e})=>{const t=document.getElementById(ht);return t?we.createPortal(a.jsx($,{sx:{position:"relative"},children:e}),t):null},qo=({title:e,component:t,children:s,sx:o={}})=>{const[n,r]=u.useState(!1),i=u.useCallback(c=>{r(!0),c.stopPropagation()},[]),l=u.useCallback(()=>{r(!1)},[]);return a.jsxs(a.Fragment,{children:[a.jsx(Je,{open:n,onClose:l,components:{Backdrop:void 0},children:a.jsxs(et,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&a.jsx(Z,{variant:"subtitle1",component:"span",children:e}),D.cloneElement(t,{closeModal:l})]})}),a.jsx($,{onClick:i,children:s})]})},_e=u.createContext({rows:[],setRows:()=>null}),Xo=({children:e,initialRows:t})=>{const[s,o]=u.useState((t??[]).map(r=>({...r,state:"untouched"}))),n=u.useMemo(()=>({rows:s,setRows:o}),[s]);return a.jsx(_e.Provider,{value:n,children:e})},ge=(e,t)=>t==="dark"?se(e,.7):oe(e,.7),fe=(e,t)=>t==="dark"?se(e,.6):oe(e,.6),he=(e,t)=>t==="dark"?se(e,.5):oe(e,.5),me=(e,t)=>t==="dark"?se(e,.4):oe(e,.4),Ko=ps(gs)(({theme:e})=>({"& .state--added":{backgroundColor:ge(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:he(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:ge(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:he(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:ge(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:he(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.error.main,e.palette.mode)}}}})),Qo=()=>a.jsx($,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:a.jsx(Z,{variant:"body2",children:"Sem registros"})}),Zo=({handleAddRecord:e,addLabel:t})=>a.jsxs(ws,{sx:{display:"flex",justifyContent:"space-around"},children:[a.jsx(Cs,{startIcon:a.jsx(Ms,{}),onPointerUp:e,children:t||"Adicionar"}),a.jsxs("div",{children:[a.jsx(bs,{}),a.jsx(Ss,{})]})]}),Jo=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:r}=u.useContext(_e),[i,l]=u.useState({}),c=()=>{const g=s();r(S=>[...S,{...g,state:"added"}]),l(S=>({...S,[g.id]:{mode:z.Edit,fieldToFocus:"id"}}))},d=u.useCallback(g=>()=>{l(S=>({...S,[g]:{mode:z.Edit}}))},[]),p=g=>(r(S=>S.map(b=>b.id===g.id?{...g,old:{...b,old:null}}:b)),g),x=(g,S)=>{g.reason===vs.rowFocusOut&&(S.defaultMuiPrevented=!0)},f=u.useCallback(g=>{const S=n.find(j=>j.id===g);if(!S)return;const b=S.state==="untouched"?"modified":S.state;r(j=>j.map(L=>L.id===g?{...L,state:b}:L)),l(j=>({...j,[g]:{mode:z.View}}))},[n]),M=u.useCallback(g=>()=>{r(S=>S.map(b=>b.id===g?{...b,state:"deleted",oldState:b.state}:b).filter(b=>!(b.state==="deleted"&&b?.oldState==="added")))},[]),k=u.useCallback(g=>()=>{r(S=>S.map(b=>b.id===g?{...b,state:b.oldState,oldState:"deleted"}:b))},[]),y=u.useCallback(g=>()=>{l(b=>({...b,[g]:{mode:z.View,ignoreModifications:!0}}));const S=n.find(b=>b.id===g);S&&S.state==="added"&&r(b=>b.filter(j=>j.id!==g))},[n]);return a.jsx(a.Fragment,{children:a.jsx(Ko,{editMode:"row",density:"compact",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:x,processRowUpdate:p,slotProps:{toolbar:{handleAddRecord:c,addLabel:t}},slots:{noRowsOverlay:Qo,toolbar:Zo},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",flex:2,minWidth:80,maxWidth:200,cellClassName:"actions",getActions:({id:g})=>{const S=n.find(j=>j.id===g);return S?i[g]?.mode===z.Edit?[a.jsx(B,{icon:a.jsx(fs,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>f(g)},"save"),a.jsx(B,{icon:a.jsx(hs,{}),label:"Cancel",className:"textPrimary",onClick:y(g),color:"inherit"},"cancel")]:S.state==="deleted"?[a.jsx(B,{icon:a.jsx(ms,{}),label:"Restore",className:"textPrimary",onClick:k(g),color:"inherit"},"restore")]:[a.jsx(B,{icon:a.jsx(xs,{}),label:"Edit",className:"textPrimary",onClick:d(g),color:"inherit"},"edit"),a.jsx(B,{icon:a.jsx(ys,{}),label:"Delete",onClick:M(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})})};function en({id:e,value:t,field:s}){const o=$s(),n=r=>{const i=r.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return a.jsx(js,{checked:t,onChange:n})}const tn=e=>{const[t,s]=u.useState();return u.useEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(r=>{r.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},Lt={name:C,version:po,depends_on:[],components:{SettingsPanel:St,DetailsPanel:bt,ViewportNotificationsTray:Yo,Accordion:Q,SystemModal:qo,CRUDGrid:Jo,CRUDBooleanCell:en,CRUDGridProvider:Xo},contexts:{CRUDGridContext:_e},hooks:{useLayoutManager:vt,useRibbonMenuManager:kt,useViewportManager:Rt,usePanelsManager:Ge,useResizeObserver:tn},store:{selectors:{selectActiveViewport:Pe,getViewportState:At}},kernelCalls:{startModule:Bo,restartModule(){},shutdownModule(){}}},Y="Loader",sn="0.0.1",W="modules",Dt=h(`[${Y}:${m.EVENT}] Module started`),on=h(`[${Y}:${m.COMMAND}] Start module`),nn={modulesCount:1,modulesGraph:W},rn=O({name:Y,initialState:nn,reducers:{},extraReducers:e=>{e.addCase(Dt,t=>(t.modulesCount+=1,t))}}),an=({managers:{storeManager:e}})=>{e.functions.loadReducer(Y,rn.reducer)};class Ke extends Error{}class cn extends Error{}const dn=e=>e.modulesCount,ln=()=>{const{modules:e,setModules:t}=u.useContext(Ce),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=Lt.hooks,{store:r,componentRegistry:i}=K.managers,l=s(),c=o(),d=n(),p=r(),x=i(),f=K.hooks.useAppDispatch(),M=K.hooks.useAppSelector;return{modulesLoaded:M(dn),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new cn(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),f(on(g.name)),g.kernelCalls.startModule({dispatch:f,managers:{storeManager:p,componentRegistryManager:x,layoutManager:l,ribbonMenuManager:c,viewportManager:d}}),f(Dt(g.name))},unloadModule(g){if(!(g in e))throw new Ke(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(p),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new Ke(`${g} is not registered.`);const S=e[g];t(e),S.kernelCalls.restartModule(p)}}}},Qe={name:Y,version:sn,depends_on:["Store","Graph"],managers:{modules:ln},kernelCalls:{startModule:an,restartModule:()=>null,shutdownModule:()=>null}},un=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=Qe.managers.modules(),o=de(W,v=>v&&v.id),[n,r]=u.useState(!0),[i,l]=u.useState(!1),[c,d]=u.useState(0),[p,x]=u.useState(0),[f,M]=u.useState(0),k=u.useMemo(()=>[Qe,Xe,Lt],[]),y=Xe.managers.graphs(),{createGraph:g,resetGraph:S}=y.functions;u.useEffect(()=>{const v=k[c];v&&!s.functions.isModuleLoaded(v.name)&&b(v)},[c]),u.useEffect(()=>{if(c===k.length){const v=t.kernel[p];v&&!s.functions.isModuleLoaded(v.name)&&j(v)}},[c,p]),u.useEffect(()=>{if(p===t.kernel.length){const v=t.system[f];v&&!s.functions.isModuleLoaded(v.name)&&L(v)}},[p,f]),u.useEffect(()=>{f===t.system.length&&r(!1)},[f]),u.useEffect(()=>{!n&&!o.state&&(g(W),l(!0))},[n]),u.useEffect(()=>{if(i&&!o.state&&g(W),!i)return;S(W);const v={id:"root",type:"ROOT"};o.actions.addNode(v),k.forEach(w=>o.actions.addNode({id:w.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${w.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:w.name}},outputs:{}})),t.kernel.forEach(w=>{w.depends_on.push("Loader");const T=w.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${w.name}`,type:"DEPENDS_ON",sourceId:P,targedId:w.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:w.name,type:"EXTRA_KERNEL_MODULE"},{inputs:T,outputs:{}})}),t.system.forEach(w=>{w.depends_on.push("Loader");const T=w.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${w.name}`,type:"DEPENDS_ON",sourceId:P,targedId:w.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:w.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:T,outputs:{}})}),r(!1)},[i]);function b(v){s.functions.loadModule(v),d(c+1)}function j(v){s.functions.loadModule(v),x(p+1)}function L(v){s.functions.loadModule(v),M(f+1)}return n?a.jsx("div",{children:"Iniciando sistema"}):e},pn=({children:e,loadModules:t})=>{const[s,o]=u.useState({Store:K}),n=u.useMemo(()=>({modules:s,setModules:o}),[s]);return a.jsx(Ce.Provider,{value:n,children:a.jsx(un,{extraModules:t,afterLoadComponent:e})})},gn=D.memo(pn),fn={},X=O({name:st,initialState:fn,reducers:{},extraReducers:e=>{}}),hn=({children:e,default_registries:t})=>{const[s,o]=u.useState(t??{}),n=u.useMemo(()=>({registries:s,createRegistry:r,createRegistries:i,getComponent:l,registerComponents:c}),[s]);function r(d){o({...s,[d]:{}})}function i(d){o({...s,...d})}function l(d,p){return s[d][p]}function c(d){const p=s,x=Object.entries(d).reduce((f,[M,k])=>M in f?{...f,[M]:{...f[M],...k}}:f,p);o(x)}return a.jsx(rt.Provider,{value:n,children:e})},mn=({children:e})=>{const[t,s]=u.useState({[X.name]:X.reducer}),o=u.useMemo(()=>Kt({reducer:He({[X.name]:X.reducer}),middleware:i=>i({serializableCheck:!1}).concat(Qt)}),[]),n=i=>{Jt(i.middleware)},r=u.useCallback(i=>{const l={...t,...i};s(l),o.replaceReducer(He(l))},[t]);return a.jsx(Zt,{store:o,children:a.jsx(ot.Provider,{value:{currentReducers:t,loadReducers:r,registerMiddleware:n},children:a.jsx(hn,{children:e})})})},xn=D.memo(mn),Tt=A(e=>e.Layout,e=>e&&e.theme),yn=({systemTray:e})=>{const t=R("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),r=kt(),{selectTab:i}=r.functions,l=s(Et),c=s(Wo),d=u.useCallback(p=>{i(p)},[]);return!c||!l?a.jsx(a.Fragment,{}):a.jsxs(Es,{value:c,children:[a.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[a.jsx(tt,{value:c,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(l).map(([p,x])=>a.jsx(F,{value:p,label:x.label,id:p,onClick:()=>d(p),wrapped:!0},p))}),a.jsx($,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),a.jsx($,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:l&&Object.entries(l).map(([p,x])=>a.jsx(ks,{value:p,children:x.sectionNames&&x.sectionNames.map(f=>{const M=n.functions.getComponent(ve,f);return u.createElement(M,{key:`ribbon-panel-${p}-section-${f}`},[])})},`ribbon-panel-${p}`))})]})},wn=({children:e,...t})=>{const s=u.useMemo(()=>({file:[a.jsx("div",{children:"test"},"test")]}),[]);return a.jsx(Fo,{default_sections:s,children:a.jsx(yn,{...t,systemTray:e})})},Cn=D.memo(wn),Mn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Pe),n=t(At(o));if(!n)return null;const r=s.functions.getComponent(I,n.type);return r?a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:D.createElement(r,n,[])}):null},bn=A(e=>e.Layout.viewportManager,e=>e&&e.groups),Sn=({sx:e,...t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=o(bn),r=o(Pe),i=o(Ho),l=u.useMemo(()=>Object.entries(i).reduce((M,[k,y])=>k==="home"?M:y.group?{...M,[y.group]:y.group in M?[...M[y.group],y]:[y]}:{...M,notGrouped:[...M.notGrouped,y]},{notGrouped:[]}),[i]),{functions:{addViewport:c,closeViewport:d,selectViewport:p}}=Rt(),x=u.useCallback(()=>{c("Nova aba","home",void 0,"new-")},[]),f=u.useCallback(M=>{d(M)},[]);return a.jsxs($,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[a.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsxs(tt,{value:r,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[a.jsx(F,{value:"home",icon:a.jsx(Rs,{}),iconPosition:"start",onClick:()=>p("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(l).map(([M,k])=>M==="notGrouped"?k.map(y=>a.jsx(F,{value:y.name,id:y.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?p(y.name):f(y.name),label:a.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{children:y.title}),a.jsx(J,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),f(y.name)}})]}),draggable:!0,wrapped:!0},`${y.name}-tab`)):k.map(y=>a.jsx(F,{value:y.name,id:y.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[y.group].color},onClick:()=>p(y.name),label:a.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{children:y.title}),a.jsx(_,{size:"small",component:"span",children:a.jsx(J,{sx:{width:.5,marginLeft:1},onClick:g=>{g.stopPropagation(),f(y.name)}})})]}),draggable:"true",wrapped:!0},`${y.name}-tab`))),a.jsx(F,{value:"new",icon:a.jsx(Vs,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:x,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),a.jsx($,{id:ht,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),a.jsx($,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:a.jsx(Mn,{})})]})},vn=D.memo(Sn),$n=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Tt),o=vt(),n=u.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return a.jsx($,{role:"system-tray-container",children:a.jsx(_,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?a.jsx(As,{fontSize:"small"}):a.jsx(Ls,{fontSize:"small"})})})},jn=D.memo($n),En=Ds($)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,kn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Tt),o=u.useMemo(()=>Ts({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return a.jsxs(Os,{theme:o,children:[a.jsx(Ns,{}),a.jsx($,{role:"layout-root",sx:{minHeight:"100vh"},children:a.jsxs(En,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[a.jsx($,{sx:{gridArea:"ribbon",width:"100%"},children:a.jsx(Cn,{children:a.jsx(jn,{})})}),a.jsx($,{id:gt,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),a.jsx(vn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),a.jsx($,{id:ft,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},Rn=D.memo(kn),Vn=e=>e.SVG,An=e=>A(Vn,t=>t&&t.svgs[e]),Ln=({path:e,instanceName:t,beforeInjection:s})=>{const o=R("Store"),{useAppSelector:n}=o.hooks,r=n(An(e)),i=u.useCallback(c=>{if(c.setAttribute("id",`${e}-root`),c.setAttribute("width","100%"),c.setAttribute("height","100%"),t){if(!r?.instances[t])return;Object.entries(r?.instances[t].proxies??{}).forEach(([p,x])=>{const f=c.getElementById(p);f&&("fill"in x&&f.setAttribute("fill",x.fill),"stroke"in x&&f.setAttribute("stroke",x.stroke))})}s&&s(c)},[s,r?.content,t,r?.instances[t]]),l=u.useMemo(()=>r?.content&&window.URL.createObjectURL(new Blob([r.content],{type:"image/svg+xml"})),[r?.content]);return!r||!l?null:a.jsx($,{role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{width:"100%",height:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:a.jsx(es,{style:{width:"100%",overflow:"hidden"},src:l,height:"100%",width:"100%",beforeInjection:i})})},V="SVG",Dn="0.0.1",Ie=h(`[${V}:SVG:${m.COMMAND}] Load SVG`),Ot=h(`[${V}:SVG:${m.COMMAND}] Fetch SVG`),Nt=h(`[${V}:SVG:${m.COMMAND}] Set pan`),Gt=h(`[${V}:SVG:${m.COMMAND}] Set zoom`),Pt=h(`[${V}:SVG:${m.COMMAND}] Add proxy`),Ue=h(`[${V}:SVG:${m.COMMAND}] Update proxy`),ze=h(`[${V}:SVG:${m.COMMAND}] Delete proxy`),Be=h(`[${V}:SVG:${m.EVENT}] SVG fetched`),Tn=h(`[${V}:SVG:${m.EVENT}] SVG loaded`);h(`[${V}:SVG:${m.COMMAND}] Proxy added`);const On=h(`[${V}:SVG:${m.COMMAND}] Proxy updated`),Nn=h(`[${V}:SVG:${m.COMMAND}] Proxy deleted`),Gn=(e,t)=>{const s=R("Store"),{useAppDispatch:o}=s.hooks,n=o(),r=s.hooks.useAppSelector,i=A(c=>c&&c.SVG.svgs[e],t);return{state:r(i),actions:{setPan(c,d,p){n(Nt({path:e,instanceName:c,x:d*-10,y:p*-10}))},setZoom(c,d){n(Gt({path:e,instanceName:c,zoom:d}))},addProxy(c,d,p){n(Pt({path:e,instanceName:d,id:c,styles:p}))},deleteProxy(c,d){n(ze({path:e,instanceName:d,id:c}))},updateProxy(c,d,p){n(Ue({path:e,instanceName:d,id:c,changes:p}))}}}},Pn=()=>{const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(Ie({path:o,instanceName:n}))}}}},q=G();q.startListening({actionCreator:Ie,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Ot({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Be({path:e.path,content:n}))}});q.startListening({actionCreator:Be,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(Tn(n[e.path]))}});q.startListening({actionCreator:Ue,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(On(n[e.path].instances[e.instanceName].proxies))}});q.startListening({actionCreator:ze,effect:async({payload:e},{dispatch:t})=>{t(Nn(e))}});const _n={progress:"not-started",instances:{},content:void 0},In={svgs:{}},Un=O({name:V,initialState:In,reducers:{},extraReducers:e=>{e.addCase(Ie,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!ee.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,..._n,instances:n}}}}),e.addCase(Ot,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(Be,(t,{payload:{path:s,content:o}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(Pt,(t,{payload:{path:s,instanceName:o,id:n,styles:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:r}:{[n]:r}}}}}})),e.addCase(Gt,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(Nt,(t,{payload:{path:s,instanceName:o,x:n,y:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,r]}}}}})),e.addCase(Ue,(t,{payload:{path:s,instanceName:o,id:n,changes:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...r}:r}}}}}})),e.addCase(ze,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((r,[i,l])=>i===n?r:{...r,[i]:l},{})}}}}}))}}),zn=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(V,Un.reducer),e.functions.registerMiddleware(q)},Bn={name:V,version:Dn,depends_on:[],components:{SVGViewer:Ln},hooks:{useSVGManager:Pn,useSVG:Gn},kernelCalls:{startModule:zn,restartModule(){},shutdownModule(){}}},Fn=({initialPosition:e})=>{const[t,s]=u.useState(!1),[o,n]=u.useState({x:0,y:0}),[r,i]=u.useState(e),l=u.useCallback(p=>{s(!0),n({x:p.clientX,y:p.clientY}),p.stopPropagation()},[]),c=u.useCallback(p=>{if(!t)return;const x={x:p.clientX-o.x,y:p.clientY-o.y},f={x:r.x+x.x,y:r.y+x.y};i(f)},[t]),d=u.useCallback(p=>{s(!1),p.stopPropagation()},[]);return{position:r,setPosition:i,listeners:{onPointerDown:l,onPointerMove:c,onPointerUp:d}}},Wn=({children:e,component:t,actions:s,onClose:o})=>{const[n,r]=u.useState(!1),[i,l]=u.useState(!0),{innerWidth:c,innerHeight:d}=window,p=[c/2,d/2],{position:x,setPosition:f,listeners:M}=Fn({initialPosition:{x:p[0],y:p[1]}}),k=u.useCallback((j,L)=>{const v=j-p[0],w=L-p[1];return v<0?w<0?1:3:w<0?2:4},[p]),y=u.useMemo(()=>k(x.x,x.y),[x]),g=u.useRef(null);u.useEffect(()=>{if(n&&i&&g.current){const{clientWidth:j,clientHeight:L}=g.current;y%2==0?f(v=>({x:v.x-j,y:v.y-L})):y>2&&f(v=>({x:v.x,y:v.y-L})),l(!1)}n||l(!0)},[n,g.current]);const S=u.useCallback(j=>{r(!0),f({x:j.clientX,y:j.clientY}),j.stopPropagation()},[]),b=u.useCallback(j=>{r(!1),j.stopPropagation(),o?.(j)},[]);return a.jsxs(a.Fragment,{children:[a.jsx(Je,{open:n,keepMounted:!0,onClose:b,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...M,children:a.jsx(et,{sx:{position:"fixed",margin:1,left:x.x,top:x.y},elevation:6,children:a.jsxs($,{ref:g,sx:{display:"flex",flexGrow:1,flexDirection:y%2==1?"row":"row-reverse"},children:[a.jsxs($,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",padding:0,flexGrow:2,justifyContent:"space-evenly",alignContent:"space-evenly",borderLeft:`1px solid rgba(0,0,0, ${y%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${y%2==1?.1:0})`},children:[a.jsx(_,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:a.jsx(Gs,{})}),s.map(j=>u.cloneElement(j,{sx:{flexGrow:"inherit"},size:"small",closeContainer:b})),a.jsx(_,{color:"error",onClick:b,size:"small",id:"close-panel",children:a.jsx(J,{})},"reject")]}),a.jsx($,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:D.cloneElement(t,{isOpen:n})})})]})})}),u.cloneElement(e,{onClick:S})]})},Hn=({gestures:e,children:t})=>{const s=u.useRef(null),n=ts(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return a.jsx($,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},Fe="Pointer",Yn="0.0.1",qn={},Xn=O({name:Fe,initialState:qn,reducers:{},extraReducers:e=>{}}),Kn=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(Fe,Xn.reducer),console.info("Pointer module started"),console.groupEnd()},Qn=({closeContainer:e,handleConfirm:t,...s})=>u.createElement(_,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},a.jsx(Ps,{})),Zn={name:Fe,version:Yn,depends_on:[],components:{MultiTouchPanel:Hn,PointerContainer:Wn,ConfirmAndCloseButton:Qn},hooks:{},store:{},kernelCalls:{startModule:Kn,restartModule(){},shutdownModule(){}}},nr=()=>{Hs({onRegistered(s){s&&setInterval(()=>{s.update()},36e5)}});const t={kernel:[Bn,Zn],system:[_s,Is,Us]};return a.jsx(xn,{children:a.jsx(gn,{loadModules:t,children:a.jsx(Rn,{})})})};export{m as A,Tn as S,Pt as a,ne as b,Ve as c,pt as d,Ue as e,ae as f,ie as g,ce as h,Lo as i,dt as j,re as k,at as l,ze as m,Ie as n,nr as o,ye as r,R as u};
