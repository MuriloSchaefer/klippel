import{r as g,u as Cs,a as ks,R as _,c as m,b as N,_ as $e,d as I,e as X,l as Z,f as Ue,g as Be,s as Ee,z as We,h as Ss,i as vs,j as $s,k as Es,m as js,n as Xe,o as i,p as Rt,S as As,q as St,M as Rs,A as Vs,t as Ds,B as A,T as Se,v as Ls,w as Ye,I as Q,x as ve,E as je,y as Os,C as Gs,D as Ts,F as Ns,G as Vt,P as Dt,H as Ps,J as _s,K as Ae,L as Re,N as ce,O as de,Q as Is,U as zs,V as Fs,W as Us,X as Bs,Y as Ws,Z as Xs,$ as Ys,a0 as qs,a1 as Hs,a2 as Ks,a3 as Zs,a4 as Qs,a5 as Js,a6 as eo,a7 as to,a8 as so,a9 as vt,aa as oo,ab as no,ac as ro,ad as ao,ae as Lt,af as le,ag as io,ah as co,ai as lo,aj as uo,ak as po,al as go,am as ho,an as fo,ao as mo,ap as Ot,aq as xo,ar as wo,as as yo,at as Mo,au as bo,av as $t,aw as Co,ax as ko,ay as So,az as vo,aA as $o,aB as Eo,aC as jo,aD as Ao,aE as Gt,aF as Tt}from"./vendor-e4518210.js";const Nt="Store",Ro="0.0.1",Pt=g.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),Vo=()=>{const{loadReducers:e,registerMiddleware:t}=g.useContext(Pt);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},_t=()=>Cs(),Do=ks,It=g.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>_.memo(()=>null),registerComponents:()=>null}),Lo=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=g.useContext(It);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},Ce={name:Nt,version:Ro,depends_on:[],managers:{store:Vo,componentRegistry:Lo},hooks:{useAppDispatch:_t,useAppSelector:Do},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},qe=g.createContext({modules:{},setModules:()=>null}),x={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},D="Graph",Oo="0.0.1",Go=m(`[${D}:Instance:${x.EVENT}] Graph loaded`),To=m(`[${D}:Instance:${x.EVENT}] Node added`),No=m(`[${D}:Instance:${x.EVENT}] Node removed`),Po=m(`[${D}:Instance:${x.EVENT}] Node updated`),_o=m(`[${D}:Instance:${x.EVENT}] Edge added`),Io=m(`[${D}:Instance:${x.EVENT}] Edge removed`),ze=m(`[${D}:Instance:${x.EVENT}] Search finished`),zo=m(`[${D}:Instance:${x.EVENT}] Search invalidated`),zt=m(`[${D}:Instance:${x.COMMAND}] Load Graph`),Ft=m(`[${D}:Instance:${x.COMMAND}] Reset Graph`),Ve=m(`[${D}:Instance:${x.COMMAND}] Add node`),De=m(`[${D}:Instance:${x.COMMAND}] Remove node`),Le=m(`[${D}:Instance:${x.COMMAND}] Update node`),ge=m(`[${D}:Instance:${x.COMMAND}] Add edge`),he=m(`[${D}:Instance:${x.COMMAND}] Remove edge`),Ut=m(`[${D}:Instance:${x.COMMAND}] Search`),Bt=m(`[${D}:Instance:${x.COMMAND}] Invalidate Search`),L=e=>{const{modules:t}=g.useContext(qe),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},Wt={inputs:{},outputs:{}},Oe=(e,t)=>{const s=L("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,r=N(d=>d?.Graph&&d.Graph.graphs[e],t),a=n(r),c=n(d=>d?.Graph&&d.Graph.graphs[e]);return{id:e,state:a,actions:{addNode:(d,p)=>{const l={...d,position:{x:0,y:0}};o(Ve({graphId:e,node:l,edges:p??Wt}))},removeNode:d=>{o(De({graphId:e,nodeId:d}))},updateNode:d=>{o(Le({graphId:e,nodeId:d.id,changes:d}))},addEdge:d=>{o(ge({graphId:e,edge:d}))},updateEdge:(d,p)=>{const l=c?.edges[d];if(l){o(he({graphId:e,edgeId:d}));const u={...l,...p};o(ge({graphId:e,edge:u}))}},removeEdge:d=>{o(he({graphId:e,edgeId:d}))},nodeExists:d=>c?d in c.nodes:!1,search:(d,p,l,u,f,w,k,h)=>{const y=h??$e.uniqueId("search");return o(Ut({id:y,graphId:e,strategy:d,nodeStart:p,validate:l,stopCriteria:u,getNeighbours:f,depth:w,label:k??y})),y}}}},He={nodes:{},edges:{},adjacencyList:{},searchResults:{}},Xt={graphs:{}};m(`[${D}:${x.EVENT}:Init] Graph Module loaded`);const Fo=m(`[${D}:GraphsManager:${x.EVENT}] Graph created`),Uo=m(`[${D}:GraphsManager:${x.EVENT}] Graph destroyed`),Ke=m(`[${D}:GraphsManager:${x.COMMAND}] Create graph`),Yt=m(`[${D}:GraphsManager:${x.COMMAND}] Destroy graph`),Bo=I({name:D,initialState:Xt,reducers:{},extraReducers:e=>{e.addCase(zt,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(Ve,(t,{payload:{graphId:s,node:o,edges:n}})=>{const r=t.graphs[s];if(!r)throw Error("Graph does not exist");if(r.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...r,nodes:{...r.nodes,[o.id]:o},edges:{...r.edges,...Object.entries(n.inputs).reduce((c,[d,p])=>({...c,[d]:p}),{}),...Object.entries(n.outputs).reduce((c,[d,p])=>({...c,[d]:p}),{})},adjacencyList:{...r.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((c,[d,p])=>({...c,[p.sourceId]:{...r.adjacencyList[p.sourceId],outputs:[...r.adjacencyList[p.sourceId].outputs,d]}}),{}),...Object.entries(n.outputs).reduce((c,[d,p])=>({...c,[p.targetId]:{...r.adjacencyList[p.targetId],inputs:[...r.adjacencyList[p.targetId].inputs,d]}}),{})}}}}}).addCase(De,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([r,a])=>a.sourceId===o||a.targetId===o).map(([r,a])=>r);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((r,a)=>a.id!==o?{...r,[a.id]:a}:r,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((r,[a,c])=>a!==o?{...r,[a]:{inputs:c.inputs.filter(d=>!n.includes(d)),outputs:c.outputs.filter(d=>!n.includes(d))}}:r,{}),edges:Object.entries(t.graphs[s].edges).reduce((r,[a,c])=>n.includes(a)?r:{...r,[a]:c},{})}}}}).addCase(Le,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const r=t.graphs[s],a=r.nodes[o];if(a===null)throw Error("Node does not exist");return r.nodes[o]={...a,...n},t}).addCase(ge,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(he,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s].edges[o];return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((r,[a,c])=>a===n.sourceId||a===n.targetId?{...r,[a]:{inputs:c.inputs.filter(d=>d!==o),outputs:c.outputs.filter(d=>d!==o)}}:{...r,[a]:c},{}),edges:Object.entries(t.graphs[s].edges).reduce((r,[a,c])=>a!==o?{...r,[a]:c}:r,{})}}}}).addCase(Ft,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...He}}})).addCase(ze,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(Bt,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),Wo=I({name:D,initialState:Xt,reducers:{},extraReducers:e=>{e.addCase(Ke,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...He,id:s},t}).addCase(Yt,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(Bo.reducer)}}),Ze=X();Ze.startListening({actionCreator:Ke,effect:async(e,t)=>{const{dispatch:s}=t;s(Fo(e.payload))}});Ze.startListening({actionCreator:Yt,effect:async(e,t)=>{const{dispatch:s}=t;s(Uo(e.payload))}});const Xo=(e,t,s,o,n)=>{const r=[],a=[];let c=0;const d=[t];for(;d.length;){const p=d.shift();if(!p)break;const l=e.nodes[p];if(r.push(l),s(l,e,a,r)&&a.push(l),o(l,e,a,r))break;if(n&&c>=n)continue;const f=e.adjacencyList[p];d.push(...f.outputs.map(w=>e.edges[w].targetId)),d.push(...f.inputs.map(w=>e.edges[w].sourceId)),c+=1}return{findings:a,visited:r,path:[]}},Yo=(e,t,s,o,n=(a,c)=>[...c.adjacencyList[a.id].inputs,...c.adjacencyList[a.id].outputs],r)=>{const a=[],c=[];let d=0;const p=[t];let l={},u=t;for(;p.length;){const k=p.pop();if(!k)break;u=k;const h=e.nodes[k];if(a.push(h),s(h,e,c,a)){if(c.push(h),o(h,e,c,a))break;if(r&&d>=r){d-=1;continue}const b=n(h,e).filter(C=>!a.map(v=>v.id).includes(e.edges[C].targetId)).map(C=>e.edges[C].targetId);p.push(...b),l=b.reduce((C,v)=>({...C,[v]:k}),l),d+=1}}const f=[];let w=u;for(;w;)f.push(w),w=l[w];return f.reverse(),{findings:c,visited:a,path:f}},Y=X();Y.startListening({actionCreator:zt,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(Go({graphId:e,graph:t}))}});Y.startListening({actionCreator:Ve,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(To({graphId:e,node:t,edges:s}))}});Y.startListening({actionCreator:De,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(No({graphId:e,nodeId:t}))}});Y.startListening({actionCreator:Le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Po(e))}});Y.startListening({actionCreator:ge,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(_o(e))}});Y.startListening({actionCreator:he,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Io(e))}});Y.startListening({actionCreator:Ut,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),r=n[e.graphId];if(r.searchResults&&e.id in r.searchResults&&!r.searchResults[e.id].outdated){s(ze({graphId:e.graphId,searchId:e.id,results:r.searchResults[e.id]}));return}let a={findings:[],visited:[],path:[]};switch(e.strategy){case"dfs":a={...Yo(r,e.nodeStart,e.validate,e.stopCriteria,e.getNeighbours,e.depth)};break;case"bfs":a=Xo(r,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(ze({graphId:e.graphId,searchId:e.id,results:{...a,outdated:!1}}))}});Y.startListening({actionCreator:Bt,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(zo(e))}});const E="Layout",qo="0.0.1",Qe="ribbonMenuSections",ae="viewportTypes",qt="settings-panel",Ht="details-panel",Kt="viewport-notifications-tray";function Ho(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const Ko=({width:e,height:t,nodeBorder:s})=>{const o=Z().domain([-1,e+1]).range([-1,e+1]),n=Z().domain([-1,t+1]).range([-1,t+1]),r=Ue(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),a=Be(n).ticks(10).tickSize(e).tickPadding(8-e);function c(u){u.append("circle").attr("r",f=>f.radius).attr("fill",f=>Ho(f.group.name??"")).attr("stroke",s),u.append("text").text(f=>f.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function d(u){function f(h){h.active||u.alphaTarget(.3).restart(),h.subject.fx=h.subject.x,h.subject.fy=h.subject.y}function w(h){h.subject.fx=h.x,h.subject.fy=h.y}function k(h){h.active||u.alphaTarget(0),h.subject.fx=null,h.subject.fy=null}return js().on("start",f).on("drag",w).on("end",k)}function p(u){u.append("line").attr("stroke-width","1em").attr("stroke","gray")}function l(u){u.each(f=>{u.attr("viewBox",[0,0,e,t]),u.selectAll("*").remove(),u.append("defs");const k=u.append("g").attr("role","grid"),h=u.append("g").attr("role","container"),y=k.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(r),$=k.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),b=We().scaleExtent([-10,40]).filter(M=>(M.preventDefault(),(!M.ctrlKey||M.type==="wheel")&&!M.button)).on("zoom",({transform:M})=>{h.attr("transform",M),y.call(r.scale(M.rescaleX(o))),$.call(a.scale(M.rescaleY(n)))});u.call(b);const C=Ss(f.nodes).force("links",vs(f.links).id(M=>M.id).distance(300).strength(1)).force("charge",$s().strength(M=>M.strength)).force("colide",Es(M=>M.radius)),v=h.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(f.links).join(M=>M.append("g").attr("role","link").attr("id",T=>T.id).call(p),M=>M,M=>M.remove()),S=h.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(f.nodes).join(M=>M.append("g").attr("role","node").attr("id",T=>T.id).call(d(C)).call(c),M=>M.select("circle").attr("cx",T=>T.x).attr("cy",T=>T.y),M=>M.remove());C.on("tick",()=>{S.attr("transform",M=>`translate(${M.x}, ${M.y})`),v.selectAll("line").attr("x1",M=>M.source.x).attr("y1",M=>M.source.y).attr("x2",M=>M.target.x).attr("y2",M=>M.target.y)}),C.alpha(1)})}return{render(u,f){Ee(f).datum(u).call(l)}}},Zo=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=L("Layout"),s=g.useRef(null),o=g.useRef(null),n=t(o),r=Oe(e,p=>p),a=g.useMemo(()=>r?.state?.nodes?{nodes:Object.values(r.state.nodes).map(p=>({id:p.id,group:{id:`${p.id}-group`,name:p.type},nodeLabel:p?.label||p.id,strength:-400,x:p.position.x,y:p.position.y,radius:50})),links:Object.values(r.state.edges).map(p=>({id:p.id,type:p.type,source:p.sourceId,target:p.targetId,value:5}))}:{nodes:[],links:[]},[r]),c=Xe(),d=Ko({nodeBorder:c.palette.getContrastText(c.palette.background.default),width:n?.width??0,height:n?.height??0});return g.useLayoutEffect(()=>{!n||!s.current||d.render(a,s.current)},[a,n]),r.state?i.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:i.jsx("svg",{ref:s,id:`${r.id}`,width:"100%",height:"100%"})}):i.jsx(i.Fragment,{})},Zt=_.memo(Zo),Qo=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(D,Wo.reducer),e.functions.registerMiddleware(Ze),e.functions.registerMiddleware(Y),t.functions.createRegistries({[Qe]:{},[ae]:{graph:Zt}})},Jo=()=>{const e=_t();return{functions:{createGraph(t){return e(Ke({graphId:t})),{id:t,state:{id:t,...He},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(Ve({graphId:t,node:n,edges:o??Wt}))},removeNode:s=>{e(De({graphId:t,nodeId:s}))},updateNode:s=>{e(Le({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(ge({graphId:t,edge:s}))},updateEdge:(s,o)=>{console.error("Not implemented yet")},removeEdge:s=>{e(he({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(Ft({graphId:t}))}}}},en=(e,t)=>{const o=t??(n=>n);return N(n=>n.Graph,n=>n&&o(n.graphs[e]))},tn=(e,t)=>{const s=L("Graph"),{useGraph:o}=s.hooks,n=o(e,c=>c?.nodes[t]),r=o(e,c=>c?.adjacencyList[t]),a=o(e,c=>Object.values(c?.edges??{}).filter(d=>r.state?.inputs?.includes(d.id)||r.state?.outputs?.includes(d.id)).reduce((d,p)=>({...d,[p.id]:p}),{}));return{node:n.state,edges:a.state??{},adjacencyList:r.state??{inputs:[],outputs:[]}}},Qt=(e,t)=>Oe(e,o=>o?.searchResults&&o.searchResults[t]).state,sn=(e,t,s)=>{g.useEffect(()=>{s()},[]);const o=Qt(e,t);return g.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},Et={name:D,version:Oo,depends_on:["Store"],components:{GraphViewer:Zt},managers:{graphs:Jo},hooks:{useGraph:Oe,useNodeInfo:tn,useSearch:sn,useSearchResult:Qt},store:{selectors:{getGraphState:en}},kernelCalls:{startModule:Qo,restartModule(){},shutdownModule(){}}},fe=m(`[${E}:Theme:${x.COMMAND}] Switch theme`),on=m(`[${E}:Theme:${x.EVENT}] Theme switched`),Jt=X();Jt.startListening({actionCreator:fe,effect:async({payload:e},t)=>{const{dispatch:s}=t;localStorage.setItem("theme",e.theme),s(on(e))}});const Je=m(`[${E}:Ribbon:${x.COMMAND}] Add tab`),et=m(`[${E}:Ribbon:${x.COMMAND}] Select tab`),nn=m(`[${E}:Ribbon:${x.EVENT}] tab added`),rn=m(`[${E}:Ribbon:${x.EVENT}] tab selected`),tt=X();tt.startListening({actionCreator:Je,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(nn({tab:n[e.name]}))}});tt.startListening({actionCreator:et,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(rn({tab:n[e]}))}});const st=m(`[${E}:Viewports:${x.COMMAND}] Add viewport`),ot=m(`[${E}:Viewports:${x.COMMAND}] Select viewport`),nt=m(`[${E}:Viewports:${x.COMMAND}] Close viewport`),es=m(`[${E}:Viewports:${x.COMMAND}] Rename viewport`),rt=m(`[${E}:Viewports:${x.COMMAND}] Set extras options`),at=m(`[${E}:Viewports:${x.COMMAND}] Add viewport to group`),Fe=m(`[${E}:Viewports:${x.COMMAND}] Viewport removed from group`),an=m(`[${E}:Viewports:${x.EVENT}] Viewport added`),cn=m(`[${E}:Viewports:${x.EVENT}] Viewport selected`),dn=m(`[${E}:Viewports:${x.EVENT}] Viewport closed`);m(`[${E}:Viewports:${x.EVENT}] Viewport renamed`);const ln=m(`[${E}:Viewports:${x.COMMAND}] Extras options set`),un=m(`[${E}:Viewports:${x.EVENT}] Viewport added to group`);m(`[${E}:Viewports:${x.EVENT}] Viewport removed from group`);const J=X();J.startListening({actionCreator:st,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(an(n[e]))}});J.startListening({actionCreator:ot,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(cn(n[e]))}});J.startListening({actionCreator:nt,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(dn({name:e}))}});J.startListening({actionCreator:rt,effect:async(e,t)=>{const{dispatch:s}=t;s(ln)}});J.startListening({actionCreator:at,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(un(e))}});J.startListening({actionCreator:Fe,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Fe(e))}});const it=m(`[${E}:Viewports:${x.COMMAND}] Create group`),pn=m(`[${E}:Viewports:${x.EVENT}] Group created`),ts=X();ts.startListening({actionCreator:it,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(pn(e))}});const ct=m(`[${E}:Panels:${x.COMMAND}] Expand settings panel`),dt=m(`[${E}:Panels:${x.COMMAND}] Collapse settings panel`),lt=m(`[${E}:Panels:${x.COMMAND}] Open details panel`),ut=m(`[${E}:Panels:${x.COMMAND}] Close details panel`),gn=m(`[${E}:Panels:${x.EVENT}] Settings panel expanded`),hn=m(`[${E}:Panels:${x.EVENT}] Settings panel collapsed`),fn=m(`[${E}:Panels:${x.EVENT}] Details panel opened`),mn=m(`[${E}:Panels:${x.EVENT}] Details panel closed`),me=X();me.startListening({actionCreator:ct,effect:async(e,t)=>{const{dispatch:s}=t;s(gn())}});me.startListening({actionCreator:dt,effect:async(e,t)=>{const{dispatch:s}=t;s(hn())}});me.startListening({actionCreator:lt,effect:async(e,t)=>{const{dispatch:s}=t;s(fn())}});me.startListening({actionCreator:ut,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(mn({viewportName:n}))}});const xn=I({name:`${E}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(it,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),wn=I({name:`${E}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(st,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(nt,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,r])=>n===s.name?o:{...o,[n]:r},{})})),e.addCase(ot,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(es,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[r,a])=>r===s?{...n,[s]:{...a,title:o}}:{...n,[r]:a},{})})),e.addCase(rt,(t,{payload:{name:s,extras:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[r,a])=>s===r?{...n,[s]:{...a,extra:o}}:{...n,[s]:a},{})})),e.addCase(at,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(Fe,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:xn.reducer(t.groups,s)}))}}),yn=I({name:`${E}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase(Je,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(et,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),ss={settings:{state:"expanded"},details:{state:"closed"}},Mn=I({name:E,initialState:ss,reducers:{},extraReducers:e=>{e.addCase(ct,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(dt,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(lt,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(ut,t=>({...t,details:{...t.details,state:"closed"}}))}}),bn={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:ss,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Cn=I({name:E,initialState:bn,reducers:{},extraReducers:e=>{e.addCase(fe,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:Mn.reducer(t.panels,s),ribbonMenu:yn.reducer(t.ribbonMenu,s),viewportManager:wn.reducer(t.viewportManager,s)}))}}),ke=({name:e,icon:t,summary:s,expanded:o,state:n,children:r,sx:a,...c})=>{const d=Rt("(min-width:1024px)");return n==="collapsed"?i.jsx(As,{children:t??i.jsx(St,{})}):i.jsxs(Rs,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...a},...c,children:[i.jsx(Vs,{expandIcon:i.jsx(Ds,{}),"aria-controls":`accordion-${e}-content`,children:i.jsxs(A,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??i.jsx(St,{}),i.jsx(Se,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&d&&i.jsx(Se,{component:"div",sx:{color:"text.secondary"},children:s})]})}),i.jsx(Ls,{children:r})]})};function pt(){const e=L("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(ct())},collapseSettings(){s(dt())},openDetails(){s(lt())},closeDetails(){s(ut())}}}}N(e=>e.Layout,e=>e&&e.panels);const kn=N(e=>e.Layout,e=>e&&e.panels.settings),Sn=N(e=>e.Layout,e=>e&&e.panels.details),os=({title:e,display:t,children:s,sx:o,...n})=>{const r=document.getElementById(Ht),a=Rt("(orientation: portrait)"),c=L("Store"),{useAppSelector:d}=c.hooks,p=pt(),l=d(Sn),u=g.useCallback(f=>{f.stopPropagation(),l&&l.state==="opened"&&p.functions.closeDetails()},[l?.state]);return!r||!l?null:Ye.createPortal(i.jsxs(A,{role:"details-panel","aria-label":"details panel",display:l.state==="opened"?"flex":"none",sx:{...o,flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},...n,children:[i.jsxs(A,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!a&&i.jsx(Q,{size:"small",component:"span",onClick:u,children:l.state==="opened"&&i.jsx(ve,{})}),i.jsx("span",{children:e??"Detalhes"})]}),i.jsx(A,{role:"panel-content",sx:{overflow:"auto",height:"100%"},children:i.jsx(je,{fallback:i.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),r)},ns=({title:e,children:t})=>{const s=L("Store"),{useAppSelector:o}=s.hooks,n=pt(),r=o(kn),a=document.getElementById(qt),c=g.useCallback(d=>{d.stopPropagation(),r&&r.state==="collapsed"&&n.functions.expandSettings(),r&&r.state==="expanded"&&n.functions.collapseSettings()},[r?.state]);return!a||!r?null:Ye.createPortal(i.jsx(A,{sx:{position:"relative"},children:i.jsxs(A,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:r.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:r.state==="collapsed"?"8vw":"100%"}},children:[i.jsxs(A,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.state==="expanded"&&i.jsxs(i.Fragment,{children:[i.jsx(Os,{}),i.jsx("span",{children:e??"Configurações"})]}),i.jsx(Q,{size:"small",component:"span",onClick:c,children:r.state==="collapsed"?i.jsx(Gs,{sx:{transform:"rotate(90deg)"}}):i.jsx(Ts,{sx:{transform:"rotate(90deg)"}})})]}),i.jsx(A,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:r.state==="collapsed"?2:0,marginTop:4},children:i.jsx(je,{fallback:i.jsx("div",{children:"Ocorreu um erro"}),children:t.map((d,p)=>g.cloneElement(d,{state:r.state,key:p}))})})]})}),a)},vn=({name:e,title:t,type:s,group:o})=>i.jsxs(i.Fragment,{children:[i.jsxs(ns,{children:[i.jsx(ke,{name:"Agenda",icon:i.jsx(Ns,{}),expanded:!0,children:i.jsx(i.Fragment,{})}),i.jsx(ke,{name:"Recebimentos",summary:"Recebimentos do mês",children:i.jsx(i.Fragment,{})}),i.jsx(ke,{name:"Andamento",summary:"Pedidos em produção",children:i.jsx(i.Fragment,{})})]}),i.jsx(os,{children:i.jsx(i.Fragment,{children:"Detalhes"})})]}),$n=_.memo(vn),En=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(E,Cn.reducer);const o=window.matchMedia("(prefers-color-scheme: dark)"),n=localStorage.getItem("theme");o.matches&&!n?e(fe({theme:"dark"})):n&&e(fe({theme:n})),t.functions.registerMiddleware(Jt),t.functions.registerMiddleware(tt),t.functions.registerMiddleware(J),t.functions.registerMiddleware(ts),t.functions.registerMiddleware(me),s.functions.createRegistries({[Qe]:{},[ae]:{home:$n}})};function rs(){const e=L("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(fe({theme:o}))}}}}const as=g.createContext({sections:{},setSections:()=>null}),jn=({children:e,default_sections:t})=>{const[s,o]=g.useState(t??{});function n(a,c){o({...s,[a]:c})}const r=g.useMemo(()=>({sections:s,setSections:n}),[s]);return i.jsx(as.Provider,{value:r,children:e})},is=e=>e&&e.Layout?.ribbonMenu,cs=N(is,e=>e&&e.tabs),An=N(is,e=>e&&e.activeTab);function ds(){const e=L("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),r=t(cs);return g.useContext(as),o(),{functions:{tabExists(a){return r!=null&&a in r},addNewTab(a){const c=$e.uniqueId("tab-"),d={...a,name:c,active:!1};n(Je({tab:d}))},selectTab(a){n(et({name:a}))}}}}function ls(){const e=L("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(r){n.functions.registerComponents({[ae]:r})},getViewportTypeComponent(r){const a=n.functions.getComponent(ae,r);if(!a)throw Error("Unknown viewport type");return a},addViewport(r,a,c,d="viewport",p={}){if(!n.functions.getComponent(ae,a))throw Error("Unknown viewport type");const u=$e.uniqueId(d);return o(st({name:u,title:r,type:a,group:c,extra:p})),u},renameViewport(r,a){o(es({oldName:r,newName:a}))},setExtras(r,a){o(rt({name:r,extras:a}))},selectViewport(r){o(ot({name:r}))},closeViewport(r){o(nt({name:r}))},createGroup(r,a){o(it({name:r,color:a}))},addToGroup(r,a){o(at({viewportName:r,groupName:a}))}}}}const Ge=N(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),us=e=>e.Layout.viewportManager,Rn=N(e=>e.Layout.viewportManager,e=>e?.groups),Vn=N(us,e=>e&&e.viewports),gt=(e,t)=>{const o=t??(n=>n);return N(us,n=>n&&o(n.viewports[e]))},Dn=({children:e})=>{const t=document.getElementById(Kt);return t?Ye.createPortal(i.jsx(A,{sx:{position:"relative"},children:e}),t):null},Ln=({title:e,component:t,button:s,sx:o={}})=>{const[n,r]=g.useState(!1),a=g.useCallback(d=>{r(!0),d.stopPropagation()},[]),c=g.useCallback(()=>{r(!1)},[]);return i.jsxs(i.Fragment,{children:[i.jsx(Vt,{open:n,onClose:c,components:{Backdrop:void 0},children:i.jsxs(Dt,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&i.jsx(Se,{variant:"subtitle1",component:"span",children:e}),_.cloneElement(t,{closeModal:c})]})}),_.cloneElement(s,{onClick:a})]})},ht=g.createContext({rows:[],setRows:()=>null}),On=({children:e,initialRows:t})=>{const[s,o]=g.useState((t??[]).map(r=>({...r,state:"untouched"}))),n=g.useMemo(()=>({rows:s,setRows:o}),[s]);return i.jsx(ht.Provider,{value:n,children:e})},Ne=(e,t)=>t==="dark"?Ae(e,.7):Re(e,.7),Pe=(e,t)=>t==="dark"?Ae(e,.6):Re(e,.6),_e=(e,t)=>t==="dark"?Ae(e,.5):Re(e,.5),Ie=(e,t)=>t==="dark"?Ae(e,.4):Re(e,.4),Gn=Ps(_s)(({theme:e})=>({"& .state--added":{backgroundColor:Ne(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:Pe(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:_e(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:Ie(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:Ne(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:Pe(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:_e(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:Ie(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:Ne(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:Pe(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:_e(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:Ie(e.palette.error.main,e.palette.mode)}}}})),Tn=()=>i.jsx(A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:i.jsx(Se,{variant:"body2",children:"Sem registros"})}),Nn=({handleAddRecord:e,addLabel:t})=>i.jsxs(Ws,{sx:{display:"flex",justifyContent:"space-around"},children:[i.jsx(Xs,{startIcon:i.jsx(Ys,{}),onPointerUp:e,children:t||"Adicionar"}),i.jsx("div",{children:i.jsx(qs,{})})]}),Pn=({columns:e,addLabel:t,newRecord:s,onSave:o,onCancel:n,...r})=>{const{rows:a,setRows:c}=g.useContext(ht),[d,p]=g.useState({}),l=()=>{const b=s();c(C=>[...C,{...b,state:"added"}]),p(C=>({...C,[b.id]:{mode:ce.Edit,fieldToFocus:"id"}}))},u=g.useCallback(b=>()=>{p(C=>({...C,[b]:{mode:ce.Edit}}))},[]),f=b=>(c(C=>C.map(v=>v.id===b.id?{...b,old:{...v,old:null}}:v)),b),w=(b,C)=>{b.reason===Hs.rowFocusOut&&(C.defaultMuiPrevented=!0)},k=g.useCallback(b=>{const C=a.find(S=>S.id===b);if(!C)return;const v=C.state==="untouched"?"modified":C.state;c(S=>S.map(M=>M.id===b?{...M,state:v}:M)),p(S=>({...S,[b]:{mode:ce.View}})),o?.()},[a]),h=g.useCallback(b=>()=>{c(C=>C.map(v=>v.id===b?{...v,state:"deleted",oldState:v.state}:v).filter(v=>!(v.state==="deleted"&&v?.oldState==="added")))},[]),y=g.useCallback(b=>()=>{c(C=>C.map(v=>v.id===b?{...v,state:v.oldState,oldState:"deleted"}:v))},[]),$=g.useCallback(b=>()=>{p(v=>({...v,[b]:{mode:ce.View,ignoreModifications:!0}}));const C=a.find(v=>v.id===b);C&&C.state==="added"&&c(v=>v.filter(S=>S.id!==b)),n?.()},[a]);return i.jsx(Gn,{editMode:"row",hideFooter:!0,autoHeight:!0,rowModesModel:d,getRowClassName:b=>`state--${b.row.state}`,onRowEditStop:w,processRowUpdate:f,slotProps:{toolbar:{handleAddRecord:l,addLabel:t}},slots:{noRowsOverlay:Tn,toolbar:Nn},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",cellClassName:"actions",getActions:({id:b})=>{const C=a.find(S=>S.id===b);return C?d[b]?.mode===ce.Edit?[i.jsx(de,{icon:i.jsx(Is,{}),label:"Save",id:`save-${b}`,sx:{color:"primary.main"},onClick:()=>k(b)},"save"),i.jsx(de,{icon:i.jsx(zs,{}),label:"Cancel",className:"textPrimary",onClick:$(b),color:"inherit"},"cancel")]:C.state==="deleted"?[i.jsx(de,{icon:i.jsx(Fs,{}),label:"Restore",className:"textPrimary",onClick:y(b),color:"inherit"},"restore")]:[i.jsx(de,{icon:i.jsx(Us,{}),label:"Edit",className:"textPrimary",onClick:u(b),color:"inherit"},"edit"),i.jsx(de,{icon:i.jsx(Bs,{}),label:"Delete",onClick:h(b),color:"inherit"},"delete")]:[]}}],...r,rows:a})};function _n({id:e,value:t,field:s}){const o=Ks(),n=r=>{const a=r.target.checked;o.current.setEditCellValue({id:e,field:s,value:a})};return i.jsx(Zs,{checked:t,onChange:n})}const In=e=>{const[t,s]=g.useState();return g.useLayoutEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(r=>{r.forEach(a=>{s(a.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},Me={100:"#DAECFF",200:"#b6daff",400:"#3399FF",500:"#007FFF",600:"#0072E5",900:"#003A75"},K={50:"#F3F6F9",100:"#E5EAF2",200:"#DAE2ED",300:"#C7D0DD",400:"#B0B8C4",500:"#9DA8B7",600:"#6B7A90",700:"#434D5B",800:"#303740",900:"#1C2025"},zn=Qs(Js)(({theme:e})=>`
    box-sizing: border-box;
    width: 100%;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.875rem;
    font-weight: 400;
    line-height: 1.5;
    padding: 8px 12px;
    border-radius: 8px;
    color: ${e.palette.mode==="dark"?K[300]:K[900]};
    background: ${e.palette.mode==="dark"?K[900]:"#fff"};
    border: 1px solid ${e.palette.mode==="dark"?K[700]:K[200]};
    box-shadow: 0px 2px 2px ${e.palette.mode==="dark"?K[900]:K[50]};

    &:hover {
      border-color: ${Me[400]};
    }

    &:focus {
      border-color: ${Me[400]};
      box-shadow: 0 0 0 3px ${e.palette.mode==="dark"?Me[600]:Me[200]};
    }

    // firefox
    &:focus-visible {
      outline: 0;
    }
  `);function Fn({wrapperProps:e,...t}){const s=Xe();return i.jsx(A,{role:"textarea-wrapper",...e,children:i.jsx(zn,{theme:s,"aria-label":"minimum height",minRows:3,placeholder:"Minimum 3 rows",...t})})}const Un=e=>i.jsx(A,{sx:{position:"absolute"},children:i.jsx(eo,{...e})});function Bn({colorChange:e,sx:t}){const[s,o]=g.useState("#ffffff"),[n,r]=g.useState(!1);return i.jsxs(A,{sx:{position:"relative"},children:[i.jsx(A,{sx:{...t,borderRadius:1,backgroundColor:s,minWidth:"10px",minHeight:"10px"},onClick:()=>r(a=>!a)}),n&&i.jsx(Un,{onChange:(a,c)=>{o(a.hex),r(!1),e?.(a,c)}})]})}function Wn({id:e,value:t,field:s,api:o,...n}){const r=a=>{const c=a.target.value;o.setEditCellValue({id:e,field:s,value:c})};return i.jsx(to,{value:t??"",onChange:r,sx:{padding:0},...n})}function Xn(){const e=L("Store"),{useAppSelector:t}=e.hooks,s=t(Ge);return t(gt(s))}const ps={name:E,version:qo,depends_on:[],components:{SettingsPanel:ns,DetailsPanel:os,ViewportNotificationsTray:Dn,Accordion:ke,SystemModal:Ln,CRUDGrid:Pn,CRUDBooleanCell:_n,CRUDTextFieldCell:Wn,CRUDGridProvider:On,CustomTextArea:Fn,ColorPicker:Bn},contexts:{CRUDGridContext:ht},hooks:{useLayoutManager:rs,useRibbonMenuManager:ds,useViewportManager:ls,useActiveViewport:Xn,usePanelsManager:pt,useResizeObserver:In},store:{selectors:{selectActiveViewport:Ge,getViewportState:gt,getViewportGroups:Rn}},kernelCalls:{startModule:En,restartModule(){},shutdownModule(){}}},xe="Loader",Yn="0.0.1",ue="modules",gs=m(`[${xe}:${x.EVENT}] Module started`),qn=m(`[${xe}:${x.COMMAND}] Start module`),Hn={modulesCount:1,modulesGraph:ue},Kn=I({name:xe,initialState:Hn,reducers:{},extraReducers:e=>{e.addCase(gs,t=>(t.modulesCount+=1,t))}}),Zn=({managers:{storeManager:e}})=>{e.functions.loadReducer(xe,Kn.reducer)};class jt extends Error{}class Qn extends Error{}const Jn=e=>e.modulesCount,er=()=>{const{modules:e,setModules:t}=g.useContext(qe),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=ps.hooks,{store:r,componentRegistry:a}=Ce.managers,c=s(),d=o(),p=n(),l=r(),u=a(),f=Ce.hooks.useAppDispatch(),w=Ce.hooks.useAppSelector;return{modulesLoaded:w(Jn),functions:{isModuleLoaded:y=>y in e,loadModule(y){if(y.name in e)throw new Qn(`${y.name} is not registered. Consider using restartModule instead.`);t({...e,[y.name]:y}),f(qn(y.name)),y.kernelCalls.startModule({dispatch:f,managers:{storeManager:l,componentRegistryManager:u,layoutManager:c,ribbonMenuManager:d,viewportManager:p}}),f(gs(y.name))},unloadModule(y){if(!(y in e))throw new jt(`${y} is not registered.`);e[y].kernelCalls.shutdownModule(l),delete e[y],t(e)},reloadModule(y){if(!(y in e))throw new jt(`${y} is not registered.`);const $=e[y];t(e),$.kernelCalls.restartModule(l)}}}},At={name:xe,version:Yn,depends_on:["Store","Graph"],managers:{modules:er},kernelCalls:{startModule:Zn,restartModule:()=>null,shutdownModule:()=>null}},tr=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=At.managers.modules(),o=Oe(ue,S=>S&&S.id),[n,r]=g.useState(!0),[a,c]=g.useState(!1),[d,p]=g.useState(0),[l,u]=g.useState(0),[f,w]=g.useState(0),k=g.useMemo(()=>[At,Et,ps],[]),h=Et.managers.graphs(),{createGraph:y,resetGraph:$}=h.functions;g.useEffect(()=>{const S=k[d];S&&!s.functions.isModuleLoaded(S.name)&&b(S)},[d]),g.useEffect(()=>{if(d===k.length){const S=t.kernel[l];S&&!s.functions.isModuleLoaded(S.name)&&C(S)}},[d,l]),g.useEffect(()=>{if(l===t.kernel.length){const S=t.system[f];S&&!s.functions.isModuleLoaded(S.name)&&v(S)}},[l,f]),g.useEffect(()=>{f===t.system.length&&r(!1)},[f]),g.useEffect(()=>{!n&&!o.state&&(y(ue),c(!0))},[n]),g.useEffect(()=>{if(a&&!o.state&&y(ue),!a)return;$(ue);const S={id:"root",type:"ROOT"};o.actions.addNode(S),k.forEach(M=>o.actions.addNode({id:M.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${M.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:M.name}},outputs:{}})),t.kernel.forEach(M=>{M.depends_on.push("Loader");const T=M.depends_on.reduce((q,z)=>{const H={id:`${z}->${M.name}`,type:"DEPENDS_ON",sourceId:z,targedId:M.name};return{...q,[z]:H}},{});o.actions.addNode({id:M.name,type:"EXTRA_KERNEL_MODULE"},{inputs:T,outputs:{}})}),t.system.forEach(M=>{M.depends_on.push("Loader");const T=M.depends_on.reduce((q,z)=>{const H={id:`${z}->${M.name}`,type:"DEPENDS_ON",sourceId:z,targedId:M.name};return{...q,[z]:H}},{});o.actions.addNode({id:M.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:T,outputs:{}})}),r(!1)},[a]);function b(S){s.functions.loadModule(S),p(d+1)}function C(S){s.functions.loadModule(S),u(l+1)}function v(S){s.functions.loadModule(S),w(f+1)}return n?i.jsx("div",{children:"Iniciando sistema"}):e},sr=({children:e,loadModules:t})=>{const[s,o]=g.useState({Store:Ce}),n=g.useMemo(()=>({modules:s,setModules:o}),[s]);return i.jsx(qe.Provider,{value:n,children:i.jsx(tr,{extraModules:t,afterLoadComponent:e})})},ia=_.memo(sr),or={},be=I({name:Nt,initialState:or,reducers:{},extraReducers:e=>{}}),nr=({children:e,default_registries:t})=>{const[s,o]=g.useState(t??{}),n=g.useMemo(()=>({registries:s,createRegistry:r,createRegistries:a,getComponent:c,registerComponents:d}),[s]);function r(p){o({...s,[p]:{}})}function a(p){o({...s,...p})}function c(p,l){return s[p][l]}function d(p){const l=s,u=Object.entries(p).reduce((f,[w,k])=>w in f?{...f,[w]:{...f[w],...k}}:f,l);o(u)}return i.jsx(It.Provider,{value:n,children:e})},rr=({children:e})=>{const[t,s]=g.useState({[be.name]:be.reducer}),o=g.useMemo(()=>so({reducer:vt({[be.name]:be.reducer}),middleware:a=>a({serializableCheck:!1}).concat(oo)}),[]),n=a=>{ro(a.middleware)},r=g.useCallback(a=>{const c={...t,...a};s(c),o.replaceReducer(vt(c))},[t]);return i.jsx(no,{store:o,children:i.jsx(Pt.Provider,{value:{currentReducers:t,loadReducers:r,registerMiddleware:n},children:i.jsx(nr,{children:e})})})},ca=_.memo(rr),hs=N(e=>e.Layout,e=>e&&e.theme),ar=({systemTray:e})=>{const t=L("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),r=ds(),{selectTab:a}=r.functions,c=s(cs),d=s(An),p=g.useCallback(l=>{a(l)},[]);return!d||!c?i.jsx(i.Fragment,{}):i.jsxs(ao,{value:d,children:[i.jsxs(A,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[i.jsx(Lt,{value:d,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(c).map(([l,u])=>i.jsx(le,{value:l,label:u.label,id:l,onClick:()=>p(l),wrapped:!0},l))}),i.jsx(A,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),i.jsx(A,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:c&&Object.entries(c).map(([l,u])=>i.jsx(io,{value:l,children:u.sectionNames&&u.sectionNames.map(f=>{const w=n.functions.getComponent(Qe,f);return g.createElement(w,{key:`ribbon-panel-${l}-section-${f}`},[])})},`ribbon-panel-${l}`))})]})},ir=({children:e,...t})=>{const s=g.useMemo(()=>({file:[i.jsx("div",{children:"test"},"test")]}),[]);return i.jsx(jn,{default_sections:s,children:i.jsx(ar,{...t,systemTray:e})})},cr=_.memo(ir),dr=()=>{const e=L("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Ge),n=t(gt(o));if(!n)return null;const r=s.functions.getComponent(ae,n.type);return r?i.jsx(je,{fallback:i.jsx("div",{children:"Ocorreu um erro"}),children:_.createElement(r,n,[])}):null},lr=N(e=>e.Layout.viewportManager,e=>e&&e.groups),ur=({sx:e,...t})=>{const s=L("Store"),{useAppSelector:o}=s.hooks,n=o(lr),r=o(Ge),a=o(Vn),c=g.useMemo(()=>Object.entries(a).reduce((w,[k,h])=>k==="home"?w:h.group?{...w,[h.group]:h.group in w?[...w[h.group],h]:[h]}:{...w,notGrouped:[...w.notGrouped,h]},{notGrouped:[]}),[a]),{functions:{addViewport:d,closeViewport:p,selectViewport:l}}=ls(),u=g.useCallback(()=>{d("Nova aba","home",void 0,"new-")},[]),f=g.useCallback(w=>{p(w)},[]);return i.jsxs(A,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[i.jsxs(A,{sx:{display:"flex",justifyContent:"space-between"},children:[i.jsxs(Lt,{value:r,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[i.jsx(le,{value:"home",icon:i.jsx(co,{}),iconPosition:"start",onClick:()=>l("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(c).map(([w,k])=>w==="notGrouped"?k.map(h=>i.jsx(le,{value:h.name,id:h.name,sx:{width:"fit-content",p:1},onClick:y=>y.button!=2?l(h.name):f(h.name),label:i.jsxs(A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("span",{children:h.title}),i.jsx(ve,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:y=>{y.stopPropagation(),f(h.name)}})]}),draggable:!0,wrapped:!0},`${h.name}-tab`)):k.map(h=>i.jsx(le,{value:h.name,id:h.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[h.group].color},onClick:()=>l(h.name),label:i.jsxs(A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[i.jsx("span",{children:h.title}),i.jsx(Q,{size:"small",component:"span",onClick:y=>{y.stopPropagation(),f(h.name)},children:i.jsx(ve,{sx:{width:.5,marginLeft:1}})})]}),draggable:"true",wrapped:!0},`${h.name}-tab`))),i.jsx(le,{value:"new",icon:i.jsx(lo,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:u,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),i.jsx(A,{id:Kt,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),i.jsx(A,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:i.jsx(dr,{})})]})},pr=_.memo(ur),gr=()=>{const e=L("Store"),{useAppSelector:t}=e.hooks,s=t(hs),o=rs(),n=g.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return i.jsx(A,{role:"system-tray-container",children:i.jsx(Q,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?i.jsx(uo,{fontSize:"small"}):i.jsx(po,{fontSize:"small"})})})},hr=_.memo(gr),fr=go(A)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,mr=()=>{const e=L("Store"),{useAppSelector:t}=e.hooks,s=t(hs),o=g.useMemo(()=>ho({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return i.jsxs(fo,{theme:o,children:[i.jsx(mo,{}),i.jsx(A,{role:"layout-root",sx:{minHeight:"100vh"},children:i.jsxs(fr,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[i.jsx(A,{sx:{gridArea:"ribbon",width:"100%"},children:i.jsx(cr,{children:i.jsx(hr,{})})}),i.jsx(A,{id:qt,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),i.jsx(pr,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),i.jsx(A,{id:Ht,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},da=_.memo(mr),xr=({dataTransform:e})=>(t,s,o)=>{const{matrix:a,names:c}=e(o),d=Ot().innerRadius(200).outerRadius(210),l=xo().padAngle(5/200).sortSubgroups(wo)(a),u=yo(Mo,c.length+1),f=bo().radius(200-1).padAngle(1/200),w=s.append("g").attr("id","chord-plot"),k=w.append("g").attr("role","groups-container"),h=w.append("g").attr("role","chords-container").attr("fill-opacity",.75),y=k.selectAll().data(l.groups).join("g").attr("id",$=>c[$.index]);y.append("path").attr("fill",$=>u[$.index]).attr("d",d),y.append("text").attr("dy","0.35em").attr("transform",$=>`
        rotate(${($.startAngle+$.endAngle)/2*180/Math.PI-90})
        translate(${210+5})
        ${($.startAngle+$.endAngle)/2>Math.PI?"rotate(180)":""}
      `).attr("text-anchor",$=>($.startAngle+$.endAngle)/2>Math.PI?"end":null).text($=>c[$.index]).attr("fill","white"),h.selectAll().data(l).join("path").style("mix-blend-mode","add").attr("fill",$=>u[$.target.index]).attr("d",f).append("title").text($=>`${c[$.source.index]} → ${c[$.target.index]} ${$.source.value}`)},wr=({xSettings:e,ySettings:t,dimensions:[s,o]})=>{const n=Z().domain(e.domain).range(e.range),r=Z().domain(t.domain).range(t.range),a=Ue(n).ticks((s+2)/(o+2)*10).tickSize(o).tickPadding(8-o),c=Be(r).ticks(10).tickSize(s).tickPadding(8-s);let d=(l,u)=>{};function p(l,u,f){const w=u.selectAll("g").data([1]).join("g").attr("role","grid"),k=l.select("#content"),h=l.select("#overlays"),y=w.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),$=w.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(c),b=We().scaleExtent([-10,40]).filter(C=>(C.preventDefault(),(!C.ctrlKey||C.type==="wheel")&&!C.button)).on("zoom",({transform:C})=>{k.attr("transform",C),h.attr("transform",C),y.call(a.scale(C.rescaleX(n))),$.call(c.scale(C.rescaleY(r)))});d(l,b),l.call(b)}return p.transformZoom=l=>(d=l,p),p.build=p,p},G="SVG",yr="0.0.1";function Mr(){let e=700,t=700,s=[],o=[],n=[];function r(c){c.each(d=>{c.attr("viewBox",[0,0,e,t]);const p=c.selectAll("#underlays").data([1]).join("g").attr("id","underlays"),l=c.selectAll("#content").data([1]).join("g").attr("id","content"),u=c.selectAll("#overlays").data([1]).join("g").attr("id","overlays");s.forEach(f=>f(c,p,d)),o.forEach(f=>f(c,l,d)),n.forEach(f=>f(c,u,d))})}function a(c,d){Ee(d).datum(c).call(r)}return a.width=c=>c?(e=c,a):e,a.height=c=>c?(t=c,a):t,a.underlays=c=>c?(s=c,a):s,a.content=c=>c?(o=c,a):o,a.overlays=c=>c?(n=c,a):n,a.render=a,a}const ft=m(`[${G}:SVG:${x.COMMAND}] Load SVG`),fs=m(`[${G}:SVG:${x.COMMAND}] Fetch SVG`),br=m(`[${G}:SVG:${x.COMMAND}] Set pan`),Cr=m(`[${G}:SVG:${x.COMMAND}] Set zoom`),kr=m(`[${G}:SVG:${x.COMMAND}] Add proxy`),ms=m(`[${G}:SVG:${x.COMMAND}] Update proxy`),xs=m(`[${G}:SVG:${x.COMMAND}] Delete proxy`),Te=m(`[${G}:SVG:${x.COMMAND}] Update SVG`),mt=m(`[${G}:SVG:${x.EVENT}] SVG fetched`),Sr=m(`[${G}:SVG:${x.EVENT}] SVG loaded`);m(`[${G}:SVG:${x.COMMAND}] Proxy added`);const vr=m(`[${G}:SVG:${x.COMMAND}] Proxy updated`),$r=m(`[${G}:SVG:${x.COMMAND}] Proxy deleted`),Er=m(`[${G}:SVG:${x.COMMAND}] SVG Updated`),jr=e=>e.SVG,xt=e=>N(jr,t=>t&&t.svgs[e]),Ar=(e,t)=>{const s=L("Store"),{useAppDispatch:o}=s.hooks,n=o(),r=s.hooks.useAppSelector,a=r(d=>xt(e)(d)?.instances[t]),c=g.useMemo(()=>a?.content?new DOMParser().parseFromString(a.content,"image/svg+xml").querySelector("svg"):void 0,[a?.content]);if(!(!a||!c))return{state:{instance:a,DOMroot:c},transform(d){const p=new XMLSerializer().serializeToString(d(c));n(Te({path:e,instanceName:t,document:p}))}}},Rr=()=>{const e=L("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(ft({path:o,instanceName:n}))}}}},ie=X();ie.startListening({actionCreator:ft,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(fs({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(mt({path:e.path,content:n}))}});ie.startListening({actionCreator:mt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(Sr(n[e.path]))}});ie.startListening({actionCreator:ms,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(vr(n[e.path].instances[e.instanceName].proxies))}});ie.startListening({actionCreator:xs,effect:async({payload:e},{dispatch:t})=>{t($r(e))}});ie.startListening({actionCreator:Te,effect:async({payload:e},{dispatch:t})=>{t(Er(e))}});const Vr={progress:"not-started",instances:{},content:void 0},Dr={svgs:{}},Lr=I({name:G,initialState:Dr,reducers:{},extraReducers:e=>{e.addCase(ft,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[0,0],proxies:{},content:void 0}};return t.svgs[s]&&!$e.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...Vr,instances:n}}}}),e.addCase(fs,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(mt,(t,{payload:{path:s,content:o}})=>({...t,svgs:{...t.svgs,[s]:{...t.svgs[s],instances:Object.entries(t.svgs[s].instances).reduce((n,[r,a])=>({...n,[r]:{...a,content:o}}),{}),progress:"completed",content:o}}})),e.addCase(kr,(t,{payload:{path:s,instanceName:o,id:n,styles:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:r}:{[n]:r}}}}}})),e.addCase(Cr,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(br,(t,{payload:{path:s,instanceName:o,x:n,y:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,r]}}}}})),e.addCase(ms,(t,{payload:{path:s,instanceName:o,id:n,changes:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...r}:r}}}}}})),e.addCase(xs,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((r,[a,c])=>a===n?r:{...r,[a]:c},{})}}}}})),e.addCase(Te,(t,{payload:{path:s,instanceName:o,document:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],content:n}}}}}))}}),Or=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(G,Lr.reducer),e.functions.registerMiddleware(ie)},Gr=()=>{let e=50,t=52,s="group",o=u=>u,n="dark",r=u=>!!u,a=u=>!!u,c=(u,f,w)=>{u.append("text").text(k=>k.nodeLabel).attr("fill",k=>w(k.group)).attr("text-anchor","middle")},d=(u,f,w,k,h,y,$)=>{u.selectAll("path").data([f]).join("path").attr("class","group-arc").attr("fill",b=>k(f.name)).attr("d",(b,C)=>h(w)),u.selectAll("text").data([f]).join("text").attr("class","group-text").text(b=>b.name).attr("fill",b=>k(b.name)).attr("text-anchor",(b,C)=>(w.endAngle+w.startAngle)/2>Math.PI?"end":"start").attr("transform",(b,C)=>{const[v,S]=h.centroid(w),M=Math.sqrt(v*v+S*S);return`translate(${v/M*e*1.3}, ${S/M*e*1.3})`})},p=(u,f,w)=>{const k=$t().curve($o.beta(.35));u.append("path").attr("data-source",h=>h.source).attr("data-target",h=>h.target).attr("d",h=>k([[(e-10)*Math.sin(f(h.sourceOffset)),(e-10)*-Math.cos(f(h.sourceOffset))],[0,0],[(e-10)*Math.sin(f(h.targetOffset)),(e-10)*-Math.cos(f(h.targetOffset))]])).attr("fill","none").attr("stroke-width",1).attr("stroke","white")};function l(u,f,w){u.selectAll("defs").data([1]).join(j=>{let V=j.append("defs"),P=V.append("linearGradient").attr("id","convertion-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");V.append("marker").attr("id","arrow").attr("viewBox",[0,0,5,5]).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto-start-reverse").append("path").attr("d",$t()([[0,0],[0,5],[5,5]])).attr("stroke","white");const B=[{color:"steelblue",offset:"0%"},{color:"red",offset:"100%"}];return P.selectAll("stop").data(B).join("stop").attr("stop-color",te=>te.color).attr("offset",te=>te.offset),P});const k=f.selectAll(".dependency-circle").data([1]).join("g").attr("class","dependency-circle"),h=o(w),y=h.nodes.filter(r);y.sort((j,V)=>j.group.name>=V.group.name?-1:1);const $=h.links.filter(a),b=y.reduce((j,V,P)=>V.group.name in j?{...j,[V.group.name]:{id:V.group.id,name:V.group.name,nodes:[...j[V.group.name].nodes,{...V,idx:P,offset:0}]}}:{...j,[V.group.name]:{id:V.group.id,name:V.group.name,nodes:[{...V,idx:P,offset:0}]}},{}),C=Object.entries(b).map(([j,V])=>({id:V.id,name:j,nodes:V.nodes,size:V.nodes.length})),v=Co().domain(Object.keys(b)).range(ko),S=Z().domain([0,y.length]).range([0,2*Math.PI]),M=So(),T=C.map(({size:j})=>j),q=M(T),z=Ot().innerRadius(e*1.1).outerRadius(e*1.2).startAngle(j=>j.startAngle).endAngle(j=>j.endAngle),H=k.selectAll(".links").data([1]).join("g").attr("class","links");k.selectAll(".groups").data([1]).join("g").attr("class","groups").selectAll(".group").data(C).join("g").attr("id",j=>j.id??"other").attr("class","group"),q.forEach((j,V)=>{const P=vo.sum(q.filter((U,se)=>U.index<j.index).map(U=>U.value)),B=C[V];Ee(`g[id="${B.id}"]`).call(d,B,j,v,z,e,t).selectAll(".nodes-container").data([B]).join("g").attr("class","nodes-container").selectAll(".node").data(B.nodes).join("g").attr("class","node").attr("id",U=>U.id).attr("data-offset",(U,se)=>P+se).attr("transform",(U,se)=>`translate(${e*Math.sin(S(P+se))}, ${e*-Math.cos(S(P+se))}) `).call(c,S,v)}),H.selectAll(".link").data($.map(j=>{const V=k.select(`g[id="${j.source}"]`),P=k.select(`g[id="${j.target}"]`);return{...j,sourceOffset:+V.attr("data-offset"),targetOffset:+P.attr("data-offset")}})).join("g",j=>(j.select("*").remove(),j),j=>j.remove()).attr("class","link").attr("id",j=>j.id).call(p,S,v)}return l.innerRadius=u=>u?(e=u,l):e,l.groupBy=u=>u?(s=u,l):s,l.graph=u=>u?(o=u,l):o,l.theme=u=>u?(n=u,l):n,l.renderNode=u=>(c=u,l),l.renderLink=u=>(p=u,l),l.renderGroup=u=>(d=u,l),l.filterNode=u=>(r=u,l),l.filterLink=u=>(a=u,l),l.build=l,l},pe={state:{tools:{pickElement:{type:"SVGElement",enabled:!1,getSelectables:e=>[],callback:e=>null}}},pickElement:()=>null,cancelPickElement:()=>null},wt=g.createContext(pe),Tr=({children:e})=>{const[t,s]=g.useState(pe.state),o=g.useMemo(()=>({state:t,cancelPickElement:()=>{console.log("canceling"),s(n=>({...n,tools:{...n.tools,pickElement:pe.state.tools.pickElement}}))},pickElement:(n,r,a)=>{s({...t,tools:{...t.tools,pickElement:{type:n,getSelectables:r,enabled:!0,callback:c=>{s(d=>({...d,tools:{...d.tools,pickElement:pe.state.tools.pickElement}})),a(c)}}}})}}),[t]);return g.useEffect(()=>()=>{s(n=>({...n,tools:{...n.tools,pickElement:pe.state.tools.pickElement}}))},[]),i.jsx(wt.Provider,{value:o,children:e})},Nr=_.memo(Tr);function Pr(e){let t="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=s.length;let n=0;for(;n<e;)t+=s.charAt(Math.floor(Math.random()*o)),n+=1;return t}const _r=({svgPath:e,instanceName:t,beforeInjection:s=o=>o})=>{const{hooks:{useResizeObserver:o}}=L("Layout"),n=L("Store"),{useAppSelector:r,useAppDispatch:a}=n.hooks,c=g.useRef(null),d=g.useRef(null),p=o(d),l=p?.width??0,u=p?.height??0,f=Xe(),w=r(xt(e))?.instances[t],k=a(),h=g.useMemo(()=>w?.content?new DOMParser().parseFromString(w.content,"image/svg+xml").querySelector("svg"):void 0,[w?.content]),{state:{tools:y}}=g.useContext(wt);g.useLayoutEffect(()=>{!p||!c.current||!w?.content||!h||Ee(c.current).datum(null).call(z)},[p,c.current,w?.content,h,y.pickElement.enabled,w?.proxies]);const $=Z().domain([-1,l+1]).range([-1,l+1]),b=Z().domain([-1,u+1]).range([-1,u+1]),C=Ue($).ticks((l+2)/(u+2)*10).tickSize(u).tickPadding(8-u),v=Be(b).ticks(10).tickSize(l).tickPadding(8-l),[S,M]=g.useState(void 0),[T,q]=g.useState([]);function z(F){F.selectChildren("*").remove();const V=F.append("defs").append("pattern").attr("id","pick-hatch-pattern").attr("width","50").attr("height","10").attr("patternTransform","rotate(45 0 0)").attr("patternUnits","userSpaceOnUse");V.append("rect").attr("width","50").attr("height","10").attr("fill",f.palette.background.default),V.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2","10").attr("style",`stroke:${f.palette.primary.main}; stroke-width:10;`);const P=F.append("g").attr("role","grid"),B=F.append("g").attr("role","container"),te=P.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(C),kt=P.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(v),U=We().scaleExtent([-10,40]).filter(O=>(O.preventDefault(),(!O.ctrlKey||O.type==="wheel")&&!O.button)).on("zoom",({transform:O},W)=>{B.attr("transform",O),te.call(C.scale(O.rescaleX($))),kt.call(v.scale(O.rescaleY(b))),M(O)});if(F.call(U),S&&F.call(U.transform,S),!h){console.error("SVG could not be parsed!");return}if(Object.entries(w?.proxies??{}).forEach(([O,W])=>{const R=h.querySelector(`#${O}`);Object.entries(W).forEach(([oe,ne])=>{R?.setAttribute(oe,ne)})}),y.pickElement.enabled&&y.pickElement.type==="SVGElement"){let O=y.pickElement.getSelectables(h);const W=[];O.map(R=>{const oe=R.getAttribute("fill"),ne=R.getAttribute("stroke"),we=R.getAttribute("stroke-width"),ye={pointerover:re=>{re.stopPropagation(),R.setAttribute("fill","url(#pick-hatch-pattern)"),R.setAttribute("stroke",f.palette.primary.main),R.setAttribute("stroke-width","30")},pointerout:re=>{re.stopPropagation(),oe?R.setAttribute("fill",oe):R.removeAttribute("fill"),ne?R.setAttribute("stroke",ne):R.removeAttribute("stroke"),we?R.setAttribute("stroke-width",we):R.removeAttribute("stroke-width")},pointerdown:re=>{re.stopPropagation(),re.preventDefault(),oe?R.setAttribute("fill",oe):R.removeAttribute("fill"),ne?R.setAttribute("stroke",ne):R.removeAttribute("stroke"),we?R.setAttribute("stroke-width",we):R.removeAttribute("stroke-width");let bs=R.getAttribute("id")||Pr(10);R.getAttribute("id")||R.setAttribute("id",bs),y.pickElement.callback(R),H(()=>h)}};R.addEventListener("pointerover",ye.pointerover),R.addEventListener("pointerout",ye.pointerout),R.addEventListener("pointerdown",ye.pointerdown),W.push({element:R,handlers:ye})}),q(W)}else T&&T.map(({element:O,handlers:W})=>{O.removeEventListener("pointerover",W.pointerover),O.removeEventListener("pointerout",W.pointerout),O.removeEventListener("pointerdown",W.pointerdown)});B.node()?.append(s(h))}function H(F){const j=new XMLSerializer().serializeToString(F(h));k(Te({path:e,instanceName:t,document:j}))}return{svgRef:c,wrapperRef:d,transform:H}};function Ir(){return g.useContext(wt)}const la={name:G,version:yr,depends_on:[],components:{SVGEditorToolkit:Nr},d3Components:{Grid:wr,ChordPlot:xr,DependencyCircle:Gr},hooks:{useD3Container:Mr,useSVGManager:Rr,useSVG:Ar,useSVGEditor:_r,useSVGEditorToolkit:Ir},selectors:{selectSVGState:xt},kernelCalls:{startModule:Or,restartModule(){},shutdownModule(){}}},zr=({initialPosition:e})=>{const[t,s]=g.useState(!1),[o,n]=g.useState({x:0,y:0}),[r,a]=g.useState(e),c=g.useCallback(l=>{s(!0),n({x:l.clientX,y:l.clientY}),l.stopPropagation()},[]),d=g.useCallback(l=>{if(!t)return;const u={x:l.clientX-o.x,y:l.clientY-o.y},f={x:r.x+u.x,y:r.y+u.y};a(f)},[t]),p=g.useCallback(l=>{s(!1),l.stopPropagation()},[]);return{position:r,setPosition:a,listeners:{onPointerDown:c,onPointerMove:d,onPointerUp:p}}},Fr=({children:e,component:t,actions:s,onClose:o})=>{const[n,r]=g.useState(!1),{innerWidth:a,innerHeight:c}=window,d=[a/2,c/2],{position:p,setPosition:l,listeners:u}=zr({initialPosition:{x:d[0],y:d[1]}}),w=((y,$)=>{const b=y-d[0],C=$-d[1];return b<0?C<0?1:3:C<0?2:4})(p.x,p.y),k=g.useCallback(y=>{r(!0),l({x:y.clientX,y:y.clientY}),y.stopPropagation()},[]),h=g.useCallback(y=>{r(!1),y.stopPropagation(),o?.(y)},[]);return i.jsxs(i.Fragment,{children:[i.jsx(Vt,{open:n,keepMounted:!0,onClose:h,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...u,children:i.jsx(Dt,{sx:{position:"fixed",margin:1,left:p.x,top:p.y,transform:`translate(${w%2===0?"-100%":"0"}, ${w>2?"-100%":"0"})`,transition:"width 1s ease-in-out",transformOrigin:"bottom right"},elevation:6,children:i.jsxs(A,{sx:{display:"flex",flexGrow:1,flexDirection:w%2==1?"row":"row-reverse"},onClick:y=>y.stopPropagation(),children:[i.jsxs(A,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignContent:"space-between",borderLeft:`1px solid rgba(0,0,0, ${w%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${w%2==1?.1:0})`},children:[i.jsx(Q,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:i.jsx(Eo,{})}),s.map(y=>g.cloneElement(y,{size:"small",closeContainer:h})),i.jsx(Q,{color:"error",onClick:h,size:"small",id:"close-panel",children:i.jsx(ve,{})},"reject")]}),i.jsx(A,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:n?i.jsx(je,{fallback:i.jsx("div",{children:"Ocorreu um erro"}),children:t}):null})]})})}),g.cloneElement(e,{onClick:k})]})},Ur=({gestures:e,children:t})=>{const s=g.useRef(null),n=jo(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return i.jsx(A,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},yt="Pointer",Br="0.0.1",Wr={},Xr=I({name:yt,initialState:Wr,reducers:{},extraReducers:e=>{}}),Yr=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(yt,Xr.reducer),console.info("Pointer module started"),console.groupEnd()},qr=({closeContainer:e,handleConfirm:t,...s})=>g.createElement(Q,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},i.jsx(Ao,{})),ua={name:yt,version:Br,depends_on:[],components:{MultiTouchPanel:Ur,PointerContainer:Fr,ConfirmAndCloseButton:qr},hooks:{},store:{},kernelCalls:{startModule:Yr,restartModule(){},shutdownModule(){}}},ee="Markdown",Hr="0.0.1",Mt=m(`[${ee}:SVG:${x.COMMAND}] Load Markdown`),ws=m(`[${ee}:SVG:${x.COMMAND}] Fetch Markdown`),bt=m(`[${ee}:SVG:${x.EVENT}] Markdown fetched`),ys=m(`[${ee}:SVG:${x.EVENT}] Markdown loaded`),Kr=()=>{const e=L("Store"),{hooks:{useAppDispatch:t}}=e,s=t();return{loadMarkdown(o){s(Mt({path:o}))}}},Zr=e=>e.Markdown,Qr=e=>N(Zr,t=>t&&t.markdowns[e]),Ms=e=>{const t=L("Store"),{useAppSelector:s}=t.hooks;return s(Qr(e))},Jr=({path:e,...t})=>{const s=Kr();g.useLayoutEffect(()=>{e&&s.loadMarkdown(e)},[e]);const o=Ms(e);return!o||o.progress!=="completed"?i.jsx(i.Fragment,{}):i.jsx(Gt,{...t,remarkPlugins:[Tt],children:o.content})},ea=({content:e,...t})=>i.jsx(Gt,{...t,remarkPlugins:[Tt],children:e}),ta=e=>"path"in e?i.jsx(Jr,{...e}):i.jsx(ea,{...e}),Ct=X();Ct.startListening({actionCreator:Mt,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ws({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(bt({path:e.path,content:n}))}});Ct.startListening({actionCreator:bt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{Markdown:{markdowns:n}}=o();s(ys(n[e.path]))}});const sa={progress:"not-started",content:null},oa={markdowns:{}},na=I({name:ee,initialState:oa,reducers:{},extraReducers:e=>{e.addCase(Mt,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...sa,path:s}}})),e.addCase(ws,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"started"}}})),e.addCase(bt,(t,{payload:{path:s,content:o}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],content:o}}})),e.addCase(ys,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"completed"}}}))}}),ra=({managers:{storeManager:e}})=>{e.functions.loadReducer(ee,na.reducer),e.functions.registerMiddleware(Ct)},pa={name:ee,version:Hr,depends_on:[],components:{MarkdownReader:ta},hooks:{useMarkdown:Ms},kernelCalls:{startModule:ra,restartModule(){},shutdownModule(){}}};export{x as A,ca as D,da as L,ia as M,Sr as S,kr as a,Ve as b,nt as c,Yt as d,Te as e,Le as f,ge as g,he as h,mn as i,Bt as j,De as k,zt as l,xs as m,ft as n,lt as o,L as p,Ke as q,Fe as r,Yo as s,la as t,ms as u,ua as v,pa as w};
