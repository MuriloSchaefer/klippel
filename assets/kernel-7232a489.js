import{r as p,u as Xt,a as Kt,R as L,c as h,b as A,_ as ne,d as G,e as T,l as te,f as tt,g as st,s as ot,z as nt,h as Qt,i as Zt,j as Jt,k as es,m as ts,n as ss,o as r,p as at,S as os,q as Ke,M as ns,A as as,t as rs,B as $,T as se,v as is,w as Ce,I as _,x as oe,E as ae,y as cs,C as ds,D as ls,F as us,G as rt,P as it,H as ps,J as gs,K as re,L as ie,N as F,O as B,Q as hs,U as ms,V as fs,W as xs,X as ws,Y as ys,Z as Ms,$ as Cs,a0 as bs,a1 as Ss,a2 as vs,a3 as $s,a4 as ks,a5 as Qe,a6 as js,a7 as Es,a8 as Rs,a9 as As,aa as ct,ab as Y,ac as Vs,ad as Ds,ae as Ls,af as Gs,ag as Os,ah as Ts,ai as Ns,aj as Ps,ak as _s,al as Is,am as Us,an as zs,ao as Fs,ap as Bs,aq as Ys,ar as qs,as as Hs,at as Ws,au as Xs,av as Ks,aw as Qs}from"./vendor-6f7c0435.js";const dt="Store",Zs="0.0.1",lt=p.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),Js=()=>{const{loadReducers:e,registerMiddleware:t}=p.useContext(lt);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},ut=()=>Xt(),eo=Kt,pt=p.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>L.memo(()=>null),registerComponents:()=>null}),to=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=p.useContext(pt);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},J={name:dt,version:Zs,depends_on:[],managers:{store:Js,componentRegistry:to},hooks:{useAppDispatch:ut,useAppSelector:eo},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},be=p.createContext({modules:{},setModules:()=>null}),m={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},E="Graph",so="0.0.1",oo=h(`[${E}:Instance:${m.EVENT}] Graph loaded`),no=h(`[${E}:Instance:${m.EVENT}] Node added`),ao=h(`[${E}:Instance:${m.EVENT}] Node removed`),ro=h(`[${E}:Instance:${m.EVENT}] Node updated`),io=h(`[${E}:Instance:${m.EVENT}] Edge added`),co=h(`[${E}:Instance:${m.EVENT}] Edge removed`),ye=h(`[${E}:Instance:${m.EVENT}] Search finished`),lo=h(`[${E}:Instance:${m.EVENT}] Search invalidated`),gt=h(`[${E}:Instance:${m.COMMAND}] Load Graph`),ht=h(`[${E}:Instance:${m.COMMAND}] Reset Graph`),ce=h(`[${E}:Instance:${m.COMMAND}] Add node`),de=h(`[${E}:Instance:${m.COMMAND}] Remove node`),le=h(`[${E}:Instance:${m.COMMAND}] Update node`),H=h(`[${E}:Instance:${m.COMMAND}] Add edge`),W=h(`[${E}:Instance:${m.COMMAND}] Remove edge`),mt=h(`[${E}:Instance:${m.COMMAND}] Search`),ft=h(`[${E}:Instance:${m.COMMAND}] Invalidate Search`),R=e=>{const{modules:t}=p.useContext(be),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},xt={inputs:{},outputs:{}},ue=(e,t)=>{const s=R("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,a=A(d=>d?.Graph&&d.Graph.graphs[e],t),i=n(a),c=n(d=>d?.Graph&&d.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(d,l)=>{const u={...d,position:{x:0,y:0}};o(ce({graphId:e,node:u,edges:l??xt}))},removeNode:d=>{o(de({graphId:e,nodeId:d}))},updateNode:d=>{o(le({graphId:e,nodeId:d.id,changes:d}))},addEdge:d=>{o(H({graphId:e,edge:d}))},updateEdge:(d,l)=>{const u=c?.edges[d];if(u){o(W({graphId:e,edgeId:d}));const w={...u,...l};o(H({graphId:e,edge:w}))}},removeEdge:d=>{o(W({graphId:e,edgeId:d}))},nodeExists:d=>c?d in c.nodes:!1,search:(d,l,u,w,x,C,k)=>{const f=k??ne.uniqueId("search");return o(mt({id:f,graphId:e,strategy:d,nodeStart:l,validate:u,stopCriteria:w,depth:x,label:C??f})),f}}}},Se={nodes:{},edges:{},adjacencyList:{},searchResults:{}},wt={graphs:{}};h(`[${E}:${m.EVENT}:Init] Graph Module loaded`);const uo=h(`[${E}:GraphsManager:${m.EVENT}] Graph created`),po=h(`[${E}:GraphsManager:${m.EVENT}] Graph destroyed`),ve=h(`[${E}:GraphsManager:${m.COMMAND}] Create graph`),yt=h(`[${E}:GraphsManager:${m.COMMAND}] Destroy graph`),go=G({name:E,initialState:wt,reducers:{},extraReducers:e=>{e.addCase(gt,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ce,(t,{payload:{graphId:s,node:o,edges:n}})=>{const a=t.graphs[s];if(!a)throw Error("Graph does not exist");if(a.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...a,nodes:{...a.nodes,[o.id]:o},edges:{...a.edges,...Object.entries(n.inputs).reduce((c,[d,l])=>({...c,[d]:l}),{}),...Object.entries(n.outputs).reduce((c,[d,l])=>({...c,[d]:l}),{})},adjacencyList:{...a.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((c,[d,l])=>({...c,[l.sourceId]:{...a.adjacencyList[l.sourceId],outputs:[...a.adjacencyList[l.sourceId].outputs,d]}}),{}),...Object.entries(n.outputs).reduce((c,[d,l])=>({...c,[l.targetId]:{...a.adjacencyList[l.targetId],inputs:[...a.adjacencyList[l.targetId].inputs,d]}}),{})}}}}}).addCase(de,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([a,i])=>i.sourceId===o||i.targetId===o).map(([a,i])=>a);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((a,i)=>i.id!==o?{...a,[i.id]:i}:a,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,c])=>i!==o?{...a,[i]:{inputs:c.inputs.filter(d=>!n.includes(d)),outputs:c.outputs.filter(d=>!n.includes(d))}}:a,{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,c])=>n.includes(i)?a:{...a,[i]:c},{})}}}}).addCase(le,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const a=t.graphs[s],i=a.nodes[o];if(i===null)throw Error("Node does not exist");return a.nodes[o]={...i,...n},t}).addCase(H,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(W,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s].edges[o];return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,c])=>i===n.sourceId||i===n.targetId?{...a,[i]:{inputs:c.inputs.filter(d=>d!==o),outputs:c.outputs.filter(d=>d!==o)}}:{...a,[i]:c},{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,c])=>i!==o?{...a,[i]:c}:a,{})}}}}).addCase(ht,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...Se}}})).addCase(ye,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(ft,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),ho=G({name:E,initialState:wt,reducers:{},extraReducers:e=>{e.addCase(ve,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...Se,id:s},t}).addCase(yt,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(go.reducer)}}),$e=T();$e.startListening({actionCreator:ve,effect:async(e,t)=>{const{dispatch:s}=t;s(uo(e.payload))}});$e.startListening({actionCreator:yt,effect:async(e,t)=>{const{dispatch:s}=t;s(po(e.payload))}});const mo=(e,t,s,o,n)=>{const a=[],i=[];let c=0;const d=[t];for(;d.length;){const l=d.shift();if(!l)break;const u=e.nodes[l];if(a.push(u),s(u,e,i,a)&&i.push(u),o(u,e,i,a))break;if(n&&c>=n)continue;const x=e.adjacencyList[l];d.push(...x.outputs.map(C=>e.edges[C].targetId)),d.push(...x.inputs.map(C=>e.edges[C].sourceId)),c+=1}return{findings:i,visited:a}},fo=(e,t,s,o,n)=>({findings:[],visited:[]}),N=T();N.startListening({actionCreator:gt,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(oo({graphId:e,graph:t}))}});N.startListening({actionCreator:ce,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(no({graphId:e,node:t,edges:s}))}});N.startListening({actionCreator:de,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(ao({graphId:e,nodeId:t}))}});N.startListening({actionCreator:le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ro(e))}});N.startListening({actionCreator:H,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(io(e))}});N.startListening({actionCreator:W,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(co(e))}});N.startListening({actionCreator:mt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),a=n[e.graphId];if(a.searchResults&&e.id in a.searchResults&&!a.searchResults[e.id].outdated){s(ye({graphId:e.graphId,searchId:e.id,results:a.searchResults[e.id]}));return}let i={findings:[],visited:[]};switch(e.strategy){case"dfs":i={...fo(a,e.nodeStart,e.validate,e.stopCriteria,e.depth)};break;case"bfs":i=mo(a,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(ye({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});N.startListening({actionCreator:ft,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(lo(e))}});const b="Layout",xo="0.0.1",ke="ribbonMenuSections",U="viewportTypes",Mt="settings-panel",Ct="details-panel",bt="viewport-notifications-tray";function wo(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const yo=({width:e,height:t,nodeBorder:s})=>{const o=te().domain([-1,e+1]).range([-1,e+1]),n=te().domain([-1,t+1]).range([-1,t+1]),a=tt(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=st(n).ticks(10).tickSize(e).tickPadding(8-e);function c(w){w.append("circle").attr("r",x=>x.radius).attr("fill",x=>wo(x.group??"")).attr("stroke",s),w.append("text").text(x=>x.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function d(w){function x(f){f.active||w.alphaTarget(.3).restart(),f.subject.fx=f.subject.x,f.subject.fy=f.subject.y}function C(f){f.subject.fx=f.x,f.subject.fy=f.y}function k(f){f.active||w.alphaTarget(0),f.subject.fx=null,f.subject.fy=null}return ts().on("start",x).on("drag",C).on("end",k)}function l(w){w.append("line").attr("stroke-width","1em").attr("stroke","gray")}function u(w){w.each(x=>{w.attr("viewBox",[0,0,e,t]),w.selectAll("*").remove(),w.append("defs");const k=w.append("g").attr("role","grid"),f=w.append("g").attr("role","container"),g=k.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),M=k.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),S=nt().scaleExtent([-10,40]).filter(y=>(y.preventDefault(),(!y.ctrlKey||y.type==="wheel")&&!y.button)).on("zoom",({transform:y})=>{f.attr("transform",y),g.call(a.scale(y.rescaleX(o))),M.call(i.scale(y.rescaleY(n)))});w.call(S);const j=Qt(x.nodes).force("links",Zt(x.links).id(y=>y.id).distance(300).strength(1)).force("charge",Jt().strength(y=>y.strength)).force("colide",es(y=>y.radius)),D=f.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(x.links).join(y=>y.append("g").attr("role","link").attr("id",O=>O.id).call(l),y=>y,y=>y.remove()),v=f.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(x.nodes).join(y=>y.append("g").attr("role","node").attr("id",O=>O.id).call(d(j)).call(c),y=>y.select("circle").attr("cx",O=>O.x).attr("cy",O=>O.y),y=>y.remove());j.on("tick",()=>{v.attr("transform",y=>`translate(${y.x}, ${y.y})`),D.selectAll("line").attr("x1",y=>y.source.x).attr("y1",y=>y.source.y).attr("x2",y=>y.target.x).attr("y2",y=>y.target.y)}),j.alpha(1)})}return{render(w,x){ot(x).datum(w).call(u)}}},Mo=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=R("Layout"),s=p.useRef(null),o=p.useRef(null),n=t(o),a=ue(e,l=>l),i=p.useMemo(()=>!a.state||!a.state.nodes?{nodes:[],links:[]}:{nodes:Object.values(a.state.nodes).map(l=>({id:l.id,group:l.type,nodeLabel:l?.label||l.id,strength:-400,x:l.position.x,y:l.position.y,radius:50})),links:Object.values(a.state.edges).map(l=>({id:l.id,type:l.type,source:l.sourceId,target:l.targetId,value:5}))},[a]),c=ss(),d=yo({nodeBorder:c.palette.getContrastText(c.palette.background.default),width:n?.width??0,height:n?.height??0});return p.useLayoutEffect(()=>{!n||!s.current||d.render(i,s.current)},[i,n]),a.state?r.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:r.jsx("svg",{ref:s,id:`${a.id}`,width:"100%",height:"100%"})}):r.jsx(r.Fragment,{})},St=L.memo(Mo),Co=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(E,ho.reducer),e.functions.registerMiddleware($e),e.functions.registerMiddleware(N),t.functions.createRegistries({[ke]:{},[U]:{graph:St}})},bo=()=>{const e=ut();return{functions:{createGraph(t){return e(ve({graphId:t})),{id:t,state:{id:t,...Se},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ce({graphId:t,node:n,edges:o??xt}))},removeNode:s=>{e(de({graphId:t,nodeId:s}))},updateNode:s=>{e(le({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(H({graphId:t,edge:s}))},updateEdge:(s,o)=>{console.error("Not implemented yet")},removeEdge:s=>{e(W({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(ht({graphId:t}))}}}},So=(e,t)=>{const o=t??(n=>n);return A(n=>n.Graph,n=>n&&o(n.graphs[e]))},vo=(e,t)=>{const s=R("Graph"),{useGraph:o}=s.hooks,n=o(e,c=>c?.nodes[t]),a=o(e,c=>c?.adjacencyList[t]),i=o(e,c=>Object.values(c?.edges??{}).filter(d=>a.state?.inputs?.includes(d.id)||a.state?.outputs?.includes(d.id)).reduce((d,l)=>({...d,[l.id]:l}),{}));return{node:n.state,edges:i.state??{},adjacencyList:a.state??{inputs:[],outputs:[]}}},vt=(e,t)=>ue(e,o=>o?.searchResults&&o.searchResults[t]).state,$o=(e,t,s)=>{p.useEffect(()=>{s()},[]);const o=vt(e,t);return p.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},Ze={name:E,version:so,depends_on:["Store"],components:{GraphViewer:St},managers:{graphs:bo},hooks:{useGraph:ue,useNodeInfo:vo,useSearch:$o,useSearchResult:vt},store:{selectors:{getGraphState:So}},kernelCalls:{startModule:Co,restartModule(){},shutdownModule(){}}},pe=h(`[${b}:Theme:${m.COMMAND}] Switch theme`),ko=h(`[${b}:Theme:${m.EVENT}] Theme switched`),$t=T();$t.startListening({actionCreator:pe,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ko(e))}});const je=h(`[${b}:Ribbon:${m.COMMAND}] Add tab`),Ee=h(`[${b}:Ribbon:${m.COMMAND}] Select tab`),jo=h(`[${b}:Ribbon:${m.EVENT}] tab added`),Eo=h(`[${b}:Ribbon:${m.EVENT}] tab selected`),Re=T();Re.startListening({actionCreator:je,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(jo({tab:n[e.name]}))}});Re.startListening({actionCreator:Ee,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(Eo({tab:n[e]}))}});const Ae=h(`[${b}:Viewports:${m.COMMAND}] Add viewport`),Ve=h(`[${b}:Viewports:${m.COMMAND}] Select viewport`),De=h(`[${b}:Viewports:${m.COMMAND}] Close viewport`),kt=h(`[${b}:Viewports:${m.COMMAND}] Rename viewport`),Le=h(`[${b}:Viewports:${m.COMMAND}] Add viewport to group`),Me=h(`[${b}:Viewports:${m.COMMAND}] Viewport removed from group`),Ro=h(`[${b}:Viewports:${m.EVENT}] Viewport added`),Ao=h(`[${b}:Viewports:${m.EVENT}] Viewport selected`),Vo=h(`[${b}:Viewports:${m.EVENT}] Viewport closed`);h(`[${b}:Viewports:${m.EVENT}] Viewport renamed`);const Do=h(`[${b}:Viewports:${m.EVENT}] Viewport added to group`);h(`[${b}:Viewports:${m.EVENT}] Viewport removed from group`);const z=T();z.startListening({actionCreator:Ae,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(Ro(n[e]))}});z.startListening({actionCreator:Ve,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(Ao(n[e]))}});z.startListening({actionCreator:De,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(Vo({name:e}))}});z.startListening({actionCreator:Le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Do(e))}});z.startListening({actionCreator:Me,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Me(e))}});const Ge=h(`[${b}:Viewports:${m.COMMAND}] Create group`),Lo=h(`[${b}:Viewports:${m.EVENT}] Group created`),jt=T();jt.startListening({actionCreator:Ge,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Lo(e))}});const Oe=h(`[${b}:Panels:${m.COMMAND}] Expand settings panel`),Te=h(`[${b}:Panels:${m.COMMAND}] Collapse settings panel`),Ne=h(`[${b}:Panels:${m.COMMAND}] Open details panel`),Pe=h(`[${b}:Panels:${m.COMMAND}] Close details panel`),Go=h(`[${b}:Panels:${m.EVENT}] Settings panel expanded`),Oo=h(`[${b}:Panels:${m.EVENT}] Settings panel collapsed`),To=h(`[${b}:Panels:${m.EVENT}] Details panel opened`),No=h(`[${b}:Panels:${m.EVENT}] Details panel closed`),X=T();X.startListening({actionCreator:Oe,effect:async(e,t)=>{const{dispatch:s}=t;s(Go())}});X.startListening({actionCreator:Te,effect:async(e,t)=>{const{dispatch:s}=t;s(Oo())}});X.startListening({actionCreator:Ne,effect:async(e,t)=>{const{dispatch:s}=t;s(To())}});X.startListening({actionCreator:Pe,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(No({viewportName:n}))}});const Po=G({name:`${b}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(Ge,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),_o=G({name:`${b}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(Ae,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(De,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,a])=>n===s.name?o:{...o,[n]:a},{})})),e.addCase(Ve,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(kt,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[a,i])=>a===s?{...n,[s]:{...i,title:o}}:{...n,[a]:i},{})})),e.addCase(Le,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(Me,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:Po.reducer(t.groups,s)}))}}),Io=G({name:`${b}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase(je,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(Ee,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),Et={settings:{state:"expanded"},details:{state:"closed"}},Uo=G({name:b,initialState:Et,reducers:{},extraReducers:e=>{e.addCase(Oe,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Te,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(Ne,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(Pe,t=>({...t,details:{...t.details,state:"closed"}}))}}),zo={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:Et,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Fo=G({name:b,initialState:zo,reducers:{},extraReducers:e=>{e.addCase(pe,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:Uo.reducer(t.panels,s),ribbonMenu:Io.reducer(t.ribbonMenu,s),viewportManager:_o.reducer(t.viewportManager,s)}))}}),ee=({name:e,icon:t,summary:s,expanded:o,state:n,children:a,sx:i,...c})=>{const d=at("(min-width:1024px)");return n==="collapsed"?r.jsx(os,{children:t??r.jsx(Ke,{})}):r.jsxs(ns,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...c,children:[r.jsx(as,{expandIcon:r.jsx(rs,{}),"aria-controls":`accordion-${e}-content`,children:r.jsxs($,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??r.jsx(Ke,{}),r.jsx(se,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&d&&r.jsx(se,{component:"div",sx:{color:"text.secondary"},children:s})]})}),r.jsx(is,{children:a})]})};function _e(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(Oe())},collapseSettings(){s(Te())},openDetails(){s(Ne())},closeDetails(){s(Pe())}}}}A(e=>e.Layout,e=>e&&e.panels);const Bo=A(e=>e.Layout,e=>e&&e.panels.settings),Yo=A(e=>e.Layout,e=>e&&e.panels.details),Rt=({title:e,display:t,children:s})=>{const o=document.getElementById(Ct),n=at("(orientation: portrait)"),a=R("Store"),{useAppSelector:i}=a.hooks,c=_e(),d=i(Yo),l=p.useCallback(u=>{u.stopPropagation(),d&&d.state==="opened"&&c.functions.closeDetails()},[d?.state]);return!o||!d?null:Ce.createPortal(r.jsxs($,{role:"details-panel","aria-label":"details panel",display:d.state==="opened"?"flex":"none",sx:{flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!n&&r.jsx(_,{size:"small",component:"span",onClick:l,children:d.state==="opened"&&r.jsx(oe,{})}),r.jsx("span",{children:e??"Detalhes"})]}),r.jsx($,{role:"panel-content",children:r.jsx(ae,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),o)},At=({title:e,children:t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=_e(),a=o(Bo),i=document.getElementById(Mt),c=p.useCallback(d=>{d.stopPropagation(),a&&a.state==="collapsed"&&n.functions.expandSettings(),a&&a.state==="expanded"&&n.functions.collapseSettings()},[a?.state]);return!i||!a?null:Ce.createPortal(r.jsx($,{sx:{position:"relative"},children:r.jsxs($,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:a.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:a.state==="collapsed"?"8vw":"100%"}},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.state==="expanded"&&r.jsxs(r.Fragment,{children:[r.jsx(cs,{}),r.jsx("span",{children:e??"Configurações"})]}),r.jsx(_,{size:"small",component:"span",onClick:c,children:a.state==="collapsed"?r.jsx(ds,{sx:{transform:"rotate(90deg)"}}):r.jsx(ls,{sx:{transform:"rotate(90deg)"}})})]}),r.jsx($,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:a.state==="collapsed"?2:0,marginTop:4},children:r.jsx(ae,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:t.map((d,l)=>p.cloneElement(d,{state:a.state,key:l}))})})]})}),i)},qo=({name:e,title:t,type:s,group:o})=>r.jsxs(r.Fragment,{children:[r.jsxs(At,{children:[r.jsx(ee,{name:"Agenda",icon:r.jsx(us,{}),expanded:!0,children:r.jsx(r.Fragment,{})}),r.jsx(ee,{name:"Recebimentos",summary:"Recebimentos do mês",children:r.jsx(r.Fragment,{})}),r.jsx(ee,{name:"Andamento",summary:"Pedidos em produção",children:r.jsx(r.Fragment,{})})]}),r.jsx(Rt,{children:r.jsx(r.Fragment,{children:"Detalhes"})})]}),Ho=L.memo(qo),Wo=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(b,Fo.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(pe({theme:"dark"})),t.functions.registerMiddleware($t),t.functions.registerMiddleware(Re),t.functions.registerMiddleware(z),t.functions.registerMiddleware(jt),t.functions.registerMiddleware(X),s.functions.createRegistries({[ke]:{},[U]:{home:Ho}})};function Vt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(pe({theme:o}))}}}}const Dt=p.createContext({sections:{},setSections:()=>null}),Xo=({children:e,default_sections:t})=>{const[s,o]=p.useState(t??{});function n(i,c){o({...s,[i]:c})}const a=p.useMemo(()=>({sections:s,setSections:n}),[s]);return r.jsx(Dt.Provider,{value:a,children:e})},Lt=e=>e&&e.Layout?.ribbonMenu,Gt=A(Lt,e=>e&&e.tabs),Ko=A(Lt,e=>e&&e.activeTab);function Ot(){const e=R("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),a=t(Gt);return p.useContext(Dt),o(),{functions:{tabExists(i){return a!=null&&i in a},addNewTab(i){const c=ne.uniqueId("tab-"),d={...i,name:c,active:!1};n(je({tab:d}))},selectTab(i){n(Ee({name:i}))}}}}function Tt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(a){n.functions.registerComponents({[U]:a})},getViewportTypeComponent(a){const i=n.functions.getComponent(U,a);if(!i)throw Error("Unknown viewport type");return i},addViewport(a,i,c,d="viewport"){if(!n.functions.getComponent(U,i))throw Error("Unknown viewport type");const u=ne.uniqueId(d);return o(Ae({name:u,title:a,type:i,group:c})),u},renameViewport(a,i){o(kt({oldName:a,newName:i}))},selectViewport(a){o(Ve({name:a}))},closeViewport(a){o(De({name:a}))},createGroup(a,i){o(Ge({name:a,color:i}))},addToGroup(a,i){o(Le({viewportName:a,groupName:i}))}}}}const Ie=A(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Nt=e=>e.Layout.viewportManager,Qo=A(Nt,e=>e&&e.viewports),Pt=(e,t)=>{const o=t??(n=>n);return A(Nt,n=>n&&o(n.viewports[e]))},Zo=({children:e})=>{const t=document.getElementById(bt);return t?Ce.createPortal(r.jsx($,{sx:{position:"relative"},children:e}),t):null},Jo=({title:e,component:t,children:s,sx:o={}})=>{const[n,a]=p.useState(!1),i=p.useCallback(d=>{a(!0),d.stopPropagation()},[]),c=p.useCallback(()=>{a(!1)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(rt,{open:n,onClose:c,components:{Backdrop:void 0},children:r.jsxs(it,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&r.jsx(se,{variant:"subtitle1",component:"span",children:e}),L.cloneElement(t,{closeModal:c})]})}),r.jsx($,{onClick:i,children:s})]})},Ue=p.createContext({rows:[],setRows:()=>null}),en=({children:e,initialRows:t})=>{const[s,o]=p.useState((t??[]).map(a=>({...a,state:"untouched"}))),n=p.useMemo(()=>({rows:s,setRows:o}),[s]);return r.jsx(Ue.Provider,{value:n,children:e})},me=(e,t)=>t==="dark"?re(e,.7):ie(e,.7),fe=(e,t)=>t==="dark"?re(e,.6):ie(e,.6),xe=(e,t)=>t==="dark"?re(e,.5):ie(e,.5),we=(e,t)=>t==="dark"?re(e,.4):ie(e,.4),tn=ps(gs)(({theme:e})=>({"& .state--added":{backgroundColor:me(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:xe(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:we(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:me(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:xe(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:we(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:me(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:xe(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:we(e.palette.error.main,e.palette.mode)}}}})),sn=()=>r.jsx($,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:r.jsx(se,{variant:"body2",children:"Sem registros"})}),on=({handleAddRecord:e,addLabel:t})=>r.jsxs(ys,{sx:{display:"flex",justifyContent:"space-around"},children:[r.jsx(Ms,{startIcon:r.jsx(Cs,{}),onPointerUp:e,children:t||"Adicionar"}),r.jsx("div",{children:r.jsx(bs,{})})]}),nn=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:a}=p.useContext(Ue),[i,c]=p.useState({}),d=()=>{const g=s();a(M=>[...M,{...g,state:"added"}]),c(M=>({...M,[g.id]:{mode:F.Edit,fieldToFocus:"id"}}))},l=p.useCallback(g=>()=>{c(M=>({...M,[g]:{mode:F.Edit}}))},[]),u=g=>(a(M=>M.map(S=>S.id===g.id?{...g,old:{...S,old:null}}:S)),g),w=(g,M)=>{g.reason===Ss.rowFocusOut&&(M.defaultMuiPrevented=!0)},x=p.useCallback(g=>{const M=n.find(j=>j.id===g);if(!M)return;const S=M.state==="untouched"?"modified":M.state;a(j=>j.map(D=>D.id===g?{...D,state:S}:D)),c(j=>({...j,[g]:{mode:F.View}}))},[n]),C=p.useCallback(g=>()=>{a(M=>M.map(S=>S.id===g?{...S,state:"deleted",oldState:S.state}:S).filter(S=>!(S.state==="deleted"&&S?.oldState==="added")))},[]),k=p.useCallback(g=>()=>{a(M=>M.map(S=>S.id===g?{...S,state:S.oldState,oldState:"deleted"}:S))},[]),f=p.useCallback(g=>()=>{c(S=>({...S,[g]:{mode:F.View,ignoreModifications:!0}}));const M=n.find(S=>S.id===g);M&&M.state==="added"&&a(S=>S.filter(j=>j.id!==g))},[n]);return r.jsx(r.Fragment,{children:r.jsx(tn,{editMode:"row",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:w,processRowUpdate:u,slotProps:{toolbar:{handleAddRecord:d,addLabel:t}},slots:{noRowsOverlay:sn,toolbar:on},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",cellClassName:"actions",getActions:({id:g})=>{const M=n.find(j=>j.id===g);return M?i[g]?.mode===F.Edit?[r.jsx(B,{icon:r.jsx(hs,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>x(g)},"save"),r.jsx(B,{icon:r.jsx(ms,{}),label:"Cancel",className:"textPrimary",onClick:f(g),color:"inherit"},"cancel")]:M.state==="deleted"?[r.jsx(B,{icon:r.jsx(fs,{}),label:"Restore",className:"textPrimary",onClick:k(g),color:"inherit"},"restore")]:[r.jsx(B,{icon:r.jsx(xs,{}),label:"Edit",className:"textPrimary",onClick:l(g),color:"inherit"},"edit"),r.jsx(B,{icon:r.jsx(ws,{}),label:"Delete",onClick:C(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})})};function an({id:e,value:t,field:s}){const o=vs(),n=a=>{const i=a.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return r.jsx($s,{checked:t,onChange:n})}const rn=e=>{const[t,s]=p.useState();return p.useLayoutEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(a=>{a.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},_t={name:b,version:xo,depends_on:[],components:{SettingsPanel:At,DetailsPanel:Rt,ViewportNotificationsTray:Zo,Accordion:ee,SystemModal:Jo,CRUDGrid:nn,CRUDBooleanCell:an,CRUDGridProvider:en},contexts:{CRUDGridContext:Ue},hooks:{useLayoutManager:Vt,useRibbonMenuManager:Ot,useViewportManager:Tt,usePanelsManager:_e,useResizeObserver:rn},store:{selectors:{selectActiveViewport:Ie,getViewportState:Pt}},kernelCalls:{startModule:Wo,restartModule(){},shutdownModule(){}}},K="Loader",cn="0.0.1",q="modules",It=h(`[${K}:${m.EVENT}] Module started`),dn=h(`[${K}:${m.COMMAND}] Start module`),ln={modulesCount:1,modulesGraph:q},un=G({name:K,initialState:ln,reducers:{},extraReducers:e=>{e.addCase(It,t=>(t.modulesCount+=1,t))}}),pn=({managers:{storeManager:e}})=>{e.functions.loadReducer(K,un.reducer)};class Je extends Error{}class gn extends Error{}const hn=e=>e.modulesCount,mn=()=>{const{modules:e,setModules:t}=p.useContext(be),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=_t.hooks,{store:a,componentRegistry:i}=J.managers,c=s(),d=o(),l=n(),u=a(),w=i(),x=J.hooks.useAppDispatch(),C=J.hooks.useAppSelector;return{modulesLoaded:C(hn),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new gn(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),x(dn(g.name)),g.kernelCalls.startModule({dispatch:x,managers:{storeManager:u,componentRegistryManager:w,layoutManager:c,ribbonMenuManager:d,viewportManager:l}}),x(It(g.name))},unloadModule(g){if(!(g in e))throw new Je(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(u),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new Je(`${g} is not registered.`);const M=e[g];t(e),M.kernelCalls.restartModule(u)}}}},et={name:K,version:cn,depends_on:["Store","Graph"],managers:{modules:mn},kernelCalls:{startModule:pn,restartModule:()=>null,shutdownModule:()=>null}},fn=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=et.managers.modules(),o=ue(q,v=>v&&v.id),[n,a]=p.useState(!0),[i,c]=p.useState(!1),[d,l]=p.useState(0),[u,w]=p.useState(0),[x,C]=p.useState(0),k=p.useMemo(()=>[et,Ze,_t],[]),f=Ze.managers.graphs(),{createGraph:g,resetGraph:M}=f.functions;p.useEffect(()=>{const v=k[d];v&&!s.functions.isModuleLoaded(v.name)&&S(v)},[d]),p.useEffect(()=>{if(d===k.length){const v=t.kernel[u];v&&!s.functions.isModuleLoaded(v.name)&&j(v)}},[d,u]),p.useEffect(()=>{if(u===t.kernel.length){const v=t.system[x];v&&!s.functions.isModuleLoaded(v.name)&&D(v)}},[u,x]),p.useEffect(()=>{x===t.system.length&&a(!1)},[x]),p.useEffect(()=>{!n&&!o.state&&(g(q),c(!0))},[n]),p.useEffect(()=>{if(i&&!o.state&&g(q),!i)return;M(q);const v={id:"root",type:"ROOT"};o.actions.addNode(v),k.forEach(y=>o.actions.addNode({id:y.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${y.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:y.name}},outputs:{}})),t.kernel.forEach(y=>{y.depends_on.push("Loader");const O=y.depends_on.reduce((ge,P)=>{const he={id:`${P}->${y.name}`,type:"DEPENDS_ON",sourceId:P,targedId:y.name};return{...ge,[P]:he}},{});o.actions.addNode({id:y.name,type:"EXTRA_KERNEL_MODULE"},{inputs:O,outputs:{}})}),t.system.forEach(y=>{y.depends_on.push("Loader");const O=y.depends_on.reduce((ge,P)=>{const he={id:`${P}->${y.name}`,type:"DEPENDS_ON",sourceId:P,targedId:y.name};return{...ge,[P]:he}},{});o.actions.addNode({id:y.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:O,outputs:{}})}),a(!1)},[i]);function S(v){s.functions.loadModule(v),l(d+1)}function j(v){s.functions.loadModule(v),w(u+1)}function D(v){s.functions.loadModule(v),C(x+1)}return n?r.jsx("div",{children:"Iniciando sistema"}):e},xn=({children:e,loadModules:t})=>{const[s,o]=p.useState({Store:J}),n=p.useMemo(()=>({modules:s,setModules:o}),[s]);return r.jsx(be.Provider,{value:n,children:r.jsx(fn,{extraModules:t,afterLoadComponent:e})})},pa=L.memo(xn),wn={},Z=G({name:dt,initialState:wn,reducers:{},extraReducers:e=>{}}),yn=({children:e,default_registries:t})=>{const[s,o]=p.useState(t??{}),n=p.useMemo(()=>({registries:s,createRegistry:a,createRegistries:i,getComponent:c,registerComponents:d}),[s]);function a(l){o({...s,[l]:{}})}function i(l){o({...s,...l})}function c(l,u){return s[l][u]}function d(l){const u=s,w=Object.entries(l).reduce((x,[C,k])=>C in x?{...x,[C]:{...x[C],...k}}:x,u);o(w)}return r.jsx(pt.Provider,{value:n,children:e})},Mn=({children:e})=>{const[t,s]=p.useState({[Z.name]:Z.reducer}),o=p.useMemo(()=>ks({reducer:Qe({[Z.name]:Z.reducer}),middleware:i=>i({serializableCheck:!1}).concat(js)}),[]),n=i=>{Rs(i.middleware)},a=p.useCallback(i=>{const c={...t,...i};s(c),o.replaceReducer(Qe(c))},[t]);return r.jsx(Es,{store:o,children:r.jsx(lt.Provider,{value:{currentReducers:t,loadReducers:a,registerMiddleware:n},children:r.jsx(yn,{children:e})})})},ga=L.memo(Mn),Ut=A(e=>e.Layout,e=>e&&e.theme),Cn=({systemTray:e})=>{const t=R("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),a=Ot(),{selectTab:i}=a.functions,c=s(Gt),d=s(Ko),l=p.useCallback(u=>{i(u)},[]);return!d||!c?r.jsx(r.Fragment,{}):r.jsxs(As,{value:d,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[r.jsx(ct,{value:d,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(c).map(([u,w])=>r.jsx(Y,{value:u,label:w.label,id:u,onClick:()=>l(u),wrapped:!0},u))}),r.jsx($,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),r.jsx($,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:c&&Object.entries(c).map(([u,w])=>r.jsx(Vs,{value:u,children:w.sectionNames&&w.sectionNames.map(x=>{const C=n.functions.getComponent(ke,x);return p.createElement(C,{key:`ribbon-panel-${u}-section-${x}`},[])})},`ribbon-panel-${u}`))})]})},bn=({children:e,...t})=>{const s=p.useMemo(()=>({file:[r.jsx("div",{children:"test"},"test")]}),[]);return r.jsx(Xo,{default_sections:s,children:r.jsx(Cn,{...t,systemTray:e})})},Sn=L.memo(bn),vn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Ie),n=t(Pt(o));if(!n)return null;const a=s.functions.getComponent(U,n.type);return a?r.jsx(ae,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.createElement(a,n,[])}):null},$n=A(e=>e.Layout.viewportManager,e=>e&&e.groups),kn=({sx:e,...t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=o($n),a=o(Ie),i=o(Qo),c=p.useMemo(()=>Object.entries(i).reduce((C,[k,f])=>k==="home"?C:f.group?{...C,[f.group]:f.group in C?[...C[f.group],f]:[f]}:{...C,notGrouped:[...C.notGrouped,f]},{notGrouped:[]}),[i]),{functions:{addViewport:d,closeViewport:l,selectViewport:u}}=Tt(),w=p.useCallback(()=>{d("Nova aba","home",void 0,"new-")},[]),x=p.useCallback(C=>{l(C)},[]);return r.jsxs($,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},children:[r.jsxs(ct,{value:a,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[r.jsx(Y,{value:"home",icon:r.jsx(Ds,{}),iconPosition:"start",onClick:()=>u("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(c).map(([C,k])=>C==="notGrouped"?k.map(f=>r.jsx(Y,{value:f.name,id:f.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?u(f.name):x(f.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(oe,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),x(f.name)}})]}),draggable:!0,wrapped:!0},`${f.name}-tab`)):k.map(f=>r.jsx(Y,{value:f.name,id:f.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[f.group].color},onClick:()=>u(f.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(_,{size:"small",component:"span",children:r.jsx(oe,{sx:{width:.5,marginLeft:1},onClick:g=>{g.stopPropagation(),x(f.name)}})})]}),draggable:"true",wrapped:!0},`${f.name}-tab`))),r.jsx(Y,{value:"new",icon:r.jsx(Ls,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:w,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),r.jsx($,{id:bt,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),r.jsx($,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:r.jsx(vn,{})})]})},jn=L.memo(kn),En=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Ut),o=Vt(),n=p.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return r.jsx($,{role:"system-tray-container",children:r.jsx(_,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?r.jsx(Gs,{fontSize:"small"}):r.jsx(Os,{fontSize:"small"})})})},Rn=L.memo(En),An=Ts($)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,Vn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Ut),o=p.useMemo(()=>Ns({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return r.jsxs(Ps,{theme:o,children:[r.jsx(_s,{}),r.jsx($,{role:"layout-root",sx:{minHeight:"100vh"},children:r.jsxs(An,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[r.jsx($,{sx:{gridArea:"ribbon",width:"100%"},children:r.jsx(Sn,{children:r.jsx(Rn,{})})}),r.jsx($,{id:Mt,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),r.jsx(jn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),r.jsx($,{id:Ct,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},ha=L.memo(Vn),Dn=({dataTransform:e})=>(t,s,o)=>{const i=e(o),c=Is().innerRadius(200).outerRadius(210),l=Us().padAngle(5/200).sortSubgroups(zs)(i),u=Fs(Bs,5),w=["Tempo","Volume","Area","Comprimento"],x=Ys().radius(200-1).padAngle(1/200),C=s.append("g").attr("id","chord-plot"),k=C.append("g").attr("role","groups-container"),f=C.append("g").attr("role","chords-container").attr("fill-opacity",.75),g=k.selectAll().data(l.groups).join("g").attr("id",M=>w[M.index]);g.append("path").attr("fill",M=>u[M.index]).attr("d",c),g.append("text").attr("dy","0.35em").attr("transform",M=>`
        rotate(${(M.startAngle+M.endAngle)/2*180/Math.PI-90})
        translate(${210+5})
        ${(M.startAngle+M.endAngle)/2>Math.PI?"rotate(180)":""}
      `).attr("text-anchor",M=>(M.startAngle+M.endAngle)/2>Math.PI?"end":null).text(M=>w[M.index]).attr("fill","white"),f.selectAll().data(l).join("path").style("mix-blend-mode","add").attr("fill",M=>u[M.target.index]).attr("d",x).append("title").text(M=>`${w[M.source.index]} → ${w[M.target.index]} ${M.source.value}`)},Ln=({xSettings:e,ySettings:t,dimensions:[s,o]})=>{const n=te().domain(e.domain).range(e.range),a=te().domain(t.domain).range(t.range),i=tt(n).ticks((s+2)/(o+2)*10).tickSize(o).tickPadding(8-o),c=st(a).ticks(10).tickSize(s).tickPadding(8-s);return(d,l)=>{const u=l.append("g").attr("role","grid"),w=d.select("#content"),x=d.select("#overlays"),C=u.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),k=u.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(c),f=nt().scaleExtent([-10,40]).filter(g=>(g.preventDefault(),(!g.ctrlKey||g.type==="wheel")&&!g.button)).on("zoom",({transform:g})=>{w.attr("transform",g),x.attr("transform",g),C.call(i.scale(g.rescaleX(n))),k.call(c.scale(g.rescaleY(a)))});d.call(f)}},Gn=e=>e.SVG,On=e=>A(Gn,t=>t&&t.svgs[e]),Tn=({path:e,instanceName:t,beforeInjection:s,sx:o,...n})=>{const a=R("Store"),{useAppSelector:i}=a.hooks,c=i(On(e)),d=p.useCallback(u=>{if(u.setAttribute("id",`${e}-root`),u.setAttribute("width","100%"),u.setAttribute("height","100%"),t){if(!c?.instances[t])return;Object.entries(c?.instances[t].proxies??{}).forEach(([x,C])=>{const k=u.getElementById(x);k&&("fill"in C&&k.setAttribute("fill",C.fill),"stroke"in C&&k.setAttribute("stroke",C.stroke))})}s&&s(u)},[s,c?.content,t,c?.instances[t]]),l=p.useMemo(()=>c?.content&&window.URL.createObjectURL(new Blob([c.content],{type:"image/svg+xml"})),[c?.content]);return!c||!l?null:r.jsx($,{...n,role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{...o,width:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:r.jsx(qs,{style:{width:"100%",overflow:"hidden"},src:l,height:"100%",width:"100%",beforeInjection:d})})},V="SVG",Nn="0.0.1";function Pn(){let e=700,t=700,s=[],o=[],n=[];function a(c){c.each(d=>{c.attr("viewBox",[0,0,e,t]),c.selectAll("*").remove();const u=c.append("g").attr("id","underlays"),w=c.append("g").attr("id","content"),x=c.append("g").attr("id","overlays");s.forEach(C=>C(c,u,d)),o.forEach(C=>C(c,w,d)),n.forEach(C=>C(c,x,d))})}function i(c,d){ot(d).datum(c).call(a)}return i.width=c=>c?(e=c,i):e,i.height=c=>c?(t=c,i):t,i.underlays=c=>c?(s=c,i):s,i.content=c=>c?(o=c,i):o,i.overlays=c=>c?(n=c,i):n,i.render=i,i}const ze=h(`[${V}:SVG:${m.COMMAND}] Load SVG`),zt=h(`[${V}:SVG:${m.COMMAND}] Fetch SVG`),Ft=h(`[${V}:SVG:${m.COMMAND}] Set pan`),Bt=h(`[${V}:SVG:${m.COMMAND}] Set zoom`),Yt=h(`[${V}:SVG:${m.COMMAND}] Add proxy`),Fe=h(`[${V}:SVG:${m.COMMAND}] Update proxy`),Be=h(`[${V}:SVG:${m.COMMAND}] Delete proxy`),Ye=h(`[${V}:SVG:${m.EVENT}] SVG fetched`),_n=h(`[${V}:SVG:${m.EVENT}] SVG loaded`);h(`[${V}:SVG:${m.COMMAND}] Proxy added`);const In=h(`[${V}:SVG:${m.COMMAND}] Proxy updated`),Un=h(`[${V}:SVG:${m.COMMAND}] Proxy deleted`),zn=(e,t)=>{const s=R("Store"),{useAppDispatch:o}=s.hooks,n=o(),a=s.hooks.useAppSelector,i=A(d=>d&&d.SVG.svgs[e],t);return{state:a(i),actions:{setPan(d,l,u){n(Ft({path:e,instanceName:d,x:l*-10,y:u*-10}))},setZoom(d,l){n(Bt({path:e,instanceName:d,zoom:l}))},addProxy(d,l,u){n(Yt({path:e,instanceName:l,id:d,styles:u}))},deleteProxy(d,l){n(Be({path:e,instanceName:l,id:d}))},updateProxy(d,l,u){n(Fe({path:e,instanceName:l,id:d,changes:u}))}}}},Fn=()=>{const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(ze({path:o,instanceName:n}))}}}},Q=T();Q.startListening({actionCreator:ze,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(zt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Ye({path:e.path,content:n}))}});Q.startListening({actionCreator:Ye,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(_n(n[e.path]))}});Q.startListening({actionCreator:Fe,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(In(n[e.path].instances[e.instanceName].proxies))}});Q.startListening({actionCreator:Be,effect:async({payload:e},{dispatch:t})=>{t(Un(e))}});const Bn={progress:"not-started",instances:{},content:void 0},Yn={svgs:{}},qn=G({name:V,initialState:Yn,reducers:{},extraReducers:e=>{e.addCase(ze,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!ne.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...Bn,instances:n}}}}),e.addCase(zt,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(Ye,(t,{payload:{path:s,content:o}})=>({...t,svgs:{...t.svgs,[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(Yt,(t,{payload:{path:s,instanceName:o,id:n,styles:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:a}:{[n]:a}}}}}})),e.addCase(Bt,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(Ft,(t,{payload:{path:s,instanceName:o,x:n,y:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,a]}}}}})),e.addCase(Fe,(t,{payload:{path:s,instanceName:o,id:n,changes:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...a}:a}}}}}})),e.addCase(Be,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((a,[i,c])=>i===n?a:{...a,[i]:c},{})}}}}}))}}),Hn=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(V,qn.reducer),e.functions.registerMiddleware(Q)},ma={name:V,version:Nn,depends_on:[],components:{SVGViewer:Tn},d3Components:{Grid:Ln,ChordPlot:Dn},hooks:{useD3Container:Pn,useSVGManager:Fn,useSVG:zn},kernelCalls:{startModule:Hn,restartModule(){},shutdownModule(){}}},Wn=({initialPosition:e})=>{const[t,s]=p.useState(!1),[o,n]=p.useState({x:0,y:0}),[a,i]=p.useState(e),c=p.useCallback(u=>{s(!0),n({x:u.clientX,y:u.clientY}),u.stopPropagation()},[]),d=p.useCallback(u=>{if(!t)return;const w={x:u.clientX-o.x,y:u.clientY-o.y},x={x:a.x+w.x,y:a.y+w.y};i(x)},[t]),l=p.useCallback(u=>{s(!1),u.stopPropagation()},[]);return{position:a,setPosition:i,listeners:{onPointerDown:c,onPointerMove:d,onPointerUp:l}}},Xn=({children:e,component:t,actions:s,onClose:o})=>{const[n,a]=p.useState(!1),[i,c]=p.useState(!0),{innerWidth:d,innerHeight:l}=window,u=[d/2,l/2],{position:w,setPosition:x,listeners:C}=Wn({initialPosition:{x:u[0],y:u[1]}}),k=p.useCallback((j,D)=>{const v=j-u[0],y=D-u[1];return v<0?y<0?1:3:y<0?2:4},[u]),f=p.useMemo(()=>k(w.x,w.y),[w]),g=p.useRef(null);p.useEffect(()=>{if(n&&i&&g.current){const{clientWidth:j,clientHeight:D}=g.current;f%2==0?x(v=>({x:v.x-j,y:v.y-D})):f>2&&x(v=>({x:v.x,y:v.y-D})),c(!1)}n||c(!0)},[n,g.current]);const M=p.useCallback(j=>{a(!0),x({x:j.clientX,y:j.clientY}),j.stopPropagation()},[]),S=p.useCallback(j=>{a(!1),j.stopPropagation(),o?.(j)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(rt,{open:n,keepMounted:!0,onClose:S,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...C,children:r.jsx(it,{sx:{position:"fixed",margin:1,left:w.x,top:w.y},elevation:6,children:r.jsxs($,{ref:g,sx:{display:"flex",flexGrow:1,flexDirection:f%2==1?"row":"row-reverse"},children:[r.jsxs($,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignContent:"space-between",borderLeft:`1px solid rgba(0,0,0, ${f%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${f%2==1?.1:0})`},children:[r.jsx(_,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:r.jsx(Hs,{})}),s.map(j=>p.cloneElement(j,{size:"small",closeContainer:S})),r.jsx(_,{color:"error",onClick:S,size:"small",id:"close-panel",children:r.jsx(oe,{})},"reject")]}),r.jsx($,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:r.jsx(ae,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.cloneElement(t,{isOpen:n})})})]})})}),p.cloneElement(e,{onClick:M})]})},Kn=({gestures:e,children:t})=>{const s=p.useRef(null),n=Ws(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return r.jsx($,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},qe="Pointer",Qn="0.0.1",Zn={},Jn=G({name:qe,initialState:Zn,reducers:{},extraReducers:e=>{}}),ea=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(qe,Jn.reducer),console.info("Pointer module started"),console.groupEnd()},ta=({closeContainer:e,handleConfirm:t,...s})=>p.createElement(_,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},r.jsx(Xs,{})),fa={name:qe,version:Qn,depends_on:[],components:{MultiTouchPanel:Kn,PointerContainer:Xn,ConfirmAndCloseButton:ta},hooks:{},store:{},kernelCalls:{startModule:ea,restartModule(){},shutdownModule(){}}},I="Markdown",sa="0.0.1",He=h(`[${I}:SVG:${m.COMMAND}] Load Markdown`),qt=h(`[${I}:SVG:${m.COMMAND}] Fetch Markdown`),We=h(`[${I}:SVG:${m.EVENT}] Markdown fetched`),Ht=h(`[${I}:SVG:${m.EVENT}] Markdown loaded`),oa=()=>{const e=R("Store"),{hooks:{useAppDispatch:t}}=e,s=t();return{loadMarkdown(o){s(He({path:o}))}}},na=e=>e.Markdown,aa=e=>A(na,t=>t&&t.markdowns[e]),Wt=e=>{const t=R("Store"),{useAppSelector:s}=t.hooks;return s(aa(e))},ra=({path:e,...t})=>{const s=oa();p.useLayoutEffect(()=>{s.loadMarkdown(e)},[e]);const o=Wt(e);return!o||o.progress!=="completed"?r.jsx(r.Fragment,{}):r.jsx(Ks,{...t,remarkPlugins:[Qs],children:o.content})},Xe=T();Xe.startListening({actionCreator:He,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(qt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(We({path:e.path,content:n}))}});Xe.startListening({actionCreator:We,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{Markdown:{markdowns:n}}=o();s(Ht(n[e.path]))}});const ia={progress:"not-started",content:null},ca={markdowns:{}},da=G({name:I,initialState:ca,reducers:{},extraReducers:e=>{e.addCase(He,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...ia,path:s}}})),e.addCase(qt,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"started"}}})),e.addCase(We,(t,{payload:{path:s,content:o}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],content:o}}})),e.addCase(Ht,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"completed"}}}))}}),la=({managers:{storeManager:e}})=>{e.functions.loadReducer(I,da.reducer),e.functions.registerMiddleware(Xe)},xa={name:I,version:sa,depends_on:[],components:{MarkdownReader:ra},hooks:{useMarkdown:Wt},kernelCalls:{startModule:la,restartModule(){},shutdownModule(){}}};export{m as A,ga as D,ha as L,pa as M,_n as S,Yt as a,ce as b,De as c,yt as d,le as e,H as f,W as g,No as h,ft as i,de as j,Be as k,gt as l,ze as m,R as n,ve as o,ma as p,fa as q,Me as r,xa as s,Fe as u};
