import{r as d,u as Pt,a as It,R as L,c as h,b as A,_ as ee,d as O,e as N,l as We,f as _t,g as Ut,s as zt,z as Ft,h as Bt,i as Wt,j as Ht,k as Yt,m as qt,n as a,o as Ce,E as te,p as Xt,q as He,t as Kt,P as Qt,v as Zt,w as Jt,x as es}from"./vendor-10645561.js";import{u as ts,a as Qe,S as ss,d as Ye,M as os,A as ns,b as rs,B as $,T as Z,c as as,I,e as J,f as is,g as cs,h as ds,i as ls,j as Ze,P as Je,s as us,D as ps,k as se,l as oe,G as z,m as F,n as gs,o as hs,p as ms,q as fs,r as xs,t as ys,v as Cs,w as ws,x as Ms,y as bs,z as Ss,C as vs,E as $s,F as js,H as et,J as B,K as Es,L as ks,N as Rs,O as Vs,Q as As,R as Ds,U as Ls,V as Ts,W as Os,X as Gs,Y as Ns}from"./material-4d42ad69.js";import{m as Ps}from"./system/Converter-f2398a4b.js";import{m as Is}from"./system/Materials-047aead8.js";import{m as _s}from"./system/Composer-37db3a12.js";const tt="Store",Us="0.0.1",st=d.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),zs=()=>{const{loadReducers:e,registerMiddleware:t}=d.useContext(st);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},ot=()=>Pt(),Fs=It,nt=d.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>L.memo(()=>null),registerComponents:()=>null}),Bs=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=d.useContext(nt);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},K={name:tt,version:Us,depends_on:[],managers:{store:zs,componentRegistry:Bs},hooks:{useAppDispatch:ot,useAppSelector:Fs},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},we=d.createContext({modules:{},setModules:()=>null}),m={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},E="Graph",Ws="0.0.1",Hs=h(`[${E}:Instance:${m.EVENT}] Graph loaded`),Ys=h(`[${E}:Instance:${m.EVENT}] Node added`),qs=h(`[${E}:Instance:${m.EVENT}] Node removed`),Xs=h(`[${E}:Instance:${m.EVENT}] Node updated`),Ks=h(`[${E}:Instance:${m.EVENT}] Edge added`),Qs=h(`[${E}:Instance:${m.EVENT}] Edge removed`),xe=h(`[${E}:Instance:${m.EVENT}] Search finished`),Zs=h(`[${E}:Instance:${m.EVENT}] Search invalidated`),rt=h(`[${E}:Instance:${m.COMMAND}] Load Graph`),at=h(`[${E}:Instance:${m.COMMAND}] Reset Graph`),ne=h(`[${E}:Instance:${m.COMMAND}] Add node`),re=h(`[${E}:Instance:${m.COMMAND}] Remove node`),ae=h(`[${E}:Instance:${m.COMMAND}] Update node`),ie=h(`[${E}:Instance:${m.COMMAND}] Add edge`),ce=h(`[${E}:Instance:${m.COMMAND}] Remove edge`),it=h(`[${E}:Instance:${m.COMMAND}] Search`),ct=h(`[${E}:Instance:${m.COMMAND}] Invalidate Search`),R=e=>{const{modules:t}=d.useContext(we),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},dt={inputs:{},outputs:{}},de=(e,t)=>{const s=R("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,r=A(c=>c?.Graph&&c.Graph.graphs[e],t),i=n(r),l=n(c=>c?.Graph&&c.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(c,u)=>{const p={...c,position:{x:0,y:0}};o(ne({graphId:e,node:p,edges:u??dt}))},removeNode:c=>{o(re({graphId:e,nodeId:c}))},updateNode:c=>{o(ae({graphId:e,nodeId:c.id,changes:c}))},addEdge:c=>{o(ie({graphId:e,edge:c}))},removeEdge:c=>{o(ce({graphId:e,edgeId:c}))},nodeExists:c=>l?c in l.nodes:!1,search:(c,u,p,C,y,M,k)=>{const f=k??ee.uniqueId("search");return o(it({id:f,graphId:e,strategy:c,nodeStart:u,validate:p,stopCriteria:C,depth:y,label:M??f})),f}}}},Me={nodes:{},edges:{},adjacencyList:{},searchResults:{}},lt={graphs:{}};h(`[${E}:${m.EVENT}:Init] Graph Module loaded`);const Js=h(`[${E}:GraphsManager:${m.EVENT}] Graph created`),eo=h(`[${E}:GraphsManager:${m.EVENT}] Graph destroyed`),be=h(`[${E}:GraphsManager:${m.COMMAND}] Create graph`),ut=h(`[${E}:GraphsManager:${m.COMMAND}] Destroy graph`),to=O({name:E,initialState:lt,reducers:{},extraReducers:e=>{e.addCase(rt,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ne,(t,{payload:{graphId:s,node:o,edges:n}})=>{const r=t.graphs[s];if(!r)throw Error("Graph does not exist");if(r.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...r,nodes:{...r.nodes,[o.id]:o},edges:{...r.edges,...Object.entries(n.inputs).reduce((l,[c,u])=>({...l,[c]:u}),{}),...Object.entries(n.outputs).reduce((l,[c,u])=>({...l,[c]:u}),{})},adjacencyList:{...r.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((l,[c,u])=>({...l,[u.sourceId]:{...r.adjacencyList[u.sourceId],outputs:[...r.adjacencyList[u.sourceId].outputs,c]}}),{}),...Object.entries(n.outputs).reduce((l,[c,u])=>({...l,[u.targetId]:{...r.adjacencyList[u.targetId],inputs:[...r.adjacencyList[u.targetId].inputs,c]}}),{})}}}}}).addCase(re,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([r,i])=>i.sourceId===o||i.targetId===o).map(([r,i])=>r);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((r,i)=>i.id!==o?{...r,[i.id]:i}:r,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((r,[i,l])=>i!==o?{...r,[i]:{inputs:l.inputs.filter(c=>!n.includes(c)),outputs:l.outputs.filter(c=>!n.includes(c))}}:r,{}),edges:Object.entries(t.graphs[s].edges).reduce((r,[i,l])=>n.includes(i)?r:{...r,[i]:l},{})}}}}).addCase(ae,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const r=t.graphs[s],i=r.nodes[o];if(i===null)throw Error("Node does not exist");return r.nodes[o]={...i,...n},t}).addCase(ie,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(ce,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s],r=n.edges[o];if(!r)throw Error("Edge does not exist");return delete n.edges[o],n.adjacencyList[r.sourceId].outputs=n.adjacencyList[r.sourceId].outputs.filter(i=>i!==r.id),n.adjacencyList[r.targetId].inputs=n.adjacencyList[r.targetId].inputs.filter(i=>i!==r.id),t}).addCase(at,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...Me}}})).addCase(xe,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(ct,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),so=O({name:E,initialState:lt,reducers:{},extraReducers:e=>{e.addCase(be,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...Me,id:s},t}).addCase(ut,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(to.reducer)}}),Se=N();Se.startListening({actionCreator:be,effect:async(e,t)=>{const{dispatch:s}=t;s(Js(e.payload))}});Se.startListening({actionCreator:ut,effect:async(e,t)=>{const{dispatch:s}=t;s(eo(e.payload))}});const oo=(e,t,s,o,n)=>{const r=[],i=[];let l=0;const c=[t];for(;c.length;){const u=c.shift();if(!u)break;const p=e.nodes[u];if(r.push(p),s(p,e,i,r)&&i.push(p),o(p,e,i,r))break;if(n&&l>=n)continue;const y=e.adjacencyList[u];c.push(...y.outputs.map(M=>e.edges[M].targetId)),c.push(...y.inputs.map(M=>e.edges[M].sourceId)),l+=1}return{findings:i,visited:r}},no=(e,t,s,o,n)=>({findings:[],visited:[]}),G=N();G.startListening({actionCreator:rt,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(Hs({graphId:e,graph:t}))}});G.startListening({actionCreator:ne,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(Ys({graphId:e,node:t,edges:s}))}});G.startListening({actionCreator:re,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(qs({graphId:e,nodeId:t}))}});G.startListening({actionCreator:ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Xs(e))}});G.startListening({actionCreator:ie,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Ks(e))}});G.startListening({actionCreator:ce,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Qs(e))}});G.startListening({actionCreator:it,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),r=n[e.graphId];if(r.searchResults&&e.id in r.searchResults&&!r.searchResults[e.id].outdated){s(xe({graphId:e.graphId,searchId:e.id,results:r.searchResults[e.id]}));return}let i={findings:[],visited:[]};switch(e.strategy){case"dfs":i={...no(r,e.nodeStart,e.validate,e.stopCriteria,e.depth)};break;case"bfs":i=oo(r,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(xe({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});G.startListening({actionCreator:ct,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Zs(e))}});const w="Layout",ro="0.0.1",ve="ribbonMenuSections",_="viewportTypes",pt="settings-panel",gt="details-panel",ht="viewport-notifications-tray";function ao(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const io=({width:e,height:t,nodeBorder:s})=>{const o=We().domain([-1,e+1]).range([-1,e+1]),n=We().domain([-1,t+1]).range([-1,t+1]),r=_t(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=Ut(n).ticks(10).tickSize(e).tickPadding(8-e);function l(C){C.append("circle").attr("r",y=>y.radius).attr("fill",y=>ao(y.group??"")).attr("stroke",s),C.append("text").text(y=>y.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function c(C){function y(f){f.active||C.alphaTarget(.3).restart(),f.subject.fx=f.subject.x,f.subject.fy=f.subject.y}function M(f){f.subject.fx=f.x,f.subject.fy=f.y}function k(f){f.active||C.alphaTarget(0),f.subject.fx=null,f.subject.fy=null}return qt().on("start",y).on("drag",M).on("end",k)}function u(C){C.append("line").attr("stroke-width","1em").attr("stroke","gray")}function p(C){C.each(y=>{C.attr("viewBox",[0,0,e,t]),C.selectAll("*").remove(),C.append("defs");const k=C.append("g").attr("role","grid"),f=C.append("g").attr("role","container"),g=k.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(r),S=k.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),b=Ft().scaleExtent([-10,40]).filter(x=>(x.preventDefault(),(!x.ctrlKey||x.type==="wheel")&&!x.button)).on("zoom",({transform:x})=>{f.attr("transform",x),g.call(r.scale(x.rescaleX(o))),S.call(i.scale(x.rescaleY(n)))});C.call(b);const j=Bt(y.nodes).force("links",Wt(y.links).id(x=>x.id).distance(300).strength(1)).force("charge",Ht().strength(x=>x.strength)).force("colide",Yt(x=>x.radius)),D=f.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(y.links).join(x=>x.append("g").attr("role","link").attr("id",T=>T.id).call(u),x=>x,x=>x.remove()),v=f.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(y.nodes).join(x=>x.append("g").attr("role","node").attr("id",T=>T.id).call(c(j)).call(l),x=>x.select("circle").attr("cx",T=>T.x).attr("cy",T=>T.y),x=>x.remove());j.on("tick",()=>{v.attr("transform",x=>`translate(${x.x}, ${x.y})`),D.selectAll("line").attr("x1",x=>x.source.x).attr("y1",x=>x.source.y).attr("x2",x=>x.target.x).attr("y2",x=>x.target.y)}),j.alpha(1)})}return{render(C,y){zt(y).datum(C).call(p)}}},co=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=R("Layout"),s=d.useRef(null),o=d.useRef(null),n=t(o),r=de(e,u=>u),i=d.useMemo(()=>!r.state||!r.state.nodes?{nodes:[],links:[]}:{nodes:Object.values(r.state.nodes).map(u=>({id:u.id,group:u.type,nodeLabel:u?.label||u.id,strength:-400,x:u.position.x,y:u.position.y,radius:50})),links:Object.values(r.state.edges).map(u=>({id:u.id,type:u.type,source:u.sourceId,target:u.targetId,value:5}))},[r]),l=ts(),c=io({nodeBorder:l.palette.getContrastText(l.palette.background.default),width:n?.width??0,height:n?.height??0});return d.useEffect(()=>{!n||!s.current||c.render(i,s.current)},[i,n]),r.state?a.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:a.jsx("svg",{ref:s,id:`${r.id}`,width:"100%",height:"100%"})}):a.jsx(a.Fragment,{})},mt=L.memo(co),lo=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(E,so.reducer),e.functions.registerMiddleware(Se),e.functions.registerMiddleware(G),t.functions.createRegistries({[ve]:{},[_]:{graph:mt}})},uo=()=>{const e=ot();return{functions:{createGraph(t){return e(be({graphId:t})),{id:t,state:{id:t,...Me},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ne({graphId:t,node:n,edges:o??dt}))},removeNode:s=>{e(re({graphId:t,nodeId:s}))},updateNode:s=>{e(ae({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(ie({graphId:t,edge:s}))},removeEdge:s=>{e(ce({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(at({graphId:t}))}}}},po=(e,t)=>{const o=t??(n=>n);return A(n=>n.Graph,n=>n&&o(n.graphs[e]))},go=(e,t)=>{const s=R("Graph"),{useGraph:o}=s.hooks,n=o(e,l=>l?.nodes[t]),r=o(e,l=>l?.adjacencyList[t]),i=o(e,l=>Object.values(l?.edges??{}).filter(c=>r.state?.inputs?.includes(c.id)||r.state?.outputs?.includes(c.id)).reduce((c,u)=>({...c,[u.id]:u}),{}));return{node:n.state,edges:i.state??{},adjacencyList:r.state??{inputs:[],outputs:[]}}},ft=(e,t)=>de(e,o=>o?.searchResults&&o.searchResults[t]).state,ho=(e,t,s)=>{d.useEffect(()=>{s()},[]);const o=ft(e,t);return d.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},qe={name:E,version:Ws,depends_on:["Store"],components:{GraphViewer:mt},managers:{graphs:uo},hooks:{useGraph:de,useNodeInfo:go,useSearch:ho,useSearchResult:ft},store:{selectors:{getGraphState:po}},kernelCalls:{startModule:lo,restartModule(){},shutdownModule(){}}},le=h(`[${w}:Theme:${m.COMMAND}] Switch theme`),mo=h(`[${w}:Theme:${m.EVENT}] Theme switched`),xt=N();xt.startListening({actionCreator:le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(mo(e))}});const $e=h(`[${w}:Ribbon:${m.COMMAND}] Add tab`),je=h(`[${w}:Ribbon:${m.COMMAND}] Select tab`),fo=h(`[${w}:Ribbon:${m.EVENT}] tab added`),xo=h(`[${w}:Ribbon:${m.EVENT}] tab selected`),Ee=N();Ee.startListening({actionCreator:$e,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(fo({tab:n[e.name]}))}});Ee.startListening({actionCreator:je,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(xo({tab:n[e]}))}});const ke=h(`[${w}:Viewports:${m.COMMAND}] Add viewport`),Re=h(`[${w}:Viewports:${m.COMMAND}] Select viewport`),Ve=h(`[${w}:Viewports:${m.COMMAND}] Close viewport`),yt=h(`[${w}:Viewports:${m.COMMAND}] Rename viewport`),Ae=h(`[${w}:Viewports:${m.COMMAND}] Add viewport to group`),ye=h(`[${w}:Viewports:${m.COMMAND}] Viewport removed from group`),yo=h(`[${w}:Viewports:${m.EVENT}] Viewport added`),Co=h(`[${w}:Viewports:${m.EVENT}] Viewport selected`),wo=h(`[${w}:Viewports:${m.EVENT}] Viewport closed`);h(`[${w}:Viewports:${m.EVENT}] Viewport renamed`);const Mo=h(`[${w}:Viewports:${m.EVENT}] Viewport added to group`);h(`[${w}:Viewports:${m.EVENT}] Viewport removed from group`);const U=N();U.startListening({actionCreator:ke,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(yo(n[e]))}});U.startListening({actionCreator:Re,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(Co(n[e]))}});U.startListening({actionCreator:Ve,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(wo({name:e}))}});U.startListening({actionCreator:Ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Mo(e))}});U.startListening({actionCreator:ye,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ye(e))}});const De=h(`[${w}:Viewports:${m.COMMAND}] Create group`),bo=h(`[${w}:Viewports:${m.EVENT}] Group created`),Ct=N();Ct.startListening({actionCreator:De,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(bo(e))}});const Le=h(`[${w}:Panels:${m.COMMAND}] Expand settings panel`),Te=h(`[${w}:Panels:${m.COMMAND}] Collapse settings panel`),Oe=h(`[${w}:Panels:${m.COMMAND}] Open details panel`),Ge=h(`[${w}:Panels:${m.COMMAND}] Close details panel`),So=h(`[${w}:Panels:${m.EVENT}] Settings panel expanded`),vo=h(`[${w}:Panels:${m.EVENT}] Settings panel collapsed`),$o=h(`[${w}:Panels:${m.EVENT}] Details panel opened`),jo=h(`[${w}:Panels:${m.EVENT}] Details panel closed`),H=N();H.startListening({actionCreator:Le,effect:async(e,t)=>{const{dispatch:s}=t;s(So())}});H.startListening({actionCreator:Te,effect:async(e,t)=>{const{dispatch:s}=t;s(vo())}});H.startListening({actionCreator:Oe,effect:async(e,t)=>{const{dispatch:s}=t;s($o())}});H.startListening({actionCreator:Ge,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(jo({viewportName:n}))}});const Eo=O({name:`${w}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(De,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),ko=O({name:`${w}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(ke,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(Ve,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,r])=>n===s.name?o:{...o,[n]:r},{})})),e.addCase(Re,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(yt,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[r,i])=>r===s?{...n,[s]:{...i,title:o}}:{...n,[r]:i},{})})),e.addCase(Ae,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(ye,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:Eo.reducer(t.groups,s)}))}}),Ro=O({name:`${w}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase($e,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(je,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),wt={settings:{state:"expanded"},details:{state:"closed"}},Vo=O({name:w,initialState:wt,reducers:{},extraReducers:e=>{e.addCase(Le,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Te,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(Oe,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(Ge,t=>({...t,details:{...t.details,state:"closed"}}))}}),Ao={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:wt,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Do=O({name:w,initialState:Ao,reducers:{},extraReducers:e=>{e.addCase(le,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:Vo.reducer(t.panels,s),ribbonMenu:Ro.reducer(t.ribbonMenu,s),viewportManager:ko.reducer(t.viewportManager,s)}))}}),Q=({name:e,icon:t,summary:s,expanded:o,state:n,children:r,sx:i,...l})=>{const c=Qe("(min-width:1024px)");return n==="collapsed"?a.jsx(ss,{children:t??a.jsx(Ye,{})}):a.jsxs(os,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...l,children:[a.jsx(ns,{expandIcon:a.jsx(rs,{}),"aria-controls":`accordion-${e}-content`,children:a.jsxs($,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??a.jsx(Ye,{}),a.jsx(Z,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&c&&a.jsx(Z,{component:"div",sx:{color:"text.secondary"},children:s})]})}),a.jsx(as,{children:r})]})};function Ne(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(Le())},collapseSettings(){s(Te())},openDetails(){s(Oe())},closeDetails(){s(Ge())}}}}A(e=>e.Layout,e=>e&&e.panels);const Lo=A(e=>e.Layout,e=>e&&e.panels.settings),To=A(e=>e.Layout,e=>e&&e.panels.details),Mt=({title:e,display:t,children:s})=>{const o=document.getElementById(gt),n=Qe("(orientation: portrait)"),r=R("Store"),{useAppSelector:i}=r.hooks,l=Ne(),c=i(To),u=d.useCallback(p=>{p.stopPropagation(),c&&c.state==="opened"&&l.functions.closeDetails()},[c?.state]);return!o||!c?null:Ce.createPortal(a.jsxs($,{role:"details-panel","aria-label":"details panel",display:c.state==="opened"?"flex":"none",sx:{flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},children:[a.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!n&&a.jsx(I,{size:"small",component:"span",onClick:u,children:c.state==="opened"&&a.jsx(J,{})}),a.jsx("span",{children:e??"Detalhes"})]}),a.jsx($,{role:"panel-content",children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),o)},bt=({title:e,children:t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=Ne(),r=o(Lo),i=document.getElementById(pt),l=d.useCallback(c=>{c.stopPropagation(),r&&r.state==="collapsed"&&n.functions.expandSettings(),r&&r.state==="expanded"&&n.functions.collapseSettings()},[r?.state]);return!i||!r?null:Ce.createPortal(a.jsx($,{sx:{position:"relative"},children:a.jsxs($,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:r.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:r.state==="collapsed"?"8vw":"100%"}},children:[a.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.state==="expanded"&&a.jsxs(a.Fragment,{children:[a.jsx(is,{}),a.jsx("span",{children:e??"Configurações"})]}),a.jsx(I,{size:"small",component:"span",onClick:l,children:r.state==="collapsed"?a.jsx(cs,{sx:{transform:"rotate(90deg)"}}):a.jsx(ds,{sx:{transform:"rotate(90deg)"}})})]}),a.jsx($,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:r.state==="collapsed"?2:0,marginTop:4},children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:t.map((c,u)=>d.cloneElement(c,{state:r.state,key:u}))})})]})}),i)},Oo=({name:e,title:t,type:s,group:o})=>a.jsxs(a.Fragment,{children:[a.jsxs(bt,{children:[a.jsx(Q,{name:"Agenda",icon:a.jsx(ls,{}),expanded:!0,children:a.jsx(a.Fragment,{})}),a.jsx(Q,{name:"Recebimentos",summary:"Recebimentos do mês",children:a.jsx(a.Fragment,{})}),a.jsx(Q,{name:"Andamento",summary:"Pedidos em produção",children:a.jsx(a.Fragment,{})})]}),a.jsx(Mt,{children:a.jsx(a.Fragment,{children:"Detalhes"})})]}),Go=L.memo(Oo),No=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(w,Do.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(le({theme:"dark"})),t.functions.registerMiddleware(xt),t.functions.registerMiddleware(Ee),t.functions.registerMiddleware(U),t.functions.registerMiddleware(Ct),t.functions.registerMiddleware(H),s.functions.createRegistries({[ve]:{},[_]:{home:Go}})};function St(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(le({theme:o}))}}}}const vt=d.createContext({sections:{},setSections:()=>null}),Po=({children:e,default_sections:t})=>{const[s,o]=d.useState(t??{});function n(i,l){o({...s,[i]:l})}const r=d.useMemo(()=>({sections:s,setSections:n}),[s]);return a.jsx(vt.Provider,{value:r,children:e})},$t=e=>e&&e.Layout?.ribbonMenu,jt=A($t,e=>e&&e.tabs),Io=A($t,e=>e&&e.activeTab);function Et(){const e=R("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),r=t(jt);return d.useContext(vt),o(),{functions:{tabExists(i){return r!=null&&i in r},addNewTab(i){const l=ee.uniqueId("tab-"),c={...i,name:l,active:!1};n($e({tab:c}))},selectTab(i){n(je({name:i}))}}}}function kt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(r){n.functions.registerComponents({[_]:r})},getViewportTypeComponent(r){const i=n.functions.getComponent(_,r);if(!i)throw Error("Unknown viewport type");return i},addViewport(r,i,l,c="viewport"){if(!n.functions.getComponent(_,i))throw Error("Unknown viewport type");const p=ee.uniqueId(c);return o(ke({name:p,title:r,type:i,group:l})),p},renameViewport(r,i){o(yt({oldName:r,newName:i}))},selectViewport(r){o(Re({name:r}))},closeViewport(r){o(Ve({name:r}))},createGroup(r,i){o(De({name:r,color:i}))},addToGroup(r,i){o(Ae({viewportName:r,groupName:i}))}}}}const Pe=A(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Rt=e=>e.Layout.viewportManager,_o=A(Rt,e=>e&&e.viewports),Vt=(e,t)=>{const o=t??(n=>n);return A(Rt,n=>n&&o(n.viewports[e]))},Uo=({children:e})=>{const t=document.getElementById(ht);return t?Ce.createPortal(a.jsx($,{sx:{position:"relative"},children:e}),t):null},zo=({title:e,component:t,children:s,sx:o={}})=>{const[n,r]=d.useState(!1),i=d.useCallback(c=>{r(!0),c.stopPropagation()},[]),l=d.useCallback(()=>{r(!1)},[]);return a.jsxs(a.Fragment,{children:[a.jsx(Ze,{open:n,onClose:l,components:{Backdrop:void 0},children:a.jsxs(Je,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&a.jsx(Z,{variant:"subtitle1",component:"span",children:e}),L.cloneElement(t,{closeModal:l})]})}),a.jsx($,{onClick:i,children:s})]})},Ie=d.createContext({rows:[],setRows:()=>null}),Fo=({children:e,initialRows:t})=>{const[s,o]=d.useState((t??[]).map(r=>({...r,state:"untouched"}))),n=d.useMemo(()=>({rows:s,setRows:o}),[s]);return a.jsx(Ie.Provider,{value:n,children:e})},ge=(e,t)=>t==="dark"?se(e,.7):oe(e,.7),he=(e,t)=>t==="dark"?se(e,.6):oe(e,.6),me=(e,t)=>t==="dark"?se(e,.5):oe(e,.5),fe=(e,t)=>t==="dark"?se(e,.4):oe(e,.4),Bo=us(ps)(({theme:e})=>({"& .state--added":{backgroundColor:ge(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:me(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:ge(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:me(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:ge(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:me(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:fe(e.palette.error.main,e.palette.mode)}}}})),Wo=()=>a.jsx($,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:a.jsx(Z,{variant:"body2",children:"Sem registros"})}),Ho=({handleAddRecord:e,addLabel:t})=>a.jsxs(ys,{sx:{display:"flex",justifyContent:"space-around"},children:[a.jsx(Cs,{startIcon:a.jsx(ws,{}),onPointerUp:e,children:t||"Adicionar"}),a.jsxs("div",{children:[a.jsx(Ms,{}),a.jsx(bs,{})]})]}),Yo=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:r}=d.useContext(Ie),[i,l]=d.useState({}),c=()=>{const g=s();r(S=>[...S,{...g,state:"added"}]),l(S=>({...S,[g.id]:{mode:z.Edit,fieldToFocus:"id"}}))},u=d.useCallback(g=>()=>{l(S=>({...S,[g]:{mode:z.Edit}}))},[]),p=g=>(r(S=>S.map(b=>b.id===g.id?{...g,old:{...b,old:null}}:b)),g),C=(g,S)=>{g.reason===Ss.rowFocusOut&&(S.defaultMuiPrevented=!0)},y=d.useCallback(g=>{const S=n.find(j=>j.id===g);if(!S)return;const b=S.state==="untouched"?"modified":S.state;r(j=>j.map(D=>D.id===g?{...D,state:b}:D)),l(j=>({...j,[g]:{mode:z.View}}))},[n]),M=d.useCallback(g=>()=>{r(S=>S.map(b=>b.id===g?{...b,state:"deleted",oldState:b.state}:b).filter(b=>!(b.state==="deleted"&&b?.oldState==="added")))},[]),k=d.useCallback(g=>()=>{r(S=>S.map(b=>b.id===g?{...b,state:b.oldState,oldState:"deleted"}:b))},[]),f=d.useCallback(g=>()=>{l(b=>({...b,[g]:{mode:z.View,ignoreModifications:!0}}));const S=n.find(b=>b.id===g);S&&S.state==="added"&&r(b=>b.filter(j=>j.id!==g))},[n]);return a.jsx(a.Fragment,{children:a.jsx(Bo,{editMode:"row",density:"compact",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:C,processRowUpdate:p,slotProps:{toolbar:{handleAddRecord:c,addLabel:t}},slots:{noRowsOverlay:Wo,toolbar:Ho},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",flex:2,minWidth:80,maxWidth:200,cellClassName:"actions",getActions:({id:g})=>{const S=n.find(j=>j.id===g);return S?i[g]?.mode===z.Edit?[a.jsx(F,{icon:a.jsx(gs,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>y(g)},"save"),a.jsx(F,{icon:a.jsx(hs,{}),label:"Cancel",className:"textPrimary",onClick:f(g),color:"inherit"},"cancel")]:S.state==="deleted"?[a.jsx(F,{icon:a.jsx(ms,{}),label:"Restore",className:"textPrimary",onClick:k(g),color:"inherit"},"restore")]:[a.jsx(F,{icon:a.jsx(fs,{}),label:"Edit",className:"textPrimary",onClick:u(g),color:"inherit"},"edit"),a.jsx(F,{icon:a.jsx(xs,{}),label:"Delete",onClick:M(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})})};function qo({id:e,value:t,field:s}){const o=vs(),n=r=>{const i=r.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return a.jsx($s,{checked:t,onChange:n})}const Xo=e=>{const[t,s]=d.useState();return d.useEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(r=>{r.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},At={name:w,version:ro,depends_on:[],components:{SettingsPanel:bt,DetailsPanel:Mt,ViewportNotificationsTray:Uo,Accordion:Q,SystemModal:zo,CRUDGrid:Yo,CRUDBooleanCell:qo,CRUDGridProvider:Fo},contexts:{CRUDGridContext:Ie},hooks:{useLayoutManager:St,useRibbonMenuManager:Et,useViewportManager:kt,usePanelsManager:Ne,useResizeObserver:Xo},store:{selectors:{selectActiveViewport:Pe,getViewportState:Vt}},kernelCalls:{startModule:No,restartModule(){},shutdownModule(){}}},Y="Loader",Ko="0.0.1",W="modules",Dt=h(`[${Y}:${m.EVENT}] Module started`),Qo=h(`[${Y}:${m.COMMAND}] Start module`),Zo={modulesCount:1,modulesGraph:W},Jo=O({name:Y,initialState:Zo,reducers:{},extraReducers:e=>{e.addCase(Dt,t=>(t.modulesCount+=1,t))}}),en=({managers:{storeManager:e}})=>{e.functions.loadReducer(Y,Jo.reducer)};class Xe extends Error{}class tn extends Error{}const sn=e=>e.modulesCount,on=()=>{const{modules:e,setModules:t}=d.useContext(we),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=At.hooks,{store:r,componentRegistry:i}=K.managers,l=s(),c=o(),u=n(),p=r(),C=i(),y=K.hooks.useAppDispatch(),M=K.hooks.useAppSelector;return{modulesLoaded:M(sn),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new tn(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),y(Qo(g.name)),g.kernelCalls.startModule({dispatch:y,managers:{storeManager:p,componentRegistryManager:C,layoutManager:l,ribbonMenuManager:c,viewportManager:u}}),y(Dt(g.name))},unloadModule(g){if(!(g in e))throw new Xe(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(p),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new Xe(`${g} is not registered.`);const S=e[g];t(e),S.kernelCalls.restartModule(p)}}}},Ke={name:Y,version:Ko,depends_on:["Store","Graph"],managers:{modules:on},kernelCalls:{startModule:en,restartModule:()=>null,shutdownModule:()=>null}},nn=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=Ke.managers.modules(),o=de(W,v=>v&&v.id),[n,r]=d.useState(!0),[i,l]=d.useState(!1),[c,u]=d.useState(0),[p,C]=d.useState(0),[y,M]=d.useState(0),k=d.useMemo(()=>[Ke,qe,At],[]),f=qe.managers.graphs(),{createGraph:g,resetGraph:S}=f.functions;d.useEffect(()=>{const v=k[c];v&&!s.functions.isModuleLoaded(v.name)&&b(v)},[c]),d.useEffect(()=>{if(c===k.length){const v=t.kernel[p];v&&!s.functions.isModuleLoaded(v.name)&&j(v)}},[c,p]),d.useEffect(()=>{if(p===t.kernel.length){const v=t.system[y];v&&!s.functions.isModuleLoaded(v.name)&&D(v)}},[p,y]),d.useEffect(()=>{y===t.system.length&&r(!1)},[y]),d.useEffect(()=>{!n&&!o.state&&(g(W),l(!0))},[n]),d.useEffect(()=>{if(i&&!o.state&&g(W),!i)return;S(W);const v={id:"root",type:"ROOT"};o.actions.addNode(v),k.forEach(x=>o.actions.addNode({id:x.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${x.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:x.name}},outputs:{}})),t.kernel.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:x.name,type:"EXTRA_KERNEL_MODULE"},{inputs:T,outputs:{}})}),t.system.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:x.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:T,outputs:{}})}),r(!1)},[i]);function b(v){s.functions.loadModule(v),u(c+1)}function j(v){s.functions.loadModule(v),C(p+1)}function D(v){s.functions.loadModule(v),M(y+1)}return n?a.jsx("div",{children:"Iniciando sistema"}):e},rn=({children:e,loadModules:t})=>{const[s,o]=d.useState({Store:K}),n=d.useMemo(()=>({modules:s,setModules:o}),[s]);return a.jsx(we.Provider,{value:n,children:a.jsx(nn,{extraModules:t,afterLoadComponent:e})})},an=L.memo(rn),cn={},X=O({name:tt,initialState:cn,reducers:{},extraReducers:e=>{}}),dn=({children:e,default_registries:t})=>{const[s,o]=d.useState(t??{}),n=d.useMemo(()=>({registries:s,createRegistry:r,createRegistries:i,getComponent:l,registerComponents:c}),[s]);function r(u){o({...s,[u]:{}})}function i(u){o({...s,...u})}function l(u,p){return s[u][p]}function c(u){const p=s,C=Object.entries(u).reduce((y,[M,k])=>M in y?{...y,[M]:{...y[M],...k}}:y,p);o(C)}return a.jsx(nt.Provider,{value:n,children:e})},ln=({children:e})=>{const[t,s]=d.useState({[X.name]:X.reducer}),o=d.useMemo(()=>Xt({reducer:He({[X.name]:X.reducer}),middleware:i=>i({serializableCheck:!1}).concat(Kt)}),[]),n=i=>{Zt(i.middleware)},r=d.useCallback(i=>{const l={...t,...i};s(l),o.replaceReducer(He(l))},[t]);return a.jsx(Qt,{store:o,children:a.jsx(st.Provider,{value:{currentReducers:t,loadReducers:r,registerMiddleware:n},children:a.jsx(dn,{children:e})})})},un=L.memo(ln),Lt=A(e=>e.Layout,e=>e&&e.theme),pn=({systemTray:e})=>{const t=R("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),r=Et(),{selectTab:i}=r.functions,l=s(jt),c=s(Io),u=d.useCallback(p=>{i(p)},[]);return!c||!l?a.jsx(a.Fragment,{}):a.jsxs(js,{value:c,children:[a.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[a.jsx(et,{value:c,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(l).map(([p,C])=>a.jsx(B,{value:p,label:C.label,id:p,onClick:()=>u(p),wrapped:!0},p))}),a.jsx($,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),a.jsx($,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:l&&Object.entries(l).map(([p,C])=>a.jsx(Es,{value:p,children:C.sectionNames&&C.sectionNames.map(y=>{const M=n.functions.getComponent(ve,y);return d.createElement(M,{key:`ribbon-panel-${p}-section-${y}`},[])})},`ribbon-panel-${p}`))})]})},gn=({children:e,...t})=>{const s=d.useMemo(()=>({file:[a.jsx("div",{children:"test"},"test")]}),[]);return a.jsx(Po,{default_sections:s,children:a.jsx(pn,{...t,systemTray:e})})},hn=L.memo(gn),mn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Pe),n=t(Vt(o));if(!n)return null;const r=s.functions.getComponent(_,n.type);return r?a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:L.createElement(r,n,[])}):null},fn=A(e=>e.Layout.viewportManager,e=>e&&e.groups),xn=({sx:e,...t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=o(fn),r=o(Pe),i=o(_o),l=d.useMemo(()=>Object.entries(i).reduce((M,[k,f])=>k==="home"?M:f.group?{...M,[f.group]:f.group in M?[...M[f.group],f]:[f]}:{...M,notGrouped:[...M.notGrouped,f]},{notGrouped:[]}),[i]),{functions:{addViewport:c,closeViewport:u,selectViewport:p}}=kt(),C=d.useCallback(()=>{c("Nova aba","home",void 0,"new-")},[]),y=d.useCallback(M=>{u(M)},[]);return a.jsxs($,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[a.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},children:[a.jsxs(et,{value:r,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[a.jsx(B,{value:"home",icon:a.jsx(ks,{}),iconPosition:"start",onClick:()=>p("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(l).map(([M,k])=>M==="notGrouped"?k.map(f=>a.jsx(B,{value:f.name,id:f.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?p(f.name):y(f.name),label:a.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{children:f.title}),a.jsx(J,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),y(f.name)}})]}),draggable:!0,wrapped:!0},`${f.name}-tab`)):k.map(f=>a.jsx(B,{value:f.name,id:f.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[f.group].color},onClick:()=>p(f.name),label:a.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsx("span",{children:f.title}),a.jsx(I,{size:"small",component:"span",children:a.jsx(J,{sx:{width:.5,marginLeft:1},onClick:g=>{g.stopPropagation(),y(f.name)}})})]}),draggable:"true",wrapped:!0},`${f.name}-tab`))),a.jsx(B,{value:"new",icon:a.jsx(Rs,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:C,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),a.jsx($,{id:ht,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),a.jsx($,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:a.jsx(mn,{})})]})},yn=L.memo(xn),Cn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Lt),o=St(),n=d.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return a.jsx($,{role:"system-tray-container",children:a.jsx(I,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?a.jsx(Vs,{fontSize:"small"}):a.jsx(As,{fontSize:"small"})})})},wn=L.memo(Cn),Mn=Ds($)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,bn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Lt),o=d.useMemo(()=>Ls({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return a.jsxs(Ts,{theme:o,children:[a.jsx(Os,{}),a.jsx($,{role:"layout-root",sx:{minHeight:"100vh"},children:a.jsxs(Mn,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[a.jsx($,{sx:{gridArea:"ribbon",width:"100%"},children:a.jsx(hn,{children:a.jsx(wn,{})})}),a.jsx($,{id:pt,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),a.jsx(yn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),a.jsx($,{id:gt,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},Sn=L.memo(bn),vn=e=>e.SVG,$n=e=>A(vn,t=>t&&t.svgs[e]),jn=({path:e,instanceName:t,beforeInjection:s})=>{const o=R("Store"),{useAppSelector:n}=o.hooks,r=n($n(e)),i=d.useCallback(c=>{if(c.setAttribute("id",`${e}-root`),c.setAttribute("width","100%"),c.setAttribute("height","100%"),t){if(!r?.instances[t])return;Object.entries(r?.instances[t].proxies??{}).forEach(([p,C])=>{const y=c.getElementById(p);y&&("fill"in C&&y.setAttribute("fill",C.fill),"stroke"in C&&y.setAttribute("stroke",C.stroke))})}s&&s(c)},[s,r?.content,t,r?.instances[t]]),l=d.useMemo(()=>r?.content&&window.URL.createObjectURL(new Blob([r.content],{type:"image/svg+xml"})),[r?.content]);return!r||!l?null:a.jsx($,{role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{width:"100%",height:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:a.jsx(Jt,{style:{width:"100%",overflow:"hidden"},src:l,height:"100%",width:"100%",beforeInjection:i})})},V="SVG",En="0.0.1",_e=h(`[${V}:SVG:${m.COMMAND}] Load SVG`),Tt=h(`[${V}:SVG:${m.COMMAND}] Fetch SVG`),Ot=h(`[${V}:SVG:${m.COMMAND}] Set pan`),Gt=h(`[${V}:SVG:${m.COMMAND}] Set zoom`),Nt=h(`[${V}:SVG:${m.COMMAND}] Add proxy`),Ue=h(`[${V}:SVG:${m.COMMAND}] Update proxy`),ze=h(`[${V}:SVG:${m.COMMAND}] Delete proxy`),Fe=h(`[${V}:SVG:${m.EVENT}] SVG fetched`),kn=h(`[${V}:SVG:${m.EVENT}] SVG loaded`);h(`[${V}:SVG:${m.COMMAND}] Proxy added`);const Rn=h(`[${V}:SVG:${m.COMMAND}] Proxy updated`),Vn=h(`[${V}:SVG:${m.COMMAND}] Proxy deleted`),An=(e,t)=>{const s=R("Store"),{useAppDispatch:o}=s.hooks,n=o(),r=s.hooks.useAppSelector,i=A(c=>c&&c.SVG.svgs[e],t);return{state:r(i),actions:{setPan(c,u,p){n(Ot({path:e,instanceName:c,x:u*-10,y:p*-10}))},setZoom(c,u){n(Gt({path:e,instanceName:c,zoom:u}))},addProxy(c,u,p){n(Nt({path:e,instanceName:u,id:c,styles:p}))},deleteProxy(c,u){n(ze({path:e,instanceName:u,id:c}))},updateProxy(c,u,p){n(Ue({path:e,instanceName:u,id:c,changes:p}))}}}},Dn=()=>{const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(_e({path:o,instanceName:n}))}}}},q=N();q.startListening({actionCreator:_e,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Tt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Fe({path:e.path,content:n}))}});q.startListening({actionCreator:Fe,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(kn(n[e.path]))}});q.startListening({actionCreator:Ue,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(Rn(n[e.path].instances[e.instanceName].proxies))}});q.startListening({actionCreator:ze,effect:async({payload:e},{dispatch:t})=>{t(Vn(e))}});const Ln={progress:"not-started",instances:{},content:void 0},Tn={svgs:{}},On=O({name:V,initialState:Tn,reducers:{},extraReducers:e=>{e.addCase(_e,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!ee.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...Ln,instances:n}}}}),e.addCase(Tt,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(Fe,(t,{payload:{path:s,content:o}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(Nt,(t,{payload:{path:s,instanceName:o,id:n,styles:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:r}:{[n]:r}}}}}})),e.addCase(Gt,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(Ot,(t,{payload:{path:s,instanceName:o,x:n,y:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,r]}}}}})),e.addCase(Ue,(t,{payload:{path:s,instanceName:o,id:n,changes:r}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...r}:r}}}}}})),e.addCase(ze,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((r,[i,l])=>i===n?r:{...r,[i]:l},{})}}}}}))}}),Gn=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(V,On.reducer),e.functions.registerMiddleware(q)},Nn={name:V,version:En,depends_on:[],components:{SVGViewer:jn},hooks:{useSVGManager:Dn,useSVG:An},kernelCalls:{startModule:Gn,restartModule(){},shutdownModule(){}}},Pn=({initialPosition:e})=>{const[t,s]=d.useState(!1),[o,n]=d.useState({x:0,y:0}),[r,i]=d.useState(e),l=d.useCallback(p=>{s(!0),n({x:p.clientX,y:p.clientY}),p.stopPropagation()},[]),c=d.useCallback(p=>{if(!t)return;const C={x:p.clientX-o.x,y:p.clientY-o.y},y={x:r.x+C.x,y:r.y+C.y};i(y)},[t]),u=d.useCallback(p=>{s(!1),p.stopPropagation()},[]);return{position:r,setPosition:i,listeners:{onPointerDown:l,onPointerMove:c,onPointerUp:u}}},In=({children:e,component:t,actions:s,onClose:o})=>{const[n,r]=d.useState(!1),[i,l]=d.useState(!0),{innerWidth:c,innerHeight:u}=window,p=[c/2,u/2],{position:C,setPosition:y,listeners:M}=Pn({initialPosition:{x:p[0],y:p[1]}}),k=d.useCallback((j,D)=>{const v=j-p[0],x=D-p[1];return v<0?x<0?1:3:x<0?2:4},[p]),f=d.useMemo(()=>k(C.x,C.y),[C]),g=d.useRef(null);d.useEffect(()=>{if(n&&i&&g.current){const{clientWidth:j,clientHeight:D}=g.current;f%2==0?y(v=>({x:v.x-j,y:v.y-D})):f>2&&y(v=>({x:v.x,y:v.y-D})),l(!1)}n||l(!0)},[n,g.current]);const S=d.useCallback(j=>{r(!0),y({x:j.clientX,y:j.clientY}),j.stopPropagation()},[]),b=d.useCallback(j=>{r(!1),j.stopPropagation(),o?.(j)},[]);return a.jsxs(a.Fragment,{children:[a.jsx(Ze,{open:n,keepMounted:!0,onClose:b,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...M,children:a.jsx(Je,{sx:{position:"fixed",margin:1,left:C.x,top:C.y},elevation:6,children:a.jsxs($,{ref:g,sx:{display:"flex",flexGrow:1,flexDirection:f%2==1?"row":"row-reverse"},children:[a.jsxs($,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",padding:0,flexGrow:2,justifyContent:"space-evenly",alignContent:"space-evenly",borderLeft:`1px solid rgba(0,0,0, ${f%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${f%2==1?.1:0})`},children:[a.jsx(I,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:a.jsx(Gs,{})}),s.map(j=>d.cloneElement(j,{sx:{flexGrow:"inherit"},size:"small",closeContainer:b})),a.jsx(I,{color:"error",onClick:b,size:"small",id:"close-panel",children:a.jsx(J,{})},"reject")]}),a.jsx($,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:a.jsx(te,{fallback:a.jsx("div",{children:"Ocorreu um erro"}),children:L.cloneElement(t,{isOpen:n})})})]})})}),d.cloneElement(e,{onClick:S})]})},_n=({gestures:e,children:t})=>{const s=d.useRef(null),n=es(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return a.jsx($,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},Be="Pointer",Un="0.0.1",zn={},Fn=O({name:Be,initialState:zn,reducers:{},extraReducers:e=>{}}),Bn=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(Be,Fn.reducer),console.info("Pointer module started"),console.groupEnd()},Wn=({closeContainer:e,handleConfirm:t,...s})=>d.createElement(I,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},a.jsx(Ns,{})),Hn={name:Be,version:Un,depends_on:[],components:{MultiTouchPanel:_n,PointerContainer:In,ConfirmAndCloseButton:Wn},hooks:{},store:{},kernelCalls:{startModule:Bn,restartModule(){},shutdownModule(){}}},Zn=()=>{const e={kernel:[Nn,Hn],system:[Ps,Is,_s]};return a.jsx(un,{children:a.jsx(an,{loadModules:e,children:a.jsx(Sn,{})})})};export{m as A,kn as S,Nt as a,ne as b,Ve as c,ut as d,Ue as e,ae as f,ie as g,ce as h,jo as i,ct as j,re as k,rt as l,ze as m,_e as n,Zn as o,ye as r,R as u};
