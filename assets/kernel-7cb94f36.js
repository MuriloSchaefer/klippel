import{r as l,u as Ht,a as Wt,R as L,c as m,b as R,_ as oe,d as O,e as N,l as Xe,f as Yt,g as qt,s as Xt,z as Kt,h as Qt,i as Zt,j as Jt,k as es,m as ts,n as ss,o as r,p as tt,S as os,q as Ke,M as ns,A as as,t as rs,B as $,T as te,v as is,w as ye,I as _,x as se,E as ne,y as cs,C as ds,D as ls,F as us,G as st,P as ot,H as ps,J as gs,K as ae,L as re,N as F,O as B,Q as ms,U as hs,V as fs,W as xs,X as ws,Y as Ms,Z as ys,$ as Cs,a0 as bs,a1 as Ss,a2 as vs,a3 as $s,a4 as ks,a5 as Qe,a6 as js,a7 as Es,a8 as Vs,a9 as Rs,aa as nt,ab as H,ac as As,ad as Ds,ae as Ls,af as Os,ag as Ts,ah as Ns,ai as Gs,aj as Ps,ak as _s,al as Is,am as Us,an as zs,ao as Fs,ap as Bs,aq as Hs}from"./vendor-4337ee46.js";const at="Store",Ws="0.0.1",rt=l.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),Ys=()=>{const{loadReducers:e,registerMiddleware:t}=l.useContext(rt);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},it=()=>Ht(),qs=Wt,ct=l.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>L.memo(()=>null),registerComponents:()=>null}),Xs=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=l.useContext(ct);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},J={name:at,version:Ws,depends_on:[],managers:{store:Ys,componentRegistry:Xs},hooks:{useAppDispatch:it,useAppSelector:qs},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},Ce=l.createContext({modules:{},setModules:()=>null}),h={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},E="Graph",Ks="0.0.1",Qs=m(`[${E}:Instance:${h.EVENT}] Graph loaded`),Zs=m(`[${E}:Instance:${h.EVENT}] Node added`),Js=m(`[${E}:Instance:${h.EVENT}] Node removed`),eo=m(`[${E}:Instance:${h.EVENT}] Node updated`),to=m(`[${E}:Instance:${h.EVENT}] Edge added`),so=m(`[${E}:Instance:${h.EVENT}] Edge removed`),we=m(`[${E}:Instance:${h.EVENT}] Search finished`),oo=m(`[${E}:Instance:${h.EVENT}] Search invalidated`),dt=m(`[${E}:Instance:${h.COMMAND}] Load Graph`),lt=m(`[${E}:Instance:${h.COMMAND}] Reset Graph`),ie=m(`[${E}:Instance:${h.COMMAND}] Add node`),ce=m(`[${E}:Instance:${h.COMMAND}] Remove node`),de=m(`[${E}:Instance:${h.COMMAND}] Update node`),Y=m(`[${E}:Instance:${h.COMMAND}] Add edge`),q=m(`[${E}:Instance:${h.COMMAND}] Remove edge`),ut=m(`[${E}:Instance:${h.COMMAND}] Search`),pt=m(`[${E}:Instance:${h.COMMAND}] Invalidate Search`),V=e=>{const{modules:t}=l.useContext(Ce),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},gt={inputs:{},outputs:{}},le=(e,t)=>{const s=V("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,a=R(c=>c?.Graph&&c.Graph.graphs[e],t),i=n(a),d=n(c=>c?.Graph&&c.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(c,u)=>{const p={...c,position:{x:0,y:0}};o(ie({graphId:e,node:p,edges:u??gt}))},removeNode:c=>{o(ce({graphId:e,nodeId:c}))},updateNode:c=>{o(de({graphId:e,nodeId:c.id,changes:c}))},addEdge:c=>{o(Y({graphId:e,edge:c}))},updateEdge:(c,u)=>{const p=d?.edges[c];if(p){o(q({graphId:e,edgeId:c}));const M={...p,...u};o(Y({graphId:e,edge:M}))}},removeEdge:c=>{o(q({graphId:e,edgeId:c}))},nodeExists:c=>d?c in d.nodes:!1,search:(c,u,p,M,w,y,j)=>{const f=j??oe.uniqueId("search");return o(ut({id:f,graphId:e,strategy:c,nodeStart:u,validate:p,stopCriteria:M,depth:w,label:y??f})),f}}}},be={nodes:{},edges:{},adjacencyList:{},searchResults:{}},mt={graphs:{}};m(`[${E}:${h.EVENT}:Init] Graph Module loaded`);const no=m(`[${E}:GraphsManager:${h.EVENT}] Graph created`),ao=m(`[${E}:GraphsManager:${h.EVENT}] Graph destroyed`),Se=m(`[${E}:GraphsManager:${h.COMMAND}] Create graph`),ht=m(`[${E}:GraphsManager:${h.COMMAND}] Destroy graph`),ro=O({name:E,initialState:mt,reducers:{},extraReducers:e=>{e.addCase(dt,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ie,(t,{payload:{graphId:s,node:o,edges:n}})=>{const a=t.graphs[s];if(!a)throw Error("Graph does not exist");if(a.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...a,nodes:{...a.nodes,[o.id]:o},edges:{...a.edges,...Object.entries(n.inputs).reduce((d,[c,u])=>({...d,[c]:u}),{}),...Object.entries(n.outputs).reduce((d,[c,u])=>({...d,[c]:u}),{})},adjacencyList:{...a.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((d,[c,u])=>({...d,[u.sourceId]:{...a.adjacencyList[u.sourceId],outputs:[...a.adjacencyList[u.sourceId].outputs,c]}}),{}),...Object.entries(n.outputs).reduce((d,[c,u])=>({...d,[u.targetId]:{...a.adjacencyList[u.targetId],inputs:[...a.adjacencyList[u.targetId].inputs,c]}}),{})}}}}}).addCase(ce,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([a,i])=>i.sourceId===o||i.targetId===o).map(([a,i])=>a);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((a,i)=>i.id!==o?{...a,[i.id]:i}:a,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,d])=>i!==o?{...a,[i]:{inputs:d.inputs.filter(c=>!n.includes(c)),outputs:d.outputs.filter(c=>!n.includes(c))}}:a,{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,d])=>n.includes(i)?a:{...a,[i]:d},{})}}}}).addCase(de,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const a=t.graphs[s],i=a.nodes[o];if(i===null)throw Error("Node does not exist");return a.nodes[o]={...i,...n},t}).addCase(Y,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(q,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s].edges[o];return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,d])=>i===n.sourceId||i===n.targetId?{...a,[i]:{inputs:d.inputs.filter(c=>c!==o),outputs:d.outputs.filter(c=>c!==o)}}:{...a,[i]:d},{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,d])=>i!==o?{...a,[i]:d}:a,{})}}}}).addCase(lt,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...be}}})).addCase(we,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(pt,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),io=O({name:E,initialState:mt,reducers:{},extraReducers:e=>{e.addCase(Se,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...be,id:s},t}).addCase(ht,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(ro.reducer)}}),ve=N();ve.startListening({actionCreator:Se,effect:async(e,t)=>{const{dispatch:s}=t;s(no(e.payload))}});ve.startListening({actionCreator:ht,effect:async(e,t)=>{const{dispatch:s}=t;s(ao(e.payload))}});const co=(e,t,s,o,n)=>{const a=[],i=[];let d=0;const c=[t];for(;c.length;){const u=c.shift();if(!u)break;const p=e.nodes[u];if(a.push(p),s(p,e,i,a)&&i.push(p),o(p,e,i,a))break;if(n&&d>=n)continue;const w=e.adjacencyList[u];c.push(...w.outputs.map(y=>e.edges[y].targetId)),c.push(...w.inputs.map(y=>e.edges[y].sourceId)),d+=1}return{findings:i,visited:a}},lo=(e,t,s,o,n)=>({findings:[],visited:[]}),G=N();G.startListening({actionCreator:dt,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(Qs({graphId:e,graph:t}))}});G.startListening({actionCreator:ie,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(Zs({graphId:e,node:t,edges:s}))}});G.startListening({actionCreator:ce,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(Js({graphId:e,nodeId:t}))}});G.startListening({actionCreator:de,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(eo(e))}});G.startListening({actionCreator:Y,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(to(e))}});G.startListening({actionCreator:q,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(so(e))}});G.startListening({actionCreator:ut,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),a=n[e.graphId];if(a.searchResults&&e.id in a.searchResults&&!a.searchResults[e.id].outdated){s(we({graphId:e.graphId,searchId:e.id,results:a.searchResults[e.id]}));return}let i={findings:[],visited:[]};switch(e.strategy){case"dfs":i={...lo(a,e.nodeStart,e.validate,e.stopCriteria,e.depth)};break;case"bfs":i=co(a,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(we({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});G.startListening({actionCreator:pt,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(oo(e))}});const C="Layout",uo="0.0.1",$e="ribbonMenuSections",U="viewportTypes",ft="settings-panel",xt="details-panel",wt="viewport-notifications-tray";function po(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const go=({width:e,height:t,nodeBorder:s})=>{const o=Xe().domain([-1,e+1]).range([-1,e+1]),n=Xe().domain([-1,t+1]).range([-1,t+1]),a=Yt(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=qt(n).ticks(10).tickSize(e).tickPadding(8-e);function d(M){M.append("circle").attr("r",w=>w.radius).attr("fill",w=>po(w.group??"")).attr("stroke",s),M.append("text").text(w=>w.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function c(M){function w(f){f.active||M.alphaTarget(.3).restart(),f.subject.fx=f.subject.x,f.subject.fy=f.subject.y}function y(f){f.subject.fx=f.x,f.subject.fy=f.y}function j(f){f.active||M.alphaTarget(0),f.subject.fx=null,f.subject.fy=null}return ts().on("start",w).on("drag",y).on("end",j)}function u(M){M.append("line").attr("stroke-width","1em").attr("stroke","gray")}function p(M){M.each(w=>{M.attr("viewBox",[0,0,e,t]),M.selectAll("*").remove(),M.append("defs");const j=M.append("g").attr("role","grid"),f=M.append("g").attr("role","container"),g=j.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),S=j.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),b=Kt().scaleExtent([-10,40]).filter(x=>(x.preventDefault(),(!x.ctrlKey||x.type==="wheel")&&!x.button)).on("zoom",({transform:x})=>{f.attr("transform",x),g.call(a.scale(x.rescaleX(o))),S.call(i.scale(x.rescaleY(n)))});M.call(b);const k=Qt(w.nodes).force("links",Zt(w.links).id(x=>x.id).distance(300).strength(1)).force("charge",Jt().strength(x=>x.strength)).force("colide",es(x=>x.radius)),D=f.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(w.links).join(x=>x.append("g").attr("role","link").attr("id",T=>T.id).call(u),x=>x,x=>x.remove()),v=f.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(w.nodes).join(x=>x.append("g").attr("role","node").attr("id",T=>T.id).call(c(k)).call(d),x=>x.select("circle").attr("cx",T=>T.x).attr("cy",T=>T.y),x=>x.remove());k.on("tick",()=>{v.attr("transform",x=>`translate(${x.x}, ${x.y})`),D.selectAll("line").attr("x1",x=>x.source.x).attr("y1",x=>x.source.y).attr("x2",x=>x.target.x).attr("y2",x=>x.target.y)}),k.alpha(1)})}return{render(M,w){Xt(w).datum(M).call(p)}}},mo=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=V("Layout"),s=l.useRef(null),o=l.useRef(null),n=t(o),a=le(e,u=>u),i=l.useMemo(()=>!a.state||!a.state.nodes?{nodes:[],links:[]}:{nodes:Object.values(a.state.nodes).map(u=>({id:u.id,group:u.type,nodeLabel:u?.label||u.id,strength:-400,x:u.position.x,y:u.position.y,radius:50})),links:Object.values(a.state.edges).map(u=>({id:u.id,type:u.type,source:u.sourceId,target:u.targetId,value:5}))},[a]),d=ss(),c=go({nodeBorder:d.palette.getContrastText(d.palette.background.default),width:n?.width??0,height:n?.height??0});return l.useLayoutEffect(()=>{!n||!s.current||c.render(i,s.current)},[i,n]),a.state?r.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:r.jsx("svg",{ref:s,id:`${a.id}`,width:"100%",height:"100%"})}):r.jsx(r.Fragment,{})},Mt=L.memo(mo),ho=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(E,io.reducer),e.functions.registerMiddleware(ve),e.functions.registerMiddleware(G),t.functions.createRegistries({[$e]:{},[U]:{graph:Mt}})},fo=()=>{const e=it();return{functions:{createGraph(t){return e(Se({graphId:t})),{id:t,state:{id:t,...be},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ie({graphId:t,node:n,edges:o??gt}))},removeNode:s=>{e(ce({graphId:t,nodeId:s}))},updateNode:s=>{e(de({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(Y({graphId:t,edge:s}))},updateEdge:(s,o)=>{console.error("Not implemented yet")},removeEdge:s=>{e(q({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(lt({graphId:t}))}}}},xo=(e,t)=>{const o=t??(n=>n);return R(n=>n.Graph,n=>n&&o(n.graphs[e]))},wo=(e,t)=>{const s=V("Graph"),{useGraph:o}=s.hooks,n=o(e,d=>d?.nodes[t]),a=o(e,d=>d?.adjacencyList[t]),i=o(e,d=>Object.values(d?.edges??{}).filter(c=>a.state?.inputs?.includes(c.id)||a.state?.outputs?.includes(c.id)).reduce((c,u)=>({...c,[u.id]:u}),{}));return{node:n.state,edges:i.state??{},adjacencyList:a.state??{inputs:[],outputs:[]}}},yt=(e,t)=>le(e,o=>o?.searchResults&&o.searchResults[t]).state,Mo=(e,t,s)=>{l.useEffect(()=>{s()},[]);const o=yt(e,t);return l.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},Ze={name:E,version:Ks,depends_on:["Store"],components:{GraphViewer:Mt},managers:{graphs:fo},hooks:{useGraph:le,useNodeInfo:wo,useSearch:Mo,useSearchResult:yt},store:{selectors:{getGraphState:xo}},kernelCalls:{startModule:ho,restartModule(){},shutdownModule(){}}},ue=m(`[${C}:Theme:${h.COMMAND}] Switch theme`),yo=m(`[${C}:Theme:${h.EVENT}] Theme switched`),Ct=N();Ct.startListening({actionCreator:ue,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(yo(e))}});const ke=m(`[${C}:Ribbon:${h.COMMAND}] Add tab`),je=m(`[${C}:Ribbon:${h.COMMAND}] Select tab`),Co=m(`[${C}:Ribbon:${h.EVENT}] tab added`),bo=m(`[${C}:Ribbon:${h.EVENT}] tab selected`),Ee=N();Ee.startListening({actionCreator:ke,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(Co({tab:n[e.name]}))}});Ee.startListening({actionCreator:je,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(bo({tab:n[e]}))}});const Ve=m(`[${C}:Viewports:${h.COMMAND}] Add viewport`),Re=m(`[${C}:Viewports:${h.COMMAND}] Select viewport`),Ae=m(`[${C}:Viewports:${h.COMMAND}] Close viewport`),bt=m(`[${C}:Viewports:${h.COMMAND}] Rename viewport`),De=m(`[${C}:Viewports:${h.COMMAND}] Add viewport to group`),Me=m(`[${C}:Viewports:${h.COMMAND}] Viewport removed from group`),So=m(`[${C}:Viewports:${h.EVENT}] Viewport added`),vo=m(`[${C}:Viewports:${h.EVENT}] Viewport selected`),$o=m(`[${C}:Viewports:${h.EVENT}] Viewport closed`);m(`[${C}:Viewports:${h.EVENT}] Viewport renamed`);const ko=m(`[${C}:Viewports:${h.EVENT}] Viewport added to group`);m(`[${C}:Viewports:${h.EVENT}] Viewport removed from group`);const z=N();z.startListening({actionCreator:Ve,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(So(n[e]))}});z.startListening({actionCreator:Re,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(vo(n[e]))}});z.startListening({actionCreator:Ae,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s($o({name:e}))}});z.startListening({actionCreator:De,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ko(e))}});z.startListening({actionCreator:Me,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Me(e))}});const Le=m(`[${C}:Viewports:${h.COMMAND}] Create group`),jo=m(`[${C}:Viewports:${h.EVENT}] Group created`),St=N();St.startListening({actionCreator:Le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(jo(e))}});const Oe=m(`[${C}:Panels:${h.COMMAND}] Expand settings panel`),Te=m(`[${C}:Panels:${h.COMMAND}] Collapse settings panel`),Ne=m(`[${C}:Panels:${h.COMMAND}] Open details panel`),Ge=m(`[${C}:Panels:${h.COMMAND}] Close details panel`),Eo=m(`[${C}:Panels:${h.EVENT}] Settings panel expanded`),Vo=m(`[${C}:Panels:${h.EVENT}] Settings panel collapsed`),Ro=m(`[${C}:Panels:${h.EVENT}] Details panel opened`),Ao=m(`[${C}:Panels:${h.EVENT}] Details panel closed`),X=N();X.startListening({actionCreator:Oe,effect:async(e,t)=>{const{dispatch:s}=t;s(Eo())}});X.startListening({actionCreator:Te,effect:async(e,t)=>{const{dispatch:s}=t;s(Vo())}});X.startListening({actionCreator:Ne,effect:async(e,t)=>{const{dispatch:s}=t;s(Ro())}});X.startListening({actionCreator:Ge,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(Ao({viewportName:n}))}});const Do=O({name:`${C}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(Le,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),Lo=O({name:`${C}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(Ve,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(Ae,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,a])=>n===s.name?o:{...o,[n]:a},{})})),e.addCase(Re,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(bt,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[a,i])=>a===s?{...n,[s]:{...i,title:o}}:{...n,[a]:i},{})})),e.addCase(De,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(Me,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:Do.reducer(t.groups,s)}))}}),Oo=O({name:`${C}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase(ke,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(je,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),vt={settings:{state:"expanded"},details:{state:"closed"}},To=O({name:C,initialState:vt,reducers:{},extraReducers:e=>{e.addCase(Oe,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Te,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(Ne,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(Ge,t=>({...t,details:{...t.details,state:"closed"}}))}}),No={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:vt,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Go=O({name:C,initialState:No,reducers:{},extraReducers:e=>{e.addCase(ue,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:To.reducer(t.panels,s),ribbonMenu:Oo.reducer(t.ribbonMenu,s),viewportManager:Lo.reducer(t.viewportManager,s)}))}}),ee=({name:e,icon:t,summary:s,expanded:o,state:n,children:a,sx:i,...d})=>{const c=tt("(min-width:1024px)");return n==="collapsed"?r.jsx(os,{children:t??r.jsx(Ke,{})}):r.jsxs(ns,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...d,children:[r.jsx(as,{expandIcon:r.jsx(rs,{}),"aria-controls":`accordion-${e}-content`,children:r.jsxs($,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??r.jsx(Ke,{}),r.jsx(te,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&c&&r.jsx(te,{component:"div",sx:{color:"text.secondary"},children:s})]})}),r.jsx(is,{children:a})]})};function Pe(){const e=V("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(Oe())},collapseSettings(){s(Te())},openDetails(){s(Ne())},closeDetails(){s(Ge())}}}}R(e=>e.Layout,e=>e&&e.panels);const Po=R(e=>e.Layout,e=>e&&e.panels.settings),_o=R(e=>e.Layout,e=>e&&e.panels.details),$t=({title:e,display:t,children:s})=>{const o=document.getElementById(xt),n=tt("(orientation: portrait)"),a=V("Store"),{useAppSelector:i}=a.hooks,d=Pe(),c=i(_o),u=l.useCallback(p=>{p.stopPropagation(),c&&c.state==="opened"&&d.functions.closeDetails()},[c?.state]);return!o||!c?null:ye.createPortal(r.jsxs($,{role:"details-panel","aria-label":"details panel",display:c.state==="opened"?"flex":"none",sx:{flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!n&&r.jsx(_,{size:"small",component:"span",onClick:u,children:c.state==="opened"&&r.jsx(se,{})}),r.jsx("span",{children:e??"Detalhes"})]}),r.jsx($,{role:"panel-content",children:r.jsx(ne,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),o)},kt=({title:e,children:t})=>{const s=V("Store"),{useAppSelector:o}=s.hooks,n=Pe(),a=o(Po),i=document.getElementById(ft),d=l.useCallback(c=>{c.stopPropagation(),a&&a.state==="collapsed"&&n.functions.expandSettings(),a&&a.state==="expanded"&&n.functions.collapseSettings()},[a?.state]);return!i||!a?null:ye.createPortal(r.jsx($,{sx:{position:"relative"},children:r.jsxs($,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:a.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:a.state==="collapsed"?"8vw":"100%"}},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.state==="expanded"&&r.jsxs(r.Fragment,{children:[r.jsx(cs,{}),r.jsx("span",{children:e??"Configurações"})]}),r.jsx(_,{size:"small",component:"span",onClick:d,children:a.state==="collapsed"?r.jsx(ds,{sx:{transform:"rotate(90deg)"}}):r.jsx(ls,{sx:{transform:"rotate(90deg)"}})})]}),r.jsx($,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:a.state==="collapsed"?2:0,marginTop:4},children:r.jsx(ne,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:t.map((c,u)=>l.cloneElement(c,{state:a.state,key:u}))})})]})}),i)},Io=({name:e,title:t,type:s,group:o})=>r.jsxs(r.Fragment,{children:[r.jsxs(kt,{children:[r.jsx(ee,{name:"Agenda",icon:r.jsx(us,{}),expanded:!0,children:r.jsx(r.Fragment,{})}),r.jsx(ee,{name:"Recebimentos",summary:"Recebimentos do mês",children:r.jsx(r.Fragment,{})}),r.jsx(ee,{name:"Andamento",summary:"Pedidos em produção",children:r.jsx(r.Fragment,{})})]}),r.jsx($t,{children:r.jsx(r.Fragment,{children:"Detalhes"})})]}),Uo=L.memo(Io),zo=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(C,Go.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(ue({theme:"dark"})),t.functions.registerMiddleware(Ct),t.functions.registerMiddleware(Ee),t.functions.registerMiddleware(z),t.functions.registerMiddleware(St),t.functions.registerMiddleware(X),s.functions.createRegistries({[$e]:{},[U]:{home:Uo}})};function jt(){const e=V("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(ue({theme:o}))}}}}const Et=l.createContext({sections:{},setSections:()=>null}),Fo=({children:e,default_sections:t})=>{const[s,o]=l.useState(t??{});function n(i,d){o({...s,[i]:d})}const a=l.useMemo(()=>({sections:s,setSections:n}),[s]);return r.jsx(Et.Provider,{value:a,children:e})},Vt=e=>e&&e.Layout?.ribbonMenu,Rt=R(Vt,e=>e&&e.tabs),Bo=R(Vt,e=>e&&e.activeTab);function At(){const e=V("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),a=t(Rt);return l.useContext(Et),o(),{functions:{tabExists(i){return a!=null&&i in a},addNewTab(i){const d=oe.uniqueId("tab-"),c={...i,name:d,active:!1};n(ke({tab:c}))},selectTab(i){n(je({name:i}))}}}}function Dt(){const e=V("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(a){n.functions.registerComponents({[U]:a})},getViewportTypeComponent(a){const i=n.functions.getComponent(U,a);if(!i)throw Error("Unknown viewport type");return i},addViewport(a,i,d,c="viewport"){if(!n.functions.getComponent(U,i))throw Error("Unknown viewport type");const p=oe.uniqueId(c);return o(Ve({name:p,title:a,type:i,group:d})),p},renameViewport(a,i){o(bt({oldName:a,newName:i}))},selectViewport(a){o(Re({name:a}))},closeViewport(a){o(Ae({name:a}))},createGroup(a,i){o(Le({name:a,color:i}))},addToGroup(a,i){o(De({viewportName:a,groupName:i}))}}}}const _e=R(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Lt=e=>e.Layout.viewportManager,Ho=R(Lt,e=>e&&e.viewports),Ot=(e,t)=>{const o=t??(n=>n);return R(Lt,n=>n&&o(n.viewports[e]))},Wo=({children:e})=>{const t=document.getElementById(wt);return t?ye.createPortal(r.jsx($,{sx:{position:"relative"},children:e}),t):null},Yo=({title:e,component:t,children:s,sx:o={}})=>{const[n,a]=l.useState(!1),i=l.useCallback(c=>{a(!0),c.stopPropagation()},[]),d=l.useCallback(()=>{a(!1)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(st,{open:n,onClose:d,components:{Backdrop:void 0},children:r.jsxs(ot,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&r.jsx(te,{variant:"subtitle1",component:"span",children:e}),L.cloneElement(t,{closeModal:d})]})}),r.jsx($,{onClick:i,children:s})]})},Ie=l.createContext({rows:[],setRows:()=>null}),qo=({children:e,initialRows:t})=>{const[s,o]=l.useState((t??[]).map(a=>({...a,state:"untouched"}))),n=l.useMemo(()=>({rows:s,setRows:o}),[s]);return r.jsx(Ie.Provider,{value:n,children:e})},me=(e,t)=>t==="dark"?ae(e,.7):re(e,.7),he=(e,t)=>t==="dark"?ae(e,.6):re(e,.6),fe=(e,t)=>t==="dark"?ae(e,.5):re(e,.5),xe=(e,t)=>t==="dark"?ae(e,.4):re(e,.4),Xo=ps(gs)(({theme:e})=>({"& .state--added":{backgroundColor:me(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:xe(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:me(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:xe(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:me(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:xe(e.palette.error.main,e.palette.mode)}}}})),Ko=()=>r.jsx($,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:r.jsx(te,{variant:"body2",children:"Sem registros"})}),Qo=({handleAddRecord:e,addLabel:t})=>r.jsxs(Ms,{sx:{display:"flex",justifyContent:"space-around"},children:[r.jsx(ys,{startIcon:r.jsx(Cs,{}),onPointerUp:e,children:t||"Adicionar"}),r.jsx("div",{children:r.jsx(bs,{})})]}),Zo=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:a}=l.useContext(Ie),[i,d]=l.useState({}),c=()=>{const g=s();a(S=>[...S,{...g,state:"added"}]),d(S=>({...S,[g.id]:{mode:F.Edit,fieldToFocus:"id"}}))},u=l.useCallback(g=>()=>{d(S=>({...S,[g]:{mode:F.Edit}}))},[]),p=g=>(a(S=>S.map(b=>b.id===g.id?{...g,old:{...b,old:null}}:b)),g),M=(g,S)=>{g.reason===Ss.rowFocusOut&&(S.defaultMuiPrevented=!0)},w=l.useCallback(g=>{const S=n.find(k=>k.id===g);if(!S)return;const b=S.state==="untouched"?"modified":S.state;a(k=>k.map(D=>D.id===g?{...D,state:b}:D)),d(k=>({...k,[g]:{mode:F.View}}))},[n]),y=l.useCallback(g=>()=>{a(S=>S.map(b=>b.id===g?{...b,state:"deleted",oldState:b.state}:b).filter(b=>!(b.state==="deleted"&&b?.oldState==="added")))},[]),j=l.useCallback(g=>()=>{a(S=>S.map(b=>b.id===g?{...b,state:b.oldState,oldState:"deleted"}:b))},[]),f=l.useCallback(g=>()=>{d(b=>({...b,[g]:{mode:F.View,ignoreModifications:!0}}));const S=n.find(b=>b.id===g);S&&S.state==="added"&&a(b=>b.filter(k=>k.id!==g))},[n]);return r.jsx(r.Fragment,{children:r.jsx(Xo,{editMode:"row",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:M,processRowUpdate:p,slotProps:{toolbar:{handleAddRecord:c,addLabel:t}},slots:{noRowsOverlay:Ko,toolbar:Qo},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",cellClassName:"actions",getActions:({id:g})=>{const S=n.find(k=>k.id===g);return S?i[g]?.mode===F.Edit?[r.jsx(B,{icon:r.jsx(ms,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>w(g)},"save"),r.jsx(B,{icon:r.jsx(hs,{}),label:"Cancel",className:"textPrimary",onClick:f(g),color:"inherit"},"cancel")]:S.state==="deleted"?[r.jsx(B,{icon:r.jsx(fs,{}),label:"Restore",className:"textPrimary",onClick:j(g),color:"inherit"},"restore")]:[r.jsx(B,{icon:r.jsx(xs,{}),label:"Edit",className:"textPrimary",onClick:u(g),color:"inherit"},"edit"),r.jsx(B,{icon:r.jsx(ws,{}),label:"Delete",onClick:y(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})})};function Jo({id:e,value:t,field:s}){const o=vs(),n=a=>{const i=a.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return r.jsx($s,{checked:t,onChange:n})}const en=e=>{const[t,s]=l.useState();return l.useLayoutEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(a=>{a.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},Tt={name:C,version:uo,depends_on:[],components:{SettingsPanel:kt,DetailsPanel:$t,ViewportNotificationsTray:Wo,Accordion:ee,SystemModal:Yo,CRUDGrid:Zo,CRUDBooleanCell:Jo,CRUDGridProvider:qo},contexts:{CRUDGridContext:Ie},hooks:{useLayoutManager:jt,useRibbonMenuManager:At,useViewportManager:Dt,usePanelsManager:Pe,useResizeObserver:en},store:{selectors:{selectActiveViewport:_e,getViewportState:Ot}},kernelCalls:{startModule:zo,restartModule(){},shutdownModule(){}}},K="Loader",tn="0.0.1",W="modules",Nt=m(`[${K}:${h.EVENT}] Module started`),sn=m(`[${K}:${h.COMMAND}] Start module`),on={modulesCount:1,modulesGraph:W},nn=O({name:K,initialState:on,reducers:{},extraReducers:e=>{e.addCase(Nt,t=>(t.modulesCount+=1,t))}}),an=({managers:{storeManager:e}})=>{e.functions.loadReducer(K,nn.reducer)};class Je extends Error{}class rn extends Error{}const cn=e=>e.modulesCount,dn=()=>{const{modules:e,setModules:t}=l.useContext(Ce),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=Tt.hooks,{store:a,componentRegistry:i}=J.managers,d=s(),c=o(),u=n(),p=a(),M=i(),w=J.hooks.useAppDispatch(),y=J.hooks.useAppSelector;return{modulesLoaded:y(cn),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new rn(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),w(sn(g.name)),g.kernelCalls.startModule({dispatch:w,managers:{storeManager:p,componentRegistryManager:M,layoutManager:d,ribbonMenuManager:c,viewportManager:u}}),w(Nt(g.name))},unloadModule(g){if(!(g in e))throw new Je(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(p),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new Je(`${g} is not registered.`);const S=e[g];t(e),S.kernelCalls.restartModule(p)}}}},et={name:K,version:tn,depends_on:["Store","Graph"],managers:{modules:dn},kernelCalls:{startModule:an,restartModule:()=>null,shutdownModule:()=>null}},ln=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=et.managers.modules(),o=le(W,v=>v&&v.id),[n,a]=l.useState(!0),[i,d]=l.useState(!1),[c,u]=l.useState(0),[p,M]=l.useState(0),[w,y]=l.useState(0),j=l.useMemo(()=>[et,Ze,Tt],[]),f=Ze.managers.graphs(),{createGraph:g,resetGraph:S}=f.functions;l.useEffect(()=>{const v=j[c];v&&!s.functions.isModuleLoaded(v.name)&&b(v)},[c]),l.useEffect(()=>{if(c===j.length){const v=t.kernel[p];v&&!s.functions.isModuleLoaded(v.name)&&k(v)}},[c,p]),l.useEffect(()=>{if(p===t.kernel.length){const v=t.system[w];v&&!s.functions.isModuleLoaded(v.name)&&D(v)}},[p,w]),l.useEffect(()=>{w===t.system.length&&a(!1)},[w]),l.useEffect(()=>{!n&&!o.state&&(g(W),d(!0))},[n]),l.useEffect(()=>{if(i&&!o.state&&g(W),!i)return;S(W);const v={id:"root",type:"ROOT"};o.actions.addNode(v),j.forEach(x=>o.actions.addNode({id:x.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${x.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:x.name}},outputs:{}})),t.kernel.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((pe,P)=>{const ge={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...pe,[P]:ge}},{});o.actions.addNode({id:x.name,type:"EXTRA_KERNEL_MODULE"},{inputs:T,outputs:{}})}),t.system.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((pe,P)=>{const ge={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...pe,[P]:ge}},{});o.actions.addNode({id:x.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:T,outputs:{}})}),a(!1)},[i]);function b(v){s.functions.loadModule(v),u(c+1)}function k(v){s.functions.loadModule(v),M(p+1)}function D(v){s.functions.loadModule(v),y(w+1)}return n?r.jsx("div",{children:"Iniciando sistema"}):e},un=({children:e,loadModules:t})=>{const[s,o]=l.useState({Store:J}),n=l.useMemo(()=>({modules:s,setModules:o}),[s]);return r.jsx(Ce.Provider,{value:n,children:r.jsx(ln,{extraModules:t,afterLoadComponent:e})})},oa=L.memo(un),pn={},Z=O({name:at,initialState:pn,reducers:{},extraReducers:e=>{}}),gn=({children:e,default_registries:t})=>{const[s,o]=l.useState(t??{}),n=l.useMemo(()=>({registries:s,createRegistry:a,createRegistries:i,getComponent:d,registerComponents:c}),[s]);function a(u){o({...s,[u]:{}})}function i(u){o({...s,...u})}function d(u,p){return s[u][p]}function c(u){const p=s,M=Object.entries(u).reduce((w,[y,j])=>y in w?{...w,[y]:{...w[y],...j}}:w,p);o(M)}return r.jsx(ct.Provider,{value:n,children:e})},mn=({children:e})=>{const[t,s]=l.useState({[Z.name]:Z.reducer}),o=l.useMemo(()=>ks({reducer:Qe({[Z.name]:Z.reducer}),middleware:i=>i({serializableCheck:!1}).concat(js)}),[]),n=i=>{Vs(i.middleware)},a=l.useCallback(i=>{const d={...t,...i};s(d),o.replaceReducer(Qe(d))},[t]);return r.jsx(Es,{store:o,children:r.jsx(rt.Provider,{value:{currentReducers:t,loadReducers:a,registerMiddleware:n},children:r.jsx(gn,{children:e})})})},na=L.memo(mn),Gt=R(e=>e.Layout,e=>e&&e.theme),hn=({systemTray:e})=>{const t=V("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),a=At(),{selectTab:i}=a.functions,d=s(Rt),c=s(Bo),u=l.useCallback(p=>{i(p)},[]);return!c||!d?r.jsx(r.Fragment,{}):r.jsxs(Rs,{value:c,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[r.jsx(nt,{value:c,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(d).map(([p,M])=>r.jsx(H,{value:p,label:M.label,id:p,onClick:()=>u(p),wrapped:!0},p))}),r.jsx($,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),r.jsx($,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:d&&Object.entries(d).map(([p,M])=>r.jsx(As,{value:p,children:M.sectionNames&&M.sectionNames.map(w=>{const y=n.functions.getComponent($e,w);return l.createElement(y,{key:`ribbon-panel-${p}-section-${w}`},[])})},`ribbon-panel-${p}`))})]})},fn=({children:e,...t})=>{const s=l.useMemo(()=>({file:[r.jsx("div",{children:"test"},"test")]}),[]);return r.jsx(Fo,{default_sections:s,children:r.jsx(hn,{...t,systemTray:e})})},xn=L.memo(fn),wn=()=>{const e=V("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(_e),n=t(Ot(o));if(!n)return null;const a=s.functions.getComponent(U,n.type);return a?r.jsx(ne,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.createElement(a,n,[])}):null},Mn=R(e=>e.Layout.viewportManager,e=>e&&e.groups),yn=({sx:e,...t})=>{const s=V("Store"),{useAppSelector:o}=s.hooks,n=o(Mn),a=o(_e),i=o(Ho),d=l.useMemo(()=>Object.entries(i).reduce((y,[j,f])=>j==="home"?y:f.group?{...y,[f.group]:f.group in y?[...y[f.group],f]:[f]}:{...y,notGrouped:[...y.notGrouped,f]},{notGrouped:[]}),[i]),{functions:{addViewport:c,closeViewport:u,selectViewport:p}}=Dt(),M=l.useCallback(()=>{c("Nova aba","home",void 0,"new-")},[]),w=l.useCallback(y=>{u(y)},[]);return r.jsxs($,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},children:[r.jsxs(nt,{value:a,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[r.jsx(H,{value:"home",icon:r.jsx(Ds,{}),iconPosition:"start",onClick:()=>p("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(d).map(([y,j])=>y==="notGrouped"?j.map(f=>r.jsx(H,{value:f.name,id:f.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?p(f.name):w(f.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(se,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),w(f.name)}})]}),draggable:!0,wrapped:!0},`${f.name}-tab`)):j.map(f=>r.jsx(H,{value:f.name,id:f.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[f.group].color},onClick:()=>p(f.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(_,{size:"small",component:"span",children:r.jsx(se,{sx:{width:.5,marginLeft:1},onClick:g=>{g.stopPropagation(),w(f.name)}})})]}),draggable:"true",wrapped:!0},`${f.name}-tab`))),r.jsx(H,{value:"new",icon:r.jsx(Ls,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:M,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),r.jsx($,{id:wt,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),r.jsx($,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:r.jsx(wn,{})})]})},Cn=L.memo(yn),bn=()=>{const e=V("Store"),{useAppSelector:t}=e.hooks,s=t(Gt),o=jt(),n=l.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return r.jsx($,{role:"system-tray-container",children:r.jsx(_,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?r.jsx(Os,{fontSize:"small"}):r.jsx(Ts,{fontSize:"small"})})})},Sn=L.memo(bn),vn=Ns($)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,$n=()=>{const e=V("Store"),{useAppSelector:t}=e.hooks,s=t(Gt),o=l.useMemo(()=>Gs({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return r.jsxs(Ps,{theme:o,children:[r.jsx(_s,{}),r.jsx($,{role:"layout-root",sx:{minHeight:"100vh"},children:r.jsxs(vn,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[r.jsx($,{sx:{gridArea:"ribbon",width:"100%"},children:r.jsx(xn,{children:r.jsx(Sn,{})})}),r.jsx($,{id:ft,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),r.jsx(Cn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),r.jsx($,{id:xt,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},aa=L.memo($n),kn=e=>e.SVG,jn=e=>R(kn,t=>t&&t.svgs[e]),En=({path:e,instanceName:t,beforeInjection:s,sx:o,...n})=>{const a=V("Store"),{useAppSelector:i}=a.hooks,d=i(jn(e)),c=l.useCallback(p=>{if(p.setAttribute("id",`${e}-root`),p.setAttribute("width","100%"),p.setAttribute("height","100%"),t){if(!d?.instances[t])return;Object.entries(d?.instances[t].proxies??{}).forEach(([w,y])=>{const j=p.getElementById(w);j&&("fill"in y&&j.setAttribute("fill",y.fill),"stroke"in y&&j.setAttribute("stroke",y.stroke))})}s&&s(p)},[s,d?.content,t,d?.instances[t]]),u=l.useMemo(()=>d?.content&&window.URL.createObjectURL(new Blob([d.content],{type:"image/svg+xml"})),[d?.content]);return!d||!u?null:r.jsx($,{...n,role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{...o,width:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:r.jsx(Is,{style:{width:"100%",overflow:"hidden"},src:u,height:"100%",width:"100%",beforeInjection:c})})},A="SVG",Vn="0.0.1",Ue=m(`[${A}:SVG:${h.COMMAND}] Load SVG`),Pt=m(`[${A}:SVG:${h.COMMAND}] Fetch SVG`),_t=m(`[${A}:SVG:${h.COMMAND}] Set pan`),It=m(`[${A}:SVG:${h.COMMAND}] Set zoom`),Ut=m(`[${A}:SVG:${h.COMMAND}] Add proxy`),ze=m(`[${A}:SVG:${h.COMMAND}] Update proxy`),Fe=m(`[${A}:SVG:${h.COMMAND}] Delete proxy`),Be=m(`[${A}:SVG:${h.EVENT}] SVG fetched`),Rn=m(`[${A}:SVG:${h.EVENT}] SVG loaded`);m(`[${A}:SVG:${h.COMMAND}] Proxy added`);const An=m(`[${A}:SVG:${h.COMMAND}] Proxy updated`),Dn=m(`[${A}:SVG:${h.COMMAND}] Proxy deleted`),Ln=(e,t)=>{const s=V("Store"),{useAppDispatch:o}=s.hooks,n=o(),a=s.hooks.useAppSelector,i=R(c=>c&&c.SVG.svgs[e],t);return{state:a(i),actions:{setPan(c,u,p){n(_t({path:e,instanceName:c,x:u*-10,y:p*-10}))},setZoom(c,u){n(It({path:e,instanceName:c,zoom:u}))},addProxy(c,u,p){n(Ut({path:e,instanceName:u,id:c,styles:p}))},deleteProxy(c,u){n(Fe({path:e,instanceName:u,id:c}))},updateProxy(c,u,p){n(ze({path:e,instanceName:u,id:c,changes:p}))}}}},On=()=>{const e=V("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(Ue({path:o,instanceName:n}))}}}},Q=N();Q.startListening({actionCreator:Ue,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Pt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Be({path:e.path,content:n}))}});Q.startListening({actionCreator:Be,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(Rn(n[e.path]))}});Q.startListening({actionCreator:ze,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(An(n[e.path].instances[e.instanceName].proxies))}});Q.startListening({actionCreator:Fe,effect:async({payload:e},{dispatch:t})=>{t(Dn(e))}});const Tn={progress:"not-started",instances:{},content:void 0},Nn={svgs:{}},Gn=O({name:A,initialState:Nn,reducers:{},extraReducers:e=>{e.addCase(Ue,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!oe.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...Tn,instances:n}}}}),e.addCase(Pt,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(Be,(t,{payload:{path:s,content:o}})=>({...t,svgs:{...t.svgs,[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(Ut,(t,{payload:{path:s,instanceName:o,id:n,styles:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:a}:{[n]:a}}}}}})),e.addCase(It,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(_t,(t,{payload:{path:s,instanceName:o,x:n,y:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,a]}}}}})),e.addCase(ze,(t,{payload:{path:s,instanceName:o,id:n,changes:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...a}:a}}}}}})),e.addCase(Fe,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((a,[i,d])=>i===n?a:{...a,[i]:d},{})}}}}}))}}),Pn=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(A,Gn.reducer),e.functions.registerMiddleware(Q)},ra={name:A,version:Vn,depends_on:[],components:{SVGViewer:En},hooks:{useSVGManager:On,useSVG:Ln},kernelCalls:{startModule:Pn,restartModule(){},shutdownModule(){}}},_n=({initialPosition:e})=>{const[t,s]=l.useState(!1),[o,n]=l.useState({x:0,y:0}),[a,i]=l.useState(e),d=l.useCallback(p=>{s(!0),n({x:p.clientX,y:p.clientY}),p.stopPropagation()},[]),c=l.useCallback(p=>{if(!t)return;const M={x:p.clientX-o.x,y:p.clientY-o.y},w={x:a.x+M.x,y:a.y+M.y};i(w)},[t]),u=l.useCallback(p=>{s(!1),p.stopPropagation()},[]);return{position:a,setPosition:i,listeners:{onPointerDown:d,onPointerMove:c,onPointerUp:u}}},In=({children:e,component:t,actions:s,onClose:o})=>{const[n,a]=l.useState(!1),[i,d]=l.useState(!0),{innerWidth:c,innerHeight:u}=window,p=[c/2,u/2],{position:M,setPosition:w,listeners:y}=_n({initialPosition:{x:p[0],y:p[1]}}),j=l.useCallback((k,D)=>{const v=k-p[0],x=D-p[1];return v<0?x<0?1:3:x<0?2:4},[p]),f=l.useMemo(()=>j(M.x,M.y),[M]),g=l.useRef(null);l.useEffect(()=>{if(n&&i&&g.current){const{clientWidth:k,clientHeight:D}=g.current;f%2==0?w(v=>({x:v.x-k,y:v.y-D})):f>2&&w(v=>({x:v.x,y:v.y-D})),d(!1)}n||d(!0)},[n,g.current]);const S=l.useCallback(k=>{a(!0),w({x:k.clientX,y:k.clientY}),k.stopPropagation()},[]),b=l.useCallback(k=>{a(!1),k.stopPropagation(),o?.(k)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(st,{open:n,keepMounted:!0,onClose:b,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...y,children:r.jsx(ot,{sx:{position:"fixed",margin:1,left:M.x,top:M.y},elevation:6,children:r.jsxs($,{ref:g,sx:{display:"flex",flexGrow:1,flexDirection:f%2==1?"row":"row-reverse"},children:[r.jsxs($,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignContent:"space-between",borderLeft:`1px solid rgba(0,0,0, ${f%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${f%2==1?.1:0})`},children:[r.jsx(_,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:r.jsx(Us,{})}),s.map(k=>l.cloneElement(k,{size:"small",closeContainer:b})),r.jsx(_,{color:"error",onClick:b,size:"small",id:"close-panel",children:r.jsx(se,{})},"reject")]}),r.jsx($,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:r.jsx(ne,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.cloneElement(t,{isOpen:n})})})]})})}),l.cloneElement(e,{onClick:S})]})},Un=({gestures:e,children:t})=>{const s=l.useRef(null),n=zs(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return r.jsx($,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},He="Pointer",zn="0.0.1",Fn={},Bn=O({name:He,initialState:Fn,reducers:{},extraReducers:e=>{}}),Hn=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(He,Bn.reducer),console.info("Pointer module started"),console.groupEnd()},Wn=({closeContainer:e,handleConfirm:t,...s})=>l.createElement(_,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},r.jsx(Fs,{})),ia={name:He,version:zn,depends_on:[],components:{MultiTouchPanel:Un,PointerContainer:In,ConfirmAndCloseButton:Wn},hooks:{},store:{},kernelCalls:{startModule:Hn,restartModule(){},shutdownModule(){}}},I="Markdown",Yn="0.0.1",We=m(`[${I}:SVG:${h.COMMAND}] Load Markdown`),zt=m(`[${I}:SVG:${h.COMMAND}] Fetch Markdown`),Ye=m(`[${I}:SVG:${h.EVENT}] Markdown fetched`),Ft=m(`[${I}:SVG:${h.EVENT}] Markdown loaded`),qn=()=>{const e=V("Store"),{hooks:{useAppDispatch:t}}=e,s=t();return{loadMarkdown(o){s(We({path:o}))}}},Xn=e=>e.Markdown,Kn=e=>R(Xn,t=>t&&t.markdowns[e]),Bt=e=>{const t=V("Store"),{useAppSelector:s}=t.hooks;return s(Kn(e))},Qn=({path:e,...t})=>{const s=qn();l.useLayoutEffect(()=>{s.loadMarkdown(e)},[e]);const o=Bt(e);return!o||o.progress!=="completed"?r.jsx(r.Fragment,{}):r.jsx(Bs,{...t,remarkPlugins:[Hs],children:o.content})},qe=N();qe.startListening({actionCreator:We,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(zt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Ye({path:e.path,content:n}))}});qe.startListening({actionCreator:Ye,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{Markdown:{markdowns:n}}=o();s(Ft(n[e.path]))}});const Zn={progress:"not-started",content:null},Jn={markdowns:{}},ea=O({name:I,initialState:Jn,reducers:{},extraReducers:e=>{e.addCase(We,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...Zn,path:s}}})),e.addCase(zt,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"started"}}})),e.addCase(Ye,(t,{payload:{path:s,content:o}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],content:o}}})),e.addCase(Ft,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"completed"}}}))}}),ta=({managers:{storeManager:e}})=>{e.functions.loadReducer(I,ea.reducer),e.functions.registerMiddleware(qe)},ca={name:I,version:Yn,depends_on:[],components:{MarkdownReader:Qn},hooks:{useMarkdown:Bt},kernelCalls:{startModule:ta,restartModule(){},shutdownModule(){}}};export{h as A,na as D,aa as L,oa as M,Rn as S,Ut as a,ie as b,Ae as c,ht as d,de as e,Y as f,q as g,Ao as h,pt as i,ce as j,Fe as k,dt as l,Ue as m,V as n,ra as o,ia as p,ca as q,Me as r,ze as u};
