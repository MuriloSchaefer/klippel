import{c as P,d as pe,b as me,_ as X,o as e,B as y,aZ as R,a_ as he,a$ as q,b0 as S,r as v,aD as N,aT as se,aX as xe,aS as ge,aO as fe,R as A,n as je,ba as ve,P as be,I as U,bb as ye,bc as Ce,bd as Se,be as Me,e as Ne,T as ae,bf as L,bg as oe}from"../vendor-4a2caf03.js";import{A as $,n as h,o as Ie,l as we}from"../kernel-dfbde91d.js";const w="Converter",Le="0.0.1",I="conversion-graph",Te={week:"Semana",day:"Dia",h:"H",m:"m",s:"s",ms:"ms"},ke={selectedNode:void 0},re=P(`[${w}:${$.COMMAND}] Load conversion graph`),z=P(`[${w}:${$.COMMAND}] Select node`),Ge=P(`[${w}:${$.EVENT}] Conversion graph loaded`),Ae=P(`[${w}:${$.COMMAND}] Node selected`),Ee=pe({name:w,initialState:ke,reducers:{},extraReducers:t=>{t.addCase(z,(n,{payload:s})=>({...n,selectedNode:s}))}}),J=t=>t.Converter,T=t=>{const n=h("Store"),s=h("Graph"),i=h("Layout"),{useGraph:a}=s.hooks,o=a(I,x=>x),r=i.hooks.usePanelsManager(),{useAppDispatch:d,useAppSelector:c}=n.hooks,u=d(),l=me(J,t),E=c(l);return c(J),{state:E,selectNode:x=>{u(z(x)),r.functions.openDetails()},addUnit:(x,k,M)=>{const f=X.uniqueId(x.toLowerCase().replace(" ",""));o.actions.addNode({type:"UNIT",id:f,name:x,position:{x:0,y:0},abbreviation:k}),console.log(M),M&&(console.log("add scale"),o.actions.addEdge({id:`${f} -> ${M}`,type:"BELONGS_TO",sourceId:f,targetId:M}))},updateUnit:(x,k,M,f)=>{o.actions.updateNode({id:x,name:k,abbreviation:M});const b=o.state?.adjacencyList[x].outputs.filter(G=>o.state?.edges[G].type==="BELONGS_TO").map(G=>o.state?.edges[G]).pop();f?(b&&b.targetId!==f&&o.actions.removeEdge(b.id),o.actions.addEdge({id:`${x} -> ${f}`,type:"BELONGS_TO",sourceId:x,targetId:f})):b&&o.actions.removeEdge(b.id)},addScale:x=>{o.actions.addNode({type:"SCALE",id:X.uniqueId(x.toLowerCase().replace(" ","")),name:x,position:{x:0,y:0}})}}};function ie({onChange:t,value:n,...s}){const i=h("Graph"),{hooks:{useGraph:a}}=i,o=a(I,r=>r&&Object.values(r.nodes).filter(d=>d.type==="SCALE"));return o.state?e.jsx(y,{role:"scale-selector",...s,sx:{display:"flex",gap:.2},children:e.jsxs(R,{sx:{m:1,minWidth:120,width:"min-content"},children:[e.jsx(he,{id:"label",children:"Escala"}),e.jsxs(q,{id:"scale-selector",inputProps:{id:"scale"},label:"Escala",labelId:"label",size:"small",onChange:r=>t(r.target.value),value:n??"",children:[o.state.map(r=>e.jsx(S,{value:r.id,children:r.name})),e.jsx(S,{value:"",children:"Nenhuma"})]})]})}):e.jsx(e.Fragment,{})}const K={name:void 0,abbreviation:void 0,scale:void 0},Oe=()=>{const t=h("Pointer"),{PointerContainer:n,ConfirmAndCloseButton:s}=t.components,i=T(d=>d),[a,o]=v.useState(K),r=v.useCallback(()=>{!a.name||!a.abbreviation||(i.addUnit(a.name,a.abbreviation,a.scale),o(K))},[a,i]);return e.jsx(n,{component:e.jsxs(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(N,{id:"unit-name",label:"Nome",variant:"standard",value:a.name,onChange:d=>o(c=>({...c,name:d.target.value}))}),e.jsx(N,{id:"abbreviation",label:"Abbreviation",variant:"standard",value:a.abbreviation,onChange:d=>o(c=>({...c,abbreviation:d.target.value})),sx:{alignItems:"center"}}),e.jsx(ie,{value:a.scale??"",onChange:d=>o(c=>({...c,scale:d}))})]}),actions:[e.jsx(s,{handleConfirm:r},"confirm")],children:e.jsx(se,{primary:"Unidade",secondary:"Adiciona um tipo de unidade simples",sx:{cursor:"pointer",flexGrow:1}})})},ee={name:void 0},Pe=()=>{const t=h("Pointer"),{PointerContainer:n,ConfirmAndCloseButton:s}=t.components,i=T(d=>d),[a,o]=v.useState(ee),r=v.useCallback(()=>{a.name&&(i.addScale(a.name),o(ee))},[a,i]);return e.jsx(n,{component:e.jsx(y,{sx:{display:"flex",flexDirection:"column",gap:1},children:e.jsx(N,{id:"part-name",label:"Nome",variant:"standard",value:a.name,onChange:d=>o(c=>({...c,name:d.target.value}))})}),actions:[e.jsx(s,{handleConfirm:r},"confirm")],children:e.jsx(se,{primary:"Escala",secondary:"Adiciona um tipo de escala",sx:{cursor:"pointer",flexGrow:1}})})},$e=()=>{const t=[{key:"unit",component:e.jsx(Oe,{})},{key:"scale",component:e.jsx(Pe,{})}];return e.jsx(xe,{role:"list-options",sx:{paddingRight:5,overflow:"auto"},children:t.map(({key:n,component:s})=>e.jsx(ge,{disableGutters:!0,children:s},n))})},_e=()=>{const t=h("Layout"),{SettingsPanel:n,Accordion:s}=t.components;return e.jsxs(n,{children:[e.jsx(s,{name:"Nodos",icon:e.jsx(fe,{}),summary:"Tipos de nodos disponíveis",children:e.jsx($e,{})}),e.jsx(e.Fragment,{})]})},De=({graphId:t})=>{const{hooks:{useResizeObserver:n}}=h("Layout"),{hooks:{useGraph:s}}=h("Graph"),{hooks:{useD3Container:i},d3Components:{Grid:a,DependencyCircle:o}}=h("SVG"),r=T(p=>p),d=v.useRef(null),c=v.useRef(null),u=n(c),l=s(t,p=>p),E=v.useMemo(()=>{if(!l.state?.nodes)return{nodes:[],links:[]};const p=m=>{if(!l.state)return{id:"other",name:"Outros"};const C=Object.values(l.state.edges).find(j=>j.sourceId===m.id&&j.type==="BELONGS_TO");if(C){const j=l.state.nodes[C.targetId];return{id:j.id,name:j.name}}return{id:"other",name:"Outros"}};return{nodes:Object.values(l.state.nodes).map(m=>({...m,nodeLabel:"abbreviation"in m?m.abbreviation:m.name,group:p(m),radius:5,strength:10,x:m.position.x,y:m.position.y})),links:Object.values(l.state.edges).map(m=>({...m,source:m.sourceId,target:m.targetId}))}},[l]),x=je(),[k,M]=v.useState(!0),[f,b]=[u?.width??700,u?.height??700],G=v.useCallback(p=>{r.selectNode(p)},[]),W=v.useCallback(p=>{r.selectNode(p)},[]),ue=i().width(f).height(b).underlays([a({xSettings:{range:[-1,f+1],domain:[-1,f+1]},ySettings:{range:[-1,b+1],domain:[-1,b+1]},dimensions:[f,b]}).transformZoom((p,m)=>{k&&(m.translateBy(p,f/2,b/2),M(!1))}).build]).content([o().innerRadius(Math.min(f,b)/2-20).filterNode(p=>p.type==="UNIT"||p.type==="COMPOUND_UNIT").filterLink(p=>p.type==="CONVERTS_TO").renderGroup((p,m,C,j,O,Y)=>{p.selectAll("path").data([m]).join("path").attr("id",g=>g.id).on("click",g=>g.target.id!=="other"&&W(g.target.id)).attr("class","group-arc").attr("fill",g=>j(m.id)).attr("d",(g,Z)=>O(C)),p.selectAll("text").data([m]).join("text").attr("class","group-text").text(g=>g.name).attr("id",g=>g.id).on("click",g=>g.target.id!=="other"&&W(g.target.id)).attr("fill",g=>j(g.id)).attr("text-anchor",(g,Z)=>(C.endAngle+C.startAngle)/2>Math.PI?"end":"start").attr("transform",(g,Z)=>{const[_,D]=O.centroid(C),Q=Math.sqrt(_*_+D*D);return`translate(${_/Q*Y*1.3}, ${D/Q*Y*1.3})`})}).renderNode((p,m,C)=>{p.append("text").text(j=>j.nodeLabel).attr("fill",j=>r.state?.selectedNode===j.id?x.palette.getContrastText(x.palette.background.default):C(j.group.id)).attr("text-anchor","middle").on("pointerdown",(j,O)=>{G(O.id),j.stopPropagation()})}).theme(x.palette.mode).build]);return v.useLayoutEffect(()=>{!u||!d.current||ue.render(E,d.current)},[E,u]),l.state?e.jsx("div",{ref:c,role:"conversion-graph-viewer",style:{height:"100%",width:"100%"},children:e.jsx("svg",{ref:d,id:`${l.id}`,width:"100%",height:"100%"})}):e.jsx(e.Fragment,{})},Ve=A.memo(De),Fe=()=>{const t=h("Layout"),{Accordion:n}=t.components,s=h("Graph"),{useGraph:i}=s.hooks,a=T(u=>u.selectedNode),o=i(I,u=>a.state&&u?.nodes?{...u.nodes[a.state],scale:u.adjacencyList[a.state].outputs.filter(l=>u.edges[l].type==="BELONGS_TO").map(l=>u.edges[l].targetId).pop()}:void 0),[r,d]=v.useState(o.state);v.useEffect(()=>d(o.state),[a.state]);const c=v.useCallback(()=>{a.updateUnit(a.state,r?.name,r?.abbreviation,r?.scale)},[o]);return!a?.state||!o?.state?e.jsx(e.Fragment,{}):e.jsx(n,{name:"Propriedades",icon:e.jsx(ve,{}),summary:"Propriedades da unidade",children:e.jsxs(be,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"unit-properties",children:[e.jsx(N,{id:"unit-name",label:"Nome",variant:"standard",value:r?.name??"",onChange:u=>d(l=>l&&{...l,name:u.target.value})}),e.jsx(N,{id:"abbreviation",label:"Abreviatura",variant:"standard",value:r?.abbreviation??"",onChange:u=>d(l=>l&&{...l,abbreviation:u.target.value}),sx:{alignItems:"center"}}),e.jsx(ie,{value:r?.scale??"",onChange:u=>d(l=>l&&{...l,scale:u})}),e.jsxs(y,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(U,{color:"success",id:"save-unit-properties",onClick:u=>c(),children:e.jsx(ye,{})},"save"),e.jsx(U,{color:"info",id:"reset-unit-properties",onClick:u=>d(o.state),children:e.jsx(Ce,{})},"reset")]})]})})},Re=()=>{const t=h("Layout");h("Graph").hooks;const s=T(a=>a.selectedNode),{Accordion:i}=t.components;return e.jsx(i,{name:"Converte de",icon:e.jsx(Se,{}),summary:`Quais unidades podem ser convertidas em ${s.state}`,children:e.jsx(e.Fragment,{})})},Ue=()=>(h("Layout").components,e.jsxs(e.Fragment,{children:[e.jsx(Fe,{}),e.jsx(Re,{})]})),Be=()=>e.jsx(e.Fragment,{children:"Escala selectionada"}),qe=()=>{const t=h("Layout"),n=h("Graph"),{DetailsPanel:s}=t.components,{useGraph:i}=n.hooks,a=T(r=>r.selectedNode),o=i(I,r=>a.state?r?.nodes[a.state]:void 0);return o.state?e.jsx(s,{children:e.jsxs(e.Fragment,{children:[o?.state?.type==="UNIT"&&e.jsx(Ue,{}),o?.state?.type==="SCALE"&&e.jsx(Be,{})]})}):e.jsx(e.Fragment,{})},ze=({name:t})=>{const n=h("Layout"),{ViewportNotificationsTray:s}=n.components;return e.jsxs(y,{role:"converter-graph-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[e.jsx(Ve,{graphId:I}),e.jsx(s,{children:e.jsx(e.Fragment,{})}),e.jsx(_e,{}),e.jsx(qe,{})]})},de=A.memo(ze),He=()=>{const t=h("Layout"),{useViewportManager:n}=t.hooks,s=n();return e.jsx(e.Fragment,{children:e.jsx(U,{onClick:()=>s.functions.addViewport("Grafo de conversão","ConverterGraphViewport",void 0,"conversion-graph"),children:e.jsx(Me,{})})})},We={id:"conversion-graph",nodes:{},edges:{},adjacencyList:{},searchResults:{}},H=Ne();H.startListening({actionCreator:re,effect:async(t,n)=>{const{dispatch:s}=n;s(Ie({graphId:I})),s(we({graphId:I,graph:We})),s(Ge())}});H.startListening({actionCreator:z,effect:async(t,n)=>{const{dispatch:s}=n;s(Ae(t.payload))}});function Ye({dispatch:t,managers:{storeManager:n,componentRegistryManager:s,ribbonMenuManager:i}}){n.functions.loadReducer(w,Ee.reducer),n.functions.registerMiddleware(H),t(re()),s.functions.registerComponents({ribbonMenuSections:{ConversorGraphSection:A.memo(He)},viewportTypes:{ConverterGraphViewport:de}}),i.functions.addNewTab({label:"Conversor",sectionNames:["ConversorGraphSection"],type:"base"})}function V(t){const n=le(t);return`${n.amount} ${n.unit}`}function le(t){const n=["centavos","R$"];let s=0,i=t;for(;i>=100&&s<n.length-1;)s+=1,i/=100;return{amount:i,unit:n[s]}}function F(t){return t<1e4?Math.round(Math.sqrt(t)):+Math.pow(t/1e3,2).toPrecision(2)}function Ze({label:t,icon:n,onChange:s,slots:i}){const[a,o]=A.useState(10),r=(d,c)=>{typeof c=="number"&&(o(c),s(le(F(c)))),d.stopPropagation(),d.preventDefault()};return e.jsxs(y,{sx:{width:250},role:"money-slider",onPointerMove:d=>{d.stopPropagation(),d.preventDefault()},children:[e.jsxs(y,{children:[e.jsxs(ae,{id:"money-slider",gutterBottom:!0,children:[t,": ",V(F(a))]}),i?.coumpoundSelector]}),e.jsxs(L,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(L,{item:!0,children:n}),e.jsx(L,{item:!0,xs:!0,children:e.jsx(oe,{value:a,min:0,step:.01,max:1e5,marks:[{value:1e4,label:"1 R$"},{value:32e3,label:"10 R$"}],scale:F,getAriaValueText:V,valueLabelFormat:V,onChange:r,valueLabelDisplay:"auto","aria-labelledby":"money-slider"})})]})]})}function te(t){const n=ce(t);return`${n.amount} ${n.unit}`}function ce(t){const n=["s","m","h","d"],s=[1,60,3600,86400],i=s.findIndex(r=>r>=t),a=Math.max(i<0?3:i-1,0);return{amount:Math.round(t/s[a]),unit:n[a]}}function ne(t){let s=t;return t<108e3?s=t/120:t<2*108e3?s=t/240:t>3*108e3&&(s=t),s}function Qe({label:t,icon:n,onChange:s,slots:i}){const[a,o]=A.useState(10),r=(d,c)=>{typeof c=="number"&&(o(c),s(ce(ne(c)))),d.stopPropagation(),d.preventDefault()};return e.jsxs(y,{sx:{width:"min-content"},onPointerMove:d=>{d.stopPropagation(),d.preventDefault()},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:1},children:[e.jsxs(e.Fragment,{children:[e.jsx(N,{id:"quotient-number",size:"small",type:"number",sx:{minWidth:80},InputLabelProps:{shrink:!0},value:100}),e.jsxs(q,{id:"quotient-unit-selector",size:"small",sx:{width:"min-content"},children:[e.jsx(S,{value:"week",children:"Sem."}),e.jsx(S,{value:"day",children:"Dia"}),e.jsx(S,{value:"h",children:"Hr"}),e.jsx(S,{value:"m",children:"min"}),e.jsx(S,{value:"s",children:"sec"})]})]}),e.jsx("span",{children:"/"}),i?.coumpoundSelector]}),e.jsxs(L,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(L,{item:!0,children:n}),e.jsx(L,{item:!0,xs:!0,children:e.jsx(oe,{value:a,min:0,step:10,max:432e3,marks:[],scale:ne,getAriaValueText:te,valueLabelFormat:te,onChange:r,valueLabelDisplay:"auto","aria-labelledby":"time-slider"})})]})]})}function Xe({scale:t,...n}){return t==="money"?e.jsx(Ze,{...n}):e.jsx(Qe,{...n})}function B({onChange:t,value:n,children:s,...i}){return e.jsxs(y,{role:"unit-selector",...i,sx:{display:"flex",gap:.2},children:[e.jsx(R,{children:e.jsx(N,{id:"amount",size:"small",type:"number",autoComplete:"off",sx:{width:"min-content",minWidth:80},value:n.amount,onChange:a=>t({unit:n.unit,amount:a.target.valueAsNumber})})}),e.jsx(R,{children:e.jsx(q,{id:"unit-selector",inputProps:{id:"unit"},size:"small",sx:{width:"min-content"},onChange:a=>t({amount:n.amount,unit:a.target.value}),value:n.unit,children:s})})]})}function Je({quotientUnitsAvailable:t,dividendUnitsAvailable:n,label:s,value:i,onChange:a}){return e.jsxs(y,{role:"compound-selector",width:"min-content",sx:{display:"flex",gap:2,alignItems:"baseline"},children:[s&&e.jsx(ae,{gutterBottom:!0,children:s}),e.jsx(B,{id:"quotient-selector",value:i.quotient,onChange:o=>a({...i,quotient:o}),children:t().map(({value:o,label:r})=>e.jsx(S,{value:o,children:r},o))},"quotient"),e.jsx("span",{children:"/"}),e.jsx(B,{id:"dividend-selector",value:i.dividend,onChange:o=>a({...i,dividend:o}),children:n().map(({value:o,label:r})=>e.jsx(S,{value:o,children:r},o))},"dividend")]})}const Ke=()=>({time:Object.entries(Te).map(([t,n])=>({value:t,label:n}))}),et=({icon:t,value:n})=>e.jsxs(y,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[t&&e.jsx("div",{role:"coumpound-value-icon",children:t}),e.jsxs("div",{role:"coumpound-value-value",children:[n.quotient.amount," ",n.quotient.unit," / ",n.dividend.amount," ",n.dividend.unit]})]}),st={name:w,version:Le,depends_on:["Graph"],components:{CoverterGraphViewport:de,ScaleSlider:Xe,CompoundSelector:Je,UnitSelector:B,CompoundUnit:et},store:{actions:{},middlewares:[],reducers:{}},hooks:{useScales:Ke},constants:{},kernelCalls:{startModule:Ye,restartModule:()=>{},shutdownModule:()=>{}}};export{st as m};
