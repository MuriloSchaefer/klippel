import{r as f,o as e,B as g,aF as S,aG as K,I as w,aH as X,$ as D,aI as q,H as ee,aJ as te,aK as V,aL as ne,R as T,aM as se,aN as oe,aO as ae,aP as re,S as F,aQ as ie,aR as le,aS as W,aT as ce,aU as A,aV as L,T as P,aW as N,Z as I,_ as k,a3 as z,aX as de,aY as ue,aZ as O,P as R,a_ as pe,a$ as _,a2 as U,b0 as me,b1 as xe,b2 as H,y as he,ay as fe,b3 as je,b4 as ge,b5 as be,b6 as ve,b7 as Ce,b8 as E,b9 as ye,ba as Me,bb as we,bc as Pe,bd as ke,be as Ge,bf as Se,aj as Ie,bg as Te}from"../../vendor-8eb1de95.js";import{n as u}from"../../kernel-a935b9dd.js";import{u as C,a as B,b as Re}from"./hooks-50d94f07.js";const Ee=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:d}=n.components,l=C(t,o=>o?.selectedPart),[c,i]=f.useState({name:"",domId:""}),r=f.useCallback(()=>{l.actions.addPart(c.name,c.domId,l.state)},[c]);return e.jsx(a,{component:e.jsxs(g,{sx:{width:200},children:[e.jsx(S,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:o=>i(s=>({...s,name:o.target.value}))}),e.jsx(S,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:o=>i(s=>({...s,domId:o.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(K,{position:"end",children:e.jsx(w,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(X,{})})})}})]}),actions:[e.jsx(d,{handleConfirm:r},"confirm")],children:e.jsx(w,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:o=>{o.stopPropagation()},children:e.jsx(D,{})})})},De=({compositionName:t})=>{const n=C(t,d=>d?.selectedPart),a=f.useCallback(d=>{n.state&&n.actions.removePart(n.state),d.stopPropagation()},[n]);return e.jsx(w,{"aria-label":"Delete part",id:`delete-part-${n.state}`,role:"delete-part-button",size:"small",sx:{},onClick:a,children:e.jsx(q,{})})};function qe(t){return e.jsx(F,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function Ae(t){return e.jsx(F,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function Le(t){return e.jsx(F,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Oe(t){const n=se({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(oe.div,{style:n,children:e.jsx(ae,{...t})})}const $e=ee(t=>e.jsx(te,{...t,TransitionComponent:Oe}))(({theme:t})=>({[`& .${V.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${V.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${ne(t.palette.text.primary,.4)}`}}));function Fe({compositionName:t,graphId:n,selectedPart:a,selectPart:d,nodeId:l}){const c=u("Graph"),{useGraph:i}=c.hooks,r=i(n,o=>o&&o.adjacencyList[l]&&{node:o.nodes[l],edges:o.edges?Object.values(o.edges).reduce((s,j)=>o.adjacencyList[l].outputs.includes(j.id)?{...s,[j.id]:j}:s,{}):{},connections:o.adjacencyList[l]});return r.state?e.jsx(g,{sx:{color:"text.primary"},children:e.jsx($e,{nodeId:l,label:e.jsxs(g,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:o=>{l!==a&&(d(l),o.stopPropagation())},children:[r.state.node.label,l===a&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{compositionName:t}),e.jsx(De,{compositionName:t})]})]}),onClick:()=>{d(l)},sx:{color:l===a?"secondary.main":"secondary.secondary"},children:r.state.connections.outputs.filter(o=>r.state?.edges[o].type==="COMPOSED_OF").map(o=>r.state&&e.jsx(Q,{compositionName:t,graphId:n,selectPart:d,selectedPart:a,nodeId:r.state.edges[o].targetId},`${l}-${r.state?.edges[o].targetId}`))})}):e.jsx(e.Fragment,{})}const Q=T.memo(Fe);function _e(){const t=u("Store"),n=u("Layout"),a=u("Graph"),{useAppSelector:d}=t.hooks,{useGraph:l}=a.hooks,{selectActiveViewport:c}=n.store.selectors,i=d(c),r=f.useCallback(j=>({name:j?.name,svgPath:j?.svgPath,graphId:j?.graphId,selectedPart:j?.selectedPart}),[]),o=C(i,r),s=l(i,j=>j?.adjacencyList);return!o.state?.svgPath||!o.state?.graphId||!o.state?.name||!s?null:e.jsx(re,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(qe,{}),defaultExpandIcon:e.jsx(Ae,{}),defaultEndIcon:e.jsx(Le,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(Q,{compositionName:o.state.name,nodeId:"garment",graphId:o.state.graphId,selectPart:o.actions.selectPart,selectedPart:o.state.selectedPart})})}const Be=()=>e.jsx(e.Fragment,{}),Ve=()=>{const t=u("Layout"),{SettingsPanel:n,Accordion:a}=t.components;return e.jsxs(n,{children:[e.jsx(a,{name:"Composição",icon:e.jsx(ie,{}),summary:"composição da peça",children:e.jsx(_e,{})}),e.jsx(a,{name:"Materiais",icon:e.jsx(le,{}),summary:"Lista de materiais necessários",children:e.jsx(Be,{})}),e.jsx(a,{name:"Prazos",icon:e.jsx(W,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})}),e.jsx(a,{name:"Valores",icon:e.jsx(ce,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})})]})},ze=T.memo(Ve),We=({graphId:t,node:n})=>{const{components:{MaterialSelector:a}}=u("Materials"),d=u("Graph"),{useGraph:l}=d.hooks,c=C(t,o=>o),i=l(t,o=>o?.nodes[n.materialId]),r=f.useCallback(o=>c.actions.changeMaterial(n.id,o),[t,n.id]);return e.jsx(a,{type:n.materialType,value:i?.state?.materialId,onChange:r})},Ne=({node:t,graphId:n})=>{const a=u("Graph"),{components:{MaterialTypeSelector:d}}=u("Materials"),{useNodeInfo:l,useGraph:c,useSearch:i}=a.hooks,r=c(n,x=>x?.nodes[t.id]),o=f.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),s=i(n,o,()=>{t&&r.actions.search("bfs",t.id,(x,h)=>x.type!=="RESTRICTION"?!1:h.adjacencyList[x.id].inputs.some(M=>{const G=h.edges[M];return G.type==="RESTRICTED_BY"&&G.attr==="materialType"}),()=>!1,1,`Get all restriction associated with ${t.label}`,o)}),j=f.useMemo(()=>s?.findings.reduce((x,h)=>h.restrictionType==="allowOnly"?[...x,...h.operand]:x,[]),[s]),m=l(n,t.materialType),p=C(n,x=>x),b=f.useCallback(x=>p.actions.changeMaterialType(t.id,x.target.value),[n,t.id]);return e.jsx(d,{filter:x=>s?.findings.length?j?.includes(x.name):!0,value:m.node?.id,onChange:b})},Ue=({graphId:t,nodeId:n})=>{const a=u("Graph"),{useNodeInfo:d}=a.hooks,{node:l}=d(t,n);return e.jsx(A,{role:"material-info",children:e.jsx(L,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(P,{children:l.label}),e.jsx(N,{})]}),secondary:e.jsx(P,{component:"div",children:e.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(g,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:l.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Ne,{graphId:t,node:l},c);case"materialId":return e.jsx(We,{graphId:t,node:l},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},He=({isOpen:t,labelState:[n,a],materialTypes:d,handleMaterialTypeChange:l})=>{const{components:{MaterialTypeSelector:c}}=u("Materials");return t?e.jsxs(g,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(c,{value:d,onChange:l,multiple:!0}),e.jsx(S,{id:"material-usage-name",label:"Nome",variant:"standard",value:n,onChange:i=>a(i.target.value)})]}):e.jsx(e.Fragment,{})},Qe=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:d}=n.components,l=C(t,m=>m?.selectedPart),[c,i]=f.useState(""),[r,o]=f.useState([]),s=f.useCallback(()=>{l.state&&l.actions.addMaterialUsage(c,l.state,r)},[c]),j=f.useCallback(m=>o(p=>m.target.value),[t]);return e.jsx(a,{component:e.jsx(He,{materialTypes:r,handleMaterialTypeChange:j,labelState:[c,i]}),actions:[e.jsx(d,{color:"success",handleConfirm:s},"accept")],children:e.jsx(I,{startIcon:e.jsx(D,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},Ye=({compositionName:t,materialUsageId:n})=>{const a=C(t,l=>l),d=f.useCallback(()=>{a.actions.removeMaterialUsage(n)},[a]);return e.jsx(w,{color:"error",id:"delete-material",onClick:d,sx:{flexGrow:2},children:e.jsx(q,{})},"delete")},Ze=({compositionState:t,materialUsageId:n,isOpen:a})=>{const d=u("Graph"),l=u("Layout"),{useNodeInfo:c}=d.hooks,{CRUDGridContext:i}=l.contexts,{CRUDGrid:r,CRUDBooleanCell:o}=l.components,{node:s}=c(t.graphId,n),j=f.useMemo(()=>s.proxies.reduce((p,b)=>({...p,[b.elem]:{...p[b.elem],[b.attr]:!0}}),{}),[s]),{setRows:m}=f.useContext(i);return f.useEffect(()=>m(Object.entries(j).map(([p,b])=>({...b,elem:p,state:"untouched",id:k.uniqueId("proxy-")}))),[j]),a?e.jsxs(g,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(P,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(P,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(r,{addLabel:"Adicionar vínculo",newRecord:()=>({id:k.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:p})=>e.jsx(z,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(o,{...p})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:p})=>e.jsx(z,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(o,{...p})}]})]}):e.jsx(e.Fragment,{})},Je=T.memo(Ze),Ke=({composition:t,materialUsageId:n,...a})=>{const d=u("Pointer"),l=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:r}=f.useContext(i),o=f.useCallback(()=>{r.filter(s=>s.state==="deleted").forEach(s=>t.actions.deleteProxy(s.elem,n)),r.filter(s=>s.state==="modified").forEach(s=>{t.actions.deleteProxy(s.old.elem,n),s.stroke&&t.actions.addProxy({elem:s.elem,attr:"stroke"},n),s.fill&&t.actions.addProxy({elem:s.elem,attr:"fill"},n)}),r.filter(s=>s.state==="added").forEach(s=>{t.actions.deleteProxy(s.elem,n),s.stroke&&t.actions.addProxy({elem:s.elem,attr:"stroke"},n),s.fill&&t.actions.addProxy({elem:s.elem,attr:"fill"},n)})},[r]);return e.jsx(c,{color:"success",...a,handleConfirm:o})},Xe=({compositionName:t,materialUsageId:n})=>{const a=C(t,r=>r),d=u("Pointer"),l=u("Layout"),{PointerContainer:c}=d.components,{CRUDGridProvider:i}=l.components;return a.state?e.jsx(i,{initialRows:[],children:e.jsx(c,{component:e.jsx(Je,{compositionState:a.state,materialUsageId:n}),actions:[e.jsx(Ke,{composition:a,materialUsageId:n},"accept")],children:e.jsx(w,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(de,{})},"configure")})}):e.jsx(e.Fragment,{})};function et({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function tt({row:t,...n}){const{components:{CRUDMaterialTypeCell:a}}=u("Materials");switch(t.attribute){case"materialType":return e.jsx(a,{row:t,value:t.operand,...n,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const nt=({compositionState:t,materialUsageId:n})=>{const a=u("Graph"),d=u("Layout"),{useGraph:l,useSearch:c}=a.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:r}=d.components,{state:o,actions:{search:s}}=l(t.graphId,x=>x?.nodes[n]),j=f.useMemo(()=>`${n}/restrictions`,[n]),m=c(t.graphId,j,()=>{o&&s("bfs",o.id,(x,h)=>x.type!=="RESTRICTION"?!1:h.adjacencyList[x.id].inputs.some(M=>h.edges[M].type==="RESTRICTED_BY"),()=>!1,1,`Get all restriction associated with ${o?.label??o.id}`,j)}),{setRows:p}=f.useContext(i);f.useEffect(()=>{m?.findings&&p(m.findings.map(x=>({...x,state:"untouched"})))},[m]),f.useEffect(()=>{m?.findings&&p(m.findings)},[]);const b=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:x})=>e.jsx(e.Fragment,{children:x})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:x})=>e.jsx(et,{node:x}),renderEditCell:x=>e.jsx(tt,{...x})}];return e.jsxs(g,{role:"restrictions-management-container",children:[e.jsx(P,{variant:"h4",children:"Restrições do material"}),e.jsxs(P,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(r,{addLabel:"Adicionar restrição",newRecord:()=>({id:k.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:b})]})},st=t=>t.isOpen?e.jsx(g,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(nt,{...t})}):e.jsx("div",{}),ot=({composition:t,materialUsageId:n,...a})=>{const d=u("Pointer"),l=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:r}=f.useContext(i),o=f.useCallback(()=>{console.group("delete"),r.filter(s=>s.state==="deleted").forEach(s=>t.actions.removeRestriction(n,s.id)),console.groupEnd(),console.group("modified"),r.filter(s=>s.state==="modified").forEach(s=>{t.actions.updateRestriction(n,s.id,s)}),console.groupEnd(),console.group("added"),r.filter(s=>s.state==="added").forEach(s=>{t.actions.addRestriction(n,{type:"RESTRICTION",id:s.id,label:s.label,operand:s.operand,position:s.position,restrictionType:s.restrictionType,attribute:s.attribute})}),console.groupEnd()},[r]);return e.jsx(c,{color:"success",...a,handleConfirm:o})},at=({sx:t,materialUsageId:n,compositionName:a,...d})=>{const l=C(a,s=>s),c=u("Pointer"),i=u("Layout"),{PointerContainer:r}=c.components,{CRUDGridProvider:o}=i.components;return l.state?e.jsx(o,{initialRows:[],children:e.jsx(r,{component:e.jsx(st,{compositionState:l.state,materialUsageId:n}),actions:[e.jsx(ot,{composition:l,materialUsageId:n},"accept")],children:e.jsx(w,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(ue,{})},"restrict")})}):e.jsx(e.Fragment,{})},rt=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(Ye,{...t}),e.jsx(Xe,{...t}),e.jsx(at,{...t,sx:{hover:{fill:"yellow"}}})]});function Y({compositionName:t,selectedPart:n,graphId:a}){const d=u("Graph"),{useNodeInfo:l}=d.hooks,{edges:c}=l(a,n);return e.jsxs(O,{sx:{width:"100%"},role:"material-list",children:[e.jsx(Qe,{compositionName:t}),Object.values(c).filter(i=>i.type==="MADE_OF").map(i=>e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(Ue,{graphId:a,nodeId:i.targetId}),e.jsx(rt,{compositionName:t,materialUsageId:i.targetId})]},i.targetId))]})}const it=({graphId:t,nodeId:n})=>{const a=u("Graph"),d=u("Converter"),{useNodeInfo:l}=a.hooks,{useUnits:c}=d.hooks,{node:i}=l(t,n),r=c([i.cost.dividend.unit,i.cost.quotient.unit,i.time_taken.dividend.unit,i.time_taken.quotient.unit]);return r?e.jsx(A,{children:e.jsx(L,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(P,{children:i.label}),e.jsx(N,{})]}),secondary:e.jsx(P,{component:"div",sx:{padding:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(W,{})," ",i.time_taken.quotient.amount," ",r[i.time_taken.quotient.unit].abbreviation," /"," ",i.time_taken.dividend.amount," ",r[i.time_taken.dividend.unit].abbreviation]}),e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(pe,{})," ",i.cost.quotient.amount," ",r[i.cost.quotient.unit].abbreviation," /"," ",i.cost.dividend.amount," ",r[i.cost.dividend.unit].abbreviation]})]})})})}):e.jsx(e.Fragment,{})},lt=({compositionName:t})=>{const n=u("Pointer"),a=u("Converter"),{PointerContainer:d,ConfirmAndCloseButton:l}=n.components,{CompoundSelector:c}=a.components;a.hooks;const i=C(t,m=>m?.selectedPart),r=f.useMemo(()=>k.uniqueId("new-process-form"),[]),[o,s]=f.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),j=f.useCallback(m=>{m.preventDefault(),m.stopPropagation(),i.state&&i.actions.addOperation(o.label,o.cost,o.time_taken,i.state)},[o]);return e.jsx(d,{component:e.jsxs(g,{component:"form",onSubmit:j,id:r,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(_,{children:e.jsx(S,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:m=>s(p=>({...p,label:m.target.value})),value:o.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",filterDividends:m=>m.abbreviation==="un",filterQuotients:(m,p)=>p?.name==="Temporal",value:o.time_taken,onChange:m=>s(p=>({...p,time_taken:m}))}),e.jsx(c,{id:"cost",label:"Custo",filterDividends:(m,p)=>m.abbreviation==="un"||p?.name=="Temporal",filterQuotients:(m,p)=>p?.name==="Monetaria",value:o.cost,onChange:m=>s(p=>({...p,cost:m}))})]}),actions:[e.jsx(l,{type:"submit",form:r,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(I,{startIcon:e.jsx(D,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},ct=({compositionName:t,processId:n})=>{const a=C(t,l=>l),d=f.useCallback(()=>{a.actions.removeOperation(n)},[a]);return e.jsx(w,{color:"error",id:`delete-process-${n}`,onClick:d,sx:{flexGrow:2},children:e.jsx(q,{})},"delete")},dt=({id:t,field:n,graphId:a,partId:d,value:l})=>{const c=u("Graph"),{useGraph:i}=c.hooks,r=U(),o=p=>Object.values(p).filter(b=>b.type==="MADE_OF"&&b.sourceId===d),s=(p,b)=>Object.entries(p).reduce((x,[h,v])=>b.includes(h)?{...x,[h]:v}:x,{}),{state:j}=i(a,p=>p&&{edges:o(p.edges),nodes:s(p.nodes,o(p.edges).map(b=>b.targetId))}),m=f.useCallback(p=>{r.current.setEditCellValue({id:t,field:n,value:p.target.value})},[a,d]);return j?e.jsxs(_,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(me,{id:"label",children:"Material"}),e.jsx(xe,{labelId:"label",id:"material-type",value:l??"",label:"Material",autoWidth:!0,onChange:m,children:j.edges.map(p=>e.jsx(H,{value:p.targetId,children:j.nodes[p.targetId].label},p.id))})]}):e.jsx(e.Fragment,{})};function ut({row:t,id:n,field:a}){const d=U(),l=u("Converter"),{components:{CompoundSelector:c}}=l,i=f.useCallback(r=>{d.current.setEditCellValue({id:n,field:a,value:r})},[n]);return e.jsx(c,{id:"quantity",filterQuotients:(r,o)=>o?.name==="Comprimento"||o?.name==="Volume"||o?.name==="Area",filterDividends:(r,o)=>r.abbreviation==="un",value:t.quantity,onChange:i})}const pt=({compositionState:t,processId:n})=>{const a=u("Graph"),d=u("Layout"),l=u("Converter"),{useGraph:c}=a.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:r}=d.components,{components:{CompoundUnit:o}}=l,s=h=>Object.values(h).filter(v=>v.type==="MADE_OF"&&v.sourceId===t.selectedPart),j=(h,v)=>Object.entries(h).reduce((y,[M,G])=>v.includes(M)?{...y,[M]:G}:y,{}),{state:m}=c(t.graphId,h=>h&&{edges:s(h.edges),nodes:j(h.nodes,s(h.edges).map(v=>v.targetId))}),{state:p}=c(t.graphId,h=>h?.edges&&Object.values(h.edges).filter(v=>v.type==="CONSUMES"&&v.sourceId===n)),{setRows:b}=f.useContext(i);if(f.useEffect(()=>{p?.length&&b(p.map(h=>({...h,state:"untouched"})))},p),!m)return e.jsx(e.Fragment,{});const x=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:h},value:v})=>e.jsx(e.Fragment,{children:m.nodes[h]?.label}),renderEditCell:({value:h,...v})=>e.jsx(dt,{value:h??v.row.targetId,partId:t.selectedPart,graphId:t.graphId,...v}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:h}})=>e.jsx(o,{value:h}),renderEditCell:h=>e.jsx(ut,{...h})}];return e.jsxs(g,{role:"material-usage-management-container",children:[e.jsx(P,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(P,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(r,{addLabel:"Víncular material",newRecord:()=>({id:k.uniqueId("material-usage-"),type:"CONSUMES",sourceId:n,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:x})]})},mt=t=>t.isOpen?e.jsx(g,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(pt,{...t})}):e.jsx("div",{}),xt=({composition:t,processId:n,...a})=>{const d=u("Pointer"),l=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:r}=f.useContext(i),o=f.useCallback(()=>{r.filter(s=>s.state==="deleted").forEach(s=>{t.actions.deleteMaterialConsuption(s.id)}),r.filter(s=>s.state==="modified").forEach(({id:s,targetId:j,quantity:m})=>{t.actions.updateMaterialConsuption(s,{targetId:j,quantity:m})}),r.filter(s=>s.state==="added").forEach(s=>{t.actions.addMaterialConsuption(n,s.targetId,s.quantity)})},[r]);return e.jsx(c,{color:"success",...a,handleConfirm:o})},ht=({sx:t,compositionName:n,processId:a,...d})=>{const l=C(n,s=>s),c=u("Pointer"),i=u("Layout"),{PointerContainer:r}=c.components,{CRUDGridProvider:o}=i.components;return l.state?e.jsx(o,{initialRows:[],children:e.jsx(r,{component:e.jsx(mt,{processId:a,compositionState:l.state}),actions:[e.jsx(xt,{composition:l,processId:a},"accept")],children:e.jsx(w,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(he,{})},"configure")})}):e.jsx(e.Fragment,{})},ft=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(ct,{...t}),e.jsx(ht,{...t})]});function Z({compositionName:t,selectedPart:n,graphId:a}){const d=u("Graph"),{useNodeInfo:l}=d.hooks,{edges:c}=l(a,n);return e.jsxs(O,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(lt,{compositionName:t}),Object.values(c).filter(i=>i.type==="PROCESS_NEEDED").map(i=>e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(it,{graphId:a,nodeId:i.targetId}),e.jsx(ft,{compositionName:t,processId:i.targetId})]},i.targetId))]})}const jt=({compositionName:t,graphId:n})=>{const a=u("Pointer"),d=u("Graph"),{PointerContainer:l,ConfirmAndCloseButton:c}=a.components,{useGraph:i}=d.hooks,r=C(t,x=>x?.selectedPart),o=i(n,x=>x?Object.values(x.nodes).filter(h=>h.type==="GRADE").map(h=>({...h,order:Object.values(x.edges).find(v=>v.targetId===h.id)?.order})):[]),s=f.useMemo(()=>o.state?fe.max(o.state.filter(x=>k.isNumber(x?.order)).map(x=>x.order))??0:0,[o]),j=f.useMemo(()=>k.uniqueId("new-process-form"),[]),[m,p]=f.useState({abbreviation:""}),b=f.useCallback(x=>{x.preventDefault(),x.stopPropagation(),r.state&&r.actions.addGrade(m.abbreviation,s+1)},[m.label,m.abbreviation,s,r.state]);return e.jsx(l,{component:e.jsx(g,{component:"form",onSubmit:b,id:j,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:e.jsx(_,{children:e.jsx(S,{id:"abbreviation",label:"Abreviação",variant:"standard",sx:{marginBottom:1},onChange:x=>p(h=>({...h,abbreviation:x.target.value})),value:m.abbreviation})})}),actions:[e.jsx(c,{type:"submit",form:j,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(I,{startIcon:e.jsx(D,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar Grade"})})};function gt({compositionName:t,graphId:n}){const a=u("Graph"),{useGraph:d}=a.hooks,l=d(n,r=>r?Object.values(r.nodes).filter(o=>o.type==="GRADE").map(o=>({...o,order:Object.values(r.edges).find(s=>s.targetId===o.id)?.order})).filter(o=>k.isNumber(o?.order)).sort((o,s)=>o?.order-s?.order):[]),c=C(t,r=>r?.selectedPart),i=f.useCallback(r=>{c.actions.removeGrade(r)},[t]);return l.state?e.jsxs(O,{sx:{width:"100%"},role:"material-list",children:[e.jsx(jt,{graphId:n,compositionName:t}),l.state.map(r=>e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"grade-container",children:[e.jsx(A,{role:"grade-info",children:e.jsx(L,{disableTypography:!0,primary:e.jsx(P,{children:r.abbreviation})})}),e.jsx(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:e.jsx(w,{color:"error",id:"delete-material",onClick:()=>i(r.id),sx:{flexGrow:2},children:e.jsx(q,{})},"delete")})]},r.id))]}):e.jsx(e.Fragment,{})}const bt=t=>{const n=u("Layout"),{Accordion:a}=n.components;return e.jsx(a,{name:"Graduação",icon:e.jsx(je,{}),summary:"Graduação da peça",sx:{flexGrow:1},children:e.jsx(gt,{...t})})},vt=({node:t,graphId:n,selectedPart:a,compositionName:d})=>{const l=u("Layout"),c=u("Markdown"),{components:{MarkdownReader:i}}=c,{DetailsPanel:r,Accordion:o,CustomTextArea:s,SystemModal:j}=l.components,[m,p]=f.useState({name:t.label??"Nova peça",description:t.description??""}),b=C(d,h=>h),x=f.useCallback(()=>{b.actions.changeProperties(m.name,m.description)},[d,m.name,m.description]);return e.jsxs(r,{title:t.label,id:"gamerment-panel",children:[e.jsx(o,{name:"Propriedades",icon:e.jsx(ge,{}),summary:"Propriedades da peça",sx:{flexGrow:1},children:e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"garment-properties",id:"garment-properties",children:[e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:1},children:[e.jsx(S,{id:"garment-name",label:"Nome",variant:"standard",sx:{width:"100%"},value:m?.name,onChange:h=>p(v=>v&&{...v,name:h.target.value})}),e.jsx(s,{id:"description",wrapperProps:{sx:{width:"100%"}},minRows:3,name:"Outlined",placeholder:"Descrição",color:"neutral",value:m.description,onChange:h=>{h.preventDefault(),h.stopPropagation(),p(v=>v&&{...v,description:h.target.value})}},"description")]}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(w,{color:"success",id:"save-properties",onClick:h=>x(),children:e.jsx(be,{})},"save"),e.jsx(j,{component:e.jsx(i,{content:m.description}),button:e.jsx(w,{color:"warning",id:"preview-description",children:e.jsx(ve,{})},"preview")}),e.jsx(w,{color:"info",id:"reset-properties",onClick:h=>p({name:t.label,description:t.description}),children:e.jsx(Ce,{})},"reset")]})]},"garment-properties")}),e.jsx(bt,{graphId:n,compositionName:d,selectedPart:a}),e.jsx(o,{name:"Materiais",icon:e.jsx(E,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Y,{graphId:n,selectedPart:a,compositionName:d})}),e.jsx(o,{name:"Processos",icon:e.jsx(E,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(Z,{graphId:n,selectedPart:a,compositionName:d})})]},"garment-panel")},Ct=()=>{const t=u("Layout"),n=u("Store"),{useAppSelector:a}=n.hooks,{selectActiveViewport:d}=t.store.selectors,l=a(d),c=f.useCallback(r=>({name:r?.name,graphId:r?.graphId,selectedPart:r?.selectedPart}),[]),i=C(l,c);return!i.state?.selectedPart||!i.state?.graphId||!i.state?.name?null:e.jsx(yt,{graphId:i.state.graphId,selectedPart:i.state.selectedPart,compositionName:i.state.name})},yt=({graphId:t,selectedPart:n,compositionName:a})=>{const d=u("Layout"),l=u("Graph"),{DetailsPanel:c,Accordion:i}=d.components,{useGraph:r}=l.hooks,o=r(t,s=>s?.nodes[n]);return o.state?.type==="GARMENT"?e.jsx(vt,{node:o.state,graphId:t,compositionName:a,selectedPart:n}):e.jsxs(c,{title:o.state?.label??n,children:[e.jsx(i,{name:"Opcionais",icon:e.jsx(E,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(i,{name:"Materiais",icon:e.jsx(E,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Y,{graphId:t,selectedPart:n,compositionName:a})}),e.jsx(i,{name:"Processos",icon:e.jsx(E,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(Z,{graphId:t,selectedPart:n,compositionName:a})})]})},Mt=T.memo(Ct),$=["Adicionar ao orçamento","Criar orçamento"];function wt(){const[t,n]=f.useState(!1),a=f.useRef(null),[d,l]=f.useState(1),c=()=>{console.info(`You clicked ${$[d]}`)},i=(s,j)=>{l(j),n(!1)},r=()=>{n(s=>!s)},o=s=>{a.current&&a.current.contains(s.target)||n(!1)};return e.jsxs(f.Fragment,{children:[e.jsxs(ye,{variant:"contained",ref:a,"aria-label":"split button",children:[e.jsx(I,{onClick:c,children:$[d]}),e.jsx(I,{size:"small","aria-controls":t?"split-button-menu":void 0,"aria-expanded":t?"true":void 0,"aria-label":"select merge strategy","aria-haspopup":"menu",onClick:r,children:e.jsx(Me,{})})]}),e.jsx(we,{sx:{zIndex:1},open:t,anchorEl:a.current,role:void 0,transition:!0,disablePortal:!0,children:({TransitionProps:s,placement:j})=>e.jsx(Pe,{...s,style:{transformOrigin:j==="bottom"?"center top":"center bottom"},children:e.jsx(R,{children:e.jsx(ke,{onClickAway:o,children:e.jsx(Ge,{id:"split-button-menu",autoFocusItem:!0,children:$.map((m,p)=>e.jsx(H,{disabled:p===2,selected:p===d,onClick:b=>i(b,p),children:m},m))})})})})})]})}const Pt=()=>e.jsx(g,{sx:{position:"absolute",bottom:10,right:10},children:e.jsx(wt,{})}),kt=T.memo(Pt),At=()=>{const t=u("Store"),n=u("Layout"),{useAppSelector:a}=t.hooks,{selectActiveViewport:d}=n.store.selectors,l=a(d),c=f.useCallback(r=>r,[l]),i=C(l,c);return!l||!i.state?null:e.jsx(Gt,{selectPart:i.actions.selectPart,compositionInfo:i.state})},Gt=({compositionInfo:t,selectPart:n})=>{const{components:{SVGViewer:a},hooks:{useSVG:d}}=u("SVG"),{components:{MultiTouchPanel:l}}=u("Pointer"),{hooks:{useGraph:c}}=u("Graph"),i=u("Layout"),{ViewportNotificationsTray:r}=i.components,{graphId:o,svgPath:s,name:j,viewportName:m}=t,p=B(),b=c(o,y=>y?.nodes),x=d(s,y=>y?.instances[j]),h=f.useCallback(y=>{b.state&&Object.values(b.state).filter(M=>M.type==="PART").forEach(M=>{if(M.domId){const[G]=[...y?.querySelectorAll(`#${M.domId}`)];G.addEventListener("click",J=>{J.stopPropagation(),n(M.id)})}})},[o]),v=f.useCallback(()=>{p.functions.createDebugView(j,m)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(g,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(l,{gestures:{onPinch:y=>{x.actions.setZoom(j,y.offset[0])},onWheel:y=>{const M=x.state?.zoom??1;x.actions.setZoom(j,M+y.delta[1]*.001)}},children:e.jsx(a,{instanceName:j,path:s,beforeInjection:h})}),e.jsx(r,{children:e.jsx(Se,{fontSize:"small",onClick:v,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(ze,{}),e.jsx(Mt,{})]}),e.jsx(kt,{})]})},St=({instanceName:t,path:n,...a})=>{const d=u("SVG"),{components:{SVGViewer:l},hooks:{useSVGManager:c}}=d,i=c();return f.useLayoutEffect(()=>{i.functions.loadSVG(n,`${t}-preview`)},[]),e.jsx(l,{...a,instanceName:`${t}-preview`,path:n})},It=Ie(g)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Tt=({closeModal:t,onModelSelection:n})=>{const a=u("Markdown"),{components:{MarkdownReader:d}}=a,l=Re(),[c,i]=f.useState(void 0);return e.jsx(R,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",p:2},children:e.jsxs(It,{role:"model-selector-container",sx:{gap:1},children:[e.jsx(O,{role:"list-options",sx:{paddingRight:5,overflow:"auto"},children:l.map(r=>e.jsx(A,{disableGutters:!0,children:e.jsx(L,{primary:r.name,secondary:null,id:r.name,color:c?.name===r.name?"primary":"secondary",onClick:()=>i({name:r.name,path:r.svgPath,descriptionPath:r.descriptionPath}),sx:{cursor:"pointer",flexGrow:1}})},k.uniqueId()))}),e.jsxs(g,{sx:{overflow:"auto",width:"100%"},children:[c?e.jsx(St,{instanceName:c.name,path:c.path,sx:{gridArea:"preview",p:1}}):e.jsx(g,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),c?.descriptionPath&&e.jsx(g,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(d,{path:c.descriptionPath})})]}),e.jsx(g,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(I,{disabled:!c,variant:"contained",onClick:()=>{c&&(n(c.name,c.path),t?.())},children:"Selecionar"})})]})})},Lt=()=>{const t=B(),n=u("Layout"),{SystemModal:a}=n.components,d=f.useCallback((l,c)=>{t.functions.createComposition(l,c)},[]);return e.jsx(a,{component:e.jsx(Tt,{onModelSelection:d}),button:e.jsx(w,{children:e.jsx(Te,{})})})},Rt=({name:t})=>{const n=u("Graph"),a=u("Layout"),{ViewportNotificationsTray:d,DetailsPanel:l,SettingsPanel:c,Accordion:i}=a.components,{components:{GraphViewer:r}}=n,o=B(),s=f.useMemo(()=>o.functions.findComposition(j=>j.debugViewport===t),[t]);return e.jsxs(g,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[s&&e.jsx(r,{graphId:s?.graphId}),e.jsx(d,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(i,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(l,{children:e.jsx(e.Fragment,{})})]})},Ot=T.memo(Rt);export{At as C,Ot as D,Lt as M};
