import{r as g,o as e,B as j,a7 as A,aG as se,I as q,aH as ce,$ as z,aI as H,H as ue,aJ as pe,aK as X,aL as xe,R as F,aM as me,aN as he,aO as fe,aP as je,S as Z,n as V,M as ge,A as be,t as ve,aQ as N,T as S,v as ye,az as _,Z as B,aR as Ce,aS as U,E as we,aT as Me,aU as ke,aV as ne,aW as Se,aX as Q,aY as Y,aZ as Ge,a3 as ee,a_ as Ie,_ as O,a$ as Pe,P as W,b0 as te,b1 as Ee,b2 as J,a2 as oe,b3 as De,b4 as qe,b5 as Te,y as Re,b6 as Ae,b7 as Oe,b8 as Le,b9 as $e,ba as _e,bb as $,bc as Fe,al as ae,bd as Ve}from"../../vendor-e4518210.js";import{p as x}from"../../kernel-5843a605.js";import{u as G,a as K,b as Ne}from"./hooks-37501076.js";const Be=({compositionName:t})=>{const n=x("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:p}=n.components,o=G({compositionName:t},s=>s?.selectedPart),[l,c]=g.useState({name:"",domId:""}),i=g.useCallback(()=>{o.actions.addPart(l.name,l.domId,o.state)},[l]);return e.jsx(a,{component:e.jsxs(j,{sx:{width:200},children:[e.jsx(A,{id:"part-name",label:"Nome",variant:"standard",value:l.name,onChange:s=>c(d=>({...d,name:s.target.value}))}),e.jsx(A,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:l.domId,onChange:s=>c(d=>({...d,domId:s.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(se,{position:"end",children:e.jsx(q,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(ce,{})})})}})]}),actions:[e.jsx(p,{handleConfirm:i},"confirm")],children:e.jsx(q,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:s=>{s.stopPropagation()},children:e.jsx(z,{})})})},Ue=({compositionName:t})=>{const n=G({compositionName:t},p=>p?.selectedPart),a=g.useCallback(p=>{n.state&&n.actions.removePart(n.state),p.stopPropagation()},[n]);return e.jsx(q,{"aria-label":"Delete part",id:`delete-part-${n.state}`,role:"delete-part-button",size:"small",sx:{},onClick:a,children:e.jsx(H,{})})};function We(t){return e.jsx(Z,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function ze(t){return e.jsx(Z,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function He(t){return e.jsx(Z,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Qe(t){const n=me({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(he.div,{style:n,children:e.jsx(fe,{...t})})}const Ye=ue(t=>e.jsx(pe,{...t,TransitionComponent:Qe}))(({theme:t})=>({[`& .${X.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${X.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${xe(t.palette.text.primary,.4)}`}}));function Ze({compositionName:t,graphId:n,selectedPart:a,selectPart:p,nodeId:o}){const l=x("Graph"),{useGraph:c}=l.hooks,i=c(n,s=>s&&s.adjacencyList[o]&&{node:s.nodes[o],edges:s.edges?Object.values(s.edges).reduce((d,u)=>s.adjacencyList[o].outputs.includes(u.id)?{...d,[u.id]:u}:d,{}):{},connections:s.adjacencyList[o]});return i.state?e.jsx(j,{sx:{color:"text.primary"},children:e.jsx(Ye,{nodeId:o,label:e.jsxs(j,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:s=>{o!==a&&(p(o),s.stopPropagation())},children:[i.state.node.label,o===a&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{compositionName:t}),e.jsx(Ue,{compositionName:t})]})]}),onClick:()=>{p(o)},sx:{color:o===a?"secondary.main":"secondary.secondary"},children:i.state.connections.outputs.filter(s=>i.state?.edges[s].type==="COMPOSED_OF").map(s=>i.state&&e.jsx(re,{compositionName:t,graphId:n,selectPart:p,selectedPart:a,nodeId:i.state.edges[s].targetId},`${o}-${i.state?.edges[s].targetId}`))})}):e.jsx(e.Fragment,{})}const re=F.memo(Ze);function Je(){const t=x("Store"),n=x("Layout"),a=x("Graph"),{useAppSelector:p}=t.hooks,{useGraph:o}=a.hooks,{selectActiveViewport:l}=n.store.selectors,c=p(l),i=g.useCallback(u=>({name:u?.name,svgPath:u?.svgPath,graphId:u?.graphId,selectedPart:u?.selectedPart}),[]),s=G({viewportName:c},i),d=o(c,u=>u?.adjacencyList);return!s.state?.svgPath||!s.state?.graphId||!s.state?.name||!d?null:e.jsx(je,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(We,{}),defaultExpandIcon:e.jsx(ze,{}),defaultEndIcon:e.jsx(He,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(re,{compositionName:s.state.name,nodeId:"garment",graphId:s.state.graphId,selectPart:s.actions.selectPart,selectedPart:s.state.selectedPart})})}function Ke({key:t,graphId:n,nodeId:a,quantity:p,material:o,materialType:l}){const c=x("Converter"),i=x("Graph"),s=V(),{useGraph:d}=i.hooks,u=c.hooks.useConverter(),h=d(n,w=>{const T=Object.values(w?.edges??{}).filter(E=>E.type=="CONSUMES"&&E.targetId===a).map(E=>E.sourceId),P=Object.values(w?.nodes??{}).filter(E=>E.type==="MATERIAL_USAGE"&&T.includes(E.id)).map(E=>E.id),R=Object.values(w?.edges??{}).filter(E=>E.type==="CONSUMES"&&P.includes(E.targetId));return{material:w?.nodes[a],consumptionEdges:R}}),f=g.useMemo(()=>{if(!(!h.state||!u))return h.state?.consumptionEdges.reduce((w,T)=>{const P=u.convert(T.quantity,o.stock.unit,{...o.attributes,unidades:p});return P?{...w,amount:w.amount+P.amount}:(console.warn("could not convert"),w)},{unit:o.stock.unit,amount:0})},[h.state]),{principal:C,extra:m}=l.schemas[l.latestSchema].selector,r=o.attributes[C],b=m==="cor"?o.attributes[m].label:o.attributes[m],M=o.stock.amount-(f?.amount??0);let I="error";o.stock.amount>0&&(I=M>=0?"success":"warning");const v=g.useMemo(()=>!f?.unit||!u?.state?.nodes?void 0:u.state.nodes[f.unit],[u?.state?.nodes,f?.unit]);return e.jsxs(ge,{sx:{width:"100%",display:"flex",flexGrow:1,flexDirection:"column"},children:[e.jsx(be,{expandIcon:e.jsx(ve,{}),sx:{width:"100%"},children:e.jsx(N,{sx:{padding:0,width:"100%",flexGrow:1},children:e.jsxs(j,{role:"summary",sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(j,{role:"row1",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsxs(S,{sx:{width:"33%",flexShrink:0,flexGrow:1},children:[l.label," - ",r]}),e.jsxs(j,{sx:{display:"flex",gap:.5,alignItems:"center",justifyContent:"center",maxWidth:"70%",flexGrow:1},children:[m==="cor"&&e.jsx(j,{role:"color-preview",sx:{width:"1em",height:"1em",borderRadius:"50%",border:`1px solid ${s.palette.getContrastText(s.palette.background.paper)}`,backgroundColor:o.attributes[m].hex}}),e.jsx("span",{children:b})]})]}),e.jsxs(j,{role:"row2",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsx(S,{variant:"caption",sx:{width:"33%",flexShrink:0},children:o.industry}),e.jsxs(j,{sx:{display:"flex",flexGrow:1,flexDirection:"row",gap:"3px",justifyContent:"flex-end"},children:[e.jsx(S,{variant:"caption",color:s.palette.primary.dark,sx:{width:"fit-content",flexShrink:0},children:f&&`${f.amount.toFixed(2)} ${v?.abbreviation}`}),e.jsxs(S,{variant:"caption",color:s.palette[I].main,children:["(",o.stock.amount," ",v?.abbreviation," em estoque)"]})]})]})]})})}),e.jsxs(ye,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(j,{sx:{display:"flex",gap:1},children:[e.jsxs(j,{role:"composition",sx:{display:"flex",border:`1px solid ${s.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(S,{variant:"body1",children:"Composição"}),_.isEmpty(o.composition)?e.jsx(S,{children:"Nenhuma composição disponível"}):e.jsx(j,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(o.composition).map(([w,T])=>e.jsxs(j,{children:[T*100,"% ",w]}))})]}),e.jsxs(j,{role:"caracteristics",sx:{display:"flex",border:`1px solid ${s.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(S,{variant:"body1",children:"Caracteristicas"}),_.isEmpty(o.caracteristics)?e.jsx(S,{children:"Nenhuma caracterisca disponível"}):e.jsx(j,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(o.caracteristics).map(([w,T])=>e.jsxs(j,{children:[w,": ",T]},w))})]})]}),e.jsx(j,{role:"actions",sx:{width:"100%",display:"flex",flexDirection:"row-reverse"},children:e.jsx(B,{variant:"outlined",children:e.jsx(Ce,{href:o.externalURL,target:"_blank",underline:"none",children:"Ver material"})})})]})]},t)}const Xe=()=>{const t=x("Store"),n=x("Layout"),a=x("Graph"),p=x("Materials"),{useAppSelector:o}=t.hooks,{useGraph:l}=a.hooks,{useMaterials:c,useMaterialTypes:i}=p.hooks,{selectActiveViewport:s}=n.store.selectors,d=o(s),u=G({viewportName:d},r=>r),h=g.useMemo(()=>Object.values(u.state?.budget?.grades??{}).reduce((r,b)=>r+b,0),[u]),f=l(d,r=>Object.values(r?.nodes??{}).filter(b=>b.type==="MATERIAL").filter(b=>Object.values(r?.edges??{}).find(M=>M.type==="CONSUMES"&&M.targetId===b.id))),C=c(f.state?.map(r=>r.materialId)??[]),m=i();return!f.state||!u.state||!C?e.jsx(e.Fragment,{children:"test"}):u.state.budget?e.jsx(U,{role:"material-list",children:f.state.map(r=>e.jsx(we,{fallback:e.jsx(e.Fragment,{children:"Não foi possivel calcular valor"}),children:e.jsx(Ke,{graphId:d,nodeId:r.id,quantity:h,material:C[r.materialId],materialType:m[C[r.materialId].type]})},r.id))}):e.jsx(e.Fragment,{children:"Crie um orçamento primeiro."})},et=()=>{const t=x("Layout"),{SettingsPanel:n,Accordion:a}=t.components;return e.jsxs(n,{children:[e.jsx(a,{name:"Composição",icon:e.jsx(Me,{}),summary:"composição da peça",children:e.jsx(Je,{})}),e.jsx(a,{name:"Materiais",icon:e.jsx(ke,{}),summary:"Lista de materiais necessários",children:e.jsx(Xe,{})}),e.jsx(a,{name:"Prazos",icon:e.jsx(ne,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})}),e.jsx(a,{name:"Valores",icon:e.jsx(Se,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})})]})},tt=F.memo(et),st=({graphId:t,node:n})=>{const{components:{MaterialSelector:a}}=x("Materials"),p=x("Graph"),{useGraph:o}=p.hooks,l=G({compositionName:t},s=>s),c=o(t,s=>s?.nodes[n.materialId]),i=g.useCallback(s=>l.actions.changeMaterial(n.id,s),[t,n.id]);return e.jsx(a,{type:n.materialType,value:c?.state?.materialId,onChange:i})},nt=({node:t,graphId:n})=>{const a=x("Graph"),{components:{MaterialTypeSelector:p}}=x("Materials"),{useNodeInfo:o,useGraph:l,useSearch:c}=a.hooks,i=l(n,m=>m?.nodes[t.id]),s=g.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),d=c(n,s,()=>{t&&i.actions.search("bfs",t.id,(m,r)=>m.type!=="RESTRICTION"?!1:r.adjacencyList[m.id].inputs.some(I=>{const v=r.edges[I];return v.type==="RESTRICTED_BY"&&v.attr==="materialType"}),()=>!1,(m,r)=>{const b=[...r.adjacencyList[m.id].inputs,...r.adjacencyList[m.id].outputs];return Object.values(r.edges).filter(M=>b.includes(M.id)).map(M=>M.targetId)},1,`Get all restriction associated with ${t.label}`,s)}),u=g.useMemo(()=>d?.findings.reduce((m,r)=>r.restrictionType==="allowOnly"?[...m,...r.operand]:m,[]),[d]),h=o(n,t.materialType),f=G({compositionName:n},m=>m),C=g.useCallback(m=>f.actions.changeMaterialType(t.id,m.target.value),[n,t.id]);return e.jsx(p,{filter:m=>d?.findings.length?u?.includes(m.name):!0,value:h.node?.id,onChange:C})},ot=({graphId:t,nodeId:n})=>{const a=x("Graph"),{useNodeInfo:p}=a.hooks,{node:o}=p(t,n);return e.jsx(N,{role:"material-info",children:e.jsx(Q,{disableTypography:!0,primary:e.jsxs(j,{sx:{marginBottom:1},children:[e.jsx(S,{children:o.label}),e.jsx(Y,{})]}),secondary:e.jsx(S,{component:"div",children:e.jsx(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(j,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:o.editableAttributes.map(l=>{switch(l){case"materialType":return e.jsx(nt,{graphId:t,node:o},l);case"materialId":return e.jsx(st,{graphId:t,node:o},l);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},at=({labelState:[t,n],materialTypes:a,handleMaterialTypeChange:p})=>{const{components:{MaterialTypeSelector:o}}=x("Materials");return e.jsxs(j,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(o,{value:a,onChange:p,multiple:!0}),e.jsx(A,{id:"material-usage-name",label:"Nome",variant:"standard",value:t,onChange:l=>n(l.target.value)})]})},rt=({compositionName:t})=>{const n=x("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:p}=n.components,o=G({compositionName:t},h=>h?.selectedPart),[l,c]=g.useState(""),[i,s]=g.useState([]),d=g.useCallback(()=>{o.state&&o.actions.addMaterialUsage(l,o.state,i)},[l]),u=g.useCallback(h=>s(f=>h.target.value),[t]);return e.jsx(a,{component:e.jsx(at,{materialTypes:i,handleMaterialTypeChange:u,labelState:[l,c]}),actions:[e.jsx(p,{color:"success",handleConfirm:d},"accept")],children:e.jsx(B,{startIcon:e.jsx(z,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},it=({compositionName:t,materialUsageId:n})=>{const a=G({compositionName:t},o=>o),p=g.useCallback(()=>{a.actions.removeMaterialUsage(n)},[a]);return e.jsx(q,{color:"error",id:"delete-material",onClick:p,sx:{flexGrow:2},children:e.jsx(H,{})},"delete")},lt=({compositionState:t,materialUsageId:n})=>{const a=x("Graph"),p=x("Layout"),o=x("SVG"),l=V(),{useNodeInfo:c}=a.hooks,{useSVGEditorToolkit:i}=o.hooks,{CRUDGridContext:s}=p.contexts,{CRUDGrid:d,CRUDBooleanCell:u,CRUDTextFieldCell:h}=p.components,{node:f}=c(t.graphId,n),C=g.useMemo(()=>f.proxies.reduce((v,w)=>({...v,[w.elem]:{...v[w.elem],[w.attr]:!0}}),{}),[f]),{setRows:m}=g.useContext(s),{state:{tools:r},pickElement:b,cancelPickElement:M}=i(),I=g.useCallback(v=>{if(r.pickElement.enabled){M();return}b("SVGElement",w=>[...w.querySelectorAll("path,circle,rect").values()],v)},[r.pickElement.enabled,b,M]);return g.useEffect(()=>m(Object.entries(C).map(([v,w])=>({...w,elem:v,state:"untouched",id:_.uniqueId("proxy-")}))),[C]),e.jsxs(j,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(S,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(S,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(d,{addLabel:"Adicionar vínculo",newRecord:()=>({id:_.uniqueId("proxy-"),stroke:!1,fill:!1}),onSave:M,onCancel:M,columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento",renderEditCell:v=>e.jsx(h,{...v,InputProps:{endAdornment:e.jsx(se,{position:"end",sx:{cursor:"pointer",color:r.pickElement.enabled&&r.pickElement.type==="SVGElement"?l.palette.secondary.main:void 0},onClick:()=>I(w=>{v.api.setEditCellValue({id:v.id,field:v.field,value:w.id})}),children:e.jsx(Ge,{})})},variant:"outlined"})},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:v})=>e.jsx(ee,{checked:v,disabled:!0}),renderEditCell:v=>e.jsx(u,{...v})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:v})=>e.jsx(ee,{checked:v,disabled:!0}),renderEditCell:v=>e.jsx(u,{...v})}]})]})},dt=F.memo(lt),ct=({composition:t,materialUsageId:n,onConfirm:a,...p})=>{const o=x("Pointer"),l=x("Layout"),{ConfirmAndCloseButton:c}=o.components,{CRUDGridContext:i}=l.contexts,{rows:s}=g.useContext(i),d=g.useCallback(()=>{s.filter(u=>u.state==="deleted").forEach(u=>t.actions.deleteProxy(u.elem,n)),s.filter(u=>u.state==="modified").forEach(u=>{t.actions.deleteProxy(u.old.elem,n),u.stroke&&t.actions.addProxy({elem:u.elem,attr:"stroke"},n),u.fill&&t.actions.addProxy({elem:u.elem,attr:"fill"},n)}),s.filter(u=>u.state==="added").forEach(u=>{t.actions.deleteProxy(u.elem,n),u.stroke&&t.actions.addProxy({elem:u.elem,attr:"stroke"},n),u.fill&&t.actions.addProxy({elem:u.elem,attr:"fill"},n)}),a?.()},[s]);return e.jsx(c,{color:"success",...p,handleConfirm:d})},ut=({compositionName:t,materialUsageId:n})=>{const a=G({compositionName:t},u=>u),p=x("Pointer"),o=x("Layout"),l=x("SVG"),{PointerContainer:c}=p.components,{CRUDGridProvider:i}=o.components,{useSVGEditorToolkit:s}=l.hooks,{cancelPickElement:d}=s();return a.state?e.jsx(i,{initialRows:[],children:e.jsx(c,{component:e.jsx(dt,{compositionState:a.state,materialUsageId:n}),onClose:d,actions:[e.jsx(ct,{onConfirm:d,composition:a,materialUsageId:n},"accept")],children:e.jsx(q,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(Ie,{})},"configure")})}):e.jsx(e.Fragment,{})};function pt({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function xt({row:t,...n}){const{components:{CRUDMaterialTypeCell:a}}=x("Materials");switch(t.attribute){case"materialType":return e.jsx(a,{row:t,value:t.operand,...n,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const mt=({compositionState:t,materialUsageId:n})=>{const a=x("Graph"),p=x("Layout"),{useGraph:o,useSearch:l}=a.hooks,{CRUDGridContext:c}=p.contexts,{CRUDGrid:i}=p.components,{state:s,actions:{search:d}}=o(t.graphId,m=>m?.nodes[n]),u=g.useMemo(()=>`${n}/restrictions`,[n]),h=l(t.graphId,u,()=>{s&&d("bfs",s.id,(m,r)=>m.type!=="RESTRICTION"?!1:r.adjacencyList[m.id].inputs.some(I=>r.edges[I].type==="RESTRICTED_BY"),()=>!1,(m,r)=>{const b=[...r.adjacencyList[m.id].inputs,...r.adjacencyList[m.id].outputs];return Object.values(r.edges).filter(M=>b.includes(M.id)).map(M=>M.targetId)},1,`Get all restriction associated with ${s?.label??s.id}`,u)}),{setRows:f}=g.useContext(c);g.useEffect(()=>{h?.findings&&f(h.findings.map(m=>({...m,state:"untouched"})))},[h]),g.useEffect(()=>{h?.findings&&f(h.findings)},[]);const C=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:m})=>e.jsx(e.Fragment,{children:m})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:m})=>e.jsx(pt,{node:m}),renderEditCell:m=>e.jsx(xt,{...m})}];return e.jsxs(j,{role:"restrictions-management-container",children:[e.jsx(S,{variant:"h4",children:"Restrições do material"}),e.jsxs(S,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(i,{addLabel:"Adicionar restrição",newRecord:()=>({id:O.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:C})]})},ht=t=>e.jsx(j,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(mt,{...t})}),ft=({composition:t,materialUsageId:n,...a})=>{const p=x("Pointer"),o=x("Layout"),{ConfirmAndCloseButton:l}=p.components,{CRUDGridContext:c}=o.contexts,{rows:i}=g.useContext(c),s=g.useCallback(()=>{console.group("delete"),i.filter(d=>d.state==="deleted").forEach(d=>t.actions.removeRestriction(n,d.id)),console.groupEnd(),console.group("modified"),i.filter(d=>d.state==="modified").forEach(d=>{t.actions.updateRestriction(n,d.id,d)}),console.groupEnd(),console.group("added"),i.filter(d=>d.state==="added").forEach(d=>{t.actions.addRestriction(n,{type:"RESTRICTION",id:d.id,label:d.label,operand:d.operand,position:d.position,restrictionType:d.restrictionType,attribute:d.attribute})}),console.groupEnd()},[i]);return e.jsx(l,{color:"success",...a,handleConfirm:s})},jt=({sx:t,materialUsageId:n,compositionName:a,...p})=>{const o=G({compositionName:a},d=>d),l=x("Pointer"),c=x("Layout"),{PointerContainer:i}=l.components,{CRUDGridProvider:s}=c.components;return o.state?e.jsx(s,{initialRows:[],children:e.jsx(i,{component:e.jsx(ht,{compositionState:o.state,materialUsageId:n}),actions:[e.jsx(ft,{composition:o,materialUsageId:n},"accept")],children:e.jsx(q,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(Pe,{})},"restrict")})}):e.jsx(e.Fragment,{})},gt=t=>e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(it,{...t}),e.jsx(ut,{...t}),e.jsx(jt,{...t,sx:{hover:{fill:"yellow"}}})]});function ie({compositionName:t,selectedPart:n,graphId:a}){const p=x("Graph"),{useNodeInfo:o}=p.hooks,{edges:l}=o(a,n);return e.jsxs(U,{sx:{width:"100%"},role:"material-list",children:[e.jsx(rt,{compositionName:t}),Object.values(l).filter(c=>c.type==="MADE_OF").map(c=>e.jsxs(W,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(ot,{graphId:a,nodeId:c.targetId}),e.jsx(gt,{compositionName:t,materialUsageId:c.targetId})]},c.targetId))]})}const bt=({graphId:t,nodeId:n})=>{const a=x("Graph"),p=x("Converter"),o=x("Layout"),l=x("Store"),c=x("Materials"),{CompoundSelector:i}=p.components,{useAppSelector:s}=l.hooks,{useNodeInfo:d,useGraph:u}=a.hooks,{useUnits:h,useConverter:f}=p.hooks,{useMaterials:C}=c.hooks,m=V(),{node:r}=d(t,n),{selectActiveViewport:b}=o.store.selectors,M=s(b),I=f(),{state:v,actions:{updateOperation:w}}=G({viewportName:M},y=>y?.budget),{state:T}=u(t,y=>y?.edges&&{nodes:Object.values(y.nodes).filter(k=>Object.values(y.edges).filter(D=>D.type==="CONSUMES"&&D.sourceId===n).map(D=>D.targetId).includes(k.id)).reduce((k,D)=>({...k,[D.id]:D}),{}),edges:Object.values(y.edges).filter(k=>k.type==="CONSUMES"&&k.sourceId===n).map(k=>({...k,total:I?.convert(k.quantity,k.quantity.quotient.unit,{unidades:Object.values(v?.grades??{}).reduce((D,L)=>D+L,0),pedidos:1})}))}),P=h([r.cost.dividend.unit,r.cost.quotient.unit,r.time_taken.dividend.unit,r.time_taken.quotient.unit,...(T?.edges??[]).reduce((y,k)=>[...y,k.quantity.quotient.unit,k.quantity.dividend.unit],[])]),R=g.useMemo(()=>{if(!P)return 0;const y=I?.convert(r.time_taken,r.time_taken.quotient.unit,{unidades:Object.values(v?.grades??{}).reduce((D,L)=>D+L,0),pedidos:1}),k=P[r.cost.dividend.unit].abbreviation==="h"?I?.convert(y,r.cost.dividend.unit,{unidades:Object.values(v?.grades??{}).reduce((D,L)=>D+L,0),[P[y.unit].abbreviation]:y.amount,pedidos:1}):void 0;return{timeRequired:y,costDividendUnit:k}},[r.time_taken,r.cost,v]),E=g.useMemo(()=>{if(!P||!R)return 0;const y={unidades:Object.values(v?.grades??{}).reduce((k,D)=>k+D,0),[P[R.costDividendUnit.unit].abbreviation]:R.costDividendUnit.amount,pedidos:1};return I?.convert(r.cost,r.cost.quotient.unit,y)},[r.cost,P,R,v]),de=C(Object.values(T?.nodes??{}).map(y=>+y.materialId.split("-")[1]));return P?e.jsx(N,{children:e.jsx(Q,{disableTypography:!0,primary:e.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2},children:[e.jsx(j,{sx:{flexGrow:1},children:e.jsx(S,{children:e.jsx(A,{id:"name",label:"Nome",variant:"standard",sx:{width:"100%"},onChange:y=>w?.(r.id,{label:y.target.value}),value:r.label})})}),e.jsxs(j,{sx:{display:"flex",justifyContent:"end",gap:2},children:[e.jsx(j,{sx:{display:"flex",flexDirection:"column",maxWidth:"100px",gap:.3,flexWrap:"wrap",alignItems:"center"},children:v&&R&&e.jsxs(j,{sx:{color:m.palette.primary.main},children:[R.timeRequired.amount.toFixed(2)," ",P[R.timeRequired.unit].abbreviation]})}),e.jsx(j,{sx:{display:"flex",flexDirection:"column",maxWidth:"100px",gap:.3,flexWrap:"wrap",alignItems:"center"},children:v&&E&&e.jsxs(j,{sx:{color:m.palette.primary.main},children:[E.amount.toFixed(2)," ",P[E.unit].abbreviation]})})]})]}),secondary:e.jsxs(S,{component:"div",sx:{padding:1,display:"flex",gap:1,flexDirection:"column"},children:[e.jsx(Y,{}),e.jsx(S,{variant:"h6",color:m.palette.primary.main,children:"Info"}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ne,{})," ",e.jsx(i,{id:"time-taken",label:"Tempo",filterDividends:y=>y.abbreviation==="un",filterQuotients:(y,k)=>k?.name==="Temporal",value:r.time_taken,onChange:y=>w?.(r.id,{time_taken:y})}),e.jsx(te,{})]}),e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ee,{})," ",e.jsx(i,{id:"cost",label:"Custo",filterDividends:(y,k)=>y.abbreviation==="un"||k?.name=="Temporal",filterQuotients:(y,k)=>k?.name==="Monetaria",value:r.cost,onChange:y=>w?.(r.id,{cost:y})}),e.jsx(te,{sx:{color:m.palette.secondary.main}})]}),e.jsx(Y,{}),e.jsx(S,{variant:"h6",color:m.palette.primary.main,children:"Materials"}),e.jsx(j,{children:T?.edges.map(y=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{children:[de[+T.nodes[y.targetId].materialId.split("-")[1]].attributes.nome," "]}),e.jsxs(j,{sx:{display:"flex",gap:1},children:[e.jsxs(j,{children:[y.quantity.quotient.amount," ",P[y.quantity.quotient.unit].abbreviation," /"," ",y.quantity.dividend.amount," ",P[y.quantity.dividend.unit].abbreviation]}),v&&y.total!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"="}),e.jsxs(j,{color:m.palette.primary.main,children:[y.total.amount.toFixed(2)," ",P[y.total.unit].abbreviation]})]})]})]},y.id))})]})})}):e.jsx(e.Fragment,{})},vt=({compositionName:t})=>{const n=x("Pointer"),a=x("Converter"),{PointerContainer:p,ConfirmAndCloseButton:o}=n.components,{CompoundSelector:l}=a.components,c=G({compositionName:t},h=>h?.selectedPart),i=g.useMemo(()=>O.uniqueId("new-process-form"),[]),[s,d]=g.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),u=g.useCallback(()=>{c.state&&c.actions.addOperation(s.label,s.cost,s.time_taken,c.state)},[s,c]);return e.jsx(p,{component:e.jsxs(j,{component:"form",id:i,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(J,{children:e.jsx(A,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:h=>d(f=>({...f,label:h.target.value})),value:s.label})}),e.jsx(l,{id:"time-taken",label:"Tempo",filterDividends:h=>h.abbreviation==="un",filterQuotients:(h,f)=>f?.name==="Temporal",value:s.time_taken,onChange:h=>d(f=>({...f,time_taken:h}))}),e.jsx(l,{id:"cost",label:"Custo",filterDividends:(h,f)=>h.abbreviation==="un"||f?.name=="Temporal",filterQuotients:(h,f)=>f?.name==="Monetaria",value:s.cost,onChange:h=>d(f=>({...f,cost:h}))})]}),actions:[e.jsx(o,{type:"submit",form:i,value:"Submit",color:"success",handleConfirm:u},"accept")],children:e.jsx(B,{startIcon:e.jsx(z,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},yt=({compositionName:t,processId:n})=>{const a=G({compositionName:t},o=>o),p=g.useCallback(()=>{a.actions.removeOperation(n)},[a]);return e.jsx(q,{color:"error",id:`delete-process-${n}`,onClick:p,sx:{flexGrow:2},children:e.jsx(H,{})},"delete")},Ct=({id:t,field:n,graphId:a,partId:p,value:o})=>{const l=x("Graph"),{useGraph:c}=l.hooks,i=oe(),s=f=>Object.values(f).filter(C=>C.type==="MADE_OF"&&C.sourceId===p),d=(f,C)=>Object.entries(f).reduce((m,[r,b])=>C.includes(r)?{...m,[r]:b}:m,{}),{state:u}=c(a,f=>f&&{edges:s(f.edges),nodes:d(f.nodes,s(f.edges).map(C=>C.targetId))}),h=g.useCallback(f=>{i.current.setEditCellValue({id:t,field:n,value:f.target.value})},[a,p]);return u?e.jsxs(J,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(De,{id:"label",children:"Material"}),e.jsx(qe,{labelId:"label",id:"material-type",value:o??"",label:"Material",autoWidth:!0,onChange:h,children:u.edges.map(f=>e.jsx(Te,{value:f.targetId,children:u.nodes[f.targetId].label},f.id))})]}):e.jsx(e.Fragment,{})};function wt({row:t,id:n,field:a}){const p=oe(),o=x("Converter"),{components:{CompoundSelector:l}}=o,c=g.useCallback(i=>{p.current.setEditCellValue({id:n,field:a,value:i})},[n]);return e.jsx(l,{id:"quantity",filterQuotients:(i,s)=>s?.name==="Comprimento"||s?.name==="Volume"||s?.name==="Area",filterDividends:(i,s)=>i.abbreviation==="un"||i.abbreviation==="pedido",value:t.quantity,onChange:c})}const Mt=({compositionState:t,processId:n})=>{const a=x("Graph"),p=x("Layout"),o=x("Converter"),{useGraph:l}=a.hooks,{CRUDGridContext:c}=p.contexts,{CRUDGrid:i}=p.components,{components:{CompoundUnit:s}}=o,d=r=>Object.values(r).filter(b=>b.type==="MADE_OF"&&b.sourceId===t.selectedPart),u=(r,b)=>Object.entries(r).reduce((M,[I,v])=>b.includes(I)?{...M,[I]:v}:M,{}),{state:h}=l(t.graphId,r=>r&&{edges:d(r.edges),nodes:u(r.nodes,d(r.edges).map(b=>b.targetId))}),{state:f}=l(t.graphId,r=>r?.edges&&Object.values(r.edges).filter(b=>b.type==="CONSUMES"&&b.sourceId===n)),{setRows:C}=g.useContext(c);if(g.useEffect(()=>{f?.length&&C(f.map(r=>({...r,state:"untouched"})))},f),!h)return e.jsx(e.Fragment,{});const m=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:r},value:b})=>e.jsx(e.Fragment,{children:h.nodes[r]?.label}),renderEditCell:({value:r,...b})=>e.jsx(Ct,{value:r??b.row.targetId,partId:t.selectedPart,graphId:t.graphId,...b}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:r}})=>e.jsx(s,{value:r}),renderEditCell:r=>e.jsx(wt,{...r})}];return e.jsxs(j,{role:"material-usage-management-container",children:[e.jsx(S,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(S,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(i,{addLabel:"Víncular material",newRecord:()=>({id:O.uniqueId("material-usage-"),type:"CONSUMES",sourceId:n,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:m})]})},kt=t=>e.jsx(j,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(Mt,{...t})}),St=({composition:t,processId:n,...a})=>{const p=x("Pointer"),o=x("Layout"),{ConfirmAndCloseButton:l}=p.components,{CRUDGridContext:c}=o.contexts,{rows:i}=g.useContext(c),s=g.useCallback(()=>{i.filter(d=>d.state==="deleted").forEach(d=>{t.actions.deleteMaterialConsuption(d.id)}),i.filter(d=>d.state==="modified").forEach(({id:d,targetId:u,quantity:h})=>{t.actions.updateMaterialConsuption(d,{targetId:u,quantity:h})}),i.filter(d=>d.state==="added").forEach(d=>{t.actions.addMaterialConsuption(n,d.targetId,d.quantity)})},[i]);return e.jsx(l,{color:"success",...a,handleConfirm:s})},Gt=({sx:t,compositionName:n,processId:a,...p})=>{const o=G({compositionName:n},d=>d),l=x("Pointer"),c=x("Layout"),{PointerContainer:i}=l.components,{CRUDGridProvider:s}=c.components;return o.state?e.jsx(s,{initialRows:[],children:e.jsx(i,{component:e.jsx(kt,{processId:a,compositionState:o.state}),actions:[e.jsx(St,{composition:o,processId:a},"accept")],children:e.jsx(q,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(Re,{})},"configure")})}):e.jsx(e.Fragment,{})},It=t=>e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(yt,{...t}),e.jsx(Gt,{...t})]});function le({compositionName:t,selectedPart:n,graphId:a}){const p=x("Graph"),{useNodeInfo:o}=p.hooks,{edges:l}=o(a,n);return e.jsxs(U,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(vt,{compositionName:t}),Object.values(l).filter(c=>c.type==="PROCESS_NEEDED").map(c=>e.jsxs(W,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(bt,{graphId:a,nodeId:c.targetId}),e.jsx(It,{compositionName:t,processId:c.targetId})]},c.targetId))]})}const Pt=({compositionName:t,graphId:n})=>{const a=x("Pointer"),p=x("Graph"),{PointerContainer:o,ConfirmAndCloseButton:l}=a.components,{useGraph:c}=p.hooks,i=G({compositionName:t},m=>m?.selectedPart),s=c(n,m=>m?Object.values(m.nodes).filter(r=>r.type==="GRADE").map(r=>({...r,order:Object.values(m.edges).find(b=>b.targetId===r.id)?.order})):[]),d=g.useMemo(()=>s.state?_.max(s.state.filter(m=>O.isNumber(m?.order)).map(m=>m.order))??0:0,[s]),u=g.useMemo(()=>O.uniqueId("new-process-form"),[]),[h,f]=g.useState({abbreviation:""}),C=g.useCallback(()=>{i.state&&i.actions.addGrade(h.abbreviation,d+1)},[h.label,h.abbreviation,d,i.state]);return e.jsx(o,{component:e.jsx(j,{component:"form",id:u,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:e.jsx(J,{children:e.jsx(A,{id:"abbreviation",label:"Abreviação",variant:"standard",sx:{marginBottom:1},onChange:m=>f(r=>({...r,abbreviation:m.target.value})),value:h.abbreviation})})}),actions:[e.jsx(l,{type:"submit",form:u,value:"Submit",color:"success",handleConfirm:C},"accept")],children:e.jsx(B,{startIcon:e.jsx(z,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar Grade"})})};function Et({compositionName:t,graphId:n}){const a=x("Graph"),{useGraph:p}=a.hooks,o=p(n,i=>i?Object.values(i.nodes).filter(s=>s.type==="GRADE").map(s=>({...s,order:Object.values(i.edges).find(d=>d.targetId===s.id)?.order})).filter(s=>O.isNumber(s?.order)).sort((s,d)=>s?.order-d?.order):[]),l=G({compositionName:t},i=>i?.selectedPart),c=g.useCallback(i=>{l.actions.removeGrade(i)},[t]);return o.state?e.jsxs(U,{sx:{width:"100%"},role:"material-list",children:[e.jsx(Pt,{graphId:n,compositionName:t}),o.state.map(i=>e.jsxs(W,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"grade-container",children:[e.jsx(N,{role:"grade-info",children:e.jsx(Q,{disableTypography:!0,primary:e.jsx(S,{children:i.abbreviation})})}),e.jsx(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:e.jsx(q,{color:"error",id:"delete-material",onClick:()=>c(i.id),sx:{flexGrow:2},children:e.jsx(H,{})},"delete")})]},i.id))]}):e.jsx(e.Fragment,{})}const Dt=t=>{const n=x("Layout"),{Accordion:a}=n.components;return e.jsx(a,{name:"Graduação",icon:e.jsx(Ae,{}),summary:"Graduação da peça",sx:{flexGrow:1},children:e.jsx(Et,{...t})})},qt=({node:t,graphId:n,selectedPart:a,compositionName:p})=>{const o=x("Layout"),l=x("Markdown"),{components:{MarkdownReader:c}}=l,{DetailsPanel:i,Accordion:s,CustomTextArea:d,SystemModal:u}=o.components,[h,f]=g.useState({name:t.label??"Nova peça",description:t.description??""}),C=G({compositionName:p},r=>r),m=g.useCallback(()=>{C.actions.changeProperties(h.name,h.description)},[p,h.name,h.description]);return e.jsxs(i,{title:t.label,id:"gamerment-panel",children:[e.jsx(s,{name:"Propriedades",icon:e.jsx(Oe,{}),summary:"Propriedades da peça",sx:{flexGrow:1},children:e.jsxs(W,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"garment-properties",id:"garment-properties",children:[e.jsxs(j,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:1},children:[e.jsx(A,{id:"garment-name",label:"Nome",variant:"standard",sx:{width:"100%"},value:h?.name,onChange:r=>f(b=>b&&{...b,name:r.target.value})}),e.jsx(d,{id:"description",wrapperProps:{sx:{width:"100%"}},minRows:3,name:"Outlined",placeholder:"Descrição",color:"neutral",value:h.description,onChange:r=>{r.preventDefault(),r.stopPropagation(),f(b=>b&&{...b,description:r.target.value})}})]}),e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(q,{color:"success",id:"save-properties",onClick:r=>m(),children:e.jsx(Le,{})},"save"),e.jsx(u,{component:e.jsx(c,{content:h.description}),button:e.jsx(q,{color:"warning",id:"preview-description",children:e.jsx($e,{})},"preview")}),e.jsx(q,{color:"info",id:"reset-properties",onClick:r=>f({name:t.label,description:t.description}),children:e.jsx(_e,{})},"reset")]})]},"garment-properties")}),e.jsx(Dt,{graphId:n,compositionName:p,selectedPart:a}),e.jsx(s,{name:"Materiais",icon:e.jsx($,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(ie,{graphId:n,selectedPart:a,compositionName:p})}),e.jsx(s,{name:"Processos",icon:e.jsx($,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(le,{graphId:n,selectedPart:a,compositionName:p})})]},"garment-panel")},Tt=()=>{const t=x("Layout"),n=x("Store"),{useAppSelector:a}=n.hooks,{selectActiveViewport:p}=t.store.selectors,o=a(p),l=g.useCallback(i=>({name:i?.name,graphId:i?.graphId,selectedPart:i?.selectedPart}),[]),c=G({viewportName:o},l);return!c.state?.selectedPart||!c.state?.graphId||!c.state?.name?null:e.jsx(Rt,{graphId:c.state.graphId,selectedPart:c.state.selectedPart,compositionName:c.state.name})},Rt=({graphId:t,selectedPart:n,compositionName:a})=>{const p=x("Layout"),o=x("Graph"),{DetailsPanel:l,Accordion:c}=p.components,{useGraph:i}=o.hooks,s=i(t,d=>d?.nodes[n]);return s.state?.type==="GARMENT"?e.jsx(qt,{node:s.state,graphId:t,compositionName:a,selectedPart:n}):e.jsxs(l,{title:s.state?.label??n,children:[e.jsx(c,{name:"Opcionais",icon:e.jsx($,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(c,{name:"Materiais",icon:e.jsx($,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(ie,{graphId:t,selectedPart:n,compositionName:a})}),e.jsx(c,{name:"Processos",icon:e.jsx($,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(le,{graphId:t,selectedPart:n,compositionName:a})})]})},At=F.memo(Tt);function Ot({compositionName:t,graphId:n}){const a=V(),p=x("Graph"),{useGraph:o}=p.hooks,l=G({compositionName:t},u=>u?.budget?.grades),c=o(n,u=>Object.values(u?.nodes??{}).filter(h=>h.type==="GRADE").reduce((h,f)=>(h[f.id]=f,h),{})),i=g.useMemo(()=>!l.state||!c?.state?[]:Object.entries(l.state).map(([u,h])=>c?.state?{id:u,counter:h,abbreviation:c.state[u].abbreviation}:{id:u,counter:h,abbreviation:u}),[l.state,c.state]),s=g.useMemo(()=>i.reduce((u,h)=>u+h.counter,0),[i]),d=g.useCallback((u,h)=>{l.actions.changeGradeCounter(u,h)},[t]);return!l.state||!c.state?e.jsx(e.Fragment,{}):e.jsxs(j,{sx:{width:"min-content",display:"flex",flexFlow:"column",backgroundColor:a.palette.background.paper,opacity:"0.9",borderRadius:2,pointerEvents:"all",border:`1px solid ${a.palette.getContrastText(a.palette.background.paper)}`},role:"grades-counter",children:[i.map(u=>e.jsx(j,{sx:{padding:1},children:e.jsx(A,{id:u.id,label:u.abbreviation,variant:"standard",value:u.counter,sx:{width:"40px"},type:"number",onChange:h=>d(u.id,+h.target.value)})},u.id)),e.jsx(j,{sx:{padding:1},children:e.jsx(A,{id:"total",label:"Total",variant:"standard",value:s,sx:{width:"40px"},disabled:!0})},"total")]})}const zt=()=>{const t=x("Store"),n=x("Layout"),a=x("SVG"),{useAppSelector:p}=t.hooks,{components:{SVGEditorToolkit:o}}=a,{selectActiveViewport:l}=n.store.selectors,c=p(l),i=g.useCallback(d=>d,[c]),s=G({viewportName:c},i);return!c||!s.state?null:e.jsx(o,{children:e.jsx(Lt,{selectPart:s.actions.selectPart,compositionInfo:s.state})})},Lt=({compositionInfo:t,selectPart:n})=>{const{graphId:a,svgPath:p,name:o,viewportName:l,budget:c}=t,{hooks:{useSVGEditor:i}}=x("SVG"),{hooks:{useGraph:s}}=x("Graph"),d=x("Layout"),u=x("Orders"),{BudgetFloatingButton:h}=u.components,{ViewportNotificationsTray:f}=d.components;V();const C=K(),m=s(a,v=>v?.nodes),r=g.useCallback(v=>(m.state,v),[a,m]),b=i({svgPath:p,instanceName:o,beforeInjection:r}),M=g.useMemo(()=>c?["convert-to-order","delete-budget"]:["create-budget","add-to-budget"],[c]),I=g.useCallback(()=>{C.functions.createDebugView(o,l)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx("div",{ref:b.wrapperRef,role:"svg-editor",style:{height:"100%",width:"100%"},children:e.jsx("svg",{ref:b.svgRef,id:"svg-editor",width:"100%",height:"100%"})}),e.jsx(f,{children:e.jsx(Fe,{fontSize:"small",onClick:I,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(tt,{}),e.jsx(At,{})]}),e.jsxs(j,{sx:{position:"absolute",display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",gap:1,padding:1,alignItems:"end",bottom:10,width:"100%",pointerEvents:"none"},children:[e.jsx(h,{allowedActions:M}),c&&e.jsx(Ot,{compositionName:o,graphId:a})]})]})},$t=({instanceName:t,path:n})=>{const a=x("SVG"),{hooks:{useSVGManager:p}}=a,o=p();return g.useLayoutEffect(()=>{o.functions.loadSVG(n,`${t}-preview`)},[]),e.jsx(j,{children:"Preview here"})},_t=ae(j)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Ft=ae(U)`

  overflow: auto;
  display:block;
  width: min-content;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;

  @media (orientation: portrait) {
    height: 200px;
    flex-wrap: wrap;
    width: 100%;
    gap: 0px 16px;
  }
`,Vt=({closeModal:t,onModelSelection:n})=>{const a=x("Markdown"),{components:{MarkdownReader:p}}=a,o=Ne(),[l,c]=g.useState(void 0);return e.jsx(W,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",minHeight:"50vh",p:2},children:e.jsxs(_t,{role:"model-selector-container",sx:{gap:1,display:"flex"},children:[e.jsx(Ft,{role:"list-options",sx:{gap:1,width:"30%"},children:o.map(i=>e.jsx(N,{disableGutters:!0,sx:{width:"fit-content"},children:e.jsx(Q,{primary:e.jsx(j,{sx:{},children:i.name}),secondary:null,id:i.name,color:l?.name===i.name?"primary":"secondary",onClick:()=>c({name:i.name,path:i.svgPath,descriptionPath:i.descriptionPath}),sx:{cursor:"pointer"}})},O.uniqueId()))}),e.jsxs(j,{sx:{overflow:"auto",width:"100%"},children:[l?e.jsx($t,{instanceName:l.name,path:l.path,sx:{gridArea:"preview",p:1}}):e.jsx(j,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),l?.descriptionPath&&e.jsx(j,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(p,{path:l.descriptionPath})})]}),e.jsx(j,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(B,{disabled:!l,variant:"contained",onClick:()=>{l&&(n(l.name,l.path),t?.())},children:"Selecionar"})})]})})},Ht=()=>{const t=K(),n=x("Layout"),{SystemModal:a}=n.components,p=g.useCallback((o,l)=>{t.functions.createComposition(o,l)},[]);return e.jsx(a,{component:e.jsx(Vt,{onModelSelection:p}),button:e.jsx(q,{children:e.jsx(Ve,{})})})},Nt=({name:t})=>{const n=x("Graph"),a=x("Layout"),{ViewportNotificationsTray:p,DetailsPanel:o,SettingsPanel:l,Accordion:c}=a.components,{components:{GraphViewer:i}}=n,s=K(),d=g.useMemo(()=>s.functions.findComposition(u=>u.debugViewport===t),[t]);return e.jsxs(j,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[d&&e.jsx(i,{graphId:d?.graphId}),e.jsx(p,{children:e.jsx(e.Fragment,{})}),e.jsxs(l,{title:"Configurações",children:[e.jsx(c,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(o,{children:e.jsx(e.Fragment,{})})]})},Qt=F.memo(Nt);export{zt as C,Qt as D,Ht as M};
