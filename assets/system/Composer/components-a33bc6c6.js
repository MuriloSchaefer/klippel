import{r as g,o as e,B as j,a7 as A,aH as K,I as q,aI as ie,$ as V,aJ as B,H as le,aK as ce,aL as Z,aM as de,R as O,aN as ue,aO as pe,aP as xe,aQ as me,S as H,n as U,M as he,A as fe,t as je,aR as $,T as G,v as ge,aA as z,Z as F,aS as be,aT as _,E as ye,aU as ve,aV as Ce,aW as X,aX as we,aY as W,aZ as ee,_ as D,a_ as Me,a3 as J,a$ as ke,b0 as Se,P as N,b1 as Ge,b2 as Q,a2 as te,b3 as Ie,b4 as Pe,b5 as Ee,y as qe,b6 as Te,b7 as De,b8 as Ae,b9 as Re,ba as Le,bb as L,bc as Oe,al as se,bd as $e}from"../../vendor-14321f5b.js";import{n as h}from"../../kernel-8e19b622.js";import{u as S,a as Y,b as Fe}from"./hooks-b73e4772.js";const _e=({compositionName:t})=>{const s=h("Pointer"),{PointerContainer:r,ConfirmAndCloseButton:u}=s.components,n=S({compositionName:t},o=>o?.selectedPart),[l,d]=g.useState({name:"",domId:""}),i=g.useCallback(()=>{n.actions.addPart(l.name,l.domId,n.state)},[l]);return e.jsx(r,{component:e.jsxs(j,{sx:{width:200},children:[e.jsx(A,{id:"part-name",label:"Nome",variant:"standard",value:l.name,onChange:o=>d(a=>({...a,name:o.target.value}))}),e.jsx(A,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:l.domId,onChange:o=>d(a=>({...a,domId:o.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(K,{position:"end",children:e.jsx(q,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(ie,{})})})}})]}),actions:[e.jsx(u,{handleConfirm:i},"confirm")],children:e.jsx(q,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:o=>{o.stopPropagation()},children:e.jsx(V,{})})})},Ne=({compositionName:t})=>{const s=S({compositionName:t},u=>u?.selectedPart),r=g.useCallback(u=>{s.state&&s.actions.removePart(s.state),u.stopPropagation()},[s]);return e.jsx(q,{"aria-label":"Delete part",id:`delete-part-${s.state}`,role:"delete-part-button",size:"small",sx:{},onClick:r,children:e.jsx(B,{})})};function Ve(t){return e.jsx(H,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function Be(t){return e.jsx(H,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function Ue(t){return e.jsx(H,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function We(t){const s=ue({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(pe.div,{style:s,children:e.jsx(xe,{...t})})}const ze=le(t=>e.jsx(ce,{...t,TransitionComponent:We}))(({theme:t})=>({[`& .${Z.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${Z.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${de(t.palette.text.primary,.4)}`}}));function He({compositionName:t,graphId:s,selectedPart:r,selectPart:u,nodeId:n}){const l=h("Graph"),{useGraph:d}=l.hooks,i=d(s,o=>o&&o.adjacencyList[n]&&{node:o.nodes[n],edges:o.edges?Object.values(o.edges).reduce((a,m)=>o.adjacencyList[n].outputs.includes(m.id)?{...a,[m.id]:m}:a,{}):{},connections:o.adjacencyList[n]});return i.state?e.jsx(j,{sx:{color:"text.primary"},children:e.jsx(ze,{nodeId:n,label:e.jsxs(j,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:o=>{n!==r&&(u(n),o.stopPropagation())},children:[i.state.node.label,n===r&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{compositionName:t}),e.jsx(Ne,{compositionName:t})]})]}),onClick:()=>{u(n)},sx:{color:n===r?"secondary.main":"secondary.secondary"},children:i.state.connections.outputs.filter(o=>i.state?.edges[o].type==="COMPOSED_OF").map(o=>i.state&&e.jsx(ne,{compositionName:t,graphId:s,selectPart:u,selectedPart:r,nodeId:i.state.edges[o].targetId},`${n}-${i.state?.edges[o].targetId}`))})}):e.jsx(e.Fragment,{})}const ne=O.memo(He);function Qe(){const t=h("Store"),s=h("Layout"),r=h("Graph"),{useAppSelector:u}=t.hooks,{useGraph:n}=r.hooks,{selectActiveViewport:l}=s.store.selectors,d=u(l),i=g.useCallback(m=>({name:m?.name,svgPath:m?.svgPath,graphId:m?.graphId,selectedPart:m?.selectedPart}),[]),o=S({viewportName:d},i),a=n(d,m=>m?.adjacencyList);return!o.state?.svgPath||!o.state?.graphId||!o.state?.name||!a?null:e.jsx(me,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(Ve,{}),defaultExpandIcon:e.jsx(Be,{}),defaultEndIcon:e.jsx(Ue,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(ne,{compositionName:o.state.name,nodeId:"garment",graphId:o.state.graphId,selectPart:o.actions.selectPart,selectedPart:o.state.selectedPart})})}function Ye({key:t,graphId:s,nodeId:r,quantity:u,material:n,materialType:l}){const d=h("Converter"),i=h("Graph"),o=U(),{useGraph:a}=i.hooks,m=d.hooks.useConverter(),x=a(s,C=>{const M=Object.values(C?.edges??{}).filter(y=>y.type=="CONSUMES"&&y.targetId===r).map(y=>y.sourceId),P=Object.values(C?.nodes??{}).filter(y=>y.type==="MATERIAL_USAGE"&&M.includes(y.id)).map(y=>y.id),R=Object.values(C?.edges??{}).filter(y=>y.type==="CONSUMES"&&P.includes(y.targetId));return{material:C?.nodes[r],consumptionEdges:R}}),f=g.useMemo(()=>{if(!(!x.state||!m))return x.state?.consumptionEdges.reduce((C,M)=>{const P=m.convert(M.quantity,n.stock.unit,{...n.attributes,unidades:u});return P?{...C,amount:C.amount+P.amount}:(console.warn("could not convert"),C)},{unit:n.stock.unit,amount:0})},[x.state]),{principal:v,extra:p}=l.schemas[l.latestSchema].selector,c=n.attributes[v],b=p==="cor"?n.attributes[p].label:n.attributes[p],w=n.stock.amount-(f?.amount??0);let k="error";n.stock.amount>0&&(k=w>=0?"success":"warning");const E=g.useMemo(()=>!f?.unit||!m?.state?.nodes?void 0:m.state.nodes[f.unit],[m?.state?.nodes,f?.unit]);return e.jsxs(he,{sx:{width:"100%",display:"flex",flexGrow:1,flexDirection:"column"},children:[e.jsx(fe,{expandIcon:e.jsx(je,{}),sx:{width:"100%"},children:e.jsx($,{sx:{padding:0,width:"100%",flexGrow:1},children:e.jsxs(j,{role:"summary",sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(j,{role:"row1",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsxs(G,{sx:{width:"33%",flexShrink:0,flexGrow:1},children:[l.label," - ",c]}),e.jsxs(j,{sx:{display:"flex",gap:.5,alignItems:"center",justifyContent:"center",maxWidth:"70%",flexGrow:1},children:[p==="cor"&&e.jsx(j,{role:"color-preview",sx:{width:"1em",height:"1em",borderRadius:"50%",border:`1px solid ${o.palette.getContrastText(o.palette.background.paper)}`,backgroundColor:n.attributes[p].hex}}),e.jsx("span",{children:b})]})]}),e.jsxs(j,{role:"row2",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsx(G,{variant:"caption",sx:{width:"33%",flexShrink:0},children:n.industry}),e.jsxs(j,{sx:{display:"flex",flexGrow:1,flexDirection:"row",gap:"3px",justifyContent:"flex-end"},children:[e.jsx(G,{variant:"caption",color:o.palette.primary.dark,sx:{width:"fit-content",flexShrink:0},children:f&&`${f.amount.toFixed(2)} ${E?.abbreviation}`}),e.jsxs(G,{variant:"caption",color:o.palette[k].main,children:["(",n.stock.amount," ",E?.abbreviation," em estoque)"]})]})]})]})})}),e.jsxs(ge,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(j,{sx:{display:"flex",gap:1},children:[e.jsxs(j,{role:"composition",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(G,{variant:"body1",children:"Composição"}),z.isEmpty(n.composition)?e.jsx(G,{children:"Nenhuma composição disponível"}):e.jsx(j,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(n.composition).map(([C,M])=>e.jsxs(j,{children:[M*100,"% ",C]}))})]}),e.jsxs(j,{role:"caracteristics",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(G,{variant:"body1",children:"Caracteristicas"}),z.isEmpty(n.caracteristics)?e.jsx(G,{children:"Nenhuma caracterisca disponível"}):e.jsx(j,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(n.caracteristics).map(([C,M])=>e.jsxs(j,{children:[C,": ",M]},C))})]})]}),e.jsx(j,{role:"actions",sx:{width:"100%",display:"flex",flexDirection:"row-reverse"},children:e.jsx(F,{variant:"outlined",children:e.jsx(be,{href:n.externalURL,target:"_blank",underline:"none",children:"Ver material"})})})]})]},t)}const Ze=()=>{const t=h("Store"),s=h("Layout"),r=h("Graph"),u=h("Materials"),{useAppSelector:n}=t.hooks,{useGraph:l}=r.hooks,{useMaterials:d,useMaterialTypes:i}=u.hooks,{selectActiveViewport:o}=s.store.selectors,a=n(o),m=S({viewportName:a},c=>c),x=g.useMemo(()=>Object.values(m.state?.budget?.grades??{}).reduce((c,b)=>c+b,0),[m]),f=l(a,c=>Object.values(c?.nodes??{}).filter(b=>b.type==="MATERIAL").filter(b=>Object.values(c?.edges??{}).find(w=>w.type==="CONSUMES"&&w.targetId===b.id))),v=d(f.state?.map(c=>c.materialId)??[]),p=i();return!f.state||!m.state||!v?e.jsx(e.Fragment,{children:"test"}):m.state.budget?e.jsx(_,{role:"material-list",children:f.state.map(c=>e.jsx(ye,{fallback:e.jsx(e.Fragment,{children:"Não foi possivel calcular valor"}),children:e.jsx(Ye,{graphId:a,nodeId:c.id,quantity:x,material:v[c.materialId],materialType:p[v[c.materialId].type]})},c.id))}):e.jsx(e.Fragment,{children:"Crie um orçamento primeiro."})},Je=()=>{const t=h("Layout"),{SettingsPanel:s,Accordion:r}=t.components;return e.jsxs(s,{children:[e.jsx(r,{name:"Composição",icon:e.jsx(ve,{}),summary:"composição da peça",children:e.jsx(Qe,{})}),e.jsx(r,{name:"Materiais",icon:e.jsx(Ce,{}),summary:"Lista de materiais necessários",children:e.jsx(Ze,{})}),e.jsx(r,{name:"Prazos",icon:e.jsx(X,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})}),e.jsx(r,{name:"Valores",icon:e.jsx(we,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})})]})},Ke=O.memo(Je),Xe=({graphId:t,node:s})=>{const{components:{MaterialSelector:r}}=h("Materials"),u=h("Graph"),{useGraph:n}=u.hooks,l=S({compositionName:t},o=>o),d=n(t,o=>o?.nodes[s.materialId]),i=g.useCallback(o=>l.actions.changeMaterial(s.id,o),[t,s.id]);return e.jsx(r,{type:s.materialType,value:d?.state?.materialId,onChange:i})},et=({node:t,graphId:s})=>{const r=h("Graph"),{components:{MaterialTypeSelector:u}}=h("Materials"),{useNodeInfo:n,useGraph:l,useSearch:d}=r.hooks,i=l(s,p=>p?.nodes[t.id]),o=g.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),a=d(s,o,()=>{t&&i.actions.search("bfs",t.id,(p,c)=>p.type!=="RESTRICTION"?!1:c.adjacencyList[p.id].inputs.some(k=>{const E=c.edges[k];return E.type==="RESTRICTED_BY"&&E.attr==="materialType"}),()=>!1,(p,c)=>{const b=[...c.adjacencyList[p.id].inputs,...c.adjacencyList[p.id].outputs];return Object.values(c.edges).filter(w=>b.includes(w.id)).map(w=>w.targetId)},1,`Get all restriction associated with ${t.label}`,o)}),m=g.useMemo(()=>a?.findings.reduce((p,c)=>c.restrictionType==="allowOnly"?[...p,...c.operand]:p,[]),[a]),x=n(s,t.materialType),f=S({compositionName:s},p=>p),v=g.useCallback(p=>f.actions.changeMaterialType(t.id,p.target.value),[s,t.id]);return e.jsx(u,{filter:p=>a?.findings.length?m?.includes(p.name):!0,value:x.node?.id,onChange:v})},tt=({graphId:t,nodeId:s})=>{const r=h("Graph"),{useNodeInfo:u}=r.hooks,{node:n}=u(t,s);return e.jsx($,{role:"material-info",children:e.jsx(W,{disableTypography:!0,primary:e.jsxs(j,{sx:{marginBottom:1},children:[e.jsx(G,{children:n.label}),e.jsx(ee,{})]}),secondary:e.jsx(G,{component:"div",children:e.jsx(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(j,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:n.editableAttributes.map(l=>{switch(l){case"materialType":return e.jsx(et,{graphId:t,node:n},l);case"materialId":return e.jsx(Xe,{graphId:t,node:n},l);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},st=({labelState:[t,s],materialTypes:r,handleMaterialTypeChange:u})=>{const{components:{MaterialTypeSelector:n}}=h("Materials");return e.jsxs(j,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(n,{value:r,onChange:u,multiple:!0}),e.jsx(A,{id:"material-usage-name",label:"Nome",variant:"standard",value:t,onChange:l=>s(l.target.value)})]})},nt=({compositionName:t})=>{const s=h("Pointer"),{PointerContainer:r,ConfirmAndCloseButton:u}=s.components,n=S({compositionName:t},x=>x?.selectedPart),[l,d]=g.useState(""),[i,o]=g.useState([]),a=g.useCallback(()=>{n.state&&n.actions.addMaterialUsage(l,n.state,i)},[l]),m=g.useCallback(x=>o(f=>x.target.value),[t]);return e.jsx(r,{component:e.jsx(st,{materialTypes:i,handleMaterialTypeChange:m,labelState:[l,d]}),actions:[e.jsx(u,{color:"success",handleConfirm:a},"accept")],children:e.jsx(F,{startIcon:e.jsx(V,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},ot=({compositionName:t,materialUsageId:s})=>{const r=S({compositionName:t},n=>n),u=g.useCallback(()=>{r.actions.removeMaterialUsage(s)},[r]);return e.jsx(q,{color:"error",id:"delete-material",onClick:u,sx:{flexGrow:2},children:e.jsx(B,{})},"delete")},at=({compositionState:t,materialUsageId:s})=>{const r=h("Graph"),u=h("Layout"),[n,l]=g.useState(!1),d=U(),{useNodeInfo:i}=r.hooks,{CRUDGridContext:o}=u.contexts,{CRUDGrid:a,CRUDBooleanCell:m,CRUDTextFieldCell:x}=u.components,{node:f}=i(t.graphId,s),v=g.useMemo(()=>f.proxies.reduce((c,b)=>({...c,[b.elem]:{...c[b.elem],[b.attr]:!0}}),{}),[f]),{setRows:p}=g.useContext(o);return g.useEffect(()=>p(Object.entries(v).map(([c,b])=>({...b,elem:c,state:"untouched",id:D.uniqueId("proxy-")}))),[v]),e.jsxs(j,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(G,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(G,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(a,{addLabel:"Adicionar vínculo",newRecord:()=>({id:D.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento",renderEditCell:c=>e.jsx(x,{...c,InputProps:{endAdornment:e.jsx(K,{position:"end",sx:{cursor:"pointer",color:n?d.palette.secondary.main:void 0},onClick:b=>{console.log("clicked",b),l(!0)},children:e.jsx(Me,{})})},variant:"outlined"})},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:c})=>e.jsx(J,{checked:c,disabled:!0}),renderEditCell:c=>e.jsx(m,{...c})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:c})=>e.jsx(J,{checked:c,disabled:!0}),renderEditCell:c=>e.jsx(m,{...c})}]})]})},rt=O.memo(at),it=({composition:t,materialUsageId:s,...r})=>{const u=h("Pointer"),n=h("Layout"),{ConfirmAndCloseButton:l}=u.components,{CRUDGridContext:d}=n.contexts,{rows:i}=g.useContext(d),o=g.useCallback(()=>{i.filter(a=>a.state==="deleted").forEach(a=>t.actions.deleteProxy(a.elem,s)),i.filter(a=>a.state==="modified").forEach(a=>{t.actions.deleteProxy(a.old.elem,s),a.stroke&&t.actions.addProxy({elem:a.elem,attr:"stroke"},s),a.fill&&t.actions.addProxy({elem:a.elem,attr:"fill"},s)}),i.filter(a=>a.state==="added").forEach(a=>{t.actions.deleteProxy(a.elem,s),a.stroke&&t.actions.addProxy({elem:a.elem,attr:"stroke"},s),a.fill&&t.actions.addProxy({elem:a.elem,attr:"fill"},s)})},[i]);return e.jsx(l,{color:"success",...r,handleConfirm:o})},lt=({compositionName:t,materialUsageId:s})=>{const r=S({compositionName:t},i=>i),u=h("Pointer"),n=h("Layout"),{PointerContainer:l}=u.components,{CRUDGridProvider:d}=n.components;return r.state?e.jsx(d,{initialRows:[],children:e.jsx(l,{component:e.jsx(rt,{compositionState:r.state,materialUsageId:s}),actions:[e.jsx(it,{composition:r,materialUsageId:s},"accept")],children:e.jsx(q,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(ke,{})},"configure")})}):e.jsx(e.Fragment,{})};function ct({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function dt({row:t,...s}){const{components:{CRUDMaterialTypeCell:r}}=h("Materials");switch(t.attribute){case"materialType":return e.jsx(r,{row:t,value:t.operand,...s,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const ut=({compositionState:t,materialUsageId:s})=>{const r=h("Graph"),u=h("Layout"),{useGraph:n,useSearch:l}=r.hooks,{CRUDGridContext:d}=u.contexts,{CRUDGrid:i}=u.components,{state:o,actions:{search:a}}=n(t.graphId,p=>p?.nodes[s]),m=g.useMemo(()=>`${s}/restrictions`,[s]),x=l(t.graphId,m,()=>{o&&a("bfs",o.id,(p,c)=>p.type!=="RESTRICTION"?!1:c.adjacencyList[p.id].inputs.some(k=>c.edges[k].type==="RESTRICTED_BY"),()=>!1,(p,c)=>{const b=[...c.adjacencyList[p.id].inputs,...c.adjacencyList[p.id].outputs];return Object.values(c.edges).filter(w=>b.includes(w.id)).map(w=>w.targetId)},1,`Get all restriction associated with ${o?.label??o.id}`,m)}),{setRows:f}=g.useContext(d);g.useEffect(()=>{x?.findings&&f(x.findings.map(p=>({...p,state:"untouched"})))},[x]),g.useEffect(()=>{x?.findings&&f(x.findings)},[]);const v=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:p})=>e.jsx(e.Fragment,{children:p})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:p})=>e.jsx(ct,{node:p}),renderEditCell:p=>e.jsx(dt,{...p})}];return e.jsxs(j,{role:"restrictions-management-container",children:[e.jsx(G,{variant:"h4",children:"Restrições do material"}),e.jsxs(G,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(i,{addLabel:"Adicionar restrição",newRecord:()=>({id:D.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:v})]})},pt=t=>e.jsx(j,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(ut,{...t})}),xt=({composition:t,materialUsageId:s,...r})=>{const u=h("Pointer"),n=h("Layout"),{ConfirmAndCloseButton:l}=u.components,{CRUDGridContext:d}=n.contexts,{rows:i}=g.useContext(d),o=g.useCallback(()=>{console.group("delete"),i.filter(a=>a.state==="deleted").forEach(a=>t.actions.removeRestriction(s,a.id)),console.groupEnd(),console.group("modified"),i.filter(a=>a.state==="modified").forEach(a=>{t.actions.updateRestriction(s,a.id,a)}),console.groupEnd(),console.group("added"),i.filter(a=>a.state==="added").forEach(a=>{t.actions.addRestriction(s,{type:"RESTRICTION",id:a.id,label:a.label,operand:a.operand,position:a.position,restrictionType:a.restrictionType,attribute:a.attribute})}),console.groupEnd()},[i]);return e.jsx(l,{color:"success",...r,handleConfirm:o})},mt=({sx:t,materialUsageId:s,compositionName:r,...u})=>{const n=S({compositionName:r},a=>a),l=h("Pointer"),d=h("Layout"),{PointerContainer:i}=l.components,{CRUDGridProvider:o}=d.components;return n.state?e.jsx(o,{initialRows:[],children:e.jsx(i,{component:e.jsx(pt,{compositionState:n.state,materialUsageId:s}),actions:[e.jsx(xt,{composition:n,materialUsageId:s},"accept")],children:e.jsx(q,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(Se,{})},"restrict")})}):e.jsx(e.Fragment,{})},ht=t=>e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(ot,{...t}),e.jsx(lt,{...t}),e.jsx(mt,{...t,sx:{hover:{fill:"yellow"}}})]});function oe({compositionName:t,selectedPart:s,graphId:r}){const u=h("Graph"),{useNodeInfo:n}=u.hooks,{edges:l}=n(r,s);return e.jsxs(_,{sx:{width:"100%"},role:"material-list",children:[e.jsx(nt,{compositionName:t}),Object.values(l).filter(d=>d.type==="MADE_OF").map(d=>e.jsxs(N,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(tt,{graphId:r,nodeId:d.targetId}),e.jsx(ht,{compositionName:t,materialUsageId:d.targetId})]},d.targetId))]})}const ft=({graphId:t,nodeId:s})=>{const r=h("Graph"),u=h("Converter"),n=h("Layout"),l=h("Store"),d=h("Materials"),{useAppSelector:i}=l.hooks,{useNodeInfo:o,useGraph:a}=r.hooks,{useUnits:m,useConverter:x}=u.hooks,{useMaterials:f}=d.hooks,v=U(),{node:p}=o(t,s),{selectActiveViewport:c}=n.store.selectors,b=i(c),w=x(),{state:k}=S({viewportName:b},y=>y?.budget),{state:E}=a(t,y=>y?.edges&&{nodes:Object.values(y.nodes).filter(I=>Object.values(y.edges).filter(T=>T.type==="CONSUMES"&&T.sourceId===s).map(T=>T.targetId).includes(I.id)).reduce((I,T)=>({...I,[T.id]:T}),{}),edges:Object.values(y.edges).filter(I=>I.type==="CONSUMES"&&I.sourceId===s).map(I=>({...I,total:w?.convert(I.quantity,I.quantity.quotient.unit,{unidades:Object.values(k?.grades??{}).reduce((T,re)=>T+re,0),pedidos:1})}))}),C=m([p.cost.dividend.unit,p.cost.quotient.unit,p.time_taken.dividend.unit,p.time_taken.quotient.unit,...(E?.edges??[]).reduce((y,I)=>[...y,I.quantity.quotient.unit,I.quantity.dividend.unit],[])]),M=g.useMemo(()=>w?.convert(p.time_taken,p.cost.dividend.unit,{unidades:Object.values(k?.grades??{}).reduce((y,I)=>y+I,0),pedidos:1}),[p.time_taken,p.cost,k]),P=g.useMemo(()=>{if(!C||!M)return 0;const y={unidades:Object.values(k?.grades??{}).reduce((I,T)=>I+T,0),[C[M.unit].abbreviation]:M.amount,pedidos:1};return w?.convert(p.cost,p.cost.quotient.unit,y)},[p.cost,C,M,k]),R=f(Object.values(E?.nodes??{}).map(y=>+y.materialId.split("-")[1]));return C?e.jsx($,{children:e.jsx(W,{disableTypography:!0,primary:e.jsxs(j,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(j,{sx:{width:"max-content"},children:e.jsx(G,{children:p.label})}),e.jsxs(j,{sx:{display:"flex",justifyContent:"end",gap:2},children:[e.jsxs(j,{sx:{display:"flex",flexDirection:"column",maxWidth:"100px",gap:.3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{})," ",e.jsx("span",{children:"Tempo"})]}),e.jsxs(j,{sx:{color:v.palette.getContrastText(v.palette.background.paper),opacity:"50%"},children:[e.jsxs("span",{children:[p.time_taken.quotient.amount,C[p.time_taken.quotient.unit].abbreviation]}),e.jsxs("span",{children:[" ","/"," "]}),e.jsxs("span",{children:[p.time_taken.dividend.amount,C[p.time_taken.dividend.unit].abbreviation]})]}),k&&M&&e.jsxs(j,{sx:{color:v.palette.primary.main},children:[M.amount.toFixed(2)," ",C[M.unit].abbreviation]})]}),e.jsxs(j,{sx:{display:"flex",flexDirection:"column",maxWidth:"100px",gap:.3,flexWrap:"wrap",alignItems:"center"},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ge,{})," ",e.jsx("span",{children:"Custo"})]}),e.jsxs(j,{sx:{color:v.palette.getContrastText(v.palette.background.paper),opacity:"50%"},children:[e.jsxs("span",{children:[p.cost.quotient.amount,C[p.cost.quotient.unit].abbreviation]}),e.jsxs("span",{children:[" ","/"," "]}),e.jsxs("span",{children:[p.cost.dividend.amount,C[p.cost.dividend.unit].abbreviation]})]}),k&&P&&e.jsxs(j,{sx:{color:v.palette.primary.main},children:[P.amount.toFixed(2)," ",C[P.unit].abbreviation]})]})]})]}),secondary:e.jsxs(G,{component:"div",sx:{padding:1,display:"flex",gap:1,flexDirection:"column"},children:[e.jsx(j,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes"}),e.jsx(ee,{}),e.jsx(j,{children:E?.edges.map(y=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{children:[R[+E.nodes[y.targetId].materialId.split("-")[1]].attributes.nome," "]}),e.jsxs(j,{sx:{display:"flex",gap:1},children:[e.jsxs(j,{children:[y.quantity.quotient.amount," ",C[y.quantity.quotient.unit].abbreviation," /"," ",y.quantity.dividend.amount," ",C[y.quantity.dividend.unit].abbreviation]}),k&&y.total!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"="}),e.jsxs(j,{color:v.palette.primary.main,children:[y.total.amount.toFixed(2)," ",C[y.total.unit].abbreviation]})]})]})]},y.id))})]})})}):e.jsx(e.Fragment,{})},jt=({compositionName:t})=>{const s=h("Pointer"),r=h("Converter"),{PointerContainer:u,ConfirmAndCloseButton:n}=s.components,{CompoundSelector:l}=r.components;r.hooks;const d=S({compositionName:t},x=>x?.selectedPart),i=g.useMemo(()=>D.uniqueId("new-process-form"),[]),[o,a]=g.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),m=g.useCallback(x=>{x.preventDefault(),x.stopPropagation(),d.state&&d.actions.addOperation(o.label,o.cost,o.time_taken,d.state)},[o]);return e.jsx(u,{component:e.jsxs(j,{component:"form",onSubmit:m,id:i,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(Q,{children:e.jsx(A,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:x=>a(f=>({...f,label:x.target.value})),value:o.label})}),e.jsx(l,{id:"time-taken",label:"Tempo",filterDividends:x=>x.abbreviation==="un",filterQuotients:(x,f)=>f?.name==="Temporal",value:o.time_taken,onChange:x=>a(f=>({...f,time_taken:x}))}),e.jsx(l,{id:"cost",label:"Custo",filterDividends:(x,f)=>x.abbreviation==="un"||f?.name=="Temporal",filterQuotients:(x,f)=>f?.name==="Monetaria",value:o.cost,onChange:x=>a(f=>({...f,cost:x}))})]}),actions:[e.jsx(n,{type:"submit",form:i,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(F,{startIcon:e.jsx(V,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},gt=({compositionName:t,processId:s})=>{const r=S({compositionName:t},n=>n),u=g.useCallback(()=>{r.actions.removeOperation(s)},[r]);return e.jsx(q,{color:"error",id:`delete-process-${s}`,onClick:u,sx:{flexGrow:2},children:e.jsx(B,{})},"delete")},bt=({id:t,field:s,graphId:r,partId:u,value:n})=>{const l=h("Graph"),{useGraph:d}=l.hooks,i=te(),o=f=>Object.values(f).filter(v=>v.type==="MADE_OF"&&v.sourceId===u),a=(f,v)=>Object.entries(f).reduce((p,[c,b])=>v.includes(c)?{...p,[c]:b}:p,{}),{state:m}=d(r,f=>f&&{edges:o(f.edges),nodes:a(f.nodes,o(f.edges).map(v=>v.targetId))}),x=g.useCallback(f=>{i.current.setEditCellValue({id:t,field:s,value:f.target.value})},[r,u]);return m?e.jsxs(Q,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(Ie,{id:"label",children:"Material"}),e.jsx(Pe,{labelId:"label",id:"material-type",value:n??"",label:"Material",autoWidth:!0,onChange:x,children:m.edges.map(f=>e.jsx(Ee,{value:f.targetId,children:m.nodes[f.targetId].label},f.id))})]}):e.jsx(e.Fragment,{})};function yt({row:t,id:s,field:r}){const u=te(),n=h("Converter"),{components:{CompoundSelector:l}}=n,d=g.useCallback(i=>{u.current.setEditCellValue({id:s,field:r,value:i})},[s]);return e.jsx(l,{id:"quantity",filterQuotients:(i,o)=>o?.name==="Comprimento"||o?.name==="Volume"||o?.name==="Area",filterDividends:(i,o)=>i.abbreviation==="un"||i.abbreviation==="pedido",value:t.quantity,onChange:d})}const vt=({compositionState:t,processId:s})=>{const r=h("Graph"),u=h("Layout"),n=h("Converter"),{useGraph:l}=r.hooks,{CRUDGridContext:d}=u.contexts,{CRUDGrid:i}=u.components,{components:{CompoundUnit:o}}=n,a=c=>Object.values(c).filter(b=>b.type==="MADE_OF"&&b.sourceId===t.selectedPart),m=(c,b)=>Object.entries(c).reduce((w,[k,E])=>b.includes(k)?{...w,[k]:E}:w,{}),{state:x}=l(t.graphId,c=>c&&{edges:a(c.edges),nodes:m(c.nodes,a(c.edges).map(b=>b.targetId))}),{state:f}=l(t.graphId,c=>c?.edges&&Object.values(c.edges).filter(b=>b.type==="CONSUMES"&&b.sourceId===s)),{setRows:v}=g.useContext(d);if(g.useEffect(()=>{f?.length&&v(f.map(c=>({...c,state:"untouched"})))},f),!x)return e.jsx(e.Fragment,{});const p=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:c},value:b})=>e.jsx(e.Fragment,{children:x.nodes[c]?.label}),renderEditCell:({value:c,...b})=>e.jsx(bt,{value:c??b.row.targetId,partId:t.selectedPart,graphId:t.graphId,...b}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:c}})=>e.jsx(o,{value:c}),renderEditCell:c=>e.jsx(yt,{...c})}];return e.jsxs(j,{role:"material-usage-management-container",children:[e.jsx(G,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(G,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(i,{addLabel:"Víncular material",newRecord:()=>({id:D.uniqueId("material-usage-"),type:"CONSUMES",sourceId:s,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:p})]})},Ct=t=>e.jsx(j,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(vt,{...t})}),wt=({composition:t,processId:s,...r})=>{const u=h("Pointer"),n=h("Layout"),{ConfirmAndCloseButton:l}=u.components,{CRUDGridContext:d}=n.contexts,{rows:i}=g.useContext(d),o=g.useCallback(()=>{i.filter(a=>a.state==="deleted").forEach(a=>{t.actions.deleteMaterialConsuption(a.id)}),i.filter(a=>a.state==="modified").forEach(({id:a,targetId:m,quantity:x})=>{t.actions.updateMaterialConsuption(a,{targetId:m,quantity:x})}),i.filter(a=>a.state==="added").forEach(a=>{t.actions.addMaterialConsuption(s,a.targetId,a.quantity)})},[i]);return e.jsx(l,{color:"success",...r,handleConfirm:o})},Mt=({sx:t,compositionName:s,processId:r,...u})=>{const n=S({compositionName:s},a=>a),l=h("Pointer"),d=h("Layout"),{PointerContainer:i}=l.components,{CRUDGridProvider:o}=d.components;return n.state?e.jsx(o,{initialRows:[],children:e.jsx(i,{component:e.jsx(Ct,{processId:r,compositionState:n.state}),actions:[e.jsx(wt,{composition:n,processId:r},"accept")],children:e.jsx(q,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(qe,{})},"configure")})}):e.jsx(e.Fragment,{})},kt=t=>e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(gt,{...t}),e.jsx(Mt,{...t})]});function ae({compositionName:t,selectedPart:s,graphId:r}){const u=h("Graph"),{useNodeInfo:n}=u.hooks,{edges:l}=n(r,s);return e.jsxs(_,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(jt,{compositionName:t}),Object.values(l).filter(d=>d.type==="PROCESS_NEEDED").map(d=>e.jsxs(N,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(ft,{graphId:r,nodeId:d.targetId}),e.jsx(kt,{compositionName:t,processId:d.targetId})]},d.targetId))]})}const St=({compositionName:t,graphId:s})=>{const r=h("Pointer"),u=h("Graph"),{PointerContainer:n,ConfirmAndCloseButton:l}=r.components,{useGraph:d}=u.hooks,i=S({compositionName:t},p=>p?.selectedPart),o=d(s,p=>p?Object.values(p.nodes).filter(c=>c.type==="GRADE").map(c=>({...c,order:Object.values(p.edges).find(b=>b.targetId===c.id)?.order})):[]),a=g.useMemo(()=>o.state?z.max(o.state.filter(p=>D.isNumber(p?.order)).map(p=>p.order))??0:0,[o]),m=g.useMemo(()=>D.uniqueId("new-process-form"),[]),[x,f]=g.useState({abbreviation:""}),v=g.useCallback(()=>{i.state&&i.actions.addGrade(x.abbreviation,a+1)},[x.label,x.abbreviation,a,i.state]);return e.jsx(n,{component:e.jsx(j,{component:"form",id:m,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:e.jsx(Q,{children:e.jsx(A,{id:"abbreviation",label:"Abreviação",variant:"standard",sx:{marginBottom:1},onChange:p=>f(c=>({...c,abbreviation:p.target.value})),value:x.abbreviation})})}),actions:[e.jsx(l,{type:"submit",form:m,value:"Submit",color:"success",handleConfirm:v},"accept")],children:e.jsx(F,{startIcon:e.jsx(V,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar Grade"})})};function Gt({compositionName:t,graphId:s}){const r=h("Graph"),{useGraph:u}=r.hooks,n=u(s,i=>i?Object.values(i.nodes).filter(o=>o.type==="GRADE").map(o=>({...o,order:Object.values(i.edges).find(a=>a.targetId===o.id)?.order})).filter(o=>D.isNumber(o?.order)).sort((o,a)=>o?.order-a?.order):[]),l=S({compositionName:t},i=>i?.selectedPart),d=g.useCallback(i=>{l.actions.removeGrade(i)},[t]);return n.state?e.jsxs(_,{sx:{width:"100%"},role:"material-list",children:[e.jsx(St,{graphId:s,compositionName:t}),n.state.map(i=>e.jsxs(N,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"grade-container",children:[e.jsx($,{role:"grade-info",children:e.jsx(W,{disableTypography:!0,primary:e.jsx(G,{children:i.abbreviation})})}),e.jsx(j,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:e.jsx(q,{color:"error",id:"delete-material",onClick:()=>d(i.id),sx:{flexGrow:2},children:e.jsx(B,{})},"delete")})]},i.id))]}):e.jsx(e.Fragment,{})}const It=t=>{const s=h("Layout"),{Accordion:r}=s.components;return e.jsx(r,{name:"Graduação",icon:e.jsx(Te,{}),summary:"Graduação da peça",sx:{flexGrow:1},children:e.jsx(Gt,{...t})})},Pt=({node:t,graphId:s,selectedPart:r,compositionName:u})=>{const n=h("Layout"),l=h("Markdown"),{components:{MarkdownReader:d}}=l,{DetailsPanel:i,Accordion:o,CustomTextArea:a,SystemModal:m}=n.components,[x,f]=g.useState({name:t.label??"Nova peça",description:t.description??""}),v=S({compositionName:u},c=>c),p=g.useCallback(()=>{v.actions.changeProperties(x.name,x.description)},[u,x.name,x.description]);return e.jsxs(i,{title:t.label,id:"gamerment-panel",children:[e.jsx(o,{name:"Propriedades",icon:e.jsx(De,{}),summary:"Propriedades da peça",sx:{flexGrow:1},children:e.jsxs(N,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"garment-properties",id:"garment-properties",children:[e.jsxs(j,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:1},children:[e.jsx(A,{id:"garment-name",label:"Nome",variant:"standard",sx:{width:"100%"},value:x?.name,onChange:c=>f(b=>b&&{...b,name:c.target.value})}),e.jsx(a,{id:"description",wrapperProps:{sx:{width:"100%"}},minRows:3,name:"Outlined",placeholder:"Descrição",color:"neutral",value:x.description,onChange:c=>{c.preventDefault(),c.stopPropagation(),f(b=>b&&{...b,description:c.target.value})}})]}),e.jsxs(j,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(q,{color:"success",id:"save-properties",onClick:c=>p(),children:e.jsx(Ae,{})},"save"),e.jsx(m,{component:e.jsx(d,{content:x.description}),button:e.jsx(q,{color:"warning",id:"preview-description",children:e.jsx(Re,{})},"preview")}),e.jsx(q,{color:"info",id:"reset-properties",onClick:c=>f({name:t.label,description:t.description}),children:e.jsx(Le,{})},"reset")]})]},"garment-properties")}),e.jsx(It,{graphId:s,compositionName:u,selectedPart:r}),e.jsx(o,{name:"Materiais",icon:e.jsx(L,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(oe,{graphId:s,selectedPart:r,compositionName:u})}),e.jsx(o,{name:"Processos",icon:e.jsx(L,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(ae,{graphId:s,selectedPart:r,compositionName:u})})]},"garment-panel")},Et=()=>{const t=h("Layout"),s=h("Store"),{useAppSelector:r}=s.hooks,{selectActiveViewport:u}=t.store.selectors,n=r(u),l=g.useCallback(i=>({name:i?.name,graphId:i?.graphId,selectedPart:i?.selectedPart}),[]),d=S({viewportName:n},l);return!d.state?.selectedPart||!d.state?.graphId||!d.state?.name?null:e.jsx(qt,{graphId:d.state.graphId,selectedPart:d.state.selectedPart,compositionName:d.state.name})},qt=({graphId:t,selectedPart:s,compositionName:r})=>{const u=h("Layout"),n=h("Graph"),{DetailsPanel:l,Accordion:d}=u.components,{useGraph:i}=n.hooks,o=i(t,a=>a?.nodes[s]);return o.state?.type==="GARMENT"?e.jsx(Pt,{node:o.state,graphId:t,compositionName:r,selectedPart:s}):e.jsxs(l,{title:o.state?.label??s,children:[e.jsx(d,{name:"Opcionais",icon:e.jsx(L,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(d,{name:"Materiais",icon:e.jsx(L,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(oe,{graphId:t,selectedPart:s,compositionName:r})}),e.jsx(d,{name:"Processos",icon:e.jsx(L,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(ae,{graphId:t,selectedPart:s,compositionName:r})})]})},Tt=O.memo(Et);function Dt({compositionName:t,graphId:s}){const r=U(),u=h("Graph"),{useGraph:n}=u.hooks,l=S({compositionName:t},m=>m?.budget?.grades),d=n(s,m=>Object.values(m?.nodes??{}).filter(x=>x.type==="GRADE").reduce((x,f)=>(x[f.id]=f,x),{})),i=g.useMemo(()=>!l.state||!d?.state?[]:Object.entries(l.state).map(([m,x])=>d?.state?{id:m,counter:x,abbreviation:d.state[m].abbreviation}:{id:m,counter:x,abbreviation:m}),[l.state,d.state]),o=g.useMemo(()=>i.reduce((m,x)=>m+x.counter,0),[i]),a=g.useCallback((m,x)=>{l.actions.changeGradeCounter(m,x)},[t]);return!l.state||!d.state?e.jsx(e.Fragment,{}):e.jsxs(j,{sx:{width:"min-content",display:"flex",flexFlow:"column",backgroundColor:r.palette.background.paper,opacity:"0.9",borderRadius:2,pointerEvents:"all",border:`1px solid ${r.palette.getContrastText(r.palette.background.paper)}`},role:"grades-counter",children:[i.map(m=>e.jsx(j,{sx:{padding:1},children:e.jsx(A,{id:m.id,label:m.abbreviation,variant:"standard",value:m.counter,sx:{width:"40px"},type:"number",onChange:x=>a(m.id,+x.target.value)})},m.id)),e.jsx(j,{sx:{padding:1},children:e.jsx(A,{id:"total",label:"Total",variant:"standard",value:o,sx:{width:"40px"},disabled:!0})},"total")]})}const Bt=()=>{const t=h("Store"),s=h("Layout"),{useAppSelector:r}=t.hooks,{selectActiveViewport:u}=s.store.selectors,n=r(u),l=g.useCallback(i=>i,[n]),d=S({viewportName:n},l);return!n||!d.state?null:e.jsx(At,{selectPart:d.actions.selectPart,compositionInfo:d.state})},At=({compositionInfo:t,selectPart:s})=>{const{components:{SVGViewer:r},hooks:{useSVG:u}}=h("SVG"),{components:{MultiTouchPanel:n}}=h("Pointer"),{hooks:{useGraph:l}}=h("Graph"),d=h("Layout"),i=h("Orders"),{BudgetFloatingButton:o}=i.components,{ViewportNotificationsTray:a}=d.components,{graphId:m,svgPath:x,name:f,viewportName:v,budget:p}=t,c=Y(),b=l(m,M=>M?.nodes),w=u(x,M=>M?.instances[f]),k=g.useMemo(()=>p?["convert-to-order","delete-budget"]:["create-budget","add-to-budget"],[p]),E=g.useCallback(M=>{b.state&&Object.values(b.state).filter(P=>P.type==="PART").forEach(P=>{if(P.domId){const[R]=[...M?.querySelectorAll(`#${P.domId}`)??[]];R.addEventListener("click",y=>{y.stopPropagation(),s(P.id)})}})},[m]),C=g.useCallback(()=>{c.functions.createDebugView(f,v)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(j,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(n,{gestures:{onPinch:M=>{w.actions.setZoom(f,M.offset[0])},onWheel:M=>{const P=w.state?.zoom??1;w.actions.setZoom(f,P+M.delta[1]*.001)}},children:e.jsx(r,{instanceName:f,path:x,beforeInjection:E})}),e.jsx(a,{children:e.jsx(Oe,{fontSize:"small",onClick:C,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(Ke,{}),e.jsx(Tt,{})]}),e.jsxs(j,{sx:{position:"absolute",display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",gap:1,padding:1,alignItems:"end",bottom:10,width:"100%",pointerEvents:"none"},children:[e.jsx(o,{allowedActions:k}),p&&e.jsx(Dt,{compositionName:f,graphId:m})]})]})},Rt=({instanceName:t,path:s,...r})=>{const u=h("SVG"),{components:{SVGViewer:n},hooks:{useSVGManager:l}}=u,d=l();return g.useLayoutEffect(()=>{d.functions.loadSVG(s,`${t}-preview`)},[]),e.jsx(n,{...r,instanceName:`${t}-preview`,path:s})},Lt=se(j)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Ot=se(_)`

  overflow: auto;
  display:block;
  width: min-content;
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;

  @media (orientation: portrait) {
    height: 200px;
    flex-wrap: wrap;
    width: 100%;
    gap: 0px 16px;
  }
`,$t=({closeModal:t,onModelSelection:s})=>{const r=h("Markdown"),{components:{MarkdownReader:u}}=r,n=Fe(),[l,d]=g.useState(void 0);return e.jsx(N,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",minHeight:"50vh",p:2},children:e.jsxs(Lt,{role:"model-selector-container",sx:{gap:1,display:"flex"},children:[e.jsx(Ot,{role:"list-options",sx:{gap:1,width:"30%"},children:n.map(i=>e.jsx($,{disableGutters:!0,sx:{width:"fit-content"},children:e.jsx(W,{primary:e.jsx(j,{sx:{},children:i.name}),secondary:null,id:i.name,color:l?.name===i.name?"primary":"secondary",onClick:()=>d({name:i.name,path:i.svgPath,descriptionPath:i.descriptionPath}),sx:{cursor:"pointer"}})},D.uniqueId()))}),e.jsxs(j,{sx:{overflow:"auto",width:"100%"},children:[l?e.jsx(Rt,{instanceName:l.name,path:l.path,sx:{gridArea:"preview",p:1}}):e.jsx(j,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),l?.descriptionPath&&e.jsx(j,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(u,{path:l.descriptionPath})})]}),e.jsx(j,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(F,{disabled:!l,variant:"contained",onClick:()=>{l&&(s(l.name,l.path),t?.())},children:"Selecionar"})})]})})},Ut=()=>{const t=Y(),s=h("Layout"),{SystemModal:r}=s.components,u=g.useCallback((n,l)=>{t.functions.createComposition(n,l)},[]);return e.jsx(r,{component:e.jsx($t,{onModelSelection:u}),button:e.jsx(q,{children:e.jsx($e,{})})})},Ft=({name:t})=>{const s=h("Graph"),r=h("Layout"),{ViewportNotificationsTray:u,DetailsPanel:n,SettingsPanel:l,Accordion:d}=r.components,{components:{GraphViewer:i}}=s,o=Y(),a=g.useMemo(()=>o.functions.findComposition(m=>m.debugViewport===t),[t]);return e.jsxs(j,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[a&&e.jsx(i,{graphId:a?.graphId}),e.jsx(u,{children:e.jsx(e.Fragment,{})}),e.jsxs(l,{title:"Configurações",children:[e.jsx(d,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(n,{children:e.jsx(e.Fragment,{})})]})},Wt=O.memo(Ft);export{Bt as C,Wt as D,Ut as M};
