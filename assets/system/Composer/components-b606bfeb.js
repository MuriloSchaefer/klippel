import{r as p,o as e,B as g,aD as T,aE as Z,I as k,aF as J,$ as D,aG as L,H as K,aH as X,aI as B,aJ as ee,R as I,aK as te,aL as ne,aM as oe,aN as se,S as A,aO as ae,aP as re,aQ as ie,aR as z,aS as F,aT as O,T as w,aU as N,Z as G,_ as S,a3 as V,aV as le,aW as ce,aX as $,P as R,aY as de,aZ as W,a2 as U,a_ as ue,a$ as me,b0 as H,y as pe,b1 as E,b2 as xe,b3 as he,b4 as fe,b5 as je,b6 as ge,b7 as Ce,b8 as ye,ah as be,b9 as ve}from"../../vendor-fbb1c590.js";import{n as u}from"../../kernel-db330990.js";import{u as M,a as _,b as Me}from"./hooks-7c3c559e.js";const we=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:s,ConfirmAndCloseButton:d}=n.components,r=M(t,a=>a?.selectedPart),[c,i]=p.useState({name:"",domId:""}),l=p.useCallback(()=>{r.actions.addPart(c.name,c.domId,r.state)},[c]);return e.jsx(s,{component:e.jsxs(g,{sx:{width:200},children:[e.jsx(T,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:a=>i(o=>({...o,name:a.target.value}))}),e.jsx(T,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:a=>i(o=>({...o,domId:a.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(Z,{position:"end",children:e.jsx(k,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(J,{})})})}})]}),actions:[e.jsx(d,{handleConfirm:l},"confirm")],children:e.jsx(k,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:a=>{a.stopPropagation()},children:e.jsx(D,{})})})},ke=({compositionName:t})=>{const n=M(t,d=>d?.selectedPart),s=p.useCallback(d=>{n.state&&n.actions.removePart(n.state),d.stopPropagation()},[n]);return e.jsx(k,{"aria-label":"Delete part",id:`delete-part-${n.state}`,role:"delete-part-button",size:"small",sx:{},onClick:s,children:e.jsx(L,{})})};function Pe(t){return e.jsx(A,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function Se(t){return e.jsx(A,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function Ie(t){return e.jsx(A,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Ge(t){const n=te({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(ne.div,{style:n,children:e.jsx(oe,{...t})})}const Te=K(t=>e.jsx(X,{...t,TransitionComponent:Ge}))(({theme:t})=>({[`& .${B.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${B.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${ee(t.palette.text.primary,.4)}`}}));function Re({compositionName:t,graphId:n,selectedPart:s,selectPart:d,nodeId:r}){const c=u("Graph"),{useGraph:i}=c.hooks,l=i(n,a=>a&&a.adjacencyList[r]&&{node:a.nodes[r],edges:a.edges?Object.values(a.edges).reduce((o,x)=>a.adjacencyList[r].outputs.includes(x.id)?{...o,[x.id]:x}:o,{}):{},connections:a.adjacencyList[r]});return l.state?e.jsx(g,{sx:{color:"text.primary"},children:e.jsx(Te,{nodeId:r,label:e.jsxs(g,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:a=>{r!==s&&(d(r),a.stopPropagation())},children:[l.state.node.label,r===s&&e.jsxs(e.Fragment,{children:[e.jsx(we,{compositionName:t}),e.jsx(ke,{compositionName:t})]})]}),onClick:()=>{d(r)},sx:{color:r===s?"secondary.main":"secondary.secondary"},children:l.state.connections.outputs.filter(a=>l.state?.edges[a].type==="COMPOSED_OF").map(a=>l.state&&e.jsx(Q,{compositionName:t,graphId:n,selectPart:d,selectedPart:s,nodeId:l.state.edges[a].targetId},`${r}-${l.state?.edges[a].targetId}`))})}):e.jsx(e.Fragment,{})}const Q=I.memo(Re);function Ee(){const t=u("Store"),n=u("Layout"),s=u("Graph"),{useAppSelector:d}=t.hooks,{useGraph:r}=s.hooks,{selectActiveViewport:c}=n.store.selectors,i=d(c),l=p.useCallback(x=>({name:x?.name,svgPath:x?.svgPath,graphId:x?.graphId,selectedPart:x?.selectedPart}),[]),a=M(i,l),o=r(i,x=>x?.adjacencyList);return!a.state?.svgPath||!a.state?.graphId||!a.state?.name||!o?null:e.jsx(se,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(Pe,{}),defaultExpandIcon:e.jsx(Se,{}),defaultEndIcon:e.jsx(Ie,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(Q,{compositionName:a.state.name,nodeId:"garment",graphId:a.state.graphId,selectPart:a.actions.selectPart,selectedPart:a.state.selectedPart})})}const qe=()=>{const t=u("Layout"),{SettingsPanel:n,Accordion:s}=t.components;return e.jsxs(n,{children:[e.jsx(s,{name:"Composição",icon:e.jsx(ae,{}),summary:"composição da peça",children:e.jsx(Ee,{})}),e.jsx(s,{name:"Sumário",icon:e.jsx(re,{}),summary:"Resumo da peça",children:e.jsx(e.Fragment,{})}),e.jsx(s,{name:"Valores",icon:e.jsx(ie,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})}),e.jsx(s,{name:"Prazos",icon:e.jsx(z,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})})]})},De=I.memo(qe),Le=({graphId:t,node:n})=>{const{components:{MaterialSelector:s}}=u("Materials"),d=u("Graph"),{useGraph:r}=d.hooks,c=M(t,a=>a),i=r(t,a=>a?.nodes[n.materialId]),l=p.useCallback(a=>c.actions.changeMaterial(n.id,a),[t,n.id]);return e.jsx(s,{type:n.materialType,value:i?.state?.materialId,onChange:l})},Ae=({node:t,graphId:n})=>{const s=u("Graph"),{components:{MaterialTypeSelector:d}}=u("Materials"),{useNodeInfo:r,useGraph:c,useSearch:i}=s.hooks,l=c(n,f=>f?.nodes[t.id]),a=p.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),o=i(n,a,()=>{t&&l.actions.search("bfs",t.id,(f,j)=>f.type!=="RESTRICTION"?!1:j.adjacencyList[f.id].inputs.some(v=>{const P=j.edges[v];return P.type==="RESTRICTED_BY"&&P.attr==="materialType"}),()=>!1,1,`Get all restriction associated with ${t.label}`,a)}),x=p.useMemo(()=>o?.findings.reduce((f,j)=>j.restrictionType==="allowOnly"?[...f,...j.operand]:f,[]),[o]),h=r(n,t.materialType),m=M(n,f=>f),C=p.useCallback(f=>m.actions.changeMaterialType(t.id,f.target.value),[n,t.id]);return e.jsx(d,{filter:f=>o?.findings.length?x?.includes(f.name):!0,value:h.node?.id,onChange:C})},Fe=({graphId:t,nodeId:n})=>{const s=u("Graph"),{useNodeInfo:d}=s.hooks,{node:r}=d(t,n);return e.jsx(F,{role:"material-info",children:e.jsx(O,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(w,{children:r.label}),e.jsx(N,{})]}),secondary:e.jsx(w,{component:"div",children:e.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(g,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:r.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Ae,{graphId:t,node:r},c);case"materialId":return e.jsx(Le,{graphId:t,node:r},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},Oe=({isOpen:t,labelState:[n,s],materialTypes:d,handleMaterialTypeChange:r})=>{const{components:{MaterialTypeSelector:c}}=u("Materials");return t?e.jsxs(g,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(c,{value:d,onChange:r,multiple:!0}),e.jsx(T,{id:"material-usage-name",label:"Nome",variant:"standard",value:n,onChange:i=>s(i.target.value)})]}):e.jsx(e.Fragment,{})},$e=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:s,ConfirmAndCloseButton:d}=n.components,r=M(t,h=>h?.selectedPart),[c,i]=p.useState(""),[l,a]=p.useState([]),o=p.useCallback(()=>{r.state&&r.actions.addMaterialUsage(c,r.state,l)},[c]),x=p.useCallback(h=>a(m=>h.target.value),[t]);return e.jsx(s,{component:e.jsx(Oe,{materialTypes:l,handleMaterialTypeChange:x,labelState:[c,i]}),actions:[e.jsx(d,{color:"success",handleConfirm:o},"accept")],children:e.jsx(G,{startIcon:e.jsx(D,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},_e=({compositionName:t,materialUsageId:n})=>{const s=M(t,r=>r),d=p.useCallback(()=>{s.actions.removeMaterialUsage(n)},[s]);return e.jsx(k,{color:"error",id:"delete-material",onClick:d,sx:{flexGrow:2},children:e.jsx(L,{})},"delete")},Be=({compositionState:t,materialUsageId:n,isOpen:s})=>{const d=u("Graph"),r=u("Layout"),{useNodeInfo:c}=d.hooks,{CRUDGridContext:i}=r.contexts,{CRUDGrid:l,CRUDBooleanCell:a}=r.components,{node:o}=c(t.graphId,n),x=p.useMemo(()=>o.proxies.reduce((m,C)=>({...m,[C.elem]:{...m[C.elem],[C.attr]:!0}}),{}),[o]),{setRows:h}=p.useContext(i);return p.useEffect(()=>h(Object.entries(x).map(([m,C])=>({...C,elem:m,state:"untouched",id:S.uniqueId("proxy-")}))),[x]),s?e.jsxs(g,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(w,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(l,{addLabel:"Adicionar vínculo",newRecord:()=>({id:S.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:m})=>e.jsx(V,{checked:m,disabled:!0}),renderEditCell:m=>e.jsx(a,{...m})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:m})=>e.jsx(V,{checked:m,disabled:!0}),renderEditCell:m=>e.jsx(a,{...m})}]})]}):e.jsx(e.Fragment,{})},Ve=I.memo(Be),ze=({composition:t,materialUsageId:n,...s})=>{const d=u("Pointer"),r=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=r.contexts,{rows:l}=p.useContext(i),a=p.useCallback(()=>{l.filter(o=>o.state==="deleted").forEach(o=>t.actions.deleteProxy(o.elem,n)),l.filter(o=>o.state==="modified").forEach(o=>{t.actions.deleteProxy(o.old.elem,n),o.stroke&&t.actions.addProxy({elem:o.elem,attr:"stroke"},n),o.fill&&t.actions.addProxy({elem:o.elem,attr:"fill"},n)}),l.filter(o=>o.state==="added").forEach(o=>{t.actions.deleteProxy(o.elem,n),o.stroke&&t.actions.addProxy({elem:o.elem,attr:"stroke"},n),o.fill&&t.actions.addProxy({elem:o.elem,attr:"fill"},n)})},[l]);return e.jsx(c,{color:"success",...s,handleConfirm:a})},Ne=({compositionName:t,materialUsageId:n})=>{const s=M(t,l=>l),d=u("Pointer"),r=u("Layout"),{PointerContainer:c}=d.components,{CRUDGridProvider:i}=r.components;return s.state?e.jsx(i,{initialRows:[],children:e.jsx(c,{component:e.jsx(Ve,{compositionState:s.state,materialUsageId:n}),actions:[e.jsx(ze,{composition:s,materialUsageId:n},"accept")],children:e.jsx(k,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(le,{})},"configure")})}):e.jsx(e.Fragment,{})};function We({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function Ue({row:t,...n}){const{components:{CRUDMaterialTypeCell:s}}=u("Materials");switch(t.attribute){case"materialType":return e.jsx(s,{row:t,value:t.operand,...n,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const He=({compositionState:t,materialUsageId:n})=>{const s=u("Graph"),d=u("Layout"),{useGraph:r,useSearch:c}=s.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:l}=d.components,{state:a,actions:{search:o}}=r(t.graphId,f=>f?.nodes[n]),x=p.useMemo(()=>`${n}/restrictions`,[n]),h=c(t.graphId,x,()=>{a&&o("bfs",a.id,(f,j)=>f.type!=="RESTRICTION"?!1:j.adjacencyList[f.id].inputs.some(v=>j.edges[v].type==="RESTRICTED_BY"),()=>!1,1,`Get all restriction associated with ${a?.label??a.id}`,x)}),{setRows:m}=p.useContext(i);p.useEffect(()=>{h?.findings&&m(h.findings.map(f=>({...f,state:"untouched"})))},[h]),p.useEffect(()=>{h?.findings&&m(h.findings)},[]);const C=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:f})=>e.jsx(e.Fragment,{children:f})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:f})=>e.jsx(We,{node:f}),renderEditCell:f=>e.jsx(Ue,{...f})}];return e.jsxs(g,{role:"restrictions-management-container",children:[e.jsx(w,{variant:"h4",children:"Restrições do material"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(l,{addLabel:"Adicionar restrição",newRecord:()=>({id:S.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:C})]})},Qe=t=>t.isOpen?e.jsx(g,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(He,{...t})}):e.jsx("div",{}),Ye=({composition:t,materialUsageId:n,...s})=>{const d=u("Pointer"),r=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=r.contexts,{rows:l}=p.useContext(i),a=p.useCallback(()=>{console.group("delete"),l.filter(o=>o.state==="deleted").forEach(o=>t.actions.removeRestriction(n,o.id)),console.groupEnd(),console.group("modified"),l.filter(o=>o.state==="modified").forEach(o=>{t.actions.updateRestriction(n,o.id,o)}),console.groupEnd(),console.group("added"),l.filter(o=>o.state==="added").forEach(o=>{t.actions.addRestriction(n,{type:"RESTRICTION",id:o.id,label:o.label,operand:o.operand,position:o.position,restrictionType:o.restrictionType,attribute:o.attribute})}),console.groupEnd()},[l]);return e.jsx(c,{color:"success",...s,handleConfirm:a})},Ze=({sx:t,materialUsageId:n,compositionName:s,...d})=>{const r=M(s,o=>o),c=u("Pointer"),i=u("Layout"),{PointerContainer:l}=c.components,{CRUDGridProvider:a}=i.components;return r.state?e.jsx(a,{initialRows:[],children:e.jsx(l,{component:e.jsx(Qe,{compositionState:r.state,materialUsageId:n}),actions:[e.jsx(Ye,{composition:r,materialUsageId:n},"accept")],children:e.jsx(k,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(ce,{})},"restrict")})}):e.jsx(e.Fragment,{})},Je=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(_e,{...t}),e.jsx(Ne,{...t}),e.jsx(Ze,{...t,sx:{hover:{fill:"yellow"}}})]});function Ke({compositionName:t,selectedPart:n,graphId:s}){const d=u("Graph"),{useNodeInfo:r}=d.hooks,{edges:c}=r(s,n);return e.jsxs($,{sx:{width:"100%"},role:"material-list",children:[e.jsx($e,{compositionName:t}),Object.values(c).filter(i=>i.type==="MADE_OF").map(i=>e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(Fe,{graphId:s,nodeId:i.targetId}),e.jsx(Je,{compositionName:t,materialUsageId:i.targetId})]},i.targetId))]})}const Xe=({graphId:t,nodeId:n})=>{const s=u("Graph"),d=u("Converter"),{useNodeInfo:r}=s.hooks,{useUnits:c}=d.hooks,{node:i}=r(t,n),l=c([i.cost.dividend.unit,i.cost.quotient.unit,i.time_taken.dividend.unit,i.time_taken.quotient.unit]);return l?e.jsx(F,{children:e.jsx(O,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(w,{children:i.label}),e.jsx(N,{})]}),secondary:e.jsx(w,{component:"div",sx:{padding:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(z,{})," ",i.time_taken.quotient.amount," ",l[i.time_taken.quotient.unit].abbreviation," /"," ",i.time_taken.dividend.amount," ",l[i.time_taken.dividend.unit].abbreviation]}),e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(de,{})," ",i.cost.quotient.amount," ",l[i.cost.quotient.unit].abbreviation," /"," ",i.cost.dividend.amount," ",l[i.cost.dividend.unit].abbreviation]})]})})})}):e.jsx(e.Fragment,{})},et=({compositionName:t})=>{const n=u("Pointer"),s=u("Converter"),{PointerContainer:d,ConfirmAndCloseButton:r}=n.components,{CompoundSelector:c}=s.components;s.hooks;const i=M(t,h=>h?.selectedPart),l=p.useMemo(()=>S.uniqueId("new-process-form"),[]),[a,o]=p.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),x=p.useCallback(h=>{h.preventDefault(),h.stopPropagation(),i.state&&i.actions.addOperation(a.label,a.cost,a.time_taken,i.state)},[a]);return e.jsx(d,{component:e.jsxs(g,{component:"form",onSubmit:x,id:l,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(W,{children:e.jsx(T,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:h=>o(m=>({...m,label:h.target.value})),value:a.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",filterDividends:h=>h.abbreviation==="un",filterQuotients:(h,m)=>m?.name==="Temporal",value:a.time_taken,onChange:h=>o(m=>({...m,time_taken:h}))}),e.jsx(c,{id:"cost",label:"Custo",filterDividends:(h,m)=>h.abbreviation==="un"||m?.name=="Temporal",filterQuotients:(h,m)=>m?.name==="Monetaria",value:a.cost,onChange:h=>o(m=>({...m,cost:h}))})]}),actions:[e.jsx(r,{type:"submit",form:l,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(G,{startIcon:e.jsx(D,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},tt=({compositionName:t,processId:n})=>{const s=M(t,r=>r),d=p.useCallback(()=>{s.actions.removeOperation(n)},[s]);return e.jsx(k,{color:"error",id:`delete-process-${n}`,onClick:d,sx:{flexGrow:2},children:e.jsx(L,{})},"delete")},nt=({id:t,field:n,graphId:s,partId:d,value:r})=>{const c=u("Graph"),{useGraph:i}=c.hooks,l=U(),a=m=>Object.values(m).filter(C=>C.type==="MADE_OF"&&C.sourceId===d),o=(m,C)=>Object.entries(m).reduce((f,[j,y])=>C.includes(j)?{...f,[j]:y}:f,{}),{state:x}=i(s,m=>m&&{edges:a(m.edges),nodes:o(m.nodes,a(m.edges).map(C=>C.targetId))}),h=p.useCallback(m=>{l.current.setEditCellValue({id:t,field:n,value:m.target.value})},[s,d]);return x?e.jsxs(W,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(ue,{id:"label",children:"Material"}),e.jsx(me,{labelId:"label",id:"material-type",value:r??"",label:"Material",autoWidth:!0,onChange:h,children:x.edges.map(m=>e.jsx(H,{value:m.targetId,children:x.nodes[m.targetId].label},m.id))})]}):e.jsx(e.Fragment,{})};function ot({row:t,id:n,field:s}){const d=U(),r=u("Converter"),{components:{CompoundSelector:c}}=r,i=p.useCallback(l=>{d.current.setEditCellValue({id:n,field:s,value:l})},[n]);return e.jsx(c,{id:"quantity",filterQuotients:(l,a)=>a?.name==="Comprimento"||a?.name==="Volume"||a?.name==="Area",filterDividends:(l,a)=>l.abbreviation==="un",value:t.quantity,onChange:i})}const st=({compositionState:t,processId:n})=>{const s=u("Graph"),d=u("Layout"),r=u("Converter"),{useGraph:c}=s.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:l}=d.components,{components:{CompoundUnit:a}}=r,o=j=>Object.values(j).filter(y=>y.type==="MADE_OF"&&y.sourceId===t.selectedPart),x=(j,y)=>Object.entries(j).reduce((b,[v,P])=>y.includes(v)?{...b,[v]:P}:b,{}),{state:h}=c(t.graphId,j=>j&&{edges:o(j.edges),nodes:x(j.nodes,o(j.edges).map(y=>y.targetId))}),{state:m}=c(t.graphId,j=>j?.edges&&Object.values(j.edges).filter(y=>y.type==="CONSUMES"&&y.sourceId===n)),{setRows:C}=p.useContext(i);if(p.useEffect(()=>{m?.length&&C(m.map(j=>({...j,state:"untouched"})))},m),!h)return e.jsx(e.Fragment,{});const f=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:j},value:y})=>e.jsx(e.Fragment,{children:h.nodes[j]?.label}),renderEditCell:({value:j,...y})=>e.jsx(nt,{value:j??y.row.targetId,partId:t.selectedPart,graphId:t.graphId,...y}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:j}})=>e.jsx(a,{value:j}),renderEditCell:j=>e.jsx(ot,{...j})}];return e.jsxs(g,{role:"material-usage-management-container",children:[e.jsx(w,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(l,{addLabel:"Víncular material",newRecord:()=>({id:S.uniqueId("material-usage-"),type:"CONSUMES",sourceId:n,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:f})]})},at=t=>t.isOpen?e.jsx(g,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(st,{...t})}):e.jsx("div",{}),rt=({composition:t,processId:n,...s})=>{const d=u("Pointer"),r=u("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=r.contexts,{rows:l}=p.useContext(i),a=p.useCallback(()=>{l.filter(o=>o.state==="deleted").forEach(o=>{t.actions.deleteMaterialConsuption(o.id)}),l.filter(o=>o.state==="modified").forEach(({id:o,targetId:x,quantity:h})=>{t.actions.updateMaterialConsuption(o,{targetId:x,quantity:h})}),l.filter(o=>o.state==="added").forEach(o=>{t.actions.addMaterialConsuption(n,o.targetId,o.quantity)})},[l]);return e.jsx(c,{color:"success",...s,handleConfirm:a})},it=({sx:t,compositionName:n,processId:s,...d})=>{const r=M(n,o=>o),c=u("Pointer"),i=u("Layout"),{PointerContainer:l}=c.components,{CRUDGridProvider:a}=i.components;return r.state?e.jsx(a,{initialRows:[],children:e.jsx(l,{component:e.jsx(at,{processId:s,compositionState:r.state}),actions:[e.jsx(rt,{composition:r,processId:s},"accept")],children:e.jsx(k,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(pe,{})},"configure")})}):e.jsx(e.Fragment,{})},lt=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(tt,{...t}),e.jsx(it,{...t})]});function ct({compositionName:t,selectedPart:n,graphId:s}){const d=u("Graph"),{useNodeInfo:r}=d.hooks,{edges:c}=r(s,n);return e.jsxs($,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(et,{compositionName:t}),Object.values(c).filter(i=>i.type==="PROCESS_NEEDED").map(i=>e.jsxs(R,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(Xe,{graphId:s,nodeId:i.targetId}),e.jsx(lt,{compositionName:t,processId:i.targetId})]},i.targetId))]})}const dt=({graphId:t})=>{const n=u("Layout"),s=u("Store"),{useAppSelector:d}=s.hooks,{selectActiveViewport:r}=n.store.selectors,c=d(r),i=p.useCallback(a=>({name:a?.name,graphId:a?.graphId,selectedPart:a?.selectedPart}),[]),l=M(c,i);return!l.state?.selectedPart||!l.state?.graphId||!l.state?.name?null:e.jsx(ut,{graphId:l.state.graphId,selectedPart:l.state.selectedPart,compositionName:l.state.name})},ut=({graphId:t,selectedPart:n,compositionName:s})=>{const d=u("Layout"),r=u("Graph"),{DetailsPanel:c,Accordion:i}=d.components,{useGraph:l}=r.hooks,a=l(t,o=>o?.nodes[n]);return e.jsxs(c,{title:a.state?.label??n,children:[e.jsx(i,{name:"Opcionais",icon:e.jsx(E,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(i,{name:"Materiais",icon:e.jsx(E,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Ke,{graphId:t,selectedPart:n,compositionName:s})}),e.jsx(i,{name:"Processos",icon:e.jsx(E,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(ct,{graphId:t,selectedPart:n,compositionName:s})})]})},mt=I.memo(dt),q=["Adicionar ao orçamento","Criar orçamento"];function pt(){const[t,n]=p.useState(!1),s=p.useRef(null),[d,r]=p.useState(1),c=()=>{console.info(`You clicked ${q[d]}`)},i=(o,x)=>{r(x),n(!1)},l=()=>{n(o=>!o)},a=o=>{s.current&&s.current.contains(o.target)||n(!1)};return e.jsxs(p.Fragment,{children:[e.jsxs(xe,{variant:"contained",ref:s,"aria-label":"split button",children:[e.jsx(G,{onClick:c,children:q[d]}),e.jsx(G,{size:"small","aria-controls":t?"split-button-menu":void 0,"aria-expanded":t?"true":void 0,"aria-label":"select merge strategy","aria-haspopup":"menu",onClick:l,children:e.jsx(he,{})})]}),e.jsx(fe,{sx:{zIndex:1},open:t,anchorEl:s.current,role:void 0,transition:!0,disablePortal:!0,children:({TransitionProps:o,placement:x})=>e.jsx(je,{...o,style:{transformOrigin:x==="bottom"?"center top":"center bottom"},children:e.jsx(R,{children:e.jsx(ge,{onClickAway:a,children:e.jsx(Ce,{id:"split-button-menu",autoFocusItem:!0,children:q.map((h,m)=>e.jsx(H,{disabled:m===2,selected:m===d,onClick:C=>i(C,m),children:h},h))})})})})})]})}const xt=()=>e.jsx(g,{sx:{position:"absolute",bottom:10,right:10},children:e.jsx(pt,{})}),ht=I.memo(xt),wt=()=>{const t=u("Store"),n=u("Layout"),{useAppSelector:s}=t.hooks,{selectActiveViewport:d}=n.store.selectors,r=s(d),c=p.useCallback(l=>l,[r]),i=M(r,c);return!r||!i.state?null:e.jsx(ft,{selectPart:i.actions.selectPart,compositionInfo:i.state})},ft=({compositionInfo:t,selectPart:n})=>{const{components:{SVGViewer:s},hooks:{useSVG:d}}=u("SVG"),{components:{MultiTouchPanel:r}}=u("Pointer"),{hooks:{useGraph:c}}=u("Graph"),i=u("Layout"),{ViewportNotificationsTray:l}=i.components,{graphId:a,svgPath:o,name:x,viewportName:h}=t,m=_(),C=c(a,b=>b?.nodes),f=d(o,b=>b?.instances[x]),j=p.useCallback(b=>{C.state&&Object.values(C.state).filter(v=>v.type==="PART").forEach(v=>{if(v.domId){const[P]=[...b?.querySelectorAll(`#${v.domId}`)];P.addEventListener("click",Y=>{Y.stopPropagation(),n(v.id)})}})},[a]),y=p.useCallback(()=>{m.functions.createDebugView(x,h)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(g,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(r,{gestures:{onPinch:b=>{f.actions.setZoom(x,b.offset[0])},onWheel:b=>{const v=f.state?.zoom??1;f.actions.setZoom(x,v+b.delta[1]*.001)}},children:e.jsx(s,{instanceName:x,path:o,beforeInjection:j})}),e.jsx(l,{children:e.jsx(ye,{fontSize:"small",onClick:y,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(De,{}),e.jsx(mt,{graphId:a})]}),e.jsx(ht,{})]})},jt=({instanceName:t,path:n,...s})=>{const d=u("SVG"),{components:{SVGViewer:r},hooks:{useSVGManager:c}}=d,i=c();return p.useLayoutEffect(()=>{i.functions.loadSVG(n,`${t}-preview`)},[]),e.jsx(r,{...s,instanceName:`${t}-preview`,path:n})},gt=be(g)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Ct=({closeModal:t,onModelSelection:n})=>{const s=u("Markdown"),{components:{MarkdownReader:d}}=s,r=Me(),[c,i]=p.useState(void 0);return e.jsx(R,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",p:2},children:e.jsxs(gt,{role:"model-selector-container",sx:{gap:1},children:[e.jsx($,{role:"list-options",sx:{paddingRight:5,overflow:"auto"},children:r.map(l=>e.jsx(F,{disableGutters:!0,children:e.jsx(O,{primary:l.name,secondary:null,id:l.name,color:c?.name===l.name?"primary":"secondary",onClick:()=>i({name:l.name,path:l.svgPath,descriptionPath:l.descriptionPath}),sx:{cursor:"pointer",flexGrow:1}})},S.uniqueId()))}),e.jsxs(g,{sx:{overflow:"auto",width:"100%"},children:[c?e.jsx(jt,{instanceName:c.name,path:c.path,sx:{gridArea:"preview",p:1}}):e.jsx(g,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),c?.descriptionPath&&e.jsx(g,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(d,{path:c.descriptionPath})})]}),e.jsx(g,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(G,{disabled:!c,variant:"contained",onClick:()=>{c&&(n(c.name,c.path),t?.())},children:"Selecionar"})})]})})},kt=()=>{const t=_(),n=u("Layout"),{SystemModal:s}=n.components,d=p.useCallback((r,c)=>{t.functions.createComposition(r,c)},[]);return e.jsx(e.Fragment,{children:e.jsx(s,{component:e.jsx(Ct,{onModelSelection:d}),children:e.jsx(k,{children:e.jsx(ve,{})})})})},yt=({name:t})=>{const n=u("Graph"),s=u("Layout"),{ViewportNotificationsTray:d,DetailsPanel:r,SettingsPanel:c,Accordion:i}=s.components,{components:{GraphViewer:l}}=n,a=_(),o=p.useMemo(()=>a.functions.findComposition(x=>x.debugViewport===t),[t]);return e.jsxs(g,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[o&&e.jsx(l,{graphId:o?.graphId}),e.jsx(d,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(i,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(r,{children:e.jsx(e.Fragment,{})})]})},Pt=I.memo(yt);export{wt as C,Pt as D,kt as M};
