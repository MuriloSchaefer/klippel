import{r as j,o as e,B as g,aG as S,aH as ne,I as w,aI as se,$ as O,aJ as $,H as oe,aK as ae,aL as z,aM as re,R,aN as ie,aO as le,aP as ce,aQ as de,S as B,aR as E,n as U,M as ue,A as pe,t as xe,aS as A,T as v,v as me,az as F,Z as q,aT as he,aU as fe,aV as je,aW as K,aX as ge,aY as _,aZ as H,_ as k,a3 as W,a_ as be,a$ as ye,P as L,b0 as ve,b1 as V,a2 as Q,b2 as Ce,b3 as we,b4 as Me,y as ke,b5 as Ge,b6 as Pe,b7 as Se,b8 as Ie,b9 as De,ba as T,bb as Te,ak as Re,bc as Ee}from"../../vendor-918b8f8e.js";import{n as x}from"../../kernel-f178b49f.js";import{u as C,a as N,b as Ae}from"./hooks-cfa1595d.js";const qe=({compositionName:t})=>{const n=x("Pointer"),{PointerContainer:o,ConfirmAndCloseButton:d}=n.components,l=C({compositionName:t},s=>s?.selectedPart),[c,i]=j.useState({name:"",domId:""}),a=j.useCallback(()=>{l.actions.addPart(c.name,c.domId,l.state)},[c]);return e.jsx(o,{component:e.jsxs(g,{sx:{width:200},children:[e.jsx(S,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:s=>i(r=>({...r,name:s.target.value}))}),e.jsx(S,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:s=>i(r=>({...r,domId:s.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(ne,{position:"end",children:e.jsx(w,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(se,{})})})}})]}),actions:[e.jsx(d,{handleConfirm:a},"confirm")],children:e.jsx(w,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:s=>{s.stopPropagation()},children:e.jsx(O,{})})})},Le=({compositionName:t})=>{const n=C({compositionName:t},d=>d?.selectedPart),o=j.useCallback(d=>{n.state&&n.actions.removePart(n.state),d.stopPropagation()},[n]);return e.jsx(w,{"aria-label":"Delete part",id:`delete-part-${n.state}`,role:"delete-part-button",size:"small",sx:{},onClick:o,children:e.jsx($,{})})};function Oe(t){return e.jsx(B,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function $e(t){return e.jsx(B,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function _e(t){return e.jsx(B,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Fe(t){const n=ie({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(le.div,{style:n,children:e.jsx(ce,{...t})})}const Be=oe(t=>e.jsx(ae,{...t,TransitionComponent:Fe}))(({theme:t})=>({[`& .${z.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${z.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${re(t.palette.text.primary,.4)}`}}));function Ve({compositionName:t,graphId:n,selectedPart:o,selectPart:d,nodeId:l}){const c=x("Graph"),{useGraph:i}=c.hooks,a=i(n,s=>s&&s.adjacencyList[l]&&{node:s.nodes[l],edges:s.edges?Object.values(s.edges).reduce((r,m)=>s.adjacencyList[l].outputs.includes(m.id)?{...r,[m.id]:m}:r,{}):{},connections:s.adjacencyList[l]});return a.state?e.jsx(g,{sx:{color:"text.primary"},children:e.jsx(Be,{nodeId:l,label:e.jsxs(g,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:s=>{l!==o&&(d(l),s.stopPropagation())},children:[a.state.node.label,l===o&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{compositionName:t}),e.jsx(Le,{compositionName:t})]})]}),onClick:()=>{d(l)},sx:{color:l===o?"secondary.main":"secondary.secondary"},children:a.state.connections.outputs.filter(s=>a.state?.edges[s].type==="COMPOSED_OF").map(s=>a.state&&e.jsx(Y,{compositionName:t,graphId:n,selectPart:d,selectedPart:o,nodeId:a.state.edges[s].targetId},`${l}-${a.state?.edges[s].targetId}`))})}):e.jsx(e.Fragment,{})}const Y=R.memo(Ve);function Ne(){const t=x("Store"),n=x("Layout"),o=x("Graph"),{useAppSelector:d}=t.hooks,{useGraph:l}=o.hooks,{selectActiveViewport:c}=n.store.selectors,i=d(c),a=j.useCallback(m=>({name:m?.name,svgPath:m?.svgPath,graphId:m?.graphId,selectedPart:m?.selectedPart}),[]),s=C({viewportName:i},a),r=l(i,m=>m?.adjacencyList);return!s.state?.svgPath||!s.state?.graphId||!s.state?.name||!r?null:e.jsx(de,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(Oe,{}),defaultExpandIcon:e.jsx($e,{}),defaultEndIcon:e.jsx(_e,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(Y,{compositionName:s.state.name,nodeId:"garment",graphId:s.state.graphId,selectPart:s.actions.selectPart,selectedPart:s.state.selectedPart})})}const ze=({material:t,materialType:n})=>{const o=U(),{principal:d,extra:l}=n.schemas[n.latestSchema].selector,c=t.attributes[d],i=l==="cor"?t.attributes[l].label:t.attributes[l],a={7:{amount:50,unit:"Kg"},8:{amount:30,unit:"Kg"},9:{amount:50,unit:"Kg"},12:{amount:20,unit:"Kg"},14:{amount:10,unit:"Kg"},17:{amount:10,unit:"Kg"},18:{amount:10,unit:"Kg"}},s={7:{amount:50,unit:"Kg"},8:{amount:30,unit:"Kg"},9:{amount:0,unit:"Kg"},12:{amount:10,unit:"Kg"},14:{amount:10,unit:"Kg"},17:{amount:10,unit:"Kg"},18:{amount:10,unit:"Kg"}},r=s[t.id].amount-a[t.id].amount;let m="error";return t.id in s&&s[t.id].amount>0&&(m=r>=0?"success":"warning"),console.log(t.id,a[t.id],s[t.id],r,m),e.jsxs(ue,{sx:{width:"100%",display:"flex",flexGrow:1,flexDirection:"column"},children:[e.jsx(pe,{expandIcon:e.jsx(xe,{}),sx:{width:"100%"},children:e.jsx(A,{sx:{padding:0,width:"100%",flexGrow:1},children:e.jsxs(g,{role:"summary",sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(g,{role:"row1",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsxs(v,{sx:{width:"33%",flexShrink:0,flexGrow:1},children:[n.label," - ",c]}),e.jsxs(g,{sx:{display:"flex",gap:.5,alignItems:"center",justifyContent:"center",maxWidth:"70%",flexGrow:1},children:[l==="cor"&&e.jsx(g,{role:"color-preview",sx:{width:"1em",height:"1em",borderRadius:"50%",border:`1px solid ${o.palette.getContrastText(o.palette.background.paper)}`,backgroundColor:t.attributes[l].hex}}),e.jsx("span",{children:i})]})]}),e.jsxs(g,{role:"row2",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsx(v,{variant:"caption",sx:{width:"33%",flexShrink:0},children:t.industry}),e.jsxs(g,{sx:{display:"flex",flexGrow:1,flexDirection:"row",gap:"3px",justifyContent:"flex-end"},children:[e.jsxs(v,{variant:"caption",color:o.palette.primary.dark,sx:{width:"fit-content",flexShrink:0},children:[a[t.id].amount," ",a[t.id].unit]}),e.jsxs(v,{variant:"caption",color:o.palette[m].main,children:["(",s[t.id].amount," ",s[t.id].unit," em estoque)"]})]})]})]})})}),e.jsxs(me,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(g,{sx:{display:"flex",gap:1},children:[e.jsxs(g,{role:"composition",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(v,{variant:"body1",children:"Composição"}),F.isEmpty(t.composition)?e.jsx(v,{children:"Nenhuma composição disponível"}):e.jsx(g,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(t.composition).map(([u,p])=>e.jsxs(g,{children:[p*100,"% ",u]}))})]}),e.jsxs(g,{role:"caracteristics",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(v,{variant:"body1",children:"Caracteristicas"}),F.isEmpty(t.caracteristics)?e.jsx(v,{children:"Nenhuma caracterisca disponível"}):e.jsx(g,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(t.caracteristics).map(([u,p])=>e.jsxs(g,{children:[u,": ",p]},u))})]})]}),e.jsx(g,{role:"actions",sx:{width:"100%",display:"flex",flexDirection:"row-reverse"},children:e.jsx(q,{variant:"outlined",children:e.jsx(he,{href:t.externalURL,target:"_blank",underline:"none",children:"Ver material"})})})]})]})},We=()=>{const t=x("Store"),n=x("Layout"),o=x("Graph"),d=x("Materials"),{useAppSelector:l}=t.hooks,{useGraph:c}=o.hooks,{useMaterials:i,useMaterialTypes:a}=d.hooks,{selectActiveViewport:s}=n.store.selectors,r=l(s),m=C({viewportName:r},h=>h),u=c(r,h=>Object.values(h?.nodes??{}).filter(f=>f.type==="MATERIAL").filter(f=>Object.values(h?.edges??{}).find(b=>b.type==="CONSUMES"&&b.targetId===f.id))),p=i(u.state?.map(h=>h.materialId)??[]),y=a();return console.log(p,y),!u.state||!m.state||!p?e.jsx(e.Fragment,{children:"test"}):e.jsx(E,{role:"material-list",children:u.state?.sort((h,f)=>h.type.localeCompare(f.type)).map(h=>e.jsx(ze,{material:p[h.materialId],materialType:y[p[h.materialId].type]},h.id))})},Ue=()=>{const t=x("Layout"),{SettingsPanel:n,Accordion:o}=t.components;return e.jsxs(n,{children:[e.jsx(o,{name:"Composição",icon:e.jsx(fe,{}),summary:"composição da peça",children:e.jsx(Ne,{})}),e.jsx(o,{name:"Materiais",icon:e.jsx(je,{}),summary:"Lista de materiais necessários",children:e.jsx(We,{})}),e.jsx(o,{name:"Prazos",icon:e.jsx(K,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})}),e.jsx(o,{name:"Valores",icon:e.jsx(ge,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})})]})},Ke=R.memo(Ue),He=({graphId:t,node:n})=>{const{components:{MaterialSelector:o}}=x("Materials"),d=x("Graph"),{useGraph:l}=d.hooks,c=C({compositionName:t},s=>s),i=l(t,s=>s?.nodes[n.materialId]),a=j.useCallback(s=>c.actions.changeMaterial(n.id,s),[t,n.id]);return e.jsx(o,{type:n.materialType,value:i?.state?.materialId,onChange:a})},Qe=({node:t,graphId:n})=>{const o=x("Graph"),{components:{MaterialTypeSelector:d}}=x("Materials"),{useNodeInfo:l,useGraph:c,useSearch:i}=o.hooks,a=c(n,h=>h?.nodes[t.id]),s=j.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),r=i(n,s,()=>{t&&a.actions.search("bfs",t.id,(h,f)=>h.type!=="RESTRICTION"?!1:f.adjacencyList[h.id].inputs.some(P=>{const I=f.edges[P];return I.type==="RESTRICTED_BY"&&I.attr==="materialType"}),()=>!1,1,`Get all restriction associated with ${t.label}`,s)}),m=j.useMemo(()=>r?.findings.reduce((h,f)=>f.restrictionType==="allowOnly"?[...h,...f.operand]:h,[]),[r]),u=l(n,t.materialType),p=C({compositionName:n},h=>h),y=j.useCallback(h=>p.actions.changeMaterialType(t.id,h.target.value),[n,t.id]);return e.jsx(d,{filter:h=>r?.findings.length?m?.includes(h.name):!0,value:u.node?.id,onChange:y})},Ye=({graphId:t,nodeId:n})=>{const o=x("Graph"),{useNodeInfo:d}=o.hooks,{node:l}=d(t,n);return e.jsx(A,{role:"material-info",children:e.jsx(_,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(v,{children:l.label}),e.jsx(H,{})]}),secondary:e.jsx(v,{component:"div",children:e.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(g,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:l.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Qe,{graphId:t,node:l},c);case"materialId":return e.jsx(He,{graphId:t,node:l},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},Ze=({isOpen:t,labelState:[n,o],materialTypes:d,handleMaterialTypeChange:l})=>{const{components:{MaterialTypeSelector:c}}=x("Materials");return t?e.jsxs(g,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(c,{value:d,onChange:l,multiple:!0}),e.jsx(S,{id:"material-usage-name",label:"Nome",variant:"standard",value:n,onChange:i=>o(i.target.value)})]}):e.jsx(e.Fragment,{})},Je=({compositionName:t})=>{const n=x("Pointer"),{PointerContainer:o,ConfirmAndCloseButton:d}=n.components,l=C({compositionName:t},u=>u?.selectedPart),[c,i]=j.useState(""),[a,s]=j.useState([]),r=j.useCallback(()=>{l.state&&l.actions.addMaterialUsage(c,l.state,a)},[c]),m=j.useCallback(u=>s(p=>u.target.value),[t]);return e.jsx(o,{component:e.jsx(Ze,{materialTypes:a,handleMaterialTypeChange:m,labelState:[c,i]}),actions:[e.jsx(d,{color:"success",handleConfirm:r},"accept")],children:e.jsx(q,{startIcon:e.jsx(O,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},Xe=({compositionName:t,materialUsageId:n})=>{const o=C({compositionName:t},l=>l),d=j.useCallback(()=>{o.actions.removeMaterialUsage(n)},[o]);return e.jsx(w,{color:"error",id:"delete-material",onClick:d,sx:{flexGrow:2},children:e.jsx($,{})},"delete")},et=({compositionState:t,materialUsageId:n,isOpen:o})=>{const d=x("Graph"),l=x("Layout"),{useNodeInfo:c}=d.hooks,{CRUDGridContext:i}=l.contexts,{CRUDGrid:a,CRUDBooleanCell:s}=l.components,{node:r}=c(t.graphId,n),m=j.useMemo(()=>r.proxies.reduce((p,y)=>({...p,[y.elem]:{...p[y.elem],[y.attr]:!0}}),{}),[r]),{setRows:u}=j.useContext(i);return j.useEffect(()=>u(Object.entries(m).map(([p,y])=>({...y,elem:p,state:"untouched",id:k.uniqueId("proxy-")}))),[m]),o?e.jsxs(g,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(v,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(v,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(a,{addLabel:"Adicionar vínculo",newRecord:()=>({id:k.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:p})=>e.jsx(W,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(s,{...p})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:p})=>e.jsx(W,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(s,{...p})}]})]}):e.jsx(e.Fragment,{})},tt=R.memo(et),nt=({composition:t,materialUsageId:n,...o})=>{const d=x("Pointer"),l=x("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:a}=j.useContext(i),s=j.useCallback(()=>{a.filter(r=>r.state==="deleted").forEach(r=>t.actions.deleteProxy(r.elem,n)),a.filter(r=>r.state==="modified").forEach(r=>{t.actions.deleteProxy(r.old.elem,n),r.stroke&&t.actions.addProxy({elem:r.elem,attr:"stroke"},n),r.fill&&t.actions.addProxy({elem:r.elem,attr:"fill"},n)}),a.filter(r=>r.state==="added").forEach(r=>{t.actions.deleteProxy(r.elem,n),r.stroke&&t.actions.addProxy({elem:r.elem,attr:"stroke"},n),r.fill&&t.actions.addProxy({elem:r.elem,attr:"fill"},n)})},[a]);return e.jsx(c,{color:"success",...o,handleConfirm:s})},st=({compositionName:t,materialUsageId:n})=>{const o=C({compositionName:t},a=>a),d=x("Pointer"),l=x("Layout"),{PointerContainer:c}=d.components,{CRUDGridProvider:i}=l.components;return o.state?e.jsx(i,{initialRows:[],children:e.jsx(c,{component:e.jsx(tt,{compositionState:o.state,materialUsageId:n}),actions:[e.jsx(nt,{composition:o,materialUsageId:n},"accept")],children:e.jsx(w,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(be,{})},"configure")})}):e.jsx(e.Fragment,{})};function ot({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function at({row:t,...n}){const{components:{CRUDMaterialTypeCell:o}}=x("Materials");switch(t.attribute){case"materialType":return e.jsx(o,{row:t,value:t.operand,...n,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const rt=({compositionState:t,materialUsageId:n})=>{const o=x("Graph"),d=x("Layout"),{useGraph:l,useSearch:c}=o.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:a}=d.components,{state:s,actions:{search:r}}=l(t.graphId,h=>h?.nodes[n]),m=j.useMemo(()=>`${n}/restrictions`,[n]),u=c(t.graphId,m,()=>{s&&r("bfs",s.id,(h,f)=>h.type!=="RESTRICTION"?!1:f.adjacencyList[h.id].inputs.some(P=>f.edges[P].type==="RESTRICTED_BY"),()=>!1,1,`Get all restriction associated with ${s?.label??s.id}`,m)}),{setRows:p}=j.useContext(i);j.useEffect(()=>{u?.findings&&p(u.findings.map(h=>({...h,state:"untouched"})))},[u]),j.useEffect(()=>{u?.findings&&p(u.findings)},[]);const y=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:h})=>e.jsx(e.Fragment,{children:h})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:h})=>e.jsx(ot,{node:h}),renderEditCell:h=>e.jsx(at,{...h})}];return e.jsxs(g,{role:"restrictions-management-container",children:[e.jsx(v,{variant:"h4",children:"Restrições do material"}),e.jsxs(v,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(a,{addLabel:"Adicionar restrição",newRecord:()=>({id:k.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:y})]})},it=t=>t.isOpen?e.jsx(g,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(rt,{...t})}):e.jsx("div",{}),lt=({composition:t,materialUsageId:n,...o})=>{const d=x("Pointer"),l=x("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:a}=j.useContext(i),s=j.useCallback(()=>{console.group("delete"),a.filter(r=>r.state==="deleted").forEach(r=>t.actions.removeRestriction(n,r.id)),console.groupEnd(),console.group("modified"),a.filter(r=>r.state==="modified").forEach(r=>{t.actions.updateRestriction(n,r.id,r)}),console.groupEnd(),console.group("added"),a.filter(r=>r.state==="added").forEach(r=>{t.actions.addRestriction(n,{type:"RESTRICTION",id:r.id,label:r.label,operand:r.operand,position:r.position,restrictionType:r.restrictionType,attribute:r.attribute})}),console.groupEnd()},[a]);return e.jsx(c,{color:"success",...o,handleConfirm:s})},ct=({sx:t,materialUsageId:n,compositionName:o,...d})=>{const l=C({compositionName:o},r=>r),c=x("Pointer"),i=x("Layout"),{PointerContainer:a}=c.components,{CRUDGridProvider:s}=i.components;return l.state?e.jsx(s,{initialRows:[],children:e.jsx(a,{component:e.jsx(it,{compositionState:l.state,materialUsageId:n}),actions:[e.jsx(lt,{composition:l,materialUsageId:n},"accept")],children:e.jsx(w,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(ye,{})},"restrict")})}):e.jsx(e.Fragment,{})},dt=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(Xe,{...t}),e.jsx(st,{...t}),e.jsx(ct,{...t,sx:{hover:{fill:"yellow"}}})]});function Z({compositionName:t,selectedPart:n,graphId:o}){const d=x("Graph"),{useNodeInfo:l}=d.hooks,{edges:c}=l(o,n);return e.jsxs(E,{sx:{width:"100%"},role:"material-list",children:[e.jsx(Je,{compositionName:t}),Object.values(c).filter(i=>i.type==="MADE_OF").map(i=>e.jsxs(L,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(Ye,{graphId:o,nodeId:i.targetId}),e.jsx(dt,{compositionName:t,materialUsageId:i.targetId})]},i.targetId))]})}const ut=({graphId:t,nodeId:n})=>{const o=x("Graph"),d=x("Converter"),{useNodeInfo:l}=o.hooks,{useUnits:c}=d.hooks,{node:i}=l(t,n),a=c([i.cost.dividend.unit,i.cost.quotient.unit,i.time_taken.dividend.unit,i.time_taken.quotient.unit]);return a?e.jsx(A,{children:e.jsx(_,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(v,{children:i.label}),e.jsx(H,{})]}),secondary:e.jsx(v,{component:"div",sx:{padding:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(K,{})," ",i.time_taken.quotient.amount," ",a[i.time_taken.quotient.unit].abbreviation," /"," ",i.time_taken.dividend.amount," ",a[i.time_taken.dividend.unit].abbreviation]}),e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(ve,{})," ",i.cost.quotient.amount," ",a[i.cost.quotient.unit].abbreviation," /"," ",i.cost.dividend.amount," ",a[i.cost.dividend.unit].abbreviation]})]})})})}):e.jsx(e.Fragment,{})},pt=({compositionName:t})=>{const n=x("Pointer"),o=x("Converter"),{PointerContainer:d,ConfirmAndCloseButton:l}=n.components,{CompoundSelector:c}=o.components;o.hooks;const i=C({compositionName:t},u=>u?.selectedPart),a=j.useMemo(()=>k.uniqueId("new-process-form"),[]),[s,r]=j.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),m=j.useCallback(u=>{u.preventDefault(),u.stopPropagation(),i.state&&i.actions.addOperation(s.label,s.cost,s.time_taken,i.state)},[s]);return e.jsx(d,{component:e.jsxs(g,{component:"form",onSubmit:m,id:a,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(V,{children:e.jsx(S,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:u=>r(p=>({...p,label:u.target.value})),value:s.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",filterDividends:u=>u.abbreviation==="un",filterQuotients:(u,p)=>p?.name==="Temporal",value:s.time_taken,onChange:u=>r(p=>({...p,time_taken:u}))}),e.jsx(c,{id:"cost",label:"Custo",filterDividends:(u,p)=>u.abbreviation==="un"||p?.name=="Temporal",filterQuotients:(u,p)=>p?.name==="Monetaria",value:s.cost,onChange:u=>r(p=>({...p,cost:u}))})]}),actions:[e.jsx(l,{type:"submit",form:a,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(q,{startIcon:e.jsx(O,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},xt=({compositionName:t,processId:n})=>{const o=C({compositionName:t},l=>l),d=j.useCallback(()=>{o.actions.removeOperation(n)},[o]);return e.jsx(w,{color:"error",id:`delete-process-${n}`,onClick:d,sx:{flexGrow:2},children:e.jsx($,{})},"delete")},mt=({id:t,field:n,graphId:o,partId:d,value:l})=>{const c=x("Graph"),{useGraph:i}=c.hooks,a=Q(),s=p=>Object.values(p).filter(y=>y.type==="MADE_OF"&&y.sourceId===d),r=(p,y)=>Object.entries(p).reduce((h,[f,b])=>y.includes(f)?{...h,[f]:b}:h,{}),{state:m}=i(o,p=>p&&{edges:s(p.edges),nodes:r(p.nodes,s(p.edges).map(y=>y.targetId))}),u=j.useCallback(p=>{a.current.setEditCellValue({id:t,field:n,value:p.target.value})},[o,d]);return m?e.jsxs(V,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(Ce,{id:"label",children:"Material"}),e.jsx(we,{labelId:"label",id:"material-type",value:l??"",label:"Material",autoWidth:!0,onChange:u,children:m.edges.map(p=>e.jsx(Me,{value:p.targetId,children:m.nodes[p.targetId].label},p.id))})]}):e.jsx(e.Fragment,{})};function ht({row:t,id:n,field:o}){const d=Q(),l=x("Converter"),{components:{CompoundSelector:c}}=l,i=j.useCallback(a=>{d.current.setEditCellValue({id:n,field:o,value:a})},[n]);return e.jsx(c,{id:"quantity",filterQuotients:(a,s)=>s?.name==="Comprimento"||s?.name==="Volume"||s?.name==="Area",filterDividends:(a,s)=>a.abbreviation==="un"||a.abbreviation==="pedido",value:t.quantity,onChange:i})}const ft=({compositionState:t,processId:n})=>{const o=x("Graph"),d=x("Layout"),l=x("Converter"),{useGraph:c}=o.hooks,{CRUDGridContext:i}=d.contexts,{CRUDGrid:a}=d.components,{components:{CompoundUnit:s}}=l,r=f=>Object.values(f).filter(b=>b.type==="MADE_OF"&&b.sourceId===t.selectedPart),m=(f,b)=>Object.entries(f).reduce((G,[P,I])=>b.includes(P)?{...G,[P]:I}:G,{}),{state:u}=c(t.graphId,f=>f&&{edges:r(f.edges),nodes:m(f.nodes,r(f.edges).map(b=>b.targetId))}),{state:p}=c(t.graphId,f=>f?.edges&&Object.values(f.edges).filter(b=>b.type==="CONSUMES"&&b.sourceId===n)),{setRows:y}=j.useContext(i);if(j.useEffect(()=>{p?.length&&y(p.map(f=>({...f,state:"untouched"})))},p),!u)return e.jsx(e.Fragment,{});const h=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:f},value:b})=>e.jsx(e.Fragment,{children:u.nodes[f]?.label}),renderEditCell:({value:f,...b})=>e.jsx(mt,{value:f??b.row.targetId,partId:t.selectedPart,graphId:t.graphId,...b}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:f}})=>e.jsx(s,{value:f}),renderEditCell:f=>e.jsx(ht,{...f})}];return e.jsxs(g,{role:"material-usage-management-container",children:[e.jsx(v,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(v,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(a,{addLabel:"Víncular material",newRecord:()=>({id:k.uniqueId("material-usage-"),type:"CONSUMES",sourceId:n,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:h})]})},jt=t=>t.isOpen?e.jsx(g,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(ft,{...t})}):e.jsx("div",{}),gt=({composition:t,processId:n,...o})=>{const d=x("Pointer"),l=x("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:i}=l.contexts,{rows:a}=j.useContext(i),s=j.useCallback(()=>{a.filter(r=>r.state==="deleted").forEach(r=>{t.actions.deleteMaterialConsuption(r.id)}),a.filter(r=>r.state==="modified").forEach(({id:r,targetId:m,quantity:u})=>{t.actions.updateMaterialConsuption(r,{targetId:m,quantity:u})}),a.filter(r=>r.state==="added").forEach(r=>{t.actions.addMaterialConsuption(n,r.targetId,r.quantity)})},[a]);return e.jsx(c,{color:"success",...o,handleConfirm:s})},bt=({sx:t,compositionName:n,processId:o,...d})=>{const l=C({compositionName:n},r=>r),c=x("Pointer"),i=x("Layout"),{PointerContainer:a}=c.components,{CRUDGridProvider:s}=i.components;return l.state?e.jsx(s,{initialRows:[],children:e.jsx(a,{component:e.jsx(jt,{processId:o,compositionState:l.state}),actions:[e.jsx(gt,{composition:l,processId:o},"accept")],children:e.jsx(w,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(ke,{})},"configure")})}):e.jsx(e.Fragment,{})},yt=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(xt,{...t}),e.jsx(bt,{...t})]});function J({compositionName:t,selectedPart:n,graphId:o}){const d=x("Graph"),{useNodeInfo:l}=d.hooks,{edges:c}=l(o,n);return e.jsxs(E,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(pt,{compositionName:t}),Object.values(c).filter(i=>i.type==="PROCESS_NEEDED").map(i=>e.jsxs(L,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(ut,{graphId:o,nodeId:i.targetId}),e.jsx(yt,{compositionName:t,processId:i.targetId})]},i.targetId))]})}const vt=({compositionName:t,graphId:n})=>{const o=x("Pointer"),d=x("Graph"),{PointerContainer:l,ConfirmAndCloseButton:c}=o.components,{useGraph:i}=d.hooks,a=C({compositionName:t},h=>h?.selectedPart),s=i(n,h=>h?Object.values(h.nodes).filter(f=>f.type==="GRADE").map(f=>({...f,order:Object.values(h.edges).find(b=>b.targetId===f.id)?.order})):[]),r=j.useMemo(()=>s.state?F.max(s.state.filter(h=>k.isNumber(h?.order)).map(h=>h.order))??0:0,[s]),m=j.useMemo(()=>k.uniqueId("new-process-form"),[]),[u,p]=j.useState({abbreviation:""}),y=j.useCallback(h=>{h.preventDefault(),h.stopPropagation(),a.state&&a.actions.addGrade(u.abbreviation,r+1)},[u.label,u.abbreviation,r,a.state]);return e.jsx(l,{component:e.jsx(g,{component:"form",onSubmit:y,id:m,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:e.jsx(V,{children:e.jsx(S,{id:"abbreviation",label:"Abreviação",variant:"standard",sx:{marginBottom:1},onChange:h=>p(f=>({...f,abbreviation:h.target.value})),value:u.abbreviation})})}),actions:[e.jsx(c,{type:"submit",form:m,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(q,{startIcon:e.jsx(O,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar Grade"})})};function Ct({compositionName:t,graphId:n}){const o=x("Graph"),{useGraph:d}=o.hooks,l=d(n,a=>a?Object.values(a.nodes).filter(s=>s.type==="GRADE").map(s=>({...s,order:Object.values(a.edges).find(r=>r.targetId===s.id)?.order})).filter(s=>k.isNumber(s?.order)).sort((s,r)=>s?.order-r?.order):[]),c=C({compositionName:t},a=>a?.selectedPart),i=j.useCallback(a=>{c.actions.removeGrade(a)},[t]);return l.state?e.jsxs(E,{sx:{width:"100%"},role:"material-list",children:[e.jsx(vt,{graphId:n,compositionName:t}),l.state.map(a=>e.jsxs(L,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"grade-container",children:[e.jsx(A,{role:"grade-info",children:e.jsx(_,{disableTypography:!0,primary:e.jsx(v,{children:a.abbreviation})})}),e.jsx(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:e.jsx(w,{color:"error",id:"delete-material",onClick:()=>i(a.id),sx:{flexGrow:2},children:e.jsx($,{})},"delete")})]},a.id))]}):e.jsx(e.Fragment,{})}const wt=t=>{const n=x("Layout"),{Accordion:o}=n.components;return e.jsx(o,{name:"Graduação",icon:e.jsx(Ge,{}),summary:"Graduação da peça",sx:{flexGrow:1},children:e.jsx(Ct,{...t})})},Mt=({node:t,graphId:n,selectedPart:o,compositionName:d})=>{const l=x("Layout"),c=x("Markdown"),{components:{MarkdownReader:i}}=c,{DetailsPanel:a,Accordion:s,CustomTextArea:r,SystemModal:m}=l.components,[u,p]=j.useState({name:t.label??"Nova peça",description:t.description??""}),y=C({compositionName:d},f=>f),h=j.useCallback(()=>{y.actions.changeProperties(u.name,u.description)},[d,u.name,u.description]);return e.jsxs(a,{title:t.label,id:"gamerment-panel",children:[e.jsx(s,{name:"Propriedades",icon:e.jsx(Pe,{}),summary:"Propriedades da peça",sx:{flexGrow:1},children:e.jsxs(L,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"garment-properties",id:"garment-properties",children:[e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:1},children:[e.jsx(S,{id:"garment-name",label:"Nome",variant:"standard",sx:{width:"100%"},value:u?.name,onChange:f=>p(b=>b&&{...b,name:f.target.value})}),e.jsx(r,{id:"description",wrapperProps:{sx:{width:"100%"}},minRows:3,name:"Outlined",placeholder:"Descrição",color:"neutral",value:u.description,onChange:f=>{f.preventDefault(),f.stopPropagation(),p(b=>b&&{...b,description:f.target.value})}},"description")]}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(w,{color:"success",id:"save-properties",onClick:f=>h(),children:e.jsx(Se,{})},"save"),e.jsx(m,{component:e.jsx(i,{content:u.description}),button:e.jsx(w,{color:"warning",id:"preview-description",children:e.jsx(Ie,{})},"preview")}),e.jsx(w,{color:"info",id:"reset-properties",onClick:f=>p({name:t.label,description:t.description}),children:e.jsx(De,{})},"reset")]})]},"garment-properties")}),e.jsx(wt,{graphId:n,compositionName:d,selectedPart:o}),e.jsx(s,{name:"Materiais",icon:e.jsx(T,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Z,{graphId:n,selectedPart:o,compositionName:d})}),e.jsx(s,{name:"Processos",icon:e.jsx(T,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(J,{graphId:n,selectedPart:o,compositionName:d})})]},"garment-panel")},kt=()=>{const t=x("Layout"),n=x("Store"),{useAppSelector:o}=n.hooks,{selectActiveViewport:d}=t.store.selectors,l=o(d),c=j.useCallback(a=>({name:a?.name,graphId:a?.graphId,selectedPart:a?.selectedPart}),[]),i=C({viewportName:l},c);return!i.state?.selectedPart||!i.state?.graphId||!i.state?.name?null:e.jsx(Gt,{graphId:i.state.graphId,selectedPart:i.state.selectedPart,compositionName:i.state.name})},Gt=({graphId:t,selectedPart:n,compositionName:o})=>{const d=x("Layout"),l=x("Graph"),{DetailsPanel:c,Accordion:i}=d.components,{useGraph:a}=l.hooks,s=a(t,r=>r?.nodes[n]);return s.state?.type==="GARMENT"?e.jsx(Mt,{node:s.state,graphId:t,compositionName:o,selectedPart:n}):e.jsxs(c,{title:s.state?.label??n,children:[e.jsx(i,{name:"Opcionais",icon:e.jsx(T,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(i,{name:"Materiais",icon:e.jsx(T,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Z,{graphId:t,selectedPart:n,compositionName:o})}),e.jsx(i,{name:"Processos",icon:e.jsx(T,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(J,{graphId:t,selectedPart:n,compositionName:o})})]})},Pt=R.memo(kt);function St({compositionName:t,graphId:n}){const o=U(),d=x("Graph"),{useGraph:l}=d.hooks,c=C({compositionName:t},m=>m?.budget?.grades),i=l(n,m=>Object.values(m?.nodes??{}).filter(u=>u.type==="GRADE").reduce((u,p)=>(u[p.id]=p,u),{})),a=j.useMemo(()=>!c.state||!i?.state?[]:Object.entries(c.state).map(([m,u])=>i?.state?{id:m,counter:u,abbreviation:i.state[m].abbreviation}:{id:m,counter:u,abbreviation:m}),[c.state,i.state]),s=j.useMemo(()=>a.reduce((m,u)=>m+u.counter,0),[a]),r=j.useCallback((m,u)=>{c.actions.changeGradeCounter(m,u)},[t]);return!c.state||!i.state?e.jsx(e.Fragment,{}):e.jsxs(g,{sx:{width:"min-content",display:"flex",flexFlow:"column",backgroundColor:o.palette.background.paper,opacity:"0.9",borderRadius:2,pointerEvents:"all",border:`1px solid ${o.palette.getContrastText(o.palette.background.paper)}`},role:"grades-counter",children:[a.map(m=>e.jsx(g,{sx:{padding:1},children:e.jsx(S,{id:m.id,label:m.abbreviation,variant:"standard",value:m.counter,sx:{width:"40px"},type:"number",onChange:u=>r(m.id,+u.target.value)})},m.id)),e.jsx(g,{sx:{padding:1},children:e.jsx(S,{id:"total",label:"Total",variant:"standard",value:s,sx:{width:"40px"},disabled:!0})},"total")]})}const Ot=()=>{const t=x("Store"),n=x("Layout"),{useAppSelector:o}=t.hooks,{selectActiveViewport:d}=n.store.selectors,l=o(d),c=j.useCallback(a=>a,[l]),i=C({viewportName:l},c);return!l||!i.state?null:e.jsx(It,{selectPart:i.actions.selectPart,compositionInfo:i.state})},It=({compositionInfo:t,selectPart:n})=>{const{components:{SVGViewer:o},hooks:{useSVG:d}}=x("SVG"),{components:{MultiTouchPanel:l}}=x("Pointer"),{hooks:{useGraph:c}}=x("Graph"),i=x("Layout"),a=x("Orders"),{BudgetFloatingButton:s}=a.components,{ViewportNotificationsTray:r}=i.components,{graphId:m,svgPath:u,name:p,viewportName:y,budget:h}=t,f=N(),b=c(m,M=>M?.nodes),G=d(u,M=>M?.instances[p]),P=j.useMemo(()=>h?["convert-to-order","delete-budget"]:["create-budget","add-to-budget"],[h]),I=j.useCallback(M=>{b.state&&Object.values(b.state).filter(D=>D.type==="PART").forEach(D=>{if(D.domId){const[ee]=[...M?.querySelectorAll(`#${D.domId}`)];ee.addEventListener("click",te=>{te.stopPropagation(),n(D.id)})}})},[m]),X=j.useCallback(()=>{f.functions.createDebugView(p,y)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(g,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(l,{gestures:{onPinch:M=>{G.actions.setZoom(p,M.offset[0])},onWheel:M=>{const D=G.state?.zoom??1;G.actions.setZoom(p,D+M.delta[1]*.001)}},children:e.jsx(o,{instanceName:p,path:u,beforeInjection:I})}),e.jsx(r,{children:e.jsx(Te,{fontSize:"small",onClick:X,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(Ke,{}),e.jsx(Pt,{})]}),e.jsxs(g,{sx:{position:"absolute",display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",gap:1,padding:1,alignItems:"end",bottom:10,width:"100%",pointerEvents:"none"},children:[e.jsx(s,{allowedActions:P}),h&&e.jsx(St,{compositionName:p,graphId:m})]})]})},Dt=({instanceName:t,path:n,...o})=>{const d=x("SVG"),{components:{SVGViewer:l},hooks:{useSVGManager:c}}=d,i=c();return j.useLayoutEffect(()=>{i.functions.loadSVG(n,`${t}-preview`)},[]),e.jsx(l,{...o,instanceName:`${t}-preview`,path:n})},Tt=Re(g)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Rt=({closeModal:t,onModelSelection:n})=>{const o=x("Markdown"),{components:{MarkdownReader:d}}=o,l=Ae(),[c,i]=j.useState(void 0);return e.jsx(L,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",p:2},children:e.jsxs(Tt,{role:"model-selector-container",sx:{gap:1},children:[e.jsx(E,{role:"list-options",sx:{paddingRight:5,overflow:"auto"},children:l.map(a=>e.jsx(A,{disableGutters:!0,children:e.jsx(_,{primary:a.name,secondary:null,id:a.name,color:c?.name===a.name?"primary":"secondary",onClick:()=>i({name:a.name,path:a.svgPath,descriptionPath:a.descriptionPath}),sx:{cursor:"pointer",flexGrow:1}})},k.uniqueId()))}),e.jsxs(g,{sx:{overflow:"auto",width:"100%"},children:[c?e.jsx(Dt,{instanceName:c.name,path:c.path,sx:{gridArea:"preview",p:1}}):e.jsx(g,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),c?.descriptionPath&&e.jsx(g,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(d,{path:c.descriptionPath})})]}),e.jsx(g,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(q,{disabled:!c,variant:"contained",onClick:()=>{c&&(n(c.name,c.path),t?.())},children:"Selecionar"})})]})})},$t=()=>{const t=N(),n=x("Layout"),{SystemModal:o}=n.components,d=j.useCallback((l,c)=>{t.functions.createComposition(l,c)},[]);return e.jsx(o,{component:e.jsx(Rt,{onModelSelection:d}),button:e.jsx(w,{children:e.jsx(Ee,{})})})},Et=({name:t})=>{const n=x("Graph"),o=x("Layout"),{ViewportNotificationsTray:d,DetailsPanel:l,SettingsPanel:c,Accordion:i}=o.components,{components:{GraphViewer:a}}=n,s=N(),r=j.useMemo(()=>s.functions.findComposition(m=>m.debugViewport===t),[t]);return e.jsxs(g,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[r&&e.jsx(a,{graphId:r?.graphId}),e.jsx(d,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(i,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(l,{children:e.jsx(e.Fragment,{})})]})},_t=R.memo(Et);export{Ot as C,_t as D,$t as M};
