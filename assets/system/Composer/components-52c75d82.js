import{r as x,o as e,B as C,ap as R,aq as Z,I as P,ar as J,$ as A,as as D,H as K,at as X,au as F,av as ee,R as S,aw as te,ax as ne,ay as se,az as oe,S as L,aA as ae,aB as re,aC as ie,aD as B,aE as _,aF as z,T as w,aG as V,Z as T,_ as I,a3 as O,aH as le,aI as ce,aJ as U,P as E,aK as de,aL as W,a2 as N,aM as ue,aN as me,aO as H,y as pe,aP as G,aQ as xe,aR as he,aS as fe,aT as je,aU as ge,aV as Ce,aW as ye,aX as be}from"../../vendor-8069b187.js";import{n as u}from"../../kernel-17e84a6e.js";import{u as M,a as $}from"./hooks-4df9b167.js";const ve=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:i}=n.components,o=M(t,r=>r?.selectedPart),[c,d]=x.useState({name:"",domId:""}),l=x.useCallback(()=>{o.actions.addPart(c.name,c.domId,o.state)},[c]);return e.jsx(a,{component:e.jsxs(C,{sx:{width:200},children:[e.jsx(R,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:r=>d(s=>({...s,name:r.target.value}))}),e.jsx(R,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:r=>d(s=>({...s,domId:r.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(Z,{position:"end",children:e.jsx(P,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(J,{})})})}})]}),actions:[e.jsx(i,{handleConfirm:l},"confirm")],children:e.jsx(P,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:r=>{r.stopPropagation()},children:e.jsx(A,{})})})},Me=({compositionName:t})=>{const n=M(t,i=>i?.selectedPart),a=x.useCallback(i=>{n.state&&n.actions.removePart(n.state),i.stopPropagation()},[n]);return e.jsx(P,{"aria-label":"Delete part",id:`delete-part-${n.state}`,role:"delete-part-button",size:"small",sx:{},onClick:a,children:e.jsx(D,{})})};function we(t){return e.jsx(L,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function Pe(t){return e.jsx(L,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function ke(t){return e.jsx(L,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Se(t){const n=te({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(ne.div,{style:n,children:e.jsx(se,{...t})})}const Ie=K(t=>e.jsx(X,{...t,TransitionComponent:Se}))(({theme:t})=>({[`& .${F.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${F.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${ee(t.palette.text.primary,.4)}`}}));function Re({compositionName:t,graphId:n,selectedPart:a,selectPart:i,nodeId:o}){const c=u("Graph"),{useGraph:d}=c.hooks,l=d(n,r=>r&&r.adjacencyList[o]&&{node:r.nodes[o],edges:r.edges?Object.values(r.edges).reduce((s,m)=>r.adjacencyList[o].outputs.includes(m.id)?{...s,[m.id]:m}:s,{}):{},connections:r.adjacencyList[o]});return l.state?e.jsx(C,{sx:{color:"text.primary"},children:e.jsx(Ie,{nodeId:o,label:e.jsxs(C,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:r=>{o!==a&&(i(o),r.stopPropagation())},children:[l.state.node.label,o===a&&e.jsxs(e.Fragment,{children:[e.jsx(ve,{compositionName:t}),e.jsx(Me,{compositionName:t})]})]}),onClick:()=>{i(o)},sx:{color:o===a?"secondary.main":"secondary.secondary"},children:l.state.connections.outputs.filter(r=>l.state?.edges[r].type==="COMPOSED_OF").map(r=>l.state&&e.jsx(Q,{compositionName:t,graphId:n,selectPart:i,selectedPart:a,nodeId:l.state.edges[r].targetId},`${o}-${l.state?.edges[r].targetId}`))})}):e.jsx(e.Fragment,{})}const Q=S.memo(Re);function Te(){const t=u("Store"),n=u("Layout"),a=u("Graph"),{useAppSelector:i}=t.hooks,{useGraph:o}=a.hooks,{selectActiveViewport:c}=n.store.selectors,d=i(c),l=x.useCallback(m=>({name:m?.name,svgPath:m?.svgPath,graphId:m?.graphId,selectedPart:m?.selectedPart}),[]),r=M(d,l),s=o(d,m=>m?.adjacencyList);return!r.state?.svgPath||!r.state?.graphId||!r.state?.name||!s?null:e.jsx(oe,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(we,{}),defaultExpandIcon:e.jsx(Pe,{}),defaultEndIcon:e.jsx(ke,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(Q,{compositionName:r.state.name,nodeId:"garment",graphId:r.state.graphId,selectPart:r.actions.selectPart,selectedPart:r.state.selectedPart})})}const Ee=()=>{const t=u("Layout"),{SettingsPanel:n,Accordion:a}=t.components;return e.jsxs(n,{children:[e.jsx(a,{name:"Composição",icon:e.jsx(ae,{}),summary:"composição da peça",children:e.jsx(Te,{})}),e.jsx(a,{name:"Sumário",icon:e.jsx(re,{}),summary:"Resumo da peça",children:e.jsx(e.Fragment,{})}),e.jsx(a,{name:"Valores",icon:e.jsx(ie,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})}),e.jsx(a,{name:"Prazos",icon:e.jsx(B,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})})]})},Ge=S.memo(Ee),qe=({graphId:t,node:n})=>{const{components:{MaterialSelector:a}}=u("Materials"),i=u("Graph"),{useGraph:o}=i.hooks,c=M(t,r=>r),d=o(t,r=>r?.nodes[n.materialId]),l=x.useCallback(r=>c.actions.changeMaterial(n.id,r),[t,n.id]);return e.jsx(a,{type:n.materialType,value:d?.state?.materialId,onChange:l})},Ae=({node:t,graphId:n})=>{const a=u("Graph"),{components:{MaterialTypeSelector:i}}=u("Materials"),{useNodeInfo:o,useGraph:c,useSearch:d}=a.hooks,l=c(n,h=>h?.nodes[t.id]),r=x.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),s=d(n,r,()=>{t&&l.actions.search("bfs",t.id,(h,f)=>h.type!=="RESTRICTION"?!1:f.adjacencyList[h.id].inputs.some(v=>{const k=f.edges[v];return k.type==="RESTRICTED_BY"&&k.attr==="materialType"}),()=>!1,1,`Get all restriction associated with ${t.label}`,r)}),m=x.useMemo(()=>s?.findings.reduce((h,f)=>f.restrictionType==="allowOnly"?[...h,...f.operand]:h,[]),[s]),g=o(n,t.materialType),p=M(n,h=>h),j=x.useCallback(h=>p.actions.changeMaterialType(t.id,h.target.value),[n,t.id]);return e.jsx(i,{filter:h=>s?.findings.length?m?.includes(h.name):!0,value:g.node?.id,onChange:j})},De=({graphId:t,nodeId:n})=>{const a=u("Graph"),{useNodeInfo:i}=a.hooks,{node:o}=i(t,n);return e.jsx(_,{role:"material-info",children:e.jsx(z,{disableTypography:!0,primary:e.jsxs(C,{sx:{marginBottom:1},children:[e.jsx(w,{children:o.label}),e.jsx(V,{})]}),secondary:e.jsx(w,{component:"div",children:e.jsx(C,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(C,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:o.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Ae,{graphId:t,node:o},c);case"materialId":return e.jsx(qe,{graphId:t,node:o},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},Le=({isOpen:t,labelState:[n,a],materialTypes:i,handleMaterialTypeChange:o})=>{const{components:{MaterialTypeSelector:c}}=u("Materials");return t?e.jsxs(C,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(c,{value:i,onChange:o,multiple:!0}),e.jsx(R,{id:"material-usage-name",label:"Nome",variant:"standard",value:n,onChange:d=>a(d.target.value)})]}):e.jsx(e.Fragment,{})},$e=({compositionName:t})=>{const n=u("Pointer"),{PointerContainer:a,ConfirmAndCloseButton:i}=n.components,o=M(t,g=>g?.selectedPart),[c,d]=x.useState(""),[l,r]=x.useState([]),s=x.useCallback(()=>{o.state&&o.actions.addMaterialUsage(c,o.state,l)},[c]),m=x.useCallback(g=>r(p=>g.target.value),[t]);return e.jsx(a,{component:e.jsx(Le,{materialTypes:l,handleMaterialTypeChange:m,labelState:[c,d]}),actions:[e.jsx(i,{color:"success",handleConfirm:s},"accept")],children:e.jsx(T,{startIcon:e.jsx(A,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},Fe=({compositionName:t,materialUsageId:n})=>{const a=M(t,o=>o),i=x.useCallback(()=>{a.actions.removeMaterialUsage(n)},[a]);return e.jsx(P,{color:"error",id:"delete-material",onClick:i,sx:{flexGrow:2},children:e.jsx(D,{})},"delete")},Oe=({compositionState:t,materialUsageId:n,isOpen:a})=>{const i=u("Graph"),o=u("Layout"),{useNodeInfo:c}=i.hooks,{CRUDGridContext:d}=o.contexts,{CRUDGrid:l,CRUDBooleanCell:r}=o.components,{node:s}=c(t.graphId,n),m=x.useMemo(()=>s.proxies.reduce((p,j)=>({...p,[j.elem]:{...p[j.elem],[j.attr]:!0}}),{}),[s]),{setRows:g}=x.useContext(d);return x.useEffect(()=>g(Object.entries(m).map(([p,j])=>({...j,elem:p,state:"untouched",id:I.uniqueId("proxy-")}))),[m]),a?e.jsxs(C,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(w,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(l,{addLabel:"Adicionar vínculo",newRecord:()=>({id:I.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:p})=>e.jsx(O,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(r,{...p})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:p})=>e.jsx(O,{checked:p,disabled:!0}),renderEditCell:p=>e.jsx(r,{...p})}]})]}):e.jsx(e.Fragment,{})},Be=S.memo(Oe),_e=({composition:t,materialUsageId:n,...a})=>{const i=u("Pointer"),o=u("Layout"),{ConfirmAndCloseButton:c}=i.components,{CRUDGridContext:d}=o.contexts,{rows:l}=x.useContext(d),r=x.useCallback(()=>{l.filter(s=>s.state==="deleted").forEach(s=>t.actions.deleteProxy(s.elem,n)),l.filter(s=>s.state==="modified").forEach(s=>{t.actions.deleteProxy(s.old.elem,n),s.stroke&&t.actions.addProxy({elem:s.elem,attr:"stroke"},n),s.fill&&t.actions.addProxy({elem:s.elem,attr:"fill"},n)}),l.filter(s=>s.state==="added").forEach(s=>{t.actions.deleteProxy(s.elem,n),s.stroke&&t.actions.addProxy({elem:s.elem,attr:"stroke"},n),s.fill&&t.actions.addProxy({elem:s.elem,attr:"fill"},n)})},[l]);return e.jsx(c,{color:"success",...a,handleConfirm:r})},ze=({compositionName:t,materialUsageId:n})=>{const a=M(t,l=>l),i=u("Pointer"),o=u("Layout"),{PointerContainer:c}=i.components,{CRUDGridProvider:d}=o.components;return a.state?e.jsx(d,{initialRows:[],children:e.jsx(c,{component:e.jsx(Be,{compositionState:a.state,materialUsageId:n}),actions:[e.jsx(_e,{composition:a,materialUsageId:n},"accept")],children:e.jsx(P,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(le,{})},"configure")})}):e.jsx(e.Fragment,{})};function Ve({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function Ue({row:t,...n}){const{components:{CRUDMaterialTypeCell:a}}=u("Materials");switch(t.attribute){case"materialType":return e.jsx(a,{row:t,value:t.operand,...n,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const We=({compositionState:t,materialUsageId:n})=>{const a=u("Graph"),i=u("Layout"),{useGraph:o,useSearch:c}=a.hooks,{CRUDGridContext:d}=i.contexts,{CRUDGrid:l}=i.components,{state:r,actions:{search:s}}=o(t.graphId,h=>h?.nodes[n]),m=x.useMemo(()=>`${n}/restrictions`,[n]),g=c(t.graphId,m,()=>{r&&s("bfs",r.id,(h,f)=>h.type!=="RESTRICTION"?!1:f.adjacencyList[h.id].inputs.some(v=>f.edges[v].type==="RESTRICTED_BY"),()=>!1,1,`Get all restriction associated with ${"label"in r?r.label:r.id}`,m)}),{setRows:p}=x.useContext(d);x.useEffect(()=>{g?.findings&&p(g.findings.map(h=>({...h,state:"untouched"})))},[g]),x.useEffect(()=>{g?.findings&&p(g.findings)},[]);const j=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:h})=>e.jsx(e.Fragment,{children:h})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:h})=>e.jsx(Ve,{node:h}),renderEditCell:h=>e.jsx(Ue,{...h})}];return e.jsxs(C,{role:"restrictions-management-container",children:[e.jsx(w,{variant:"h4",children:"Restrições do material"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(l,{addLabel:"Adicionar restrição",newRecord:()=>({id:I.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:j})]})},Ne=t=>t.isOpen?e.jsx(C,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(We,{...t})}):e.jsx("div",{}),He=({composition:t,materialUsageId:n,...a})=>{const i=u("Pointer"),o=u("Layout"),{ConfirmAndCloseButton:c}=i.components,{CRUDGridContext:d}=o.contexts,{rows:l}=x.useContext(d),r=x.useCallback(()=>{console.group("delete"),l.filter(s=>s.state==="deleted").forEach(s=>t.actions.removeRestriction(n,s.id)),console.groupEnd(),console.group("modified"),l.filter(s=>s.state==="modified").forEach(s=>{t.actions.updateRestriction(n,s.id,s)}),console.groupEnd(),console.group("added"),l.filter(s=>s.state==="added").forEach(s=>{t.actions.addRestriction(n,{type:"RESTRICTION",id:s.id,label:s.label,operand:s.operand,position:s.position,restrictionType:s.restrictionType,attribute:s.attribute})}),console.groupEnd()},[l]);return e.jsx(c,{color:"success",...a,handleConfirm:r})},Qe=({sx:t,materialUsageId:n,compositionName:a,...i})=>{const o=M(a,s=>s),c=u("Pointer"),d=u("Layout"),{PointerContainer:l}=c.components,{CRUDGridProvider:r}=d.components;return o.state?e.jsx(r,{initialRows:[],children:e.jsx(l,{component:e.jsx(Ne,{compositionState:o.state,materialUsageId:n}),actions:[e.jsx(He,{composition:o,materialUsageId:n},"accept")],children:e.jsx(P,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(ce,{})},"restrict")})}):e.jsx(e.Fragment,{})},Ye=t=>e.jsxs(C,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(Fe,{...t}),e.jsx(ze,{...t}),e.jsx(Qe,{...t,sx:{hover:{fill:"yellow"}}})]});function Ze({compositionName:t,selectedPart:n,graphId:a}){const i=u("Graph"),{useNodeInfo:o}=i.hooks,{edges:c}=o(a,n);return e.jsxs(U,{sx:{width:"100%"},role:"material-list",children:[e.jsx($e,{compositionName:t}),Object.values(c).filter(d=>d.type==="MADE_OF").map(d=>e.jsxs(E,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(De,{graphId:a,nodeId:d.targetId}),e.jsx(Ye,{compositionName:t,materialUsageId:d.targetId})]},d.targetId))]})}const Je=({graphId:t,nodeId:n})=>{const a=u("Graph"),{useNodeInfo:i}=a.hooks,{node:o}=i(t,n);return e.jsx(_,{children:e.jsx(z,{disableTypography:!0,primary:e.jsxs(C,{sx:{marginBottom:1},children:[e.jsx(w,{children:o.label}),e.jsx(V,{})]}),secondary:e.jsx(w,{component:"div",sx:{padding:1},children:e.jsxs(C,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(C,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(B,{})," ",o.time_taken.quotient.amount," ",o.time_taken.quotient.unit," /"," ",o.time_taken.dividend.amount," ",o.time_taken.dividend.unit]}),e.jsxs(C,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(de,{})," ",o.cost.quotient.amount," ",o.cost.quotient.unit," / ",o.cost.dividend.amount," ",o.cost.dividend.unit]})]})})})})},Ke=({compositionName:t})=>{const n=u("Pointer"),a=u("Converter"),{PointerContainer:i,ConfirmAndCloseButton:o}=n.components,{CompoundSelector:c}=a.components,{useScales:d}=a.hooks,l=d(),r=M(t,j=>j?.selectedPart),s=x.useMemo(()=>I.uniqueId("new-process-form"),[]),[m,g]=x.useState({label:"",cost:{quotient:{amount:1,unit:"R$"},dividend:{amount:1,unit:"un"}},time_taken:{quotient:{amount:1,unit:"m"},dividend:{amount:1,unit:"un"}}}),p=x.useCallback(j=>{j.preventDefault(),j.stopPropagation(),r.state&&r.actions.addOperation(m.label,m.cost,m.time_taken,r.state)},[m]);return e.jsx(i,{component:e.jsxs(C,{component:"form",onSubmit:p,id:s,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(W,{children:e.jsx(R,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:j=>g(h=>({...h,label:j.target.value})),value:m.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",quotientUnitsAvailable:()=>l.time,dividendUnitsAvailable:()=>[{value:"un",label:"Un"}],value:m.time_taken,onChange:j=>g(h=>({...h,time_taken:j}))}),e.jsx(c,{id:"cost",label:"Custo",quotientUnitsAvailable:()=>[{value:"R$",label:"R$"},{value:"$",label:"USD"}],dividendUnitsAvailable:()=>[{value:"un",label:"Un"}],value:m.cost,onChange:j=>g(h=>({...h,cost:j}))})]}),actions:[e.jsx(o,{type:"submit",form:s,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(T,{startIcon:e.jsx(A,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},Xe=({compositionName:t,processId:n})=>{const a=M(t,o=>o),i=x.useCallback(()=>{a.actions.removeOperation(n)},[a]);return e.jsx(P,{color:"error",id:`delete-process-${n}`,onClick:i,sx:{flexGrow:2},children:e.jsx(D,{})},"delete")},et=({id:t,field:n,graphId:a,partId:i,value:o})=>{const c=u("Graph"),{useGraph:d}=c.hooks,l=N(),r=p=>Object.values(p).filter(j=>j.type==="MADE_OF"&&j.sourceId===i),s=(p,j)=>Object.entries(p).reduce((h,[f,y])=>j.includes(f)?{...h,[f]:y}:h,{}),{state:m}=d(a,p=>p&&{edges:r(p.edges),nodes:s(p.nodes,r(p.edges).map(j=>j.targetId))}),g=x.useCallback(p=>{l.current.setEditCellValue({id:t,field:n,value:p.target.value})},[a,i]);return m?e.jsxs(W,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(ue,{id:"label",children:"Material"}),e.jsx(me,{labelId:"label",id:"material-type",value:o??"",label:"Material",autoWidth:!0,onChange:g,children:m.edges.map(p=>e.jsx(H,{value:p.targetId,children:m.nodes[p.targetId].label},p.id))})]}):e.jsx(e.Fragment,{})};function tt({row:t,id:n,field:a}){const i=N(),o=u("Converter"),{components:{CompoundSelector:c}}=o,d=x.useCallback(l=>{i.current.setEditCellValue({id:n,field:a,value:l})},[n]);return e.jsx(c,{id:"quantity",quotientUnitsAvailable:()=>[{value:"cm",label:"cm"},{value:"m",label:"m"},{value:"cm2",label:"cm²"},{value:"m2",label:"m²"},{value:"cm3",label:"cm³"},{value:"m3",label:"m³"},{value:"ml",label:"ml"},{value:"l",label:"l"}],dividendUnitsAvailable:()=>[{value:"un",label:"Un"}],value:t.quantity,onChange:d})}const nt=({compositionState:t,processId:n})=>{const a=u("Graph"),i=u("Layout"),o=u("Converter"),{useGraph:c}=a.hooks,{CRUDGridContext:d}=i.contexts,{CRUDGrid:l}=i.components,{components:{CompoundUnit:r}}=o,s=f=>Object.values(f).filter(y=>y.type==="MADE_OF"&&y.sourceId===t.selectedPart),m=(f,y)=>Object.entries(f).reduce((b,[v,k])=>y.includes(v)?{...b,[v]:k}:b,{}),{state:g}=c(t.graphId,f=>f&&{edges:s(f.edges),nodes:m(f.nodes,s(f.edges).map(y=>y.targetId))}),{state:p}=c(t.graphId,f=>f?.edges&&Object.values(f.edges).filter(y=>y.type==="CONSUMES"&&y.sourceId===n)),{setRows:j}=x.useContext(d);if(x.useEffect(()=>{p?.length&&j(p.map(f=>({...f,state:"untouched"})))},p),!g)return e.jsx(e.Fragment,{});const h=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:f},value:y})=>e.jsx(e.Fragment,{children:g.nodes[f]?.label}),renderEditCell:({value:f,...y})=>e.jsx(et,{value:f??y.row.targetId,partId:t.selectedPart,graphId:t.graphId,...y}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:400,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:f}})=>e.jsx(r,{value:f}),renderEditCell:f=>e.jsx(tt,{...f})}];return e.jsxs(C,{role:"material-usage-management-container",children:[e.jsx(w,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(w,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(l,{addLabel:"Víncular material",newRecord:()=>({id:I.uniqueId("material-usage-"),type:"CONSUMES",sourceId:n,targedId:"",quantity:{quotient:{amount:1,unit:"cm2"},dividend:{amount:1,unit:"un"}}}),columns:h})]})},st=t=>t.isOpen?e.jsx(C,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(nt,{...t})}):e.jsx("div",{}),ot=({composition:t,processId:n,...a})=>{const i=u("Pointer"),o=u("Layout"),{ConfirmAndCloseButton:c}=i.components,{CRUDGridContext:d}=o.contexts,{rows:l}=x.useContext(d),r=x.useCallback(()=>{l.filter(s=>s.state==="deleted").forEach(s=>{t.actions.deleteMaterialConsuption(s.id)}),l.filter(s=>s.state==="modified").forEach(({id:s,targetId:m,quantity:g})=>{t.actions.updateMaterialConsuption(s,{targetId:m,quantity:g})}),l.filter(s=>s.state==="added").forEach(s=>{t.actions.addMaterialConsuption(n,s.targetId,s.quantity)})},[l]);return e.jsx(c,{color:"success",...a,handleConfirm:r})},at=({sx:t,compositionName:n,processId:a,...i})=>{const o=M(n,s=>s),c=u("Pointer"),d=u("Layout"),{PointerContainer:l}=c.components,{CRUDGridProvider:r}=d.components;return o.state?e.jsx(r,{initialRows:[],children:e.jsx(l,{component:e.jsx(st,{processId:a,compositionState:o.state}),actions:[e.jsx(ot,{composition:o,processId:a},"accept")],children:e.jsx(P,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(pe,{})},"configure")})}):e.jsx(e.Fragment,{})},rt=t=>e.jsxs(C,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(Xe,{...t}),e.jsx(at,{...t})]});function it({compositionName:t,selectedPart:n,graphId:a}){const i=u("Graph"),{useNodeInfo:o}=i.hooks,{edges:c}=o(a,n);return e.jsxs(U,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(Ke,{compositionName:t}),Object.values(c).filter(d=>d.type==="PROCESS_NEEDED").map(d=>e.jsxs(E,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(Je,{graphId:a,nodeId:d.targetId}),e.jsx(rt,{compositionName:t,processId:d.targetId})]},d.targetId))]})}const lt=({graphId:t})=>{const n=u("Layout"),a=u("Store"),{useAppSelector:i}=a.hooks,{selectActiveViewport:o}=n.store.selectors,c=i(o),d=x.useCallback(r=>({name:r?.name,graphId:r?.graphId,selectedPart:r?.selectedPart}),[]),l=M(c,d);return!l.state?.selectedPart||!l.state?.graphId||!l.state?.name?null:e.jsx(ct,{graphId:l.state.graphId,selectedPart:l.state.selectedPart,compositionName:l.state.name})},ct=({graphId:t,selectedPart:n,compositionName:a})=>{const i=u("Layout"),o=u("Graph"),{DetailsPanel:c,Accordion:d}=i.components,{useGraph:l}=o.hooks,r=l(t,s=>s?.nodes[n]);return e.jsxs(c,{title:r.state?.label??n,children:[e.jsx(d,{name:"Opcionais",icon:e.jsx(G,{}),summary:"Lista de opcionais",sx:{flexGrow:1}}),e.jsx(d,{name:"Materiais",icon:e.jsx(G,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Ze,{graphId:t,selectedPart:n,compositionName:a})}),e.jsx(d,{name:"Processos",icon:e.jsx(G,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(it,{graphId:t,selectedPart:n,compositionName:a})})]})},dt=S.memo(lt),q=["Adicionar ao orçamento","Criar orçamento"];function ut(){const[t,n]=x.useState(!1),a=x.useRef(null),[i,o]=x.useState(1),c=()=>{console.info(`You clicked ${q[i]}`)},d=(s,m)=>{o(m),n(!1)},l=()=>{n(s=>!s)},r=s=>{a.current&&a.current.contains(s.target)||n(!1)};return e.jsxs(x.Fragment,{children:[e.jsxs(xe,{variant:"contained",ref:a,"aria-label":"split button",children:[e.jsx(T,{onClick:c,children:q[i]}),e.jsx(T,{size:"small","aria-controls":t?"split-button-menu":void 0,"aria-expanded":t?"true":void 0,"aria-label":"select merge strategy","aria-haspopup":"menu",onClick:l,children:e.jsx(he,{})})]}),e.jsx(fe,{sx:{zIndex:1},open:t,anchorEl:a.current,role:void 0,transition:!0,disablePortal:!0,children:({TransitionProps:s,placement:m})=>e.jsx(je,{...s,style:{transformOrigin:m==="bottom"?"center top":"center bottom"},children:e.jsx(E,{children:e.jsx(ge,{onClickAway:r,children:e.jsx(Ce,{id:"split-button-menu",autoFocusItem:!0,children:q.map((g,p)=>e.jsx(H,{disabled:p===2,selected:p===i,onClick:j=>d(j,p),children:g},g))})})})})})]})}const mt=()=>e.jsx(C,{sx:{position:"absolute",bottom:10,right:10},children:e.jsx(ut,{})}),pt=S.memo(mt),yt=()=>{const t=u("Store"),n=u("Layout"),{useAppSelector:a}=t.hooks,{selectActiveViewport:i}=n.store.selectors,o=a(i),c=x.useCallback(l=>l,[o]),d=M(o,c);return!o||!d.state?null:e.jsx(xt,{selectPart:d.actions.selectPart,compositionInfo:d.state})},xt=({compositionInfo:t,selectPart:n})=>{const{components:{SVGViewer:a},hooks:{useSVG:i}}=u("SVG"),{components:{MultiTouchPanel:o}}=u("Pointer"),{hooks:{useGraph:c}}=u("Graph"),d=u("Layout"),{ViewportNotificationsTray:l}=d.components,{graphId:r,svgPath:s,name:m,viewportName:g}=t,p=$(),j=c(r,b=>b?.nodes),h=i(s,b=>b?.instances[m]),f=x.useCallback(b=>{j.state&&Object.values(j.state).filter(v=>v.type==="PART").forEach(v=>{if(v.domId){const[k]=[...b?.querySelectorAll(`#${v.domId}`)];k.addEventListener("click",Y=>{Y.stopPropagation(),n(v.id)})}})},[r]),y=x.useCallback(()=>{p.functions.createDebugView(m,g)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(o,{gestures:{onPinch:b=>{h.actions.setZoom(m,b.offset[0])},onWheel:b=>{const v=h.state?.zoom??1;h.actions.setZoom(m,v+b.delta[1]*.001)}},children:e.jsx(a,{instanceName:m,path:s,beforeInjection:f})}),e.jsx(l,{children:e.jsx(ye,{fontSize:"small",onClick:y,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(Ge,{}),e.jsx(dt,{graphId:r})]}),e.jsx(pt,{})]})},ht=({closeModal:t,onModelSelection:n})=>e.jsx(E,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4},children:e.jsx(C,{onClick:()=>{n("Decorated","camisa-polo/decorated.svg"),t?.()},sx:{cursor:"pointer"},children:"Camisa polo fem"})}),bt=()=>{const t=$(),n=u("Layout"),{SystemModal:a}=n.components,i=x.useCallback((o,c)=>{t.functions.createComposition(o,c)},[]);return e.jsx(e.Fragment,{children:e.jsx(a,{component:e.jsx(ht,{onModelSelection:i}),children:e.jsx(P,{children:e.jsx(be,{})})})})},ft=({name:t})=>{const n=u("Graph"),a=u("Layout"),{ViewportNotificationsTray:i,DetailsPanel:o,SettingsPanel:c,Accordion:d}=a.components,{components:{GraphViewer:l}}=n,r=$(),s=x.useMemo(()=>r.functions.findComposition(m=>m.debugViewport===t),[t]);return e.jsxs(C,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[s&&e.jsx(l,{graphId:s?.graphId}),e.jsx(i,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(d,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(o,{children:e.jsx(e.Fragment,{})})]})},vt=S.memo(ft);export{yt as C,vt as D,bt as M};
