import{r as j,o as e,B as g,aG as D,aH as se,I as S,aI as ne,$ as _,aJ as F,H as oe,aK as ae,aL as H,aM as re,R as A,aN as ie,aO as le,aP as ce,aQ as de,S as z,n as Y,M as ue,A as pe,t as xe,aR as L,T as C,v as me,az as N,Z as q,aS as he,aT as O,E as fe,aU as je,aV as ge,aW as Z,aX as be,aY as B,aZ as J,_ as T,a3 as Q,a_ as ye,a$ as ve,P as $,b0 as Ce,b1 as U,a2 as K,b2 as Me,b3 as we,b4 as ke,y as Ge,b5 as Se,b6 as Pe,b7 as Ie,b8 as Ee,b9 as Te,ba as R,bb as De,ak as Re,bc as Ae}from"../../vendor-efd8fb1e.js";import{n as m}from"../../kernel-78de68a2.js";import{u as M,a as W,b as Le}from"./hooks-74c00113.js";const qe=({compositionName:t})=>{const s=m("Pointer"),{PointerContainer:r,ConfirmAndCloseButton:d}=s.components,n=M({compositionName:t},o=>o?.selectedPart),[c,l]=j.useState({name:"",domId:""}),a=j.useCallback(()=>{n.actions.addPart(c.name,c.domId,n.state)},[c]);return e.jsx(r,{component:e.jsxs(g,{sx:{width:200},children:[e.jsx(D,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:o=>l(i=>({...i,name:o.target.value}))}),e.jsx(D,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:o=>l(i=>({...i,domId:o.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(se,{position:"end",children:e.jsx(S,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(ne,{})})})}})]}),actions:[e.jsx(d,{handleConfirm:a},"confirm")],children:e.jsx(S,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:o=>{o.stopPropagation()},children:e.jsx(_,{})})})},Oe=({compositionName:t})=>{const s=M({compositionName:t},d=>d?.selectedPart),r=j.useCallback(d=>{s.state&&s.actions.removePart(s.state),d.stopPropagation()},[s]);return e.jsx(S,{"aria-label":"Delete part",id:`delete-part-${s.state}`,role:"delete-part-button",size:"small",sx:{},onClick:r,children:e.jsx(F,{})})};function $e(t){return e.jsx(z,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function _e(t){return e.jsx(z,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function Fe(t){return e.jsx(z,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Be(t){const s=ie({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(le.div,{style:s,children:e.jsx(ce,{...t})})}const Ve=oe(t=>e.jsx(ae,{...t,TransitionComponent:Be}))(({theme:t})=>({[`& .${H.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${H.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${re(t.palette.text.primary,.4)}`}}));function Ne({compositionName:t,graphId:s,selectedPart:r,selectPart:d,nodeId:n}){const c=m("Graph"),{useGraph:l}=c.hooks,a=l(s,o=>o&&o.adjacencyList[n]&&{node:o.nodes[n],edges:o.edges?Object.values(o.edges).reduce((i,x)=>o.adjacencyList[n].outputs.includes(x.id)?{...i,[x.id]:x}:i,{}):{},connections:o.adjacencyList[n]});return a.state?e.jsx(g,{sx:{color:"text.primary"},children:e.jsx(Ve,{nodeId:n,label:e.jsxs(g,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:o=>{n!==r&&(d(n),o.stopPropagation())},children:[a.state.node.label,n===r&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{compositionName:t}),e.jsx(Oe,{compositionName:t})]})]}),onClick:()=>{d(n)},sx:{color:n===r?"secondary.main":"secondary.secondary"},children:a.state.connections.outputs.filter(o=>a.state?.edges[o].type==="COMPOSED_OF").map(o=>a.state&&e.jsx(X,{compositionName:t,graphId:s,selectPart:d,selectedPart:r,nodeId:a.state.edges[o].targetId},`${n}-${a.state?.edges[o].targetId}`))})}):e.jsx(e.Fragment,{})}const X=A.memo(Ne);function ze(){const t=m("Store"),s=m("Layout"),r=m("Graph"),{useAppSelector:d}=t.hooks,{useGraph:n}=r.hooks,{selectActiveViewport:c}=s.store.selectors,l=d(c),a=j.useCallback(x=>({name:x?.name,svgPath:x?.svgPath,graphId:x?.graphId,selectedPart:x?.selectedPart}),[]),o=M({viewportName:l},a),i=n(l,x=>x?.adjacencyList);return!o.state?.svgPath||!o.state?.graphId||!o.state?.name||!i?null:e.jsx(de,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx($e,{}),defaultExpandIcon:e.jsx(_e,{}),defaultEndIcon:e.jsx(Fe,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(X,{compositionName:o.state.name,nodeId:"garment",graphId:o.state.graphId,selectPart:o.actions.selectPart,selectedPart:o.state.selectedPart})})}function Ue({key:t,graphId:s,nodeId:r,quantity:d,material:n,materialType:c}){const l=m("Converter"),a=m("Graph"),o=Y(),{useGraph:i}=a.hooks,x=l.hooks.useConverter(),u=i(s,k=>{const w=Object.values(k?.edges??{}).filter(G=>G.type=="CONSUMES"&&G.targetId===r).map(G=>G.sourceId),P=Object.values(k?.nodes??{}).filter(G=>G.type==="MATERIAL_USAGE"&&w.includes(G.id)).map(G=>G.id),V=Object.values(k?.edges??{}).filter(G=>G.type==="CONSUMES"&&P.includes(G.targetId));return{material:k?.nodes[r],consumptionEdges:V}}),h=j.useMemo(()=>{if(!(!u.state||!x))return u.state?.consumptionEdges.reduce((k,w)=>{const P=x.convert(w.quantity,n.stock.unit,{...n.attributes,unidades:d});return P?{...k,amount:k.amount+P.amount}:(console.warn("could not convert"),k)},{unit:n.stock.unit,amount:0})},[u.state]),{principal:y,extra:f}=c.schemas[c.latestSchema].selector,p=n.attributes[y],b=f==="cor"?n.attributes[f].label:n.attributes[f],v=n.stock.amount-(h?.amount??0);let I="error";n.stock.amount>0&&(I=v>=0?"success":"warning");const E=j.useMemo(()=>!h?.unit||!x?.state?.nodes?void 0:x.state.nodes[h.unit],[x?.state?.nodes,h?.unit]);return e.jsxs(ue,{sx:{width:"100%",display:"flex",flexGrow:1,flexDirection:"column"},children:[e.jsx(pe,{expandIcon:e.jsx(xe,{}),sx:{width:"100%"},children:e.jsx(L,{sx:{padding:0,width:"100%",flexGrow:1},children:e.jsxs(g,{role:"summary",sx:{display:"flex",flexDirection:"column",width:"100%"},children:[e.jsxs(g,{role:"row1",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsxs(C,{sx:{width:"33%",flexShrink:0,flexGrow:1},children:[c.label," - ",p]}),e.jsxs(g,{sx:{display:"flex",gap:.5,alignItems:"center",justifyContent:"center",maxWidth:"70%",flexGrow:1},children:[f==="cor"&&e.jsx(g,{role:"color-preview",sx:{width:"1em",height:"1em",borderRadius:"50%",border:`1px solid ${o.palette.getContrastText(o.palette.background.paper)}`,backgroundColor:n.attributes[f].hex}}),e.jsx("span",{children:b})]})]}),e.jsxs(g,{role:"row2",sx:{display:"flex",gap:2,width:"100%",alignItems:"center",flexGrow:1,justifyContent:"space-between"},children:[e.jsx(C,{variant:"caption",sx:{width:"33%",flexShrink:0},children:n.industry}),e.jsxs(g,{sx:{display:"flex",flexGrow:1,flexDirection:"row",gap:"3px",justifyContent:"flex-end"},children:[e.jsx(C,{variant:"caption",color:o.palette.primary.dark,sx:{width:"fit-content",flexShrink:0},children:h&&`${h.amount.toFixed(2)} ${E?.abbreviation}`}),e.jsxs(C,{variant:"caption",color:o.palette[I].main,children:["(",n.stock.amount," ",n.stock.unit," em estoque)"]})]})]})]})})}),e.jsxs(me,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(g,{sx:{display:"flex",gap:1},children:[e.jsxs(g,{role:"composition",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(C,{variant:"body1",children:"Composição"}),N.isEmpty(n.composition)?e.jsx(C,{children:"Nenhuma composição disponível"}):e.jsx(g,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(n.composition).map(([k,w])=>e.jsxs(g,{children:[w*100,"% ",k]}))})]}),e.jsxs(g,{role:"caracteristics",sx:{display:"flex",border:`1px solid ${o.palette.grey[600]}`,padding:1,width:"50%",flexDirection:"column",alignItems:"center",justifyContent:"space-around"},children:[e.jsx(C,{variant:"body1",children:"Caracteristicas"}),N.isEmpty(n.caracteristics)?e.jsx(C,{children:"Nenhuma caracterisca disponível"}):e.jsx(g,{sx:{display:"flex",width:"100%",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-around"},children:Object.entries(n.caracteristics).map(([k,w])=>e.jsxs(g,{children:[k,": ",w]},k))})]})]}),e.jsx(g,{role:"actions",sx:{width:"100%",display:"flex",flexDirection:"row-reverse"},children:e.jsx(q,{variant:"outlined",children:e.jsx(he,{href:n.externalURL,target:"_blank",underline:"none",children:"Ver material"})})})]})]},t)}const We=()=>{const t=m("Store"),s=m("Layout"),r=m("Graph"),d=m("Materials"),{useAppSelector:n}=t.hooks,{useGraph:c}=r.hooks,{useMaterials:l,useMaterialTypes:a}=d.hooks,{selectActiveViewport:o}=s.store.selectors,i=n(o),x=M({viewportName:i},p=>p),u=j.useMemo(()=>Object.values(x.state?.budget?.grades??{}).reduce((p,b)=>p+b,0),[x]),h=c(i,p=>Object.values(p?.nodes??{}).filter(b=>b.type==="MATERIAL").filter(b=>Object.values(p?.edges??{}).find(v=>v.type==="CONSUMES"&&v.targetId===b.id))),y=l(h.state?.map(p=>p.materialId)??[]),f=a();return!h.state||!x.state||!y?e.jsx(e.Fragment,{children:"test"}):x.state.budget?e.jsx(O,{role:"material-list",children:h.state.map(p=>e.jsx(fe,{fallback:e.jsx(e.Fragment,{children:"Não foi possivel calcular valor"}),children:e.jsx(Ue,{graphId:i,nodeId:p.id,quantity:u,material:y[p.materialId],materialType:f[y[p.materialId].type]})},p.id))}):e.jsx(e.Fragment,{children:"Crie um orçamento primeiro."})},He=()=>{const t=m("Layout"),{SettingsPanel:s,Accordion:r}=t.components;return e.jsxs(s,{children:[e.jsx(r,{name:"Composição",icon:e.jsx(je,{}),summary:"composição da peça",children:e.jsx(ze,{})}),e.jsx(r,{name:"Materiais",icon:e.jsx(ge,{}),summary:"Lista de materiais necessários",children:e.jsx(We,{})}),e.jsx(r,{name:"Prazos",icon:e.jsx(Z,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})}),e.jsx(r,{name:"Valores",icon:e.jsx(be,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})})]})},Qe=A.memo(He),Ye=({graphId:t,node:s})=>{const{components:{MaterialSelector:r}}=m("Materials"),d=m("Graph"),{useGraph:n}=d.hooks,c=M({compositionName:t},o=>o),l=n(t,o=>o?.nodes[s.materialId]),a=j.useCallback(o=>c.actions.changeMaterial(s.id,o),[t,s.id]);return e.jsx(r,{type:s.materialType,value:l?.state?.materialId,onChange:a})},Ze=({node:t,graphId:s})=>{const r=m("Graph"),{components:{MaterialTypeSelector:d}}=m("Materials"),{useNodeInfo:n,useGraph:c,useSearch:l}=r.hooks,a=c(s,f=>f?.nodes[t.id]),o=j.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),i=l(s,o,()=>{t&&a.actions.search("bfs",t.id,(f,p)=>f.type!=="RESTRICTION"?!1:p.adjacencyList[f.id].inputs.some(I=>{const E=p.edges[I];return E.type==="RESTRICTED_BY"&&E.attr==="materialType"}),()=>!1,(f,p)=>{const b=[...p.adjacencyList[f.id].inputs,...p.adjacencyList[f.id].outputs];return Object.values(p.edges).filter(v=>b.includes(v.id)).map(v=>v.targetId)},1,`Get all restriction associated with ${t.label}`,o)}),x=j.useMemo(()=>i?.findings.reduce((f,p)=>p.restrictionType==="allowOnly"?[...f,...p.operand]:f,[]),[i]),u=n(s,t.materialType),h=M({compositionName:s},f=>f),y=j.useCallback(f=>h.actions.changeMaterialType(t.id,f.target.value),[s,t.id]);return e.jsx(d,{filter:f=>i?.findings.length?x?.includes(f.name):!0,value:u.node?.id,onChange:y})},Je=({graphId:t,nodeId:s})=>{const r=m("Graph"),{useNodeInfo:d}=r.hooks,{node:n}=d(t,s);return e.jsx(L,{role:"material-info",children:e.jsx(B,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(C,{children:n.label}),e.jsx(J,{})]}),secondary:e.jsx(C,{component:"div",children:e.jsx(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(g,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:n.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Ze,{graphId:t,node:n},c);case"materialId":return e.jsx(Ye,{graphId:t,node:n},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},Ke=({labelState:[t,s],materialTypes:r,handleMaterialTypeChange:d})=>{const{components:{MaterialTypeSelector:n}}=m("Materials");return e.jsxs(g,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(n,{value:r,onChange:d,multiple:!0}),e.jsx(D,{id:"material-usage-name",label:"Nome",variant:"standard",value:t,onChange:c=>s(c.target.value)})]})},Xe=({compositionName:t})=>{const s=m("Pointer"),{PointerContainer:r,ConfirmAndCloseButton:d}=s.components,n=M({compositionName:t},u=>u?.selectedPart),[c,l]=j.useState(""),[a,o]=j.useState([]),i=j.useCallback(()=>{n.state&&n.actions.addMaterialUsage(c,n.state,a)},[c]),x=j.useCallback(u=>o(h=>u.target.value),[t]);return e.jsx(r,{component:e.jsx(Ke,{materialTypes:a,handleMaterialTypeChange:x,labelState:[c,l]}),actions:[e.jsx(d,{color:"success",handleConfirm:i},"accept")],children:e.jsx(q,{startIcon:e.jsx(_,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},et=({compositionName:t,materialUsageId:s})=>{const r=M({compositionName:t},n=>n),d=j.useCallback(()=>{r.actions.removeMaterialUsage(s)},[r]);return e.jsx(S,{color:"error",id:"delete-material",onClick:d,sx:{flexGrow:2},children:e.jsx(F,{})},"delete")},tt=({compositionState:t,materialUsageId:s})=>{const r=m("Graph"),d=m("Layout"),{useNodeInfo:n}=r.hooks,{CRUDGridContext:c}=d.contexts,{CRUDGrid:l,CRUDBooleanCell:a}=d.components,{node:o}=n(t.graphId,s),i=j.useMemo(()=>o.proxies.reduce((u,h)=>({...u,[h.elem]:{...u[h.elem],[h.attr]:!0}}),{}),[o]),{setRows:x}=j.useContext(c);return j.useEffect(()=>x(Object.entries(i).map(([u,h])=>({...h,elem:u,state:"untouched",id:T.uniqueId("proxy-")}))),[i]),e.jsxs(g,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(C,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(C,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(l,{addLabel:"Adicionar vínculo",newRecord:()=>({id:T.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:u})=>e.jsx(Q,{checked:u,disabled:!0}),renderEditCell:u=>e.jsx(a,{...u})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:u})=>e.jsx(Q,{checked:u,disabled:!0}),renderEditCell:u=>e.jsx(a,{...u})}]})]})},st=A.memo(tt),nt=({composition:t,materialUsageId:s,...r})=>{const d=m("Pointer"),n=m("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:l}=n.contexts,{rows:a}=j.useContext(l),o=j.useCallback(()=>{a.filter(i=>i.state==="deleted").forEach(i=>t.actions.deleteProxy(i.elem,s)),a.filter(i=>i.state==="modified").forEach(i=>{t.actions.deleteProxy(i.old.elem,s),i.stroke&&t.actions.addProxy({elem:i.elem,attr:"stroke"},s),i.fill&&t.actions.addProxy({elem:i.elem,attr:"fill"},s)}),a.filter(i=>i.state==="added").forEach(i=>{t.actions.deleteProxy(i.elem,s),i.stroke&&t.actions.addProxy({elem:i.elem,attr:"stroke"},s),i.fill&&t.actions.addProxy({elem:i.elem,attr:"fill"},s)})},[a]);return e.jsx(c,{color:"success",...r,handleConfirm:o})},ot=({compositionName:t,materialUsageId:s})=>{const r=M({compositionName:t},a=>a),d=m("Pointer"),n=m("Layout"),{PointerContainer:c}=d.components,{CRUDGridProvider:l}=n.components;return r.state?e.jsx(l,{initialRows:[],children:e.jsx(c,{component:e.jsx(st,{compositionState:r.state,materialUsageId:s}),actions:[e.jsx(nt,{composition:r,materialUsageId:s},"accept")],children:e.jsx(S,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(ye,{})},"configure")})}):e.jsx(e.Fragment,{})};function at({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function rt({row:t,...s}){const{components:{CRUDMaterialTypeCell:r}}=m("Materials");switch(t.attribute){case"materialType":return e.jsx(r,{row:t,value:t.operand,...s,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const it=({compositionState:t,materialUsageId:s})=>{const r=m("Graph"),d=m("Layout"),{useGraph:n,useSearch:c}=r.hooks,{CRUDGridContext:l}=d.contexts,{CRUDGrid:a}=d.components,{state:o,actions:{search:i}}=n(t.graphId,f=>f?.nodes[s]),x=j.useMemo(()=>`${s}/restrictions`,[s]),u=c(t.graphId,x,()=>{o&&i("bfs",o.id,(f,p)=>f.type!=="RESTRICTION"?!1:p.adjacencyList[f.id].inputs.some(I=>p.edges[I].type==="RESTRICTED_BY"),()=>!1,(f,p)=>{const b=[...p.adjacencyList[f.id].inputs,...p.adjacencyList[f.id].outputs];return Object.values(p.edges).filter(v=>b.includes(v.id)).map(v=>v.targetId)},1,`Get all restriction associated with ${o?.label??o.id}`,x)}),{setRows:h}=j.useContext(l);j.useEffect(()=>{u?.findings&&h(u.findings.map(f=>({...f,state:"untouched"})))},[u]),j.useEffect(()=>{u?.findings&&h(u.findings)},[]);const y=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:f})=>e.jsx(e.Fragment,{children:f})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:f})=>e.jsx(at,{node:f}),renderEditCell:f=>e.jsx(rt,{...f})}];return e.jsxs(g,{role:"restrictions-management-container",children:[e.jsx(C,{variant:"h4",children:"Restrições do material"}),e.jsxs(C,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(a,{addLabel:"Adicionar restrição",newRecord:()=>({id:T.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:y})]})},lt=t=>e.jsx(g,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(it,{...t})}),ct=({composition:t,materialUsageId:s,...r})=>{const d=m("Pointer"),n=m("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:l}=n.contexts,{rows:a}=j.useContext(l),o=j.useCallback(()=>{console.group("delete"),a.filter(i=>i.state==="deleted").forEach(i=>t.actions.removeRestriction(s,i.id)),console.groupEnd(),console.group("modified"),a.filter(i=>i.state==="modified").forEach(i=>{t.actions.updateRestriction(s,i.id,i)}),console.groupEnd(),console.group("added"),a.filter(i=>i.state==="added").forEach(i=>{t.actions.addRestriction(s,{type:"RESTRICTION",id:i.id,label:i.label,operand:i.operand,position:i.position,restrictionType:i.restrictionType,attribute:i.attribute})}),console.groupEnd()},[a]);return e.jsx(c,{color:"success",...r,handleConfirm:o})},dt=({sx:t,materialUsageId:s,compositionName:r,...d})=>{const n=M({compositionName:r},i=>i),c=m("Pointer"),l=m("Layout"),{PointerContainer:a}=c.components,{CRUDGridProvider:o}=l.components;return n.state?e.jsx(o,{initialRows:[],children:e.jsx(a,{component:e.jsx(lt,{compositionState:n.state,materialUsageId:s}),actions:[e.jsx(ct,{composition:n,materialUsageId:s},"accept")],children:e.jsx(S,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(ve,{})},"restrict")})}):e.jsx(e.Fragment,{})},ut=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(et,{...t}),e.jsx(ot,{...t}),e.jsx(dt,{...t,sx:{hover:{fill:"yellow"}}})]});function ee({compositionName:t,selectedPart:s,graphId:r}){const d=m("Graph"),{useNodeInfo:n}=d.hooks,{edges:c}=n(r,s);return e.jsxs(O,{sx:{width:"100%"},role:"material-list",children:[e.jsx(Xe,{compositionName:t}),Object.values(c).filter(l=>l.type==="MADE_OF").map(l=>e.jsxs($,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(Je,{graphId:r,nodeId:l.targetId}),e.jsx(ut,{compositionName:t,materialUsageId:l.targetId})]},l.targetId))]})}const pt=({graphId:t,nodeId:s})=>{const r=m("Graph"),d=m("Converter"),{useNodeInfo:n}=r.hooks,{useUnits:c}=d.hooks,{node:l}=n(t,s),a=c([l.cost.dividend.unit,l.cost.quotient.unit,l.time_taken.dividend.unit,l.time_taken.quotient.unit]);return a?e.jsx(L,{children:e.jsx(B,{disableTypography:!0,primary:e.jsxs(g,{sx:{marginBottom:1},children:[e.jsx(C,{children:l.label}),e.jsx(J,{})]}),secondary:e.jsx(C,{component:"div",sx:{padding:1},children:e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(Z,{})," ",l.time_taken.quotient.amount," ",a[l.time_taken.quotient.unit].abbreviation," /"," ",l.time_taken.dividend.amount," ",a[l.time_taken.dividend.unit].abbreviation]}),e.jsxs(g,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(Ce,{})," ",l.cost.quotient.amount," ",a[l.cost.quotient.unit].abbreviation," /"," ",l.cost.dividend.amount," ",a[l.cost.dividend.unit].abbreviation]})]})})})}):e.jsx(e.Fragment,{})},xt=({compositionName:t})=>{const s=m("Pointer"),r=m("Converter"),{PointerContainer:d,ConfirmAndCloseButton:n}=s.components,{CompoundSelector:c}=r.components;r.hooks;const l=M({compositionName:t},u=>u?.selectedPart),a=j.useMemo(()=>T.uniqueId("new-process-form"),[]),[o,i]=j.useState({label:"",cost:{quotient:{amount:1,unit:"reais11"},dividend:{amount:1,unit:"unitario18"}},time_taken:{quotient:{amount:1,unit:"minutos249"},dividend:{amount:1,unit:"unitario18"}}}),x=j.useCallback(u=>{u.preventDefault(),u.stopPropagation(),l.state&&l.actions.addOperation(o.label,o.cost,o.time_taken,l.state)},[o]);return e.jsx(d,{component:e.jsxs(g,{component:"form",onSubmit:x,id:a,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(U,{children:e.jsx(D,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:u=>i(h=>({...h,label:u.target.value})),value:o.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",filterDividends:u=>u.abbreviation==="un",filterQuotients:(u,h)=>h?.name==="Temporal",value:o.time_taken,onChange:u=>i(h=>({...h,time_taken:u}))}),e.jsx(c,{id:"cost",label:"Custo",filterDividends:(u,h)=>u.abbreviation==="un"||h?.name=="Temporal",filterQuotients:(u,h)=>h?.name==="Monetaria",value:o.cost,onChange:u=>i(h=>({...h,cost:u}))})]}),actions:[e.jsx(n,{type:"submit",form:a,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(q,{startIcon:e.jsx(_,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},mt=({compositionName:t,processId:s})=>{const r=M({compositionName:t},n=>n),d=j.useCallback(()=>{r.actions.removeOperation(s)},[r]);return e.jsx(S,{color:"error",id:`delete-process-${s}`,onClick:d,sx:{flexGrow:2},children:e.jsx(F,{})},"delete")},ht=({id:t,field:s,graphId:r,partId:d,value:n})=>{const c=m("Graph"),{useGraph:l}=c.hooks,a=K(),o=h=>Object.values(h).filter(y=>y.type==="MADE_OF"&&y.sourceId===d),i=(h,y)=>Object.entries(h).reduce((f,[p,b])=>y.includes(p)?{...f,[p]:b}:f,{}),{state:x}=l(r,h=>h&&{edges:o(h.edges),nodes:i(h.nodes,o(h.edges).map(y=>y.targetId))}),u=j.useCallback(h=>{a.current.setEditCellValue({id:t,field:s,value:h.target.value})},[r,d]);return x?e.jsxs(U,{sx:{m:1,minWidth:120,width:"min-content"},size:"small",children:[e.jsx(Me,{id:"label",children:"Material"}),e.jsx(we,{labelId:"label",id:"material-type",value:n??"",label:"Material",autoWidth:!0,onChange:u,children:x.edges.map(h=>e.jsx(ke,{value:h.targetId,children:x.nodes[h.targetId].label},h.id))})]}):e.jsx(e.Fragment,{})};function ft({row:t,id:s,field:r}){const d=K(),n=m("Converter"),{components:{CompoundSelector:c}}=n,l=j.useCallback(a=>{d.current.setEditCellValue({id:s,field:r,value:a})},[s]);return e.jsx(c,{id:"quantity",filterQuotients:(a,o)=>o?.name==="Comprimento"||o?.name==="Volume"||o?.name==="Area",filterDividends:(a,o)=>a.abbreviation==="un"||a.abbreviation==="pedido",value:t.quantity,onChange:l})}const jt=({compositionState:t,processId:s})=>{const r=m("Graph"),d=m("Layout"),n=m("Converter"),{useGraph:c}=r.hooks,{CRUDGridContext:l}=d.contexts,{CRUDGrid:a}=d.components,{components:{CompoundUnit:o}}=n,i=p=>Object.values(p).filter(b=>b.type==="MADE_OF"&&b.sourceId===t.selectedPart),x=(p,b)=>Object.entries(p).reduce((v,[I,E])=>b.includes(I)?{...v,[I]:E}:v,{}),{state:u}=c(t.graphId,p=>p&&{edges:i(p.edges),nodes:x(p.nodes,i(p.edges).map(b=>b.targetId))}),{state:h}=c(t.graphId,p=>p?.edges&&Object.values(p.edges).filter(b=>b.type==="CONSUMES"&&b.sourceId===s)),{setRows:y}=j.useContext(l);if(j.useEffect(()=>{h?.length&&y(h.map(p=>({...p,state:"untouched"})))},h),!u)return e.jsx(e.Fragment,{});const f=[{field:"targetId",editable:!0,flex:2,minWidth:200,renderCell:({row:{targetId:p},value:b})=>e.jsx(e.Fragment,{children:u.nodes[p]?.label}),renderEditCell:({value:p,...b})=>e.jsx(ht,{value:p??b.row.targetId,partId:t.selectedPart,graphId:t.graphId,...b}),renderHeader:()=>"Material"},{field:"quantity",editable:!0,flex:2,width:800,minWidth:500,align:"center",headerAlign:"center",renderHeader:()=>"Quantidade",renderCell:({row:{quantity:p}})=>e.jsx(o,{value:p}),renderEditCell:p=>e.jsx(ft,{...p})}];return e.jsxs(g,{role:"material-usage-management-container",children:[e.jsx(C,{variant:"h4",children:"Materiais consumidos"}),e.jsxs(C,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os materiais utilizados neste processo."}),e.jsx("p",{children:"Essas informações são utilizadas para calcular o custo em tempo e dinheiro da peça."})]}),e.jsx(a,{addLabel:"Víncular material",newRecord:()=>({id:T.uniqueId("material-usage-"),type:"CONSUMES",sourceId:s,targedId:"",quantity:{quotient:{amount:1,unit:"metrosquadrados17"},dividend:{amount:1,unit:"unitario18"}}}),columns:f})]})},gt=t=>e.jsx(g,{role:"material-usage-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(jt,{...t})}),bt=({composition:t,processId:s,...r})=>{const d=m("Pointer"),n=m("Layout"),{ConfirmAndCloseButton:c}=d.components,{CRUDGridContext:l}=n.contexts,{rows:a}=j.useContext(l),o=j.useCallback(()=>{a.filter(i=>i.state==="deleted").forEach(i=>{t.actions.deleteMaterialConsuption(i.id)}),a.filter(i=>i.state==="modified").forEach(({id:i,targetId:x,quantity:u})=>{t.actions.updateMaterialConsuption(i,{targetId:x,quantity:u})}),a.filter(i=>i.state==="added").forEach(i=>{t.actions.addMaterialConsuption(s,i.targetId,i.quantity)})},[a]);return e.jsx(c,{color:"success",...r,handleConfirm:o})},yt=({sx:t,compositionName:s,processId:r,...d})=>{const n=M({compositionName:s},i=>i),c=m("Pointer"),l=m("Layout"),{PointerContainer:a}=c.components,{CRUDGridProvider:o}=l.components;return n.state?e.jsx(o,{initialRows:[],children:e.jsx(a,{component:e.jsx(gt,{processId:r,compositionState:n.state}),actions:[e.jsx(bt,{composition:n,processId:r},"accept")],children:e.jsx(S,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(Ge,{})},"configure")})}):e.jsx(e.Fragment,{})},vt=t=>e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(mt,{...t}),e.jsx(yt,{...t})]});function te({compositionName:t,selectedPart:s,graphId:r}){const d=m("Graph"),{useNodeInfo:n}=d.hooks,{edges:c}=n(r,s);return e.jsxs(O,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(xt,{compositionName:t}),Object.values(c).filter(l=>l.type==="PROCESS_NEEDED").map(l=>e.jsxs($,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(pt,{graphId:r,nodeId:l.targetId}),e.jsx(vt,{compositionName:t,processId:l.targetId})]},l.targetId))]})}const Ct=({compositionName:t,graphId:s})=>{const r=m("Pointer"),d=m("Graph"),{PointerContainer:n,ConfirmAndCloseButton:c}=r.components,{useGraph:l}=d.hooks,a=M({compositionName:t},f=>f?.selectedPart),o=l(s,f=>f?Object.values(f.nodes).filter(p=>p.type==="GRADE").map(p=>({...p,order:Object.values(f.edges).find(b=>b.targetId===p.id)?.order})):[]),i=j.useMemo(()=>o.state?N.max(o.state.filter(f=>T.isNumber(f?.order)).map(f=>f.order))??0:0,[o]),x=j.useMemo(()=>T.uniqueId("new-process-form"),[]),[u,h]=j.useState({abbreviation:""}),y=j.useCallback(()=>{a.state&&a.actions.addGrade(u.abbreviation,i+1)},[u.label,u.abbreviation,i,a.state]);return e.jsx(n,{component:e.jsx(g,{component:"form",id:x,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:e.jsx(U,{children:e.jsx(D,{id:"abbreviation",label:"Abreviação",variant:"standard",sx:{marginBottom:1},onChange:f=>h(p=>({...p,abbreviation:f.target.value})),value:u.abbreviation})})}),actions:[e.jsx(c,{type:"submit",form:x,value:"Submit",color:"success",handleConfirm:y},"accept")],children:e.jsx(q,{startIcon:e.jsx(_,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar Grade"})})};function Mt({compositionName:t,graphId:s}){const r=m("Graph"),{useGraph:d}=r.hooks,n=d(s,a=>a?Object.values(a.nodes).filter(o=>o.type==="GRADE").map(o=>({...o,order:Object.values(a.edges).find(i=>i.targetId===o.id)?.order})).filter(o=>T.isNumber(o?.order)).sort((o,i)=>o?.order-i?.order):[]),c=M({compositionName:t},a=>a?.selectedPart),l=j.useCallback(a=>{c.actions.removeGrade(a)},[t]);return n.state?e.jsxs(O,{sx:{width:"100%"},role:"material-list",children:[e.jsx(Ct,{graphId:s,compositionName:t}),n.state.map(a=>e.jsxs($,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"grade-container",children:[e.jsx(L,{role:"grade-info",children:e.jsx(B,{disableTypography:!0,primary:e.jsx(C,{children:a.abbreviation})})}),e.jsx(g,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:e.jsx(S,{color:"error",id:"delete-material",onClick:()=>l(a.id),sx:{flexGrow:2},children:e.jsx(F,{})},"delete")})]},a.id))]}):e.jsx(e.Fragment,{})}const wt=t=>{const s=m("Layout"),{Accordion:r}=s.components;return e.jsx(r,{name:"Graduação",icon:e.jsx(Se,{}),summary:"Graduação da peça",sx:{flexGrow:1},children:e.jsx(Mt,{...t})})},kt=({node:t,graphId:s,selectedPart:r,compositionName:d})=>{const n=m("Layout"),c=m("Markdown"),{components:{MarkdownReader:l}}=c,{DetailsPanel:a,Accordion:o,CustomTextArea:i,SystemModal:x}=n.components,[u,h]=j.useState({name:t.label??"Nova peça",description:t.description??""}),y=M({compositionName:d},p=>p),f=j.useCallback(()=>{y.actions.changeProperties(u.name,u.description)},[d,u.name,u.description]);return e.jsxs(a,{title:t.label,id:"gamerment-panel",children:[e.jsx(o,{name:"Propriedades",icon:e.jsx(Pe,{}),summary:"Propriedades da peça",sx:{flexGrow:1},children:e.jsxs($,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex",justifyContent:"space-between"},role:"garment-properties",id:"garment-properties",children:[e.jsxs(g,{sx:{display:"flex",flexDirection:"column",width:"100%",gap:1},children:[e.jsx(D,{id:"garment-name",label:"Nome",variant:"standard",sx:{width:"100%"},value:u?.name,onChange:p=>h(b=>b&&{...b,name:p.target.value})}),e.jsx(i,{id:"description",wrapperProps:{sx:{width:"100%"}},minRows:3,name:"Outlined",placeholder:"Descrição",color:"neutral",value:u.description,onChange:p=>{p.preventDefault(),p.stopPropagation(),h(b=>b&&{...b,description:p.target.value})}})]}),e.jsxs(g,{sx:{display:"flex",flexDirection:"column",padding:0,gap:1,justifyContent:"space-between",alignContent:"space-evenly"},role:"actions",children:[e.jsx(S,{color:"success",id:"save-properties",onClick:p=>f(),children:e.jsx(Ie,{})},"save"),e.jsx(x,{component:e.jsx(l,{content:u.description}),button:e.jsx(S,{color:"warning",id:"preview-description",children:e.jsx(Ee,{})},"preview")}),e.jsx(S,{color:"info",id:"reset-properties",onClick:p=>h({name:t.label,description:t.description}),children:e.jsx(Te,{})},"reset")]})]},"garment-properties")}),e.jsx(wt,{graphId:s,compositionName:d,selectedPart:r}),e.jsx(o,{name:"Materiais",icon:e.jsx(R,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(ee,{graphId:s,selectedPart:r,compositionName:d})}),e.jsx(o,{name:"Processos",icon:e.jsx(R,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(te,{graphId:s,selectedPart:r,compositionName:d})})]},"garment-panel")},Gt=()=>{const t=m("Layout"),s=m("Store"),{useAppSelector:r}=s.hooks,{selectActiveViewport:d}=t.store.selectors,n=r(d),c=j.useCallback(a=>({name:a?.name,graphId:a?.graphId,selectedPart:a?.selectedPart}),[]),l=M({viewportName:n},c);return!l.state?.selectedPart||!l.state?.graphId||!l.state?.name?null:e.jsx(St,{graphId:l.state.graphId,selectedPart:l.state.selectedPart,compositionName:l.state.name})},St=({graphId:t,selectedPart:s,compositionName:r})=>{const d=m("Layout"),n=m("Graph"),{DetailsPanel:c,Accordion:l}=d.components,{useGraph:a}=n.hooks,o=a(t,i=>i?.nodes[s]);return o.state?.type==="GARMENT"?e.jsx(kt,{node:o.state,graphId:t,compositionName:r,selectedPart:s}):e.jsxs(c,{title:o.state?.label??s,children:[e.jsx(l,{name:"Opcionais",icon:e.jsx(R,{}),summary:"Lista de opcionais",sx:{flexGrow:1},children:e.jsx(e.Fragment,{})}),e.jsx(l,{name:"Materiais",icon:e.jsx(R,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(ee,{graphId:t,selectedPart:s,compositionName:r})}),e.jsx(l,{name:"Processos",icon:e.jsx(R,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(te,{graphId:t,selectedPart:s,compositionName:r})})]})},Pt=A.memo(Gt);function It({compositionName:t,graphId:s}){const r=Y(),d=m("Graph"),{useGraph:n}=d.hooks,c=M({compositionName:t},x=>x?.budget?.grades),l=n(s,x=>Object.values(x?.nodes??{}).filter(u=>u.type==="GRADE").reduce((u,h)=>(u[h.id]=h,u),{})),a=j.useMemo(()=>!c.state||!l?.state?[]:Object.entries(c.state).map(([x,u])=>l?.state?{id:x,counter:u,abbreviation:l.state[x].abbreviation}:{id:x,counter:u,abbreviation:x}),[c.state,l.state]),o=j.useMemo(()=>a.reduce((x,u)=>x+u.counter,0),[a]),i=j.useCallback((x,u)=>{c.actions.changeGradeCounter(x,u)},[t]);return!c.state||!l.state?e.jsx(e.Fragment,{}):e.jsxs(g,{sx:{width:"min-content",display:"flex",flexFlow:"column",backgroundColor:r.palette.background.paper,opacity:"0.9",borderRadius:2,pointerEvents:"all",border:`1px solid ${r.palette.getContrastText(r.palette.background.paper)}`},role:"grades-counter",children:[a.map(x=>e.jsx(g,{sx:{padding:1},children:e.jsx(D,{id:x.id,label:x.abbreviation,variant:"standard",value:x.counter,sx:{width:"40px"},type:"number",onChange:u=>i(x.id,+u.target.value)})},x.id)),e.jsx(g,{sx:{padding:1},children:e.jsx(D,{id:"total",label:"Total",variant:"standard",value:o,sx:{width:"40px"},disabled:!0})},"total")]})}const $t=()=>{const t=m("Store"),s=m("Layout"),{useAppSelector:r}=t.hooks,{selectActiveViewport:d}=s.store.selectors,n=r(d),c=j.useCallback(a=>a,[n]),l=M({viewportName:n},c);return!n||!l.state?null:e.jsx(Et,{selectPart:l.actions.selectPart,compositionInfo:l.state})},Et=({compositionInfo:t,selectPart:s})=>{const{components:{SVGViewer:r},hooks:{useSVG:d}}=m("SVG"),{components:{MultiTouchPanel:n}}=m("Pointer"),{hooks:{useGraph:c}}=m("Graph"),l=m("Layout"),a=m("Orders"),{BudgetFloatingButton:o}=a.components,{ViewportNotificationsTray:i}=l.components,{graphId:x,svgPath:u,name:h,viewportName:y,budget:f}=t,p=W(),b=c(x,w=>w?.nodes),v=d(u,w=>w?.instances[h]),I=j.useMemo(()=>f?["convert-to-order","delete-budget"]:["create-budget","add-to-budget"],[f]),E=j.useCallback(w=>{b.state&&Object.values(b.state).filter(P=>P.type==="PART").forEach(P=>{if(P.domId){const[V]=[...w?.querySelectorAll(`#${P.domId}`)];V.addEventListener("click",G=>{G.stopPropagation(),s(P.id)})}})},[x]),k=j.useCallback(()=>{p.functions.createDebugView(h,y)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(g,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(n,{gestures:{onPinch:w=>{v.actions.setZoom(h,w.offset[0])},onWheel:w=>{const P=v.state?.zoom??1;v.actions.setZoom(h,P+w.delta[1]*.001)}},children:e.jsx(r,{instanceName:h,path:u,beforeInjection:E})}),e.jsx(i,{children:e.jsx(De,{fontSize:"small",onClick:k,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(Qe,{}),e.jsx(Pt,{})]}),e.jsxs(g,{sx:{position:"absolute",display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",gap:1,padding:1,alignItems:"end",bottom:10,width:"100%",pointerEvents:"none"},children:[e.jsx(o,{allowedActions:I}),f&&e.jsx(It,{compositionName:h,graphId:x})]})]})},Tt=({instanceName:t,path:s,...r})=>{const d=m("SVG"),{components:{SVGViewer:n},hooks:{useSVGManager:c}}=d,l=c();return j.useLayoutEffect(()=>{l.functions.loadSVG(s,`${t}-preview`)},[]),e.jsx(n,{...r,instanceName:`${t}-preview`,path:s})},Dt=Re(g)`
  display: flex;
  flex-direction: row;
  max-height: 85vh;

  @media (orientation: portrait) {
    flex-direction: column;
  }
`,Rt=({closeModal:t,onModelSelection:s})=>{const r=m("Markdown"),{components:{MarkdownReader:d}}=r,n=Le(),[c,l]=j.useState(void 0);return e.jsx($,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",width:"85vw",overflow:"hidden",maxHeight:"85vh",p:2},children:e.jsxs(Dt,{role:"model-selector-container",sx:{gap:1},children:[e.jsx(O,{role:"list-options",sx:{paddingRight:5,overflow:"auto"},children:n.map(a=>e.jsx(L,{disableGutters:!0,children:e.jsx(B,{primary:a.name,secondary:null,id:a.name,color:c?.name===a.name?"primary":"secondary",onClick:()=>l({name:a.name,path:a.svgPath,descriptionPath:a.descriptionPath}),sx:{cursor:"pointer",flexGrow:1}})},T.uniqueId()))}),e.jsxs(g,{sx:{overflow:"auto",width:"100%"},children:[c?e.jsx(Tt,{instanceName:c.name,path:c.path,sx:{gridArea:"preview",p:1}}):e.jsx(g,{sx:{p:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{children:"Selecione um modelo"})}),c?.descriptionPath&&e.jsx(g,{role:"model-description",sx:{flexGrow:1,p:1,gridArea:"description",overflowY:"auto",height:"min-content"},children:e.jsx(d,{path:c.descriptionPath})})]}),e.jsx(g,{role:"actions",sx:{position:"absolute",top:10,right:10,display:"flex",flexDirection:"row-reverse"},children:e.jsx(q,{disabled:!c,variant:"contained",onClick:()=>{c&&(s(c.name,c.path),t?.())},children:"Selecionar"})})]})})},_t=()=>{const t=W(),s=m("Layout"),{SystemModal:r}=s.components,d=j.useCallback((n,c)=>{t.functions.createComposition(n,c)},[]);return e.jsx(r,{component:e.jsx(Rt,{onModelSelection:d}),button:e.jsx(S,{children:e.jsx(Ae,{})})})},At=({name:t})=>{const s=m("Graph"),r=m("Layout"),{ViewportNotificationsTray:d,DetailsPanel:n,SettingsPanel:c,Accordion:l}=r.components,{components:{GraphViewer:a}}=s,o=W(),i=j.useMemo(()=>o.functions.findComposition(x=>x.debugViewport===t),[t]);return e.jsxs(g,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[i&&e.jsx(a,{graphId:i?.graphId}),e.jsx(d,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(l,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(n,{children:e.jsx(e.Fragment,{})})]})},Ft=A.memo(At);export{$t as C,Ft as D,_t as M};
