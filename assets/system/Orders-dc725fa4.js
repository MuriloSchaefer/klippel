import{c as w,d as $,e as _,_ as q,n as z,r as m,o as e,B as v,aG as P,Z as M,b as U,b3 as W,b4 as D,T as Y,bl as Z,bm as H,bn as J,bo as K,P as Q,bp as X,bq as ee}from"../vendor-918b8f8e.js";import{A as S,n as u}from"../kernel-f178b49f.js";const C="Orders",te="0.0.1",oe={budgets:{},orders:{}},k=w(`[${C}:Compositions:${S.COMMAND}] Create budget`),I=w(`[${C}:Compositions:${S.COMMAND}] Delete budget`),ne=w(`[${C}:Compositions:${S.EVENT}] Budget created`),se=w(`[${C}:Compositions:${S.EVENT}] Budget deleted`),re=$({name:"budgets",initialState:{},reducers:{},extraReducers:t=>{t.addCase(k,(o,{payload:n})=>({...o,[n.id]:n})),t.addCase(I,(o,{payload:n})=>Object.values(o).reduce((r,c)=>c.id===n.id?r:{...r,[c.id]:c},{}))}}),ae=$({name:C,initialState:oe,reducers:{},extraReducers:t=>{t.addCase(k,(o,n)=>({...o,budgets:re.reducer(o.budgets,n)}))}}),E=_();E.startListening({actionCreator:k,effect:async({payload:t},o)=>{const{dispatch:n}=o;n(ne({id:t.id}))}});E.startListening({actionCreator:I,effect:async({payload:t},o)=>{const{dispatch:n,getState:r}=o,{Orders:{budgets:c}}=r(),s=c[t.id];n(se(s))}});function ce({managers:{storeManager:t,componentRegistryManager:o,layoutManager:n,ribbonMenuManager:r,viewportManager:c}}){t.functions.loadReducer(C,ae.reducer),t.functions.registerMiddleware(E)}function B(){const t=u("Store"),o=u("Layout"),n=u("Composer"),{useAppDispatch:r,useAppSelector:c}=t.hooks,{useViewportManager:s}=o.hooks,{selectActiveViewport:l}=o.store.selectors,{useComposition:d}=n.hooks,b=r(),i=s(),a=c(l),g=d({viewportName:a},p=>p?.name);return{createBudget(p,y){if(!a)throw Error("No active viewport");const h=q.uniqueId("budget-");i.functions.createGroup(h,y),i.functions.addToGroup(a,h),b(k({id:h,label:p,viewportGroup:h})),g.actions.addToBudget(g.state,h)},addTobudget(p){if(!a)throw Error("No active viewport");i.functions.addToGroup(a,p),g.actions.addToBudget(g.state,p)}}}const f={"create-budget":{id:"create-budget",label:"Criar orçamento",color:"info"},"add-to-budget":{id:"add-to-budget",label:"Adicionar ao orçamento",color:"info"},"convert-to-order":{id:"convert-to-order",label:"Converter em pedido",color:"success"},"delete-budget":{id:"delete-budget",label:"Deletar orçamento",color:"error"}},A=f["create-budget"];function le(){const t=z(),o=u("Pointer"),n=u("Layout"),{PointerContainer:r,ConfirmAndCloseButton:c}=o.components,{ColorPicker:s}=n.components,[l,d]=m.useState({label:"",color:""}),b=B(),i=m.useCallback(()=>{b.createBudget(l.label,l.color)},[l.color,l.label,b]);return e.jsx(r,{actions:[e.jsx(c,{type:"submit",value:"Submit",color:"success",handleConfirm:i},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(s,{sx:{width:"40px",height:"40px",border:`1px solid ${t.palette.getContrastText(t.palette.background.default)}`},colorChange:a=>d(g=>({...g,color:a.hex}))}),e.jsx(P,{id:"part-name",label:"Nome",variant:"standard",value:l.label,onChange:a=>d(g=>({...g,label:a.target.value}))})]}),children:e.jsx(M,{color:A.color,children:A.label})})}const de=t=>t.Orders,ie=()=>U(de,t=>Object.values(t?.budgets??{}));function ue(t){const o=u("Store"),n=u("Layout"),{useAppSelector:r}=o.hooks,{getViewportGroups:c}=n.store.selectors,s=r(ie()),l=r(c);return e.jsx(W,{...t,sx:{width:"200px",...t.sx},autoWidth:!0,inputProps:{sx:{display:"flex",gap:1}},children:s.map(d=>e.jsxs(D,{value:d.id,sx:{display:"flex",gap:1},children:[e.jsx(v,{sx:{width:"20px",height:"20px",backgroundColor:l[d.viewportGroup].color}}),e.jsx(Y,{children:d.label})]},d.id))})}const O=f["add-to-budget"];function pe(){const t=u("Pointer"),{PointerContainer:o,ConfirmAndCloseButton:n}=t.components,[r,c]=m.useState(""),s=B(),l=m.useCallback(()=>s.addTobudget(r),[r,s]);return e.jsx(o,{actions:[e.jsx(n,{type:"submit",value:"Submit",color:"success",handleConfirm:l},"accept")],component:e.jsx(e.Fragment,{children:e.jsx(ue,{value:r,onChange:d=>c(d.target.value),sx:{width:"100%"}})}),children:e.jsx(M,{color:O.color,children:O.label})})}const N=f["convert-to-order"];function ge(){const t=u("Pointer"),o=u("Layout"),{PointerContainer:n,ConfirmAndCloseButton:r}=t.components,{ColorPicker:c}=o.components,[s,l]=m.useState({label:"",color:""}),d=B(),b=m.useCallback(()=>{d.createBudget(s.label,s.color)},[s.color,s.label,d]);return e.jsx(n,{actions:[e.jsx(r,{type:"submit",value:"Submit",color:"success",handleConfirm:b},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(c,{sx:{width:"40px",height:"40px"},colorChange:i=>l(a=>({...a,color:i.hex}))}),e.jsx(P,{id:"part-name",label:"Nome",variant:"standard",value:s.label,onChange:i=>l(a=>({...a,label:i.target.value}))})]}),children:e.jsx(M,{color:N.color,children:N.label})})}const L=f["delete-budget"];function me(){const t=u("Pointer"),o=u("Layout"),{PointerContainer:n,ConfirmAndCloseButton:r}=t.components,{ColorPicker:c}=o.components,[s,l]=m.useState({label:"",color:""}),d=B(),b=m.useCallback(()=>{d.createBudget(s.label,s.color)},[s.color,s.label,d]);return e.jsx(n,{actions:[e.jsx(r,{type:"submit",value:"Submit",color:"success",handleConfirm:b},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(c,{sx:{width:"40px",height:"40px"},colorChange:i=>l(a=>({...a,color:i.hex}))}),e.jsx(P,{id:"part-name",label:"Nome",variant:"standard",value:s.label,onChange:i=>l(a=>({...a,label:i.target.value}))})]}),children:e.jsx(M,{color:L.color,children:L.label})})}function be({allowedActions:t=["create-budget","add-to-budget","convert-to-order","delete-budget"]}){const o=u("Store"),n=u("Layout"),r=u("Composer"),{useAppSelector:c}=o.hooks,{useComposition:s}=r.hooks,{selectActiveViewport:l}=n.store.selectors,d=c(l),b=s({viewportName:d},x=>x),[i,a]=m.useState(!1),g=m.useRef(null),[p,y]=m.useState(t[0]??"create-budget");m.useEffect(()=>{t.length&&!t.includes(p)&&y(t[0])},[t]);const h=(x,T)=>{y(T),a(!1)},G=()=>{a(x=>!x)},V=x=>{g.current&&g.current.contains(x.target)||a(!1)};return!b.state||!t.length?e.jsx(e.Fragment,{}):e.jsxs(v,{sx:{pointerEvents:"all"},children:[e.jsxs(Z,{variant:"contained",ref:g,"aria-label":"budget button",children:[p==="create-budget"&&e.jsx(le,{}),p==="add-to-budget"&&e.jsx(pe,{}),p==="convert-to-order"&&e.jsx(ge,{}),p==="delete-budget"&&e.jsx(me,{}),e.jsx(M,{size:"small","aria-haspopup":"menu",onClick:G,color:f[p].color,children:e.jsx(H,{})})]}),e.jsx(J,{sx:{zIndex:1},open:i,anchorEl:g.current,role:"budget-floating-buttons",transition:!0,disablePortal:!0,children:({TransitionProps:x,placement:T})=>e.jsx(K,{...x,style:{transformOrigin:T==="bottom"?"center top":"center bottom"},children:e.jsx(Q,{children:e.jsx(X,{onClickAway:V,children:e.jsx(ee,{id:"split-button-menu",autoFocusItem:!0,children:t.map(F=>{const j=f[F];return e.jsx(D,{selected:j.id===p,onClick:R=>h(R,j.id),color:j.color,children:j.label},j.id)})})})})})})]})}const Ce={name:C,version:te,depends_on:["Composer"],components:{BudgetFloatingButton:be},hooks:{useBudgetManager:B},kernelCalls:{startModule:ce,restartModule(){},shutdownModule(){}}};export{Ce as m};
