import{c as j,b as Pe,_ as D,r as M,n as e,R as A,Q as Ee,S as Ne,e as ae,d as ie}from"../vendor-10645561.js";import{B as S,Z as G,_ as Te,I as k,$ as ke,w as Y,a0 as Z,s as Ae,a1 as Re,a2 as se,a3 as De,a4 as Oe,a5 as Ge,S as Q,a6 as Le,a7 as Ve,a8 as qe,a9 as re,aa as ce,ab as de,T as R,v as L,E as ne,ac as _e,ad as Fe,ae as le,P as V,af as Be,ag as ze,ah as Ue,f as We,ai as U,aj as He,ak as Ye,al as Ze,am as Qe,an as Je,ao as Ke,ap as Xe,aq as et,ar as tt}from"../material-4d42ad69.js";import{A as y,u,c as ot,r as st,d as nt,S as pe,a as me,l as at,b as ue,e as it,f as q,g as rt,h as ct,i as dt,j as J,k as lt,m as pt,n as mt}from"../kernel-09488e7b.js";const C="Composer",ut="0.0.1",he=j(`[${C}:Compositions:${y.COMMAND}] Add material`),ht=j(`[${C}:Compositions:${y.COMMAND}] Add material type`),ge=j(`[${C}:Compositions:${y.COMMAND}] Change material`),_=j(`[${C}:Compositions:${y.COMMAND}] Select part`),F=j(`[${C}:Compositions:${y.COMMAND}] Unselect part`),xe=j(`[${C}:Compositions:${y.COMMAND}] Add Proxy`),fe=j(`[${C}:Compositions:${y.COMMAND}] Delete Proxy`);j(`[${C}:Compositions:${y.COMMAND}] Update Proxy`);const Ce=j(`[${C}:Compositions:${y.COMMAND}] Add Restriction`),Me=j(`[${C}:Compositions:${y.COMMAND}] Delete Restriction`),je=j(`[${C}:Compositions:${y.COMMAND}] Update Restriction`),B=j(`[${C}:Compositions:${y.COMMAND}] Open debug viewport`);j(`[${C}:Compositions:${y.COMMAND}] Create debug viewport`);const gt=j(`[${C}:Compositions:${y.EVENT}] Material added`);j(`[${C}:Compositions:${y.EVENT}] Material type added`);const xt=j(`[${C}:Compositions:${y.EVENT}] Part selected`),ft=j(`[${C}:Compositions:${y.EVENT}] Part unselected`),Ct=j(`[${C}:Compositions:${y.EVENT}] Material changed`),Mt=j(`[${C}:Compositions:${y.EVENT}] Proxy added`),jt=j(`[${C}:Compositions:${y.EVENT}] Proxy deleted`);j(`[${C}:Compositions:${y.EVENT}] Proxy updated`);const yt=j(`[${C}:Compositions:${y.EVENT}] Restriction added`),vt=j(`[${C}:Compositions:${y.EVENT}] Restriction deleted`),bt=j(`[${C}:Compositions:${y.EVENT}] Restriction updated`),It=j(`[${C}:Compositions:${y.EVENT}] Debug viewport opened`);j(`[${C}:Compositions:${y.EVENT}] Debug viewport closed`);const w=(t,o)=>{const s=u("Store"),a=u("Layout"),n=u("Graph"),c=u("SVG"),{useAppDispatch:l,useAppSelector:d}=s.hooks,i=l(),r=a.hooks.usePanelsManager(),{useGraph:p}=n.hooks,{useSVG:f}=c.hooks,g=Pe(h=>h&&h.Composer.compositionsManager.compositions[t],o),x=d(g),m=d(h=>h&&h.Composer.compositionsManager.compositions[t]),b=p(m?.graphId,h=>({adjacencyList:h?.adjacencyList,nodes:h?.nodes}));return f(m?.svgPath,h=>h),{state:x,actions:{addPart(h,v,I){const $={type:"PART",id:h,label:h,position:{x:0,y:0},domId:v};let E;if(I){const T=`${I}->${h}`;E={inputs:{[T]:{id:T,sourceId:I,targetId:h,type:"COMPOSED_OF"}},outputs:{}}}b.actions.addNode($,E)},removePart(h){b.actions.removeNode(h)},addMaterialUsage(h,v,I){const $=D.uniqueId("material-usage-"),E={type:"MATERIAL_USAGE",id:$,label:h,editableAttributes:["materialType","materialId"],materialId:"material-12",materialType:I[0]??"malha",position:{x:0,y:0},proxies:[]},T=`${$}-restriction-1`,O=`${v}->${$}`,z={inputs:{[O]:{id:O,sourceId:v,targetId:$,type:"MADE_OF"}},outputs:{}};b.actions.addNode(E,z);const $e={type:"RESTRICTION",restrictionType:"allowOnly",attribute:"materialType",id:T,label:"Permitido apenas",operand:I,position:{x:0,y:0}},oe=`${$}->${T}`,we={inputs:{[oe]:{id:oe,sourceId:$,targetId:T,attr:"materialType",type:"RESTRICTED_BY"}},outputs:{}};b.actions.addNode($e,we)},removeMaterialUsage(h){b.actions.removeNode(h)},addRestriction(h,v){i(Ce({compositionName:t,materialId:h,restriction:v}))},updateRestriction(h,v,I){i(je({compositionName:t,materialId:h,restrictionId:v,changes:I}))},removeRestriction(h,v){i(Me({compositionName:t,materialId:h,restrictionId:v}))},removeOperation(h){b.actions.removeNode(h)},addOperation(h,v,I,$){const E=D.uniqueId("operation-"),T=`${$}->${E}`,O={id:E,type:"OPERATION",label:h,position:{x:0,y:0},cost:v,time_taken:I},z={inputs:{[T]:{id:T,sourceId:$,targetId:E,type:"PROCESS_NEEDED"}},outputs:{}};b.actions.addNode(O,z)},selectPart(h){i(_({compositionName:t,partName:h})),r.functions.openDetails()},changeMaterialType(h,v){b.actions.nodeExists(v)||i(ht({compositionName:m?.name,materialType:v})),b.actions.updateNode({id:h,materialType:v})},changeMaterial(h,v){i(ge({compositionName:m?.name,materialUsageId:h,materialId:v}))},addProxy(h,v){i(xe({compositionName:t,materialId:v,proxy:h}))},deleteProxy(h,v){i(fe({compositionName:t,materialId:v,proxyId:h}))},updateProxy(){}}}},St=({compositionName:t})=>{const o=u("Pointer"),{PointerContainer:s,ConfirmAndCloseButton:a}=o.components,n=w(t,i=>i?.selectedPart),[c,l]=M.useState({name:"",domId:""}),d=M.useCallback(()=>{n.actions.addPart(c.name,c.domId,n.state)},[c]);return e.jsx(s,{component:e.jsxs(S,{sx:{width:200},children:[e.jsx(G,{id:"part-name",label:"Nome",variant:"standard",value:c.name,onChange:i=>l(r=>({...r,name:i.target.value}))}),e.jsx(G,{id:"dom-id-name",label:"Dom ID",variant:"standard",value:c.domId,onChange:i=>l(r=>({...r,domId:i.target.value})),sx:{alignItems:"center"},InputProps:{endAdornment:e.jsx(Te,{position:"end",children:e.jsx(k,{"aria-label":"pick dom id",edge:"end",sx:{paddingLeft:"0px"},disabled:!0,children:e.jsx(ke,{})})})}})]}),actions:[e.jsx(a,{handleConfirm:d},"confirm")],children:e.jsx(k,{"aria-label":"Add new part",size:"small",sx:{lineHeight:"0.3em"},onClick:i=>{i.stopPropagation()},children:e.jsx(Y,{})})})},$t=({compositionName:t})=>{const o=w(t,a=>a?.selectedPart),s=M.useCallback(a=>{o.state&&o.actions.removePart(o.state),a.stopPropagation()},[o]);return e.jsx(k,{"aria-label":"Delete part",id:`delete-part-${o.state}`,role:"delete-part-button",size:"small",sx:{},onClick:s,children:e.jsx(Z,{})})};function wt(t){return e.jsx(Q,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 11.023h-11.826q-.375 0-.669.281t-.294.682v0q0 .401.294 .682t.669.281h11.826q.375 0 .669-.281t.294-.682v0q0-.401-.294-.682t-.669-.281z"})})}function Pt(t){return e.jsx(Q,{fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0zM17.873 12.977h-4.923v4.896q0 .401-.281.682t-.682.281v0q-.375 0-.669-.281t-.294-.682v-4.896h-4.923q-.401 0-.682-.294t-.281-.669v0q0-.401.281-.682t.682-.281h4.923v-4.896q0-.401.294-.682t.669-.281v0q.401 0 .682.281t.281.682v4.896h4.923q.401 0 .682.281t.281.682v0q0 .375-.281.669t-.682.294z"})})}function Et(t){return e.jsx(Q,{className:"close",fontSize:"inherit",style:{width:14,height:14},...t,children:e.jsx("path",{d:"M17.485 17.512q-.281.281-.682.281t-.696-.268l-4.12-4.147-4.12 4.147q-.294.268-.696.268t-.682-.281-.281-.682.294-.669l4.12-4.147-4.12-4.147q-.294-.268-.294-.669t.281-.682.682-.281.696 .268l4.12 4.147 4.12-4.147q.294-.268.696-.268t.682.281 .281.669-.294.682l-4.12 4.147 4.12 4.147q.294.268 .294.669t-.281.682zM22.047 22.074v0 0-20.147 0h-20.12v0 20.147 0h20.12zM22.047 24h-20.12q-.803 0-1.365-.562t-.562-1.365v-20.147q0-.776.562-1.351t1.365-.575h20.147q.776 0 1.351.575t.575 1.351v20.147q0 .803-.575 1.365t-1.378.562v0z"})})}function Nt(t){const o=Ee({from:{opacity:0,transform:"translate3d(20px,0,0)"},to:{opacity:t.in?1:0,transform:`translate3d(${t.in?0:20}px,0,0)`}});return e.jsx(Ne.div,{style:o,children:e.jsx(Oe,{...t})})}const Tt=Ae(t=>e.jsx(Re,{...t,TransitionComponent:Nt}))(({theme:t})=>({[`& .${se.iconContainer}`]:{"& .close":{opacity:.3}},[`& .${se.group}`]:{marginLeft:15,paddingLeft:18,borderLeft:`1px dashed ${De(t.palette.text.primary,.4)}`}}));function kt({compositionName:t,graphId:o,selectedPart:s,selectPart:a,nodeId:n}){const c=u("Graph"),{useGraph:l}=c.hooks,d=l(o,i=>i&&i.adjacencyList[n]&&{node:i.nodes[n],edges:i.edges?Object.values(i.edges).reduce((r,p)=>i.adjacencyList[n].outputs.includes(p.id)?{...r,[p.id]:p}:r,{}):{},connections:i.adjacencyList[n]});return d.state?e.jsx(S,{sx:{color:"text.primary"},children:e.jsx(Tt,{nodeId:n,label:e.jsxs(S,{sx:{height:"30px",alignItems:"center",display:"flex"},onClick:i=>{n!==s&&(a(n),i.stopPropagation())},children:[d.state.node.label,n===s&&e.jsxs(e.Fragment,{children:[e.jsx(St,{compositionName:t}),e.jsx($t,{compositionName:t})]})]}),onClick:()=>{a(n)},sx:{color:n===s?"secondary.main":"secondary.secondary"},children:d.state.connections.outputs.filter(i=>d.state?.edges[i].type==="COMPOSED_OF").map(i=>d.state&&e.jsx(ye,{compositionName:t,graphId:o,selectPart:a,selectedPart:s,nodeId:d.state.edges[i].targetId},`${n}-${d.state?.edges[i].targetId}`))})}):e.jsx(e.Fragment,{})}const ye=A.memo(kt);function At(){const t=u("Store"),o=u("Layout"),s=u("Graph"),{useAppSelector:a}=t.hooks,{useGraph:n}=s.hooks,{selectActiveViewport:c}=o.store.selectors,l=a(c),d=M.useCallback(p=>({name:p?.name,svgPath:p?.svgPath,graphId:p?.graphId,selectedPart:p?.selectedPart}),[]),i=w(l,d),r=n(l,p=>p?.adjacencyList);return!i.state?.svgPath||!i.state?.graphId||!i.state?.name||!r?null:e.jsx(Ge,{"aria-label":"composition tree",defaultExpanded:["root"],defaultCollapseIcon:e.jsx(wt,{}),defaultExpandIcon:e.jsx(Pt,{}),defaultEndIcon:e.jsx(Et,{}),sx:{flexGrow:1,maxWidth:"100%",overflowY:"auto"},children:e.jsx(ye,{compositionName:i.state.name,nodeId:"garment",graphId:i.state.graphId,selectPart:i.actions.selectPart,selectedPart:i.state.selectedPart})})}const Rt=()=>{const t=u("Layout"),{SettingsPanel:o,Accordion:s}=t.components;return e.jsxs(o,{children:[e.jsx(s,{name:"Composição",icon:e.jsx(Le,{}),summary:"composição da peça",children:e.jsx(At,{})}),e.jsx(s,{name:"Sumário",icon:e.jsx(Ve,{}),summary:"Resumo da peça",children:e.jsx(e.Fragment,{})}),e.jsx(s,{name:"Valores",icon:e.jsx(qe,{}),summary:"Preço da peça",children:e.jsx(e.Fragment,{})}),e.jsx(s,{name:"Prazos",icon:e.jsx(re,{}),summary:"tempo de produção",children:e.jsx(e.Fragment,{})})]})},Dt=A.memo(Rt),Ot=({graphId:t,node:o})=>{const{components:{MaterialSelector:s}}=u("Materials"),a=u("Graph"),{useGraph:n}=a.hooks,c=w(t,i=>i),l=n(t,i=>i?.nodes[o.materialId]),d=M.useCallback(i=>c.actions.changeMaterial(o.id,i),[t,o.id]);return e.jsx(s,{type:o.materialType,value:l?.state?.materialId,onChange:d})},Gt=({node:t,graphId:o})=>{const s=u("Graph"),{components:{MaterialTypeSelector:a}}=u("Materials"),{useNodeInfo:n,useGraph:c,useSearch:l}=s.hooks,d=c(o,m=>m?.nodes[t.id]),i=M.useMemo(()=>`${t.id}/materialType/restrictions`,[t?.id]),r=l(o,i,()=>{t&&d.actions.search("bfs",t.id,(m,b)=>m.type!=="RESTRICTION"?!1:b.adjacencyList[m.id].inputs.some(I=>{const $=b.edges[I];return $.type==="RESTRICTED_BY"&&$.attr==="materialType"}),()=>!1,1,`Get all restriction associated with ${t.label}`,i)}),p=M.useMemo(()=>r?.findings.reduce((m,b)=>b.restrictionType==="allowOnly"?[...m,...b.operand]:m,[]),[r]),f=n(o,t.materialType),g=w(o,m=>m),x=M.useCallback(m=>g.actions.changeMaterialType(t.id,m.target.value),[o,t.id]);return e.jsx(a,{filter:m=>r?.findings.length?p?.includes(m.name):!0,value:f.node?.id,onChange:x})},Lt=({graphId:t,nodeId:o})=>{const s=u("Graph"),{useNodeInfo:a}=s.hooks,{node:n}=a(t,o);return e.jsx(ce,{role:"material-info",children:e.jsx(de,{disableTypography:!0,primary:e.jsx(R,{component:"div",children:n.label}),secondary:e.jsx(R,{component:"div",children:e.jsx(S,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsx(S,{sx:{gap:1,display:"flex",flexWrap:"wrap",flexDirection:"row"},role:"material-attributes","aria-label":"material attributes",children:n.editableAttributes.map(c=>{switch(c){case"materialType":return e.jsx(Gt,{graphId:t,node:n},c);case"materialId":return e.jsx(Ot,{graphId:t,node:n},c);default:return e.jsx(e.Fragment,{children:"error"})}})})})})})})},Vt=({isOpen:t,labelState:[o,s],materialTypes:a,handleMaterialTypeChange:n})=>{const{components:{MaterialTypeSelector:c}}=u("Materials");return t?e.jsxs(S,{sx:{display:"flex",flexDirection:"column",flexGrow:2},children:[e.jsx(c,{value:a,onChange:n,multiple:!0}),e.jsx(G,{id:"material-usage-name",label:"Nome",variant:"standard",value:o,onChange:l=>s(l.target.value)})]}):e.jsx(e.Fragment,{})},qt=({compositionName:t})=>{const o=u("Pointer"),{PointerContainer:s,ConfirmAndCloseButton:a}=o.components,n=w(t,f=>f?.selectedPart),[c,l]=M.useState(""),[d,i]=M.useState([]),r=M.useCallback(()=>{n.state&&n.actions.addMaterialUsage(c,n.state,d)},[c]),p=M.useCallback(f=>i(g=>f.target.value),[t]);return e.jsx(s,{component:e.jsx(Vt,{materialTypes:d,handleMaterialTypeChange:p,labelState:[c,l]}),actions:[e.jsx(a,{color:"success",handleConfirm:r},"accept")],children:e.jsx(L,{startIcon:e.jsx(Y,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar material"})})},_t=({compositionName:t,materialUsageId:o})=>{const s=w(t,n=>n),a=M.useCallback(()=>{s.actions.removeMaterialUsage(o)},[s]);return e.jsx(k,{color:"error",id:"delete-material",onClick:a,sx:{flexGrow:2},children:e.jsx(Z,{})},"delete")},Ft=({compositionState:t,materialUsageId:o,isOpen:s})=>{const a=u("Graph"),n=u("Layout"),{useNodeInfo:c}=a.hooks,{CRUDGridContext:l}=n.contexts,{CRUDGrid:d,CRUDBooleanCell:i}=n.components,{node:r}=c(t.graphId,o),p=M.useMemo(()=>r.proxies.reduce((g,x)=>({...g,[x.elem]:{...g[x.elem],[x.attr]:!0}}),{}),[r]),{setRows:f}=M.useContext(l);return M.useEffect(()=>f(Object.entries(p).map(([g,x])=>({...x,elem:g,state:"untouched",id:D.uniqueId("proxy-")}))),[p]),s?e.jsxs(S,{role:"link-material-container",sx:{height:"max-content"},children:[e.jsx(R,{variant:"h4",children:"Elementos visuais vinculados"}),e.jsxs(R,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra os atuais elementos visuais vínculados com o material."}),e.jsx("p",{children:"Manipule a tabela para alterar os valores"})]}),e.jsx(d,{addLabel:"Adicionar vínculo",newRecord:()=>({id:D.uniqueId("proxy-"),stroke:!1,fill:!1}),columns:[{field:"elem",editable:!0,flex:1,width:100,minWidth:200,maxWidth:200,renderHeader:()=>"Elemento"},{field:"stroke",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Contorno",renderCell:({value:g})=>e.jsx(ne,{checked:g,disabled:!0}),renderEditCell:g=>e.jsx(i,{...g})},{field:"fill",editable:!0,width:100,flex:1,minWidth:100,maxWidth:200,renderHeader:()=>"Preenchimento",renderCell:({value:g})=>e.jsx(ne,{checked:g,disabled:!0}),renderEditCell:g=>e.jsx(i,{...g})}]})]}):e.jsx(e.Fragment,{})},Bt=A.memo(Ft),zt=({composition:t,materialUsageId:o,...s})=>{const a=u("Pointer"),n=u("Layout"),{ConfirmAndCloseButton:c}=a.components,{CRUDGridContext:l}=n.contexts,{rows:d}=M.useContext(l),i=M.useCallback(()=>{d.filter(r=>r.state==="deleted").forEach(r=>t.actions.deleteProxy(r.elem,o)),d.filter(r=>r.state==="modified").forEach(r=>{t.actions.deleteProxy(r.old.elem,o),r.stroke&&t.actions.addProxy({elem:r.elem,attr:"stroke"},o),r.fill&&t.actions.addProxy({elem:r.elem,attr:"fill"},o)}),d.filter(r=>r.state==="added").forEach(r=>{t.actions.deleteProxy(r.elem,o),r.stroke&&t.actions.addProxy({elem:r.elem,attr:"stroke"},o),r.fill&&t.actions.addProxy({elem:r.elem,attr:"fill"},o)})},[d]);return e.jsx(c,{color:"success",...s,handleConfirm:i})},Ut=({compositionName:t,materialUsageId:o})=>{const s=w(t,d=>d),a=u("Pointer"),n=u("Layout"),{PointerContainer:c}=a.components,{CRUDGridProvider:l}=n.components;return s.state?e.jsx(l,{initialRows:[],children:e.jsx(c,{component:e.jsx(Bt,{compositionState:s.state,materialUsageId:o}),actions:[e.jsx(zt,{composition:s,materialUsageId:o},"accept")],children:e.jsx(k,{id:"configure-material",sx:{flexGrow:2},children:e.jsx(_e,{})},"configure")})}):e.jsx(e.Fragment,{})};function Wt({node:t}){switch(t.restrictionType){case"allowOnly":return e.jsx(e.Fragment,{children:t.operand.join(",")});case"sameAs":return e.jsx(e.Fragment,{children:t.operand});default:return e.jsx(e.Fragment,{})}}function Ht({row:t,...o}){const{components:{CRUDMaterialTypeCell:s}}=u("Materials");switch(t.attribute){case"materialType":return e.jsx(s,{row:t,value:t.operand,...o,multiple:t.restrictionType==="allowOnly"});default:return e.jsx(e.Fragment,{})}}const Yt=({compositionState:t,materialUsageId:o})=>{const s=u("Graph"),a=u("Layout"),{useGraph:n,useSearch:c}=s.hooks,{CRUDGridContext:l}=a.contexts,{CRUDGrid:d}=a.components,{state:i,actions:{search:r}}=n(t.graphId,m=>m?.nodes[o]),p=M.useMemo(()=>`${o}/restrictions`,[o]),f=c(t.graphId,p,()=>{i&&r("bfs",i.id,(m,b)=>m.type!=="RESTRICTION"?!1:b.adjacencyList[m.id].inputs.some(I=>b.edges[I].type==="RESTRICTED_BY"),()=>!1,1,`Get all restriction associated with ${"label"in i?i.label:i.id}`,p)}),{setRows:g}=M.useContext(l);M.useEffect(()=>{f?.findings&&g(f.findings.map(m=>({...m,state:"untouched"})))},[f]),M.useEffect(()=>{f?.findings&&g(f.findings)},[]);const x=[{field:"label",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Restrição"},{field:"attribute",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Atributo",renderCell:({value:m})=>e.jsx(e.Fragment,{children:m})},{field:"restrictionType",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operador"},{field:"operand",editable:!0,flex:1,width:100,minWidth:200,maxWidth:400,renderHeader:()=>"Operando",renderCell:({row:m})=>e.jsx(Wt,{node:m}),renderEditCell:m=>e.jsx(Ht,{...m})}];return e.jsxs(S,{role:"restrictions-management-container",children:[e.jsx(R,{variant:"h4",children:"Restrições do material"}),e.jsxs(R,{component:"div",children:[e.jsx("p",{children:"A tabela abaixo mostra as atuais restrições para este material."}),e.jsxs("p",{children:["Quando essas condições são quebradas o modelo é considerado"," ",e.jsx("strong",{children:"inválido"}),"."]})]}),e.jsx(d,{addLabel:"Adicionar restrição",newRecord:()=>({id:D.uniqueId("hard-restriction-"),label:"Nova restricao",operand:[],restrictionType:"allowOnly",attribute:"materialType"}),columns:x})]})},Zt=t=>t.isOpen?e.jsx(S,{role:"add-restriction-container",sx:{height:"max-content",display:"flex",gap:2,justifyContent:"space-between",flexDirection:"column",padding:1},children:e.jsx(Yt,{...t})}):e.jsx("div",{}),Qt=({composition:t,materialUsageId:o,...s})=>{const a=u("Pointer"),n=u("Layout"),{ConfirmAndCloseButton:c}=a.components,{CRUDGridContext:l}=n.contexts,{rows:d}=M.useContext(l),i=M.useCallback(()=>{console.group("delete"),d.filter(r=>r.state==="deleted").forEach(r=>t.actions.removeRestriction(o,r.id)),console.groupEnd(),console.group("modified"),d.filter(r=>r.state==="modified").forEach(r=>{t.actions.updateRestriction(o,r.id,r)}),console.groupEnd(),console.group("added"),d.filter(r=>r.state==="added").forEach(r=>{t.actions.addRestriction(o,{type:"RESTRICTION",id:r.id,label:r.label,operand:r.operand,position:r.position,restrictionType:r.restrictionType,attribute:r.attribute})}),console.groupEnd()},[d]);return e.jsx(c,{color:"success",...s,handleConfirm:i})},Jt=({sx:t,materialUsageId:o,compositionName:s,...a})=>{const n=w(s,r=>r),c=u("Pointer"),l=u("Layout"),{PointerContainer:d}=c.components,{CRUDGridProvider:i}=l.components;return n.state?e.jsx(i,{initialRows:[],children:e.jsx(d,{component:e.jsx(Zt,{compositionState:n.state,materialUsageId:o}),actions:[e.jsx(Qt,{composition:n,materialUsageId:o},"accept")],children:e.jsx(k,{id:"restrict-material",sx:{flexGrow:2},children:e.jsx(Fe,{})},"restrict")})}):e.jsx(e.Fragment,{})},Kt=t=>e.jsxs(S,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(_t,{...t}),e.jsx(Ut,{...t}),e.jsx(Jt,{...t,sx:{hover:{fill:"yellow"}}})]});function Xt({compositionName:t,selectedPart:o,graphId:s}){const a=u("Graph"),{useNodeInfo:n}=a.hooks,{edges:c}=n(s,o);return e.jsxs(le,{sx:{width:"100%"},role:"material-list",children:[e.jsx(qt,{compositionName:t}),Object.values(c).filter(l=>l.type==="MADE_OF").map(l=>e.jsxs(V,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"material-container",children:[e.jsx(Lt,{graphId:s,nodeId:l.targetId}),e.jsx(Kt,{compositionName:t,materialUsageId:l.targetId})]},l.targetId))]})}const eo=({graphId:t,nodeId:o})=>{const s=u("Graph"),{useNodeInfo:a}=s.hooks,{node:n}=a(t,o);return e.jsx(ce,{children:e.jsx(de,{disableTypography:!0,primary:e.jsxs(S,{children:[e.jsx(R,{variant:"h6",sx:{fontWeight:"bold"},children:n.label}),e.jsx(Be,{})]}),secondary:e.jsx(R,{component:"div",sx:{padding:1},children:e.jsxs(S,{sx:{display:"flex",justifyContent:"space-between"},role:"material-attributes","aria-label":"material attributes",children:[e.jsxs(S,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(re,{})," ",n.time_taken.quotient.amount," ",n.time_taken.quotient.unit," /"," ",n.time_taken.dividend.amount," ",n.time_taken.dividend.unit]}),e.jsxs(S,{sx:{display:"flex",gap:.3,alignItems:"center"},children:[e.jsx(ze,{})," ",n.cost.quotient.amount," ",n.cost.quotient.unit," / ",n.cost.dividend.amount," ",n.cost.dividend.unit]})]})})})})},to=({compositionName:t})=>{const o=u("Pointer"),s=u("Converter"),{PointerContainer:a,ConfirmAndCloseButton:n}=o.components,{CompoundSelector:c}=s.components,{useScales:l}=s.hooks,d=l(),i=w(t,x=>x?.selectedPart),r=M.useMemo(()=>D.uniqueId("new-process-form"),[]),[p,f]=M.useState({label:"",cost:{quotient:{amount:1,unit:"R$"},dividend:{amount:1,unit:"un"}},time_taken:{quotient:{amount:1,unit:"m"},dividend:{amount:1,unit:"un"}}}),g=M.useCallback(x=>{x.preventDefault(),x.stopPropagation(),i.state&&i.actions.addOperation(p.label,p.cost,p.time_taken,i.state)},[p]);return e.jsx(a,{component:e.jsxs(S,{component:"form",onSubmit:g,id:r,sx:{display:"flex",flexDirection:"column",flexGrow:2,gap:1},children:[e.jsx(Ue,{children:e.jsx(G,{id:"name",label:"Nome",variant:"standard",sx:{marginBottom:1},onChange:x=>f(m=>({...m,label:x.target.value})),value:p.label})}),e.jsx(c,{id:"time-taken",label:"Tempo",quotientUnitsAvailable:()=>d.time,dividendUnitsAvailable:()=>[{value:"un",label:"Un"}],value:p.time_taken,onChange:x=>f(m=>({...m,time_taken:x}))}),e.jsx(c,{id:"cost",label:"Custo",quotientUnitsAvailable:()=>[{value:"R$",label:"R$"},{value:"$",label:"USD"}],dividendUnitsAvailable:()=>[{value:"un",label:"Un"}],value:p.cost,onChange:x=>f(m=>({...m,cost:x}))})]}),actions:[e.jsx(n,{type:"submit",form:r,value:"Submit",color:"success",handleConfirm:()=>null},"accept")],children:e.jsx(L,{startIcon:e.jsx(Y,{}),variant:"outlined",size:"small",sx:{marginBottom:1},children:"Adicionar processo"})})},oo=({compositionName:t,processId:o})=>{const s=w(t,n=>n),a=M.useCallback(()=>{s.actions.removeOperation(o)},[s]);return e.jsx(k,{color:"error",id:`delete-process-${o}`,onClick:a,sx:{flexGrow:2},children:e.jsx(Z,{})},"delete")},so=({composition:t,processId:o,...s})=>{const a=u("Pointer"),n=u("Layout"),{ConfirmAndCloseButton:c}=a.components,{CRUDGridContext:l}=n.contexts,{rows:d}=M.useContext(l),i=M.useCallback(()=>{},[d]);return e.jsx(c,{color:"success",...s,handleConfirm:i})},no=({sx:t,compositionName:o,processId:s,...a})=>{const n=w(o,r=>r),c=u("Pointer"),l=u("Layout"),{PointerContainer:d}=c.components,{CRUDGridProvider:i}=l.components;return n.state?e.jsx(i,{initialRows:[],children:e.jsx(d,{component:e.jsx(e.Fragment,{children:"div"}),actions:[e.jsx(so,{composition:n,processId:s},"accept")],children:e.jsx(k,{color:"default",id:"configure-process",sx:{flexGrow:2},children:e.jsx(We,{})},"configure")})}):e.jsx(e.Fragment,{})},ao=t=>e.jsxs(S,{sx:{display:"flex",flexDirection:"column",padding:0,justifyContent:"space-around",alignContent:"space-evenly"},role:"actions",children:[e.jsx(oo,{...t}),e.jsx(no,{...t})]});function io({compositionName:t,selectedPart:o,graphId:s}){const a=u("Graph"),{useNodeInfo:n}=a.hooks,{edges:c}=n(s,o);return e.jsxs(le,{sx:{width:"100%"},role:"processes-list",children:[e.jsx(to,{compositionName:t}),Object.values(c).filter(l=>l.type==="PROCESS_NEEDED").map(l=>e.jsxs(V,{variant:"outlined",square:!0,sx:{width:"100%",padding:1,"&:div + div":{borderTop:0},display:"flex"},role:"process-container",children:[e.jsx(eo,{graphId:s,nodeId:l.targetId}),e.jsx(ao,{compositionName:t,processId:l.targetId})]},l.targetId))]})}const ro=({graphId:t})=>{const o=u("Layout"),s=u("Store"),{useAppSelector:a}=s.hooks,{selectActiveViewport:n}=o.store.selectors,c=a(n),l=M.useCallback(i=>({name:i?.name,graphId:i?.graphId,selectedPart:i?.selectedPart}),[]),d=w(c,l);return!d.state?.selectedPart||!d.state?.graphId||!d.state?.name?null:e.jsx(co,{graphId:d.state.graphId,selectedPart:d.state.selectedPart,compositionName:d.state.name})},co=({graphId:t,selectedPart:o,compositionName:s})=>{const a=u("Layout"),n=u("Graph"),{DetailsPanel:c,Accordion:l}=a.components,{useGraph:d}=n.hooks,i=d(t,r=>r?.nodes[o]);return e.jsxs(c,{title:i.state?.label??o,children:[e.jsx(l,{name:"Opcionais",icon:e.jsx(U,{}),summary:"Lista de opcionais",sx:{flexGrow:1}}),e.jsx(l,{name:"Materiais",icon:e.jsx(U,{}),summary:"Lista de materiais",sx:{flexGrow:1},children:e.jsx(Xt,{graphId:t,selectedPart:o,compositionName:s})}),e.jsx(l,{name:"Processos",icon:e.jsx(U,{}),summary:"Lista de processos",sx:{flexGrow:1},children:e.jsx(io,{graphId:t,selectedPart:o,compositionName:s})})]})},lo=A.memo(ro),W=["Adicionar ao orçamento","Criar orçamento"];function po(){const[t,o]=M.useState(!1),s=M.useRef(null),[a,n]=M.useState(1),c=()=>{console.info(`You clicked ${W[a]}`)},l=(r,p)=>{n(p),o(!1)},d=()=>{o(r=>!r)},i=r=>{s.current&&s.current.contains(r.target)||o(!1)};return e.jsxs(M.Fragment,{children:[e.jsxs(He,{variant:"contained",ref:s,"aria-label":"split button",children:[e.jsx(L,{onClick:c,children:W[a]}),e.jsx(L,{size:"small","aria-controls":t?"split-button-menu":void 0,"aria-expanded":t?"true":void 0,"aria-label":"select merge strategy","aria-haspopup":"menu",onClick:d,children:e.jsx(Ye,{})})]}),e.jsx(Ze,{sx:{zIndex:1},open:t,anchorEl:s.current,role:void 0,transition:!0,disablePortal:!0,children:({TransitionProps:r,placement:p})=>e.jsx(Qe,{...r,style:{transformOrigin:p==="bottom"?"center top":"center bottom"},children:e.jsx(V,{children:e.jsx(Je,{onClickAway:i,children:e.jsx(Ke,{id:"split-button-menu",autoFocusItem:!0,children:W.map((f,g)=>e.jsx(Xe,{disabled:g===2,selected:g===a,onClick:x=>l(x,g),children:f},f))})})})})})]})}const mo=()=>e.jsx(S,{sx:{position:"absolute",bottom:10,right:10},children:e.jsx(po,{})}),uo=A.memo(mo),K=j(`[${C}:Compositions:${y.COMMAND}] Create composition`),X=j(`[${C}:Compositions:${y.COMMAND}] Close composition`);j(`[${C}:Compositions:${y.COMMAND}] Parse SVG`);const ee=j(`[${C}:Compositions:${y.COMMAND}] Fetch model `),ve=j(`[${C}:Compositions:${y.COMMAND}] Store model`),be=j(`[${C}:Compositions:${y.COMMAND}] Load proxies`),ho=j(`[${C}:Compositions:${y.EVENT}] Composition created`),go=j(`[${C}:Compositions:${y.EVENT}] Composition closed`);j(`[${C}:Compositions:${y.EVENT}] SVG parsed`);const Ie=j(`[${C}:Compositions:${y.EVENT}] Model fetched`),xo=j(`[${C}:Compositions:${y.EVENT}] Proxies loaded`),Se=j(`[${C}:Compositions:${y.EVENT}] Model stored`),fo=t=>t.Composer,te=()=>{const t=u("Store"),o=u("Graph"),s=u("Layout"),a=u("SVG"),{useAppDispatch:n,useAppSelector:c}=t.hooks,l=n(),d=s.hooks.useViewportManager(),i=a.hooks.useSVGManager(),r=o.managers.graphs(),{compositionsManager:p}=c(fo);return{functions:{createComposition(f,g){const x=d.functions.addViewport(f,"Composer",void 0,"composition-"),m=`catalog/${g}`;r.functions.createGraph(x),l(K({name:x,viewportName:x,svgPath:m,graphId:x})),i.functions.loadSVG(m,x)},createDebugView(f,g){const x=`debug-${f}`;d.functions.createGroup(x,"blue"),d.functions.addToGroup(g,x);const m=d.functions.addViewport("Modelo","DebuggerViewport",x,"debug-");l(B({compositionName:f,debugViewport:m})),d.functions.selectViewport(m)},findComposition(f){return Object.values(p.compositions).find(f)}}}},Co=()=>{const t=u("Store"),o=u("Layout"),{useAppSelector:s}=t.hooks,{selectActiveViewport:a}=o.store.selectors,n=s(a),c=M.useCallback(d=>d,[n]),l=w(n,c);return!n||!l.state?null:e.jsx(Mo,{selectPart:l.actions.selectPart,compositionInfo:l.state})},Mo=({compositionInfo:t,selectPart:o})=>{const{components:{SVGViewer:s},hooks:{useSVG:a}}=u("SVG"),{components:{MultiTouchPanel:n}}=u("Pointer"),{hooks:{useGraph:c}}=u("Graph"),l=u("Layout"),{ViewportNotificationsTray:d}=l.components,{graphId:i,svgPath:r,name:p,viewportName:f}=t,g=te(),x=c(i,v=>v?.nodes),m=a(r,v=>v?.instances[p]),b=M.useCallback(v=>{x.state&&Object.values(x.state).filter(I=>I.type==="PART").forEach(I=>{if(I.domId){const[$]=[...v?.querySelectorAll(`#${I.domId}`)];$.addEventListener("click",E=>{E.stopPropagation(),o(I.id)})}})},[i]),h=M.useCallback(()=>{g.functions.createDebugView(p,f)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{role:"composer-viewport",sx:{padding:1,height:"100%",position:"relative",cursor:"crosshair",overflow:"hidden"},children:[e.jsx(n,{gestures:{onPinch:v=>{m.actions.setZoom(p,v.offset[0])},onWheel:v=>{const I=m.state?.zoom??1;m.actions.setZoom(p,I+v.delta[1]*.001)}},children:e.jsx(s,{instanceName:p,path:r,beforeInjection:b})}),e.jsx(d,{children:e.jsx(et,{fontSize:"small",onClick:h,sx:{":hover":{cursor:"pointer",color:"primary.main"}}})}),e.jsx(Dt,{}),e.jsx(lo,{graphId:i})]}),e.jsx(uo,{})]})},jo=({closeModal:t,onModelSelection:o})=>e.jsx(V,{elevation:6,id:"open-model-modal",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4},children:e.jsx(S,{onClick:()=>{o("Decorated","camisa-polo/decorated.svg"),t?.()},sx:{cursor:"pointer"},children:"Camisa polo fem"})}),yo=()=>{const t=te(),o=u("Layout"),{SystemModal:s}=o.components,a=M.useCallback((n,c)=>{t.functions.createComposition(n,c)},[]);return e.jsx(e.Fragment,{children:e.jsx(s,{component:e.jsx(jo,{onModelSelection:a}),children:e.jsx(k,{children:e.jsx(tt,{})})})})},N=ae();N.startListening({actionCreator:K,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a();s(ho(n.compositions[t.name]))}});N.startListening({actionCreator:ot,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a();Object.values(n.compositions).forEach(c=>{c.viewportName===t.name&&s(X({name:c.name,graphId:c.graphId})),c.debugViewport===t.name&&s(st({viewportName:c.name}))})}});N.startListening({actionCreator:X,effect:async({payload:t},o)=>{const{dispatch:s}=o;s(nt({graphId:t.graphId})),s(go({name:t.name}))}});N.startListening({actionCreator:pe,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a(),c=Object.values(n.compositions).filter(r=>r.svgPath===t.path);if(!t.content)return;const i=new DOMParser().parseFromString(t.content,"image/svg+xml").getElementsByTagName("modelPath").item(0)?.innerHTML;i&&c.forEach(r=>{r.loading.loadModel==="not-started"&&s(ee({compositionName:r.name,modelPath:i}))})}});N.startListening({actionCreator:ee,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a(),c=n.compositions[t.compositionName],d=await(await(await fetch(t.modelPath)).blob()).text();s(Ie({compositionName:c.name,model:JSON.parse(d)}))}});N.startListening({actionCreator:Ie,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a(),c=n.compositions[t.compositionName];s(be({compositionName:c.name,model:t.model})),s(ve({compositionName:c.name,model:t.model}))}});N.startListening({actionCreator:be,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a(),c=n.compositions[t.compositionName],l=t.model.nodes;Object.values(l).forEach(d=>{if(!("proxies"in d))return;const i=d.proxies.reduce((r,p)=>({...r,[p.elem]:{...r[p.elem],[p.attr]:"grey"}}),{});Object.entries(i).forEach(([r,p])=>{s(me({path:c.svgPath,instanceName:c.name,id:r,styles:p}))})}),s(xo({compositionName:c.name,model:t.model}))}});N.startListening({actionCreator:ve,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a(),c=n.compositions[t.compositionName];s(at({graphId:c.graphId,graph:t.model})),s(Se({compositionName:c.name,model:t.model}))}});N.startListening({actionCreator:B,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n}}=a();n.compositions[t.compositionName],s(It({compositionName:t.compositionName,viewportName:t.debugViewport}))}});const P=ae();P.startListening({actionCreator:he,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:n},Materials:{materials:c,materialTypes:l}}=a(),d=c[t.materialId],i=l[d.type],r=i.schemas[i.latestSchema],p=n.compositions[t.compositionName].graphId,f=`material-${t.materialId}`,g={id:f,type:"MATERIAL",label:d.attributes[r.selector.principal],materialId:t.materialId,position:{x:0,y:0}};s(ue({graphId:p,node:g,edges:{inputs:{},outputs:{}}})),s(gt({compositionName:t.compositionName,materialId:t.materialId,nodeId:f}))}});P.startListening({actionCreator:ge,effect:async({payload:{compositionName:t,materialUsageId:o,materialId:s}},a)=>{const{dispatch:n,getState:c}=a,l=c(),d=l.Composer.compositionsManager.compositions[t],i=l.Graph.graphs[d.graphId],r=l.Materials.materials[s],p=`material-${s}`;p in i.nodes||n(he({compositionName:d.name,materialId:s}));const g=i.nodes[o],x=Object.values(i.edges).filter(m=>m.sourceId===o&&m.type=="CONSUMES");if("proxies"in g&&g.proxies.length>0&&"cor"in r.attributes){const m=g.proxies.reduce((b,{attr:h,elem:v})=>({...b,[v]:{...b[v],[h]:r.attributes.cor.hex}}),{});Object.entries(m).forEach(([b,h])=>{n(it({path:d.svgPath,instanceName:d.name,id:b,changes:h}))})}n(q({graphId:d.graphId,nodeId:o,changes:{materialId:p}})),n(rt({edge:{id:`${o}->${p}`,sourceId:o,targetId:p,type:"CONSUMES"},graphId:d.graphId})),x.forEach(m=>{n(ct({graphId:d.graphId,edgeId:m.id}))}),n(Ct({compositionName:t,materialUsageId:o,materialId:p}))}});P.startListening({actionCreator:_,effect:async({payload:t},o)=>{const{dispatch:s}=o;s(xt(t))}});P.startListening({actionCreator:dt,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:{compositions:n}}}=a(),c=Object.values(n).find(l=>l.viewportName===t.viewportName);c&&s(F({compositionName:c.name}))}});P.startListening({actionCreator:F,effect:async({payload:t},o)=>{const{dispatch:s}=o;s(ft({compositionName:t.compositionName}))}});P.startListening({actionCreator:Ce,effect:async({payload:{compositionName:t,materialId:o,restriction:s}},a)=>{const{dispatch:n,getState:c}=a,{Composer:{compositionsManager:{compositions:l}},Graph:{graphs:d}}=c(),i=l[t],{searchResults:r}=d[i.graphId];n(ue({graphId:i.graphId,node:s,edges:{inputs:{[o]:{id:`${o}->${s.id}`,type:"RESTRICTED_BY",attr:s.attribute,sourceId:o,targetId:s.id}},outputs:{}}})),Object.entries(r).filter(([p,f])=>!!p.includes("restriction")).forEach(([p,f])=>n(J({graphId:i.graphId,searchId:p}))),n(yt({compositionName:t,materialId:o,restrictionId:s.id}))}});P.startListening({actionCreator:je,effect:async({payload:{compositionName:t,materialId:o,restrictionId:s,changes:a}},n)=>{const{dispatch:c,getState:l}=n,{Composer:{compositionsManager:{compositions:d}},Graph:{graphs:i}}=l(),r=d[t],{searchResults:p}=i[r.graphId];c(q({graphId:r.graphId,nodeId:s,changes:a})),Object.entries(p).filter(([f,g])=>!!g.findings.find(x=>x.id===s)).forEach(([f,g])=>c(J({graphId:r.graphId,searchId:f}))),c(bt({compositionName:t,materialId:o,restrictionId:s}))}});P.startListening({actionCreator:Me,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:{compositions:n}},Graph:{graphs:c}}=a(),l=n[t.compositionName],{searchResults:d}=c[l.graphId];s(lt({graphId:l.graphId,nodeId:t.restrictionId})),Object.entries(d).filter(([i,r])=>!!r.findings.find(p=>p.id===t.restrictionId)).forEach(([i,r])=>s(J({graphId:l.graphId,searchId:i}))),s(vt(t))}});P.startListening({actionCreator:fe,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:{compositions:n}},Graph:{graphs:c}}=a(),l=n[t.compositionName],d=c[l.graphId];if(!l.selectedPart){console.warn("trying to delete proxy without selecting a part");return}const i=d.nodes[t.materialId];if(!("proxies"in i))return;const r=i.proxies.filter(p=>p.elem!==t.proxyId);s(q({graphId:l.graphId,nodeId:t.materialId,changes:{proxies:r}})),s(pt({path:l.svgPath,instanceName:l.name,id:t.proxyId})),s(jt(t))}});P.startListening({actionCreator:xe,effect:async({payload:t},o)=>{const{dispatch:s,getState:a}=o,{Composer:{compositionsManager:{compositions:n}},Graph:{graphs:c},Materials:{materials:l}}=a(),d=n[t.compositionName],i=c[d.graphId];if(!d.selectedPart){console.error("trying to delete proxy without selecting a part");return}const r=i.nodes[t.materialId];if(!("proxies"in r)){console.error("trying to add proxy in an node that does not support proxies");return}const p=[...r.proxies,t.proxy],f=Number(r.materialId.split("-")[1]),g=l[f];if(!("cor"in g.attributes)){console.error("material does not have a color attribute ");return}const x=p.filter(m=>m.elem===t.proxy.elem).reduce((m,b)=>({...m,[b.attr]:g.attributes.cor.hex}),{});s(q({graphId:d.graphId,nodeId:t.materialId,changes:{proxies:p}})),s(me({path:d.svgPath,instanceName:d.name,id:t.proxy.elem,styles:x})),s(Mt(t))}});const vo={loading:{loadSVG:"not-started",loadModel:"not-started"}},bo={compositionsManager:{compositions:{}}},H=ie({name:C,initialState:{},reducers:{},extraReducers:t=>{t.addCase(_,(o,{payload:{partName:s}})=>({...o,selectedPart:s})),t.addCase(F,o=>({...o,selectedPart:void 0})),t.addCase(B,(o,{payload:s})=>({...o,debugViewport:s.debugViewport}))}}),Io=ie({name:C,initialState:bo,reducers:{},extraReducers:t=>{t.addCase(K,(o,{payload:{name:s,viewportName:a,svgPath:n,graphId:c}})=>({...o,compositionsManager:{...o.compositionsManager,compositions:{...o.compositionsManager.compositions,[s]:{...vo,name:s,svgPath:n,graphId:c,viewportName:a}}}})),t.addCase(X,(o,{payload:{name:s}})=>({...o,compositionsManager:{...o.compositionsManager,compositions:Object.values(o.compositionsManager.compositions).reduce((a,n)=>n.name===s?a:{...a,[n.name]:n},{})}})),t.addCase(mt,(o,{payload:{path:s}})=>{const a=Object.values(o.compositionsManager.compositions).find(n=>n.svgPath===s);return a?{...o,compositionsManager:{compositions:{...o.compositionsManager.compositions,[a.name]:{...a,loading:{...a.loading,loadSVG:"started"}}}}}:o}),t.addCase(pe,(o,{payload:{path:s}})=>{const a=Object.values(o.compositionsManager.compositions).find(n=>n.svgPath===s);return a?{...o,compositionsManager:{compositions:{...o.compositionsManager.compositions,[a.name]:{...a,loading:{...a.loading,loadSVG:"completed"}}}}}:o}),t.addCase(ee,(o,{payload:{compositionName:s}})=>({...o,compositionsManager:{compositions:{...o.compositionsManager.compositions,[s]:{...o.compositionsManager.compositions[s],loading:{...o.compositionsManager.compositions[s].loading,loadModel:"started"}}}}})),t.addCase(Se,(o,{payload:s})=>({...o,compositionsManager:{compositions:{...o.compositionsManager.compositions,[s.compositionName]:{...o.compositionsManager.compositions[s.compositionName],loading:{...o.compositionsManager.compositions[s.compositionName].loading,loadModel:"completed"}}}}})),t.addCase(_,(o,s)=>({...o,compositionsManager:{...o.compositionsManager,compositions:{...o.compositionsManager.compositions,[s.payload.compositionName]:H.reducer(o.compositionsManager.compositions[s.payload.compositionName],s)}}})),t.addCase(F,(o,s)=>({...o,compositionsManager:{...o.compositionsManager,compositions:{...o.compositionsManager.compositions,[s.payload.compositionName]:H.reducer(o.compositionsManager.compositions[s.payload.compositionName],s)}}})),t.addCase(B,(o,s)=>({...o,compositionsManager:{...o.compositionsManager,compositions:{...o.compositionsManager.compositions,[s.payload.compositionName]:H.reducer(o.compositionsManager.compositions[s.payload.compositionName],s)}}}))}}),So=({name:t})=>{const o=u("Graph"),s=u("Layout"),{ViewportNotificationsTray:a,DetailsPanel:n,SettingsPanel:c,Accordion:l}=s.components,{components:{GraphViewer:d}}=o,i=te(),r=M.useMemo(()=>i.functions.findComposition(p=>p.debugViewport===t),[t]);return e.jsxs(S,{role:"composer-debugger-viewport",sx:{padding:1,height:"100%",position:"relative",overflow:"hidden"},children:[r&&e.jsx(d,{graphId:r?.graphId}),e.jsx(a,{children:e.jsx(e.Fragment,{})}),e.jsxs(c,{title:"Configurações",children:[e.jsx(l,{name:"Tipos de nodos",summary:"Tipos de nodos disponiveis",children:e.jsx(e.Fragment,{})}),e.jsx(e.Fragment,{})]}),e.jsx(n,{children:e.jsx(e.Fragment,{})})]})},$o=A.memo(So);function wo({managers:{storeManager:t,componentRegistryManager:o,layoutManager:s,ribbonMenuManager:a,viewportManager:n}}){t.functions.loadReducer(C,Io.reducer),t.functions.registerMiddleware(N),t.functions.registerMiddleware(P),o.functions.registerComponents({ribbonMenuSections:{ModelSelector:A.memo(yo)},viewportTypes:{Composer:A.memo(Co),DebuggerViewport:$o}}),a.functions.addNewTab({label:"Compositor",sectionNames:["ModelSelector"],type:"base"})}const To={name:C,version:ut,depends_on:["Layout","Graph","SVG","Materials","Converter"],components:{},kernelCalls:{startModule:wo,restartModule(){},shutdownModule(){}}};export{To as m};
