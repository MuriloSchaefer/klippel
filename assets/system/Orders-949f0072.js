import{c as w,d as D,e as _,_ as z,r as g,o as e,B as v,aG as T,Z as M,b as U,b2 as q,b3 as $,T as W,bk as Y,bl as Z,bm as H,bn as J,P as K,bo as Q,bp as X}from"../vendor-a3d4e7ed.js";import{A as S,n as u}from"../kernel-4d57db79.js";const C="Orders",ee="0.0.1",te={budgets:{},orders:{}},k=w(`[${C}:Compositions:${S.COMMAND}] Create budget`),I=w(`[${C}:Compositions:${S.COMMAND}] Delete budget`),oe=w(`[${C}:Compositions:${S.EVENT}] Budget created`),ne=w(`[${C}:Compositions:${S.EVENT}] Budget deleted`),se=D({name:"budgets",initialState:{},reducers:{},extraReducers:t=>{t.addCase(k,(n,{payload:s})=>({...n,[s.id]:s})),t.addCase(I,(n,{payload:s})=>Object.values(n).reduce((r,c)=>c.id===s.id?r:{...r,[c.id]:c},{}))}}),re=D({name:C,initialState:te,reducers:{},extraReducers:t=>{t.addCase(k,(n,s)=>({...n,budgets:se.reducer(n.budgets,s)}))}}),A=_();A.startListening({actionCreator:k,effect:async({payload:t},n)=>{const{dispatch:s}=n;s(oe({id:t.id}))}});A.startListening({actionCreator:I,effect:async({payload:t},n)=>{const{dispatch:s,getState:r}=n,{Orders:{budgets:c}}=r(),o=c[t.id];s(ne(o))}});function ae({managers:{storeManager:t,componentRegistryManager:n,layoutManager:s,ribbonMenuManager:r,viewportManager:c}}){t.functions.loadReducer(C,re.reducer),t.functions.registerMiddleware(A)}function B(){const t=u("Store"),n=u("Layout"),s=u("Composer"),{useAppDispatch:r,useAppSelector:c}=t.hooks,{useViewportManager:o}=n.hooks,{selectActiveViewport:d}=n.store.selectors,{useComposition:l}=s.hooks,m=r(),i=o(),a=c(d),b=l({viewportName:a},p=>p?.name);return{createBudget(p,y){if(!a)throw Error("No active viewport");const h=z.uniqueId("budget-");i.functions.createGroup(h,y),i.functions.addToGroup(a,h),m(k({id:h,label:p,viewportGroup:h})),b.actions.addToBudget(b.state,h)},addTobudget(p){if(!a)throw Error("No active viewport");i.functions.addToGroup(a,p),b.actions.addToBudget(b.state,p)}}}const f={"create-budget":{id:"create-budget",label:"Criar orçamento",color:"info"},"add-to-budget":{id:"add-to-budget",label:"Adicionar ao orçamento",color:"info"},"convert-to-order":{id:"convert-to-order",label:"Converter em pedido",color:"success"},"delete-budget":{id:"delete-budget",label:"Deletar orçamento",color:"error"}},E=f["create-budget"];function ce(){const t=u("Pointer"),n=u("Layout"),{PointerContainer:s,ConfirmAndCloseButton:r}=t.components,{ColorPicker:c}=n.components,[o,d]=g.useState({label:"",color:""}),l=B(),m=g.useCallback(()=>{l.createBudget(o.label,o.color)},[o.color,o.label,l]);return e.jsx(s,{actions:[e.jsx(r,{type:"submit",value:"Submit",color:"success",handleConfirm:m},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(c,{sx:{width:"40px",height:"40px"},colorChange:i=>d(a=>({...a,color:i.hex}))}),e.jsx(T,{id:"part-name",label:"Nome",variant:"standard",value:o.label,onChange:i=>d(a=>({...a,label:i.target.value}))})]}),children:e.jsx(M,{color:E.color,children:E.label})})}const le=t=>t.Orders,ie=()=>U(le,t=>Object.values(t?.budgets??{}));function de(t){const n=u("Store"),s=u("Layout"),{useAppSelector:r}=n.hooks,{getViewportGroups:c}=s.store.selectors,o=r(ie()),d=r(c);return e.jsx(q,{...t,sx:{width:"200px",...t.sx},autoWidth:!0,inputProps:{sx:{display:"flex",gap:1}},children:o.map(l=>e.jsxs($,{value:l.id,sx:{display:"flex",gap:1},children:[e.jsx(v,{sx:{width:"20px",height:"20px",backgroundColor:d[l.viewportGroup].color}}),e.jsx(W,{children:l.label})]},l.id))})}const O=f["add-to-budget"];function ue(){const t=u("Pointer"),{PointerContainer:n,ConfirmAndCloseButton:s}=t.components,[r,c]=g.useState(""),o=B(),d=g.useCallback(()=>o.addTobudget(r),[r,o]);return e.jsx(n,{actions:[e.jsx(s,{type:"submit",value:"Submit",color:"success",handleConfirm:d},"accept")],component:e.jsx(e.Fragment,{children:e.jsx(de,{value:r,onChange:l=>c(l.target.value),sx:{width:"100%"}})}),children:e.jsx(M,{color:O.color,children:O.label})})}const N=f["convert-to-order"];function pe(){const t=u("Pointer"),n=u("Layout"),{PointerContainer:s,ConfirmAndCloseButton:r}=t.components,{ColorPicker:c}=n.components,[o,d]=g.useState({label:"",color:""}),l=B(),m=g.useCallback(()=>{l.createBudget(o.label,o.color)},[o.color,o.label,l]);return e.jsx(s,{actions:[e.jsx(r,{type:"submit",value:"Submit",color:"success",handleConfirm:m},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(c,{sx:{width:"40px",height:"40px"},colorChange:i=>d(a=>({...a,color:i.hex}))}),e.jsx(T,{id:"part-name",label:"Nome",variant:"standard",value:o.label,onChange:i=>d(a=>({...a,label:i.target.value}))})]}),children:e.jsx(M,{color:N.color,children:N.label})})}const L=f["delete-budget"];function ge(){const t=u("Pointer"),n=u("Layout"),{PointerContainer:s,ConfirmAndCloseButton:r}=t.components,{ColorPicker:c}=n.components,[o,d]=g.useState({label:"",color:""}),l=B(),m=g.useCallback(()=>{l.createBudget(o.label,o.color)},[o.color,o.label,l]);return e.jsx(s,{actions:[e.jsx(r,{type:"submit",value:"Submit",color:"success",handleConfirm:m},"accept")],component:e.jsxs(v,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(c,{sx:{width:"40px",height:"40px"},colorChange:i=>d(a=>({...a,color:i.hex}))}),e.jsx(T,{id:"part-name",label:"Nome",variant:"standard",value:o.label,onChange:i=>d(a=>({...a,label:i.target.value}))})]}),children:e.jsx(M,{color:L.color,children:L.label})})}function me({allowedActions:t=["create-budget","add-to-budget","convert-to-order","delete-budget"]}){const n=u("Store"),s=u("Layout"),r=u("Composer"),{useAppSelector:c}=n.hooks,{useComposition:o}=r.hooks,{selectActiveViewport:d}=s.store.selectors,l=c(d),m=o({viewportName:l},x=>x),[i,a]=g.useState(!1),b=g.useRef(null),[p,y]=g.useState(t[0]??"create-budget");g.useEffect(()=>{t.length&&!t.includes(p)&&y(t[0])},[t]);const h=(x,P)=>{y(P),a(!1)},G=()=>{a(x=>!x)},V=x=>{b.current&&b.current.contains(x.target)||a(!1)};return!m.state||!t.length?e.jsx(e.Fragment,{}):e.jsxs(v,{sx:{position:"absolute",bottom:10,right:10},children:[e.jsxs(Y,{variant:"contained",ref:b,"aria-label":"budget button",children:[p==="create-budget"&&e.jsx(ce,{}),p==="add-to-budget"&&e.jsx(ue,{}),p==="convert-to-order"&&e.jsx(pe,{}),p==="delete-budget"&&e.jsx(ge,{}),e.jsx(M,{size:"small","aria-haspopup":"menu",onClick:G,color:f[p].color,children:e.jsx(Z,{})})]}),e.jsx(H,{sx:{zIndex:1},open:i,anchorEl:b.current,role:"budget-floating-buttons",transition:!0,disablePortal:!0,children:({TransitionProps:x,placement:P})=>e.jsx(J,{...x,style:{transformOrigin:P==="bottom"?"center top":"center bottom"},children:e.jsx(K,{children:e.jsx(Q,{onClickAway:V,children:e.jsx(X,{id:"split-button-menu",autoFocusItem:!0,children:t.map(F=>{const j=f[F];return e.jsx($,{selected:j.id===p,onClick:R=>h(R,j.id),color:j.color,children:j.label},j.id)})})})})})})]})}const he={name:C,version:ee,depends_on:["Composer"],components:{BudgetFloatingButton:me},hooks:{useBudgetManager:B},kernelCalls:{startModule:ae,restartModule(){},shutdownModule(){}}};export{he as m};
