import{r as d,u as Pt,a as It,R as L,c as h,b as A,_ as ee,d as O,e as N,l as We,f as _t,g as Ut,s as zt,z as Ft,h as Bt,i as Wt,j as Ht,k as Yt,m as Xt,n as qt,o as r,p as Qe,S as Kt,q as He,M as Qt,A as Zt,t as Jt,B as $,T as Z,v as es,w as Ce,I,x as J,E as te,y as ts,C as ss,D as os,F as ns,G as Ze,P as Je,H as as,J as rs,K as se,L as oe,N as z,O as F,Q as is,U as cs,V as ds,W as ls,X as us,Y as ps,Z as gs,$ as hs,a0 as fs,a1 as ms,a2 as xs,a3 as ys,a4 as Cs,a5 as ws,a6 as Ye,a7 as Ms,a8 as bs,a9 as Ss,aa as vs,ab as et,ac as B,ad as $s,ae as js,af as Es,ag as ks,ah as Rs,ai as Vs,aj as As,ak as Ds,al as Ls,am as Ts,an as Os,ao as Gs,ap as Ns}from"./vendor-2fa183ac.js";const tt="Store",Ps="0.0.1",st=d.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),Is=()=>{const{loadReducers:e,registerMiddleware:t}=d.useContext(st);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},ot=()=>Pt(),_s=It,nt=d.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>L.memo(()=>null),registerComponents:()=>null}),Us=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=d.useContext(nt);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},K={name:tt,version:Ps,depends_on:[],managers:{store:Is,componentRegistry:Us},hooks:{useAppDispatch:ot,useAppSelector:_s},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},we=d.createContext({modules:{},setModules:()=>null}),f={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},E="Graph",zs="0.0.1",Fs=h(`[${E}:Instance:${f.EVENT}] Graph loaded`),Bs=h(`[${E}:Instance:${f.EVENT}] Node added`),Ws=h(`[${E}:Instance:${f.EVENT}] Node removed`),Hs=h(`[${E}:Instance:${f.EVENT}] Node updated`),Ys=h(`[${E}:Instance:${f.EVENT}] Edge added`),Xs=h(`[${E}:Instance:${f.EVENT}] Edge removed`),xe=h(`[${E}:Instance:${f.EVENT}] Search finished`),qs=h(`[${E}:Instance:${f.EVENT}] Search invalidated`),at=h(`[${E}:Instance:${f.COMMAND}] Load Graph`),rt=h(`[${E}:Instance:${f.COMMAND}] Reset Graph`),ne=h(`[${E}:Instance:${f.COMMAND}] Add node`),ae=h(`[${E}:Instance:${f.COMMAND}] Remove node`),re=h(`[${E}:Instance:${f.COMMAND}] Update node`),ie=h(`[${E}:Instance:${f.COMMAND}] Add edge`),ce=h(`[${E}:Instance:${f.COMMAND}] Remove edge`),it=h(`[${E}:Instance:${f.COMMAND}] Search`),ct=h(`[${E}:Instance:${f.COMMAND}] Invalidate Search`),R=e=>{const{modules:t}=d.useContext(we),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},dt={inputs:{},outputs:{}},de=(e,t)=>{const s=R("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,a=A(c=>c?.Graph&&c.Graph.graphs[e],t),i=n(a),l=n(c=>c?.Graph&&c.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(c,u)=>{const p={...c,position:{x:0,y:0}};o(ne({graphId:e,node:p,edges:u??dt}))},removeNode:c=>{o(ae({graphId:e,nodeId:c}))},updateNode:c=>{o(re({graphId:e,nodeId:c.id,changes:c}))},addEdge:c=>{o(ie({graphId:e,edge:c}))},removeEdge:c=>{o(ce({graphId:e,edgeId:c}))},nodeExists:c=>l?c in l.nodes:!1,search:(c,u,p,C,y,M,k)=>{const m=k??ee.uniqueId("search");return o(it({id:m,graphId:e,strategy:c,nodeStart:u,validate:p,stopCriteria:C,depth:y,label:M??m})),m}}}},Me={nodes:{},edges:{},adjacencyList:{},searchResults:{}},lt={graphs:{}};h(`[${E}:${f.EVENT}:Init] Graph Module loaded`);const Ks=h(`[${E}:GraphsManager:${f.EVENT}] Graph created`),Qs=h(`[${E}:GraphsManager:${f.EVENT}] Graph destroyed`),be=h(`[${E}:GraphsManager:${f.COMMAND}] Create graph`),ut=h(`[${E}:GraphsManager:${f.COMMAND}] Destroy graph`),Zs=O({name:E,initialState:lt,reducers:{},extraReducers:e=>{e.addCase(at,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ne,(t,{payload:{graphId:s,node:o,edges:n}})=>{const a=t.graphs[s];if(!a)throw Error("Graph does not exist");if(a.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...a,nodes:{...a.nodes,[o.id]:o},edges:{...a.edges,...Object.entries(n.inputs).reduce((l,[c,u])=>({...l,[c]:u}),{}),...Object.entries(n.outputs).reduce((l,[c,u])=>({...l,[c]:u}),{})},adjacencyList:{...a.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((l,[c,u])=>({...l,[u.sourceId]:{...a.adjacencyList[u.sourceId],outputs:[...a.adjacencyList[u.sourceId].outputs,c]}}),{}),...Object.entries(n.outputs).reduce((l,[c,u])=>({...l,[u.targetId]:{...a.adjacencyList[u.targetId],inputs:[...a.adjacencyList[u.targetId].inputs,c]}}),{})}}}}}).addCase(ae,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([a,i])=>i.sourceId===o||i.targetId===o).map(([a,i])=>a);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((a,i)=>i.id!==o?{...a,[i.id]:i}:a,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,l])=>i!==o?{...a,[i]:{inputs:l.inputs.filter(c=>!n.includes(c)),outputs:l.outputs.filter(c=>!n.includes(c))}}:a,{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,l])=>n.includes(i)?a:{...a,[i]:l},{})}}}}).addCase(re,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const a=t.graphs[s],i=a.nodes[o];if(i===null)throw Error("Node does not exist");return a.nodes[o]={...i,...n},t}).addCase(ie,(t,{payload:{graphId:s,edge:o}})=>{const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(ce,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s],a=n.edges[o];if(!a)throw Error("Edge does not exist");return delete n.edges[o],n.adjacencyList[a.sourceId].outputs=n.adjacencyList[a.sourceId].outputs.filter(i=>i!==a.id),n.adjacencyList[a.targetId].inputs=n.adjacencyList[a.targetId].inputs.filter(i=>i!==a.id),t}).addCase(rt,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...Me}}})).addCase(xe,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(ct,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),Js=O({name:E,initialState:lt,reducers:{},extraReducers:e=>{e.addCase(be,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...Me,id:s},t}).addCase(ut,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(Zs.reducer)}}),Se=N();Se.startListening({actionCreator:be,effect:async(e,t)=>{const{dispatch:s}=t;s(Ks(e.payload))}});Se.startListening({actionCreator:ut,effect:async(e,t)=>{const{dispatch:s}=t;s(Qs(e.payload))}});const eo=(e,t,s,o,n)=>{const a=[],i=[];let l=0;const c=[t];for(;c.length;){const u=c.shift();if(!u)break;const p=e.nodes[u];if(a.push(p),s(p,e,i,a)&&i.push(p),o(p,e,i,a))break;if(n&&l>=n)continue;const y=e.adjacencyList[u];c.push(...y.outputs.map(M=>e.edges[M].targetId)),c.push(...y.inputs.map(M=>e.edges[M].sourceId)),l+=1}return{findings:i,visited:a}},to=(e,t,s,o,n)=>({findings:[],visited:[]}),G=N();G.startListening({actionCreator:at,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(Fs({graphId:e,graph:t}))}});G.startListening({actionCreator:ne,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(Bs({graphId:e,node:t,edges:s}))}});G.startListening({actionCreator:ae,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o(Ws({graphId:e,nodeId:t}))}});G.startListening({actionCreator:re,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Hs(e))}});G.startListening({actionCreator:ie,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Ys(e))}});G.startListening({actionCreator:ce,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Xs(e))}});G.startListening({actionCreator:it,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),a=n[e.graphId];if(a.searchResults&&e.id in a.searchResults&&!a.searchResults[e.id].outdated){s(xe({graphId:e.graphId,searchId:e.id,results:a.searchResults[e.id]}));return}let i={findings:[],visited:[]};switch(e.strategy){case"dfs":i={...to(a,e.nodeStart,e.validate,e.stopCriteria,e.depth)};break;case"bfs":i=eo(a,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(xe({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});G.startListening({actionCreator:ct,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(qs(e))}});const w="Layout",so="0.0.1",ve="ribbonMenuSections",_="viewportTypes",pt="settings-panel",gt="details-panel",ht="viewport-notifications-tray";function oo(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const no=({width:e,height:t,nodeBorder:s})=>{const o=We().domain([-1,e+1]).range([-1,e+1]),n=We().domain([-1,t+1]).range([-1,t+1]),a=_t(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=Ut(n).ticks(10).tickSize(e).tickPadding(8-e);function l(C){C.append("circle").attr("r",y=>y.radius).attr("fill",y=>oo(y.group??"")).attr("stroke",s),C.append("text").text(y=>y.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function c(C){function y(m){m.active||C.alphaTarget(.3).restart(),m.subject.fx=m.subject.x,m.subject.fy=m.subject.y}function M(m){m.subject.fx=m.x,m.subject.fy=m.y}function k(m){m.active||C.alphaTarget(0),m.subject.fx=null,m.subject.fy=null}return Xt().on("start",y).on("drag",M).on("end",k)}function u(C){C.append("line").attr("stroke-width","1em").attr("stroke","gray")}function p(C){C.each(y=>{C.attr("viewBox",[0,0,e,t]),C.selectAll("*").remove(),C.append("defs");const k=C.append("g").attr("role","grid"),m=C.append("g").attr("role","container"),g=k.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),S=k.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),b=Ft().scaleExtent([-10,40]).filter(x=>(x.preventDefault(),(!x.ctrlKey||x.type==="wheel")&&!x.button)).on("zoom",({transform:x})=>{m.attr("transform",x),g.call(a.scale(x.rescaleX(o))),S.call(i.scale(x.rescaleY(n)))});C.call(b);const j=Bt(y.nodes).force("links",Wt(y.links).id(x=>x.id).distance(300).strength(1)).force("charge",Ht().strength(x=>x.strength)).force("colide",Yt(x=>x.radius)),D=m.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(y.links).join(x=>x.append("g").attr("role","link").attr("id",T=>T.id).call(u),x=>x,x=>x.remove()),v=m.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(y.nodes).join(x=>x.append("g").attr("role","node").attr("id",T=>T.id).call(c(j)).call(l),x=>x.select("circle").attr("cx",T=>T.x).attr("cy",T=>T.y),x=>x.remove());j.on("tick",()=>{v.attr("transform",x=>`translate(${x.x}, ${x.y})`),D.selectAll("line").attr("x1",x=>x.source.x).attr("y1",x=>x.source.y).attr("x2",x=>x.target.x).attr("y2",x=>x.target.y)}),j.alpha(1)})}return{render(C,y){zt(y).datum(C).call(p)}}},ao=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=R("Layout"),s=d.useRef(null),o=d.useRef(null),n=t(o),a=de(e,u=>u),i=d.useMemo(()=>!a.state||!a.state.nodes?{nodes:[],links:[]}:{nodes:Object.values(a.state.nodes).map(u=>({id:u.id,group:u.type,nodeLabel:u?.label||u.id,strength:-400,x:u.position.x,y:u.position.y,radius:50})),links:Object.values(a.state.edges).map(u=>({id:u.id,type:u.type,source:u.sourceId,target:u.targetId,value:5}))},[a]),l=qt(),c=no({nodeBorder:l.palette.getContrastText(l.palette.background.default),width:n?.width??0,height:n?.height??0});return d.useEffect(()=>{!n||!s.current||c.render(i,s.current)},[i,n]),a.state?r.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:r.jsx("svg",{ref:s,id:`${a.id}`,width:"100%",height:"100%"})}):r.jsx(r.Fragment,{})},ft=L.memo(ao),ro=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(E,Js.reducer),e.functions.registerMiddleware(Se),e.functions.registerMiddleware(G),t.functions.createRegistries({[ve]:{},[_]:{graph:ft}})},io=()=>{const e=ot();return{functions:{createGraph(t){return e(be({graphId:t})),{id:t,state:{id:t,...Me},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ne({graphId:t,node:n,edges:o??dt}))},removeNode:s=>{e(ae({graphId:t,nodeId:s}))},updateNode:s=>{e(re({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(ie({graphId:t,edge:s}))},removeEdge:s=>{e(ce({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(rt({graphId:t}))}}}},co=(e,t)=>{const o=t??(n=>n);return A(n=>n.Graph,n=>n&&o(n.graphs[e]))},lo=(e,t)=>{const s=R("Graph"),{useGraph:o}=s.hooks,n=o(e,l=>l?.nodes[t]),a=o(e,l=>l?.adjacencyList[t]),i=o(e,l=>Object.values(l?.edges??{}).filter(c=>a.state?.inputs?.includes(c.id)||a.state?.outputs?.includes(c.id)).reduce((c,u)=>({...c,[u.id]:u}),{}));return{node:n.state,edges:i.state??{},adjacencyList:a.state??{inputs:[],outputs:[]}}},mt=(e,t)=>de(e,o=>o?.searchResults&&o.searchResults[t]).state,uo=(e,t,s)=>{d.useEffect(()=>{s()},[]);const o=mt(e,t);return d.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},Xe={name:E,version:zs,depends_on:["Store"],components:{GraphViewer:ft},managers:{graphs:io},hooks:{useGraph:de,useNodeInfo:lo,useSearch:uo,useSearchResult:mt},store:{selectors:{getGraphState:co}},kernelCalls:{startModule:ro,restartModule(){},shutdownModule(){}}},le=h(`[${w}:Theme:${f.COMMAND}] Switch theme`),po=h(`[${w}:Theme:${f.EVENT}] Theme switched`),xt=N();xt.startListening({actionCreator:le,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(po(e))}});const $e=h(`[${w}:Ribbon:${f.COMMAND}] Add tab`),je=h(`[${w}:Ribbon:${f.COMMAND}] Select tab`),go=h(`[${w}:Ribbon:${f.EVENT}] tab added`),ho=h(`[${w}:Ribbon:${f.EVENT}] tab selected`),Ee=N();Ee.startListening({actionCreator:$e,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(go({tab:n[e.name]}))}});Ee.startListening({actionCreator:je,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(ho({tab:n[e]}))}});const ke=h(`[${w}:Viewports:${f.COMMAND}] Add viewport`),Re=h(`[${w}:Viewports:${f.COMMAND}] Select viewport`),Ve=h(`[${w}:Viewports:${f.COMMAND}] Close viewport`),yt=h(`[${w}:Viewports:${f.COMMAND}] Rename viewport`),Ae=h(`[${w}:Viewports:${f.COMMAND}] Add viewport to group`),ye=h(`[${w}:Viewports:${f.COMMAND}] Viewport removed from group`),fo=h(`[${w}:Viewports:${f.EVENT}] Viewport added`),mo=h(`[${w}:Viewports:${f.EVENT}] Viewport selected`),xo=h(`[${w}:Viewports:${f.EVENT}] Viewport closed`);h(`[${w}:Viewports:${f.EVENT}] Viewport renamed`);const yo=h(`[${w}:Viewports:${f.EVENT}] Viewport added to group`);h(`[${w}:Viewports:${f.EVENT}] Viewport removed from group`);const U=N();U.startListening({actionCreator:ke,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(fo(n[e]))}});U.startListening({actionCreator:Re,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(mo(n[e]))}});U.startListening({actionCreator:Ve,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(xo({name:e}))}});U.startListening({actionCreator:Ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(yo(e))}});U.startListening({actionCreator:ye,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(ye(e))}});const De=h(`[${w}:Viewports:${f.COMMAND}] Create group`),Co=h(`[${w}:Viewports:${f.EVENT}] Group created`),Ct=N();Ct.startListening({actionCreator:De,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Co(e))}});const Le=h(`[${w}:Panels:${f.COMMAND}] Expand settings panel`),Te=h(`[${w}:Panels:${f.COMMAND}] Collapse settings panel`),Oe=h(`[${w}:Panels:${f.COMMAND}] Open details panel`),Ge=h(`[${w}:Panels:${f.COMMAND}] Close details panel`),wo=h(`[${w}:Panels:${f.EVENT}] Settings panel expanded`),Mo=h(`[${w}:Panels:${f.EVENT}] Settings panel collapsed`),bo=h(`[${w}:Panels:${f.EVENT}] Details panel opened`),So=h(`[${w}:Panels:${f.EVENT}] Details panel closed`),H=N();H.startListening({actionCreator:Le,effect:async(e,t)=>{const{dispatch:s}=t;s(wo())}});H.startListening({actionCreator:Te,effect:async(e,t)=>{const{dispatch:s}=t;s(Mo())}});H.startListening({actionCreator:Oe,effect:async(e,t)=>{const{dispatch:s}=t;s(bo())}});H.startListening({actionCreator:Ge,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(So({viewportName:n}))}});const vo=O({name:`${w}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(De,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),$o=O({name:`${w}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(ke,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(Ve,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,a])=>n===s.name?o:{...o,[n]:a},{})})),e.addCase(Re,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(yt,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[a,i])=>a===s?{...n,[s]:{...i,title:o}}:{...n,[a]:i},{})})),e.addCase(Ae,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(ye,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:vo.reducer(t.groups,s)}))}}),jo=O({name:`${w}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase($e,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(je,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),wt={settings:{state:"expanded"},details:{state:"closed"}},Eo=O({name:w,initialState:wt,reducers:{},extraReducers:e=>{e.addCase(Le,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Te,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(Oe,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(Ge,t=>({...t,details:{...t.details,state:"closed"}}))}}),ko={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:wt,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},Ro=O({name:w,initialState:ko,reducers:{},extraReducers:e=>{e.addCase(le,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:Eo.reducer(t.panels,s),ribbonMenu:jo.reducer(t.ribbonMenu,s),viewportManager:$o.reducer(t.viewportManager,s)}))}}),Q=({name:e,icon:t,summary:s,expanded:o,state:n,children:a,sx:i,...l})=>{const c=Qe("(min-width:1024px)");return n==="collapsed"?r.jsx(Kt,{children:t??r.jsx(He,{})}):r.jsxs(Qt,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...l,children:[r.jsx(Zt,{expandIcon:r.jsx(Jt,{}),"aria-controls":`accordion-${e}-content`,children:r.jsxs($,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??r.jsx(He,{}),r.jsx(Z,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&c&&r.jsx(Z,{component:"div",sx:{color:"text.secondary"},children:s})]})}),r.jsx(es,{children:a})]})};function Ne(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(Le())},collapseSettings(){s(Te())},openDetails(){s(Oe())},closeDetails(){s(Ge())}}}}A(e=>e.Layout,e=>e&&e.panels);const Vo=A(e=>e.Layout,e=>e&&e.panels.settings),Ao=A(e=>e.Layout,e=>e&&e.panels.details),Mt=({title:e,display:t,children:s})=>{const o=document.getElementById(gt),n=Qe("(orientation: portrait)"),a=R("Store"),{useAppSelector:i}=a.hooks,l=Ne(),c=i(Ao),u=d.useCallback(p=>{p.stopPropagation(),c&&c.state==="opened"&&l.functions.closeDetails()},[c?.state]);return!o||!c?null:Ce.createPortal(r.jsxs($,{role:"details-panel","aria-label":"details panel",display:c.state==="opened"?"flex":"none",sx:{flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!n&&r.jsx(I,{size:"small",component:"span",onClick:u,children:c.state==="opened"&&r.jsx(J,{})}),r.jsx("span",{children:e??"Detalhes"})]}),r.jsx($,{role:"panel-content",children:r.jsx(te,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),o)},bt=({title:e,children:t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=Ne(),a=o(Vo),i=document.getElementById(pt),l=d.useCallback(c=>{c.stopPropagation(),a&&a.state==="collapsed"&&n.functions.expandSettings(),a&&a.state==="expanded"&&n.functions.collapseSettings()},[a?.state]);return!i||!a?null:Ce.createPortal(r.jsx($,{sx:{position:"relative"},children:r.jsxs($,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:a.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:a.state==="collapsed"?"8vw":"100%"}},children:[r.jsxs($,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.state==="expanded"&&r.jsxs(r.Fragment,{children:[r.jsx(ts,{}),r.jsx("span",{children:e??"Configurações"})]}),r.jsx(I,{size:"small",component:"span",onClick:l,children:a.state==="collapsed"?r.jsx(ss,{sx:{transform:"rotate(90deg)"}}):r.jsx(os,{sx:{transform:"rotate(90deg)"}})})]}),r.jsx($,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:a.state==="collapsed"?2:0,marginTop:4},children:r.jsx(te,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:t.map((c,u)=>d.cloneElement(c,{state:a.state,key:u}))})})]})}),i)},Do=({name:e,title:t,type:s,group:o})=>r.jsxs(r.Fragment,{children:[r.jsxs(bt,{children:[r.jsx(Q,{name:"Agenda",icon:r.jsx(ns,{}),expanded:!0,children:r.jsx(r.Fragment,{})}),r.jsx(Q,{name:"Recebimentos",summary:"Recebimentos do mês",children:r.jsx(r.Fragment,{})}),r.jsx(Q,{name:"Andamento",summary:"Pedidos em produção",children:r.jsx(r.Fragment,{})})]}),r.jsx(Mt,{children:r.jsx(r.Fragment,{children:"Detalhes"})})]}),Lo=L.memo(Do),To=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer(w,Ro.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(le({theme:"dark"})),t.functions.registerMiddleware(xt),t.functions.registerMiddleware(Ee),t.functions.registerMiddleware(U),t.functions.registerMiddleware(Ct),t.functions.registerMiddleware(H),s.functions.createRegistries({[ve]:{},[_]:{home:Lo}})};function St(){const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(le({theme:o}))}}}}const vt=d.createContext({sections:{},setSections:()=>null}),Oo=({children:e,default_sections:t})=>{const[s,o]=d.useState(t??{});function n(i,l){o({...s,[i]:l})}const a=d.useMemo(()=>({sections:s,setSections:n}),[s]);return r.jsx(vt.Provider,{value:a,children:e})},$t=e=>e&&e.Layout?.ribbonMenu,jt=A($t,e=>e&&e.tabs),Go=A($t,e=>e&&e.activeTab);function Et(){const e=R("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),a=t(jt);return d.useContext(vt),o(),{functions:{tabExists(i){return a!=null&&i in a},addNewTab(i){const l=ee.uniqueId("tab-"),c={...i,name:l,active:!1};n($e({tab:c}))},selectTab(i){n(je({name:i}))}}}}function kt(){const e=R("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(a){n.functions.registerComponents({[_]:a})},getViewportTypeComponent(a){const i=n.functions.getComponent(_,a);if(!i)throw Error("Unknown viewport type");return i},addViewport(a,i,l,c="viewport"){if(!n.functions.getComponent(_,i))throw Error("Unknown viewport type");const p=ee.uniqueId(c);return o(ke({name:p,title:a,type:i,group:l})),p},renameViewport(a,i){o(yt({oldName:a,newName:i}))},selectViewport(a){o(Re({name:a}))},closeViewport(a){o(Ve({name:a}))},createGroup(a,i){o(De({name:a,color:i}))},addToGroup(a,i){o(Ae({viewportName:a,groupName:i}))}}}}const Pe=A(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Rt=e=>e.Layout.viewportManager,No=A(Rt,e=>e&&e.viewports),Vt=(e,t)=>{const o=t??(n=>n);return A(Rt,n=>n&&o(n.viewports[e]))},Po=({children:e})=>{const t=document.getElementById(ht);return t?Ce.createPortal(r.jsx($,{sx:{position:"relative"},children:e}),t):null},Io=({title:e,component:t,children:s,sx:o={}})=>{const[n,a]=d.useState(!1),i=d.useCallback(c=>{a(!0),c.stopPropagation()},[]),l=d.useCallback(()=>{a(!1)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{open:n,onClose:l,components:{Backdrop:void 0},children:r.jsxs(Je,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&r.jsx(Z,{variant:"subtitle1",component:"span",children:e}),L.cloneElement(t,{closeModal:l})]})}),r.jsx($,{onClick:i,children:s})]})},Ie=d.createContext({rows:[],setRows:()=>null}),_o=({children:e,initialRows:t})=>{const[s,o]=d.useState((t??[]).map(a=>({...a,state:"untouched"}))),n=d.useMemo(()=>({rows:s,setRows:o}),[s]);return r.jsx(Ie.Provider,{value:n,children:e})},ge=(e,t)=>t==="dark"?se(e,.7):oe(e,.7),he=(e,t)=>t==="dark"?se(e,.6):oe(e,.6),fe=(e,t)=>t==="dark"?se(e,.5):oe(e,.5),me=(e,t)=>t==="dark"?se(e,.4):oe(e,.4),Uo=as(rs)(({theme:e})=>({"& .state--added":{backgroundColor:ge(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:ge(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:ge(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:he(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:fe(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:me(e.palette.error.main,e.palette.mode)}}}})),zo=()=>r.jsx($,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:r.jsx(Z,{variant:"body2",children:"Sem registros"})}),Fo=({handleAddRecord:e,addLabel:t})=>r.jsxs(ps,{sx:{display:"flex",justifyContent:"space-around"},children:[r.jsx(gs,{startIcon:r.jsx(hs,{}),onPointerUp:e,children:t||"Adicionar"}),r.jsxs("div",{children:[r.jsx(fs,{}),r.jsx(ms,{})]})]}),Bo=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:a}=d.useContext(Ie),[i,l]=d.useState({}),c=()=>{const g=s();a(S=>[...S,{...g,state:"added"}]),l(S=>({...S,[g.id]:{mode:z.Edit,fieldToFocus:"id"}}))},u=d.useCallback(g=>()=>{l(S=>({...S,[g]:{mode:z.Edit}}))},[]),p=g=>(a(S=>S.map(b=>b.id===g.id?{...g,old:{...b,old:null}}:b)),g),C=(g,S)=>{g.reason===xs.rowFocusOut&&(S.defaultMuiPrevented=!0)},y=d.useCallback(g=>{const S=n.find(j=>j.id===g);if(!S)return;const b=S.state==="untouched"?"modified":S.state;a(j=>j.map(D=>D.id===g?{...D,state:b}:D)),l(j=>({...j,[g]:{mode:z.View}}))},[n]),M=d.useCallback(g=>()=>{a(S=>S.map(b=>b.id===g?{...b,state:"deleted",oldState:b.state}:b).filter(b=>!(b.state==="deleted"&&b?.oldState==="added")))},[]),k=d.useCallback(g=>()=>{a(S=>S.map(b=>b.id===g?{...b,state:b.oldState,oldState:"deleted"}:b))},[]),m=d.useCallback(g=>()=>{l(b=>({...b,[g]:{mode:z.View,ignoreModifications:!0}}));const S=n.find(b=>b.id===g);S&&S.state==="added"&&a(b=>b.filter(j=>j.id!==g))},[n]);return r.jsx(r.Fragment,{children:r.jsx(Uo,{editMode:"row",density:"compact",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:C,processRowUpdate:p,slotProps:{toolbar:{handleAddRecord:c,addLabel:t}},slots:{noRowsOverlay:zo,toolbar:Fo},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",flex:2,minWidth:80,maxWidth:200,cellClassName:"actions",getActions:({id:g})=>{const S=n.find(j=>j.id===g);return S?i[g]?.mode===z.Edit?[r.jsx(F,{icon:r.jsx(is,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>y(g)},"save"),r.jsx(F,{icon:r.jsx(cs,{}),label:"Cancel",className:"textPrimary",onClick:m(g),color:"inherit"},"cancel")]:S.state==="deleted"?[r.jsx(F,{icon:r.jsx(ds,{}),label:"Restore",className:"textPrimary",onClick:k(g),color:"inherit"},"restore")]:[r.jsx(F,{icon:r.jsx(ls,{}),label:"Edit",className:"textPrimary",onClick:u(g),color:"inherit"},"edit"),r.jsx(F,{icon:r.jsx(us,{}),label:"Delete",onClick:M(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})})};function Wo({id:e,value:t,field:s}){const o=ys(),n=a=>{const i=a.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return r.jsx(Cs,{checked:t,onChange:n})}const Ho=e=>{const[t,s]=d.useState();return d.useEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(a=>{a.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},At={name:w,version:so,depends_on:[],components:{SettingsPanel:bt,DetailsPanel:Mt,ViewportNotificationsTray:Po,Accordion:Q,SystemModal:Io,CRUDGrid:Bo,CRUDBooleanCell:Wo,CRUDGridProvider:_o},contexts:{CRUDGridContext:Ie},hooks:{useLayoutManager:St,useRibbonMenuManager:Et,useViewportManager:kt,usePanelsManager:Ne,useResizeObserver:Ho},store:{selectors:{selectActiveViewport:Pe,getViewportState:Vt}},kernelCalls:{startModule:To,restartModule(){},shutdownModule(){}}},Y="Loader",Yo="0.0.1",W="modules",Dt=h(`[${Y}:${f.EVENT}] Module started`),Xo=h(`[${Y}:${f.COMMAND}] Start module`),qo={modulesCount:1,modulesGraph:W},Ko=O({name:Y,initialState:qo,reducers:{},extraReducers:e=>{e.addCase(Dt,t=>(t.modulesCount+=1,t))}}),Qo=({managers:{storeManager:e}})=>{e.functions.loadReducer(Y,Ko.reducer)};class qe extends Error{}class Zo extends Error{}const Jo=e=>e.modulesCount,en=()=>{const{modules:e,setModules:t}=d.useContext(we),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=At.hooks,{store:a,componentRegistry:i}=K.managers,l=s(),c=o(),u=n(),p=a(),C=i(),y=K.hooks.useAppDispatch(),M=K.hooks.useAppSelector;return{modulesLoaded:M(Jo),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new Zo(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),y(Xo(g.name)),g.kernelCalls.startModule({dispatch:y,managers:{storeManager:p,componentRegistryManager:C,layoutManager:l,ribbonMenuManager:c,viewportManager:u}}),y(Dt(g.name))},unloadModule(g){if(!(g in e))throw new qe(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(p),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new qe(`${g} is not registered.`);const S=e[g];t(e),S.kernelCalls.restartModule(p)}}}},Ke={name:Y,version:Yo,depends_on:["Store","Graph"],managers:{modules:en},kernelCalls:{startModule:Qo,restartModule:()=>null,shutdownModule:()=>null}},tn=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=Ke.managers.modules(),o=de(W,v=>v&&v.id),[n,a]=d.useState(!0),[i,l]=d.useState(!1),[c,u]=d.useState(0),[p,C]=d.useState(0),[y,M]=d.useState(0),k=d.useMemo(()=>[Ke,Xe,At],[]),m=Xe.managers.graphs(),{createGraph:g,resetGraph:S}=m.functions;d.useEffect(()=>{const v=k[c];v&&!s.functions.isModuleLoaded(v.name)&&b(v)},[c]),d.useEffect(()=>{if(c===k.length){const v=t.kernel[p];v&&!s.functions.isModuleLoaded(v.name)&&j(v)}},[c,p]),d.useEffect(()=>{if(p===t.kernel.length){const v=t.system[y];v&&!s.functions.isModuleLoaded(v.name)&&D(v)}},[p,y]),d.useEffect(()=>{y===t.system.length&&a(!1)},[y]),d.useEffect(()=>{!n&&!o.state&&(g(W),l(!0))},[n]),d.useEffect(()=>{if(i&&!o.state&&g(W),!i)return;S(W);const v={id:"root",type:"ROOT"};o.actions.addNode(v),k.forEach(x=>o.actions.addNode({id:x.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${x.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:x.name}},outputs:{}})),t.kernel.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:x.name,type:"EXTRA_KERNEL_MODULE"},{inputs:T,outputs:{}})}),t.system.forEach(x=>{x.depends_on.push("Loader");const T=x.depends_on.reduce((ue,P)=>{const pe={id:`${P}->${x.name}`,type:"DEPENDS_ON",sourceId:P,targedId:x.name};return{...ue,[P]:pe}},{});o.actions.addNode({id:x.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:T,outputs:{}})}),a(!1)},[i]);function b(v){s.functions.loadModule(v),u(c+1)}function j(v){s.functions.loadModule(v),C(p+1)}function D(v){s.functions.loadModule(v),M(y+1)}return n?r.jsx("div",{children:"Iniciando sistema"}):e},sn=({children:e,loadModules:t})=>{const[s,o]=d.useState({Store:K}),n=d.useMemo(()=>({modules:s,setModules:o}),[s]);return r.jsx(we.Provider,{value:n,children:r.jsx(tn,{extraModules:t,afterLoadComponent:e})})},_n=L.memo(sn),on={},q=O({name:tt,initialState:on,reducers:{},extraReducers:e=>{}}),nn=({children:e,default_registries:t})=>{const[s,o]=d.useState(t??{}),n=d.useMemo(()=>({registries:s,createRegistry:a,createRegistries:i,getComponent:l,registerComponents:c}),[s]);function a(u){o({...s,[u]:{}})}function i(u){o({...s,...u})}function l(u,p){return s[u][p]}function c(u){const p=s,C=Object.entries(u).reduce((y,[M,k])=>M in y?{...y,[M]:{...y[M],...k}}:y,p);o(C)}return r.jsx(nt.Provider,{value:n,children:e})},an=({children:e})=>{const[t,s]=d.useState({[q.name]:q.reducer}),o=d.useMemo(()=>ws({reducer:Ye({[q.name]:q.reducer}),middleware:i=>i({serializableCheck:!1}).concat(Ms)}),[]),n=i=>{Ss(i.middleware)},a=d.useCallback(i=>{const l={...t,...i};s(l),o.replaceReducer(Ye(l))},[t]);return r.jsx(bs,{store:o,children:r.jsx(st.Provider,{value:{currentReducers:t,loadReducers:a,registerMiddleware:n},children:r.jsx(nn,{children:e})})})},Un=L.memo(an),Lt=A(e=>e.Layout,e=>e&&e.theme),rn=({systemTray:e})=>{const t=R("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),a=Et(),{selectTab:i}=a.functions,l=s(jt),c=s(Go),u=d.useCallback(p=>{i(p)},[]);return!c||!l?r.jsx(r.Fragment,{}):r.jsxs(vs,{value:c,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[r.jsx(et,{value:c,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(l).map(([p,C])=>r.jsx(B,{value:p,label:C.label,id:p,onClick:()=>u(p),wrapped:!0},p))}),r.jsx($,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),r.jsx($,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:l&&Object.entries(l).map(([p,C])=>r.jsx($s,{value:p,children:C.sectionNames&&C.sectionNames.map(y=>{const M=n.functions.getComponent(ve,y);return d.createElement(M,{key:`ribbon-panel-${p}-section-${y}`},[])})},`ribbon-panel-${p}`))})]})},cn=({children:e,...t})=>{const s=d.useMemo(()=>({file:[r.jsx("div",{children:"test"},"test")]}),[]);return r.jsx(Oo,{default_sections:s,children:r.jsx(rn,{...t,systemTray:e})})},dn=L.memo(cn),ln=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Pe),n=t(Vt(o));if(!n)return null;const a=s.functions.getComponent(_,n.type);return a?r.jsx(te,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.createElement(a,n,[])}):null},un=A(e=>e.Layout.viewportManager,e=>e&&e.groups),pn=({sx:e,...t})=>{const s=R("Store"),{useAppSelector:o}=s.hooks,n=o(un),a=o(Pe),i=o(No),l=d.useMemo(()=>Object.entries(i).reduce((M,[k,m])=>k==="home"?M:m.group?{...M,[m.group]:m.group in M?[...M[m.group],m]:[m]}:{...M,notGrouped:[...M.notGrouped,m]},{notGrouped:[]}),[i]),{functions:{addViewport:c,closeViewport:u,selectViewport:p}}=kt(),C=d.useCallback(()=>{c("Nova aba","home",void 0,"new-")},[]),y=d.useCallback(M=>{u(M)},[]);return r.jsxs($,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[r.jsxs($,{sx:{display:"flex",justifyContent:"space-between"},children:[r.jsxs(et,{value:a,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[r.jsx(B,{value:"home",icon:r.jsx(js,{}),iconPosition:"start",onClick:()=>p("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(l).map(([M,k])=>M==="notGrouped"?k.map(m=>r.jsx(B,{value:m.name,id:m.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?p(m.name):y(m.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:m.title}),r.jsx(J,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),y(m.name)}})]}),draggable:!0,wrapped:!0},`${m.name}-tab`)):k.map(m=>r.jsx(B,{value:m.name,id:m.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[m.group].color},onClick:()=>p(m.name),label:r.jsxs($,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:m.title}),r.jsx(I,{size:"small",component:"span",children:r.jsx(J,{sx:{width:.5,marginLeft:1},onClick:g=>{g.stopPropagation(),y(m.name)}})})]}),draggable:"true",wrapped:!0},`${m.name}-tab`))),r.jsx(B,{value:"new",icon:r.jsx(Es,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:C,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),r.jsx($,{id:ht,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),r.jsx($,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:r.jsx(ln,{})})]})},gn=L.memo(pn),hn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Lt),o=St(),n=d.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return r.jsx($,{role:"system-tray-container",children:r.jsx(I,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?r.jsx(ks,{fontSize:"small"}):r.jsx(Rs,{fontSize:"small"})})})},fn=L.memo(hn),mn=Vs($)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,xn=()=>{const e=R("Store"),{useAppSelector:t}=e.hooks,s=t(Lt),o=d.useMemo(()=>As({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return r.jsxs(Ds,{theme:o,children:[r.jsx(Ls,{}),r.jsx($,{role:"layout-root",sx:{minHeight:"100vh"},children:r.jsxs(mn,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[r.jsx($,{sx:{gridArea:"ribbon",width:"100%"},children:r.jsx(dn,{children:r.jsx(fn,{})})}),r.jsx($,{id:pt,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),r.jsx(gn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),r.jsx($,{id:gt,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},zn=L.memo(xn),yn=e=>e.SVG,Cn=e=>A(yn,t=>t&&t.svgs[e]),wn=({path:e,instanceName:t,beforeInjection:s})=>{const o=R("Store"),{useAppSelector:n}=o.hooks,a=n(Cn(e)),i=d.useCallback(c=>{if(c.setAttribute("id",`${e}-root`),c.setAttribute("width","100%"),c.setAttribute("height","100%"),t){if(!a?.instances[t])return;Object.entries(a?.instances[t].proxies??{}).forEach(([p,C])=>{const y=c.getElementById(p);y&&("fill"in C&&y.setAttribute("fill",C.fill),"stroke"in C&&y.setAttribute("stroke",C.stroke))})}s&&s(c)},[s,a?.content,t,a?.instances[t]]),l=d.useMemo(()=>a?.content&&window.URL.createObjectURL(new Blob([a.content],{type:"image/svg+xml"})),[a?.content]);return!a||!l?null:r.jsx($,{role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{width:"100%",height:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:r.jsx(Ts,{style:{width:"100%",overflow:"hidden"},src:l,height:"100%",width:"100%",beforeInjection:i})})},V="SVG",Mn="0.0.1",_e=h(`[${V}:SVG:${f.COMMAND}] Load SVG`),Tt=h(`[${V}:SVG:${f.COMMAND}] Fetch SVG`),Ot=h(`[${V}:SVG:${f.COMMAND}] Set pan`),Gt=h(`[${V}:SVG:${f.COMMAND}] Set zoom`),Nt=h(`[${V}:SVG:${f.COMMAND}] Add proxy`),Ue=h(`[${V}:SVG:${f.COMMAND}] Update proxy`),ze=h(`[${V}:SVG:${f.COMMAND}] Delete proxy`),Fe=h(`[${V}:SVG:${f.EVENT}] SVG fetched`),bn=h(`[${V}:SVG:${f.EVENT}] SVG loaded`);h(`[${V}:SVG:${f.COMMAND}] Proxy added`);const Sn=h(`[${V}:SVG:${f.COMMAND}] Proxy updated`),vn=h(`[${V}:SVG:${f.COMMAND}] Proxy deleted`),$n=(e,t)=>{const s=R("Store"),{useAppDispatch:o}=s.hooks,n=o(),a=s.hooks.useAppSelector,i=A(c=>c&&c.SVG.svgs[e],t);return{state:a(i),actions:{setPan(c,u,p){n(Ot({path:e,instanceName:c,x:u*-10,y:p*-10}))},setZoom(c,u){n(Gt({path:e,instanceName:c,zoom:u}))},addProxy(c,u,p){n(Nt({path:e,instanceName:u,id:c,styles:p}))},deleteProxy(c,u){n(ze({path:e,instanceName:u,id:c}))},updateProxy(c,u,p){n(Ue({path:e,instanceName:u,id:c,changes:p}))}}}},jn=()=>{const e=R("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(_e({path:o,instanceName:n}))}}}},X=N();X.startListening({actionCreator:_e,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Tt({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(Fe({path:e.path,content:n}))}});X.startListening({actionCreator:Fe,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(bn(n[e.path]))}});X.startListening({actionCreator:Ue,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(Sn(n[e.path].instances[e.instanceName].proxies))}});X.startListening({actionCreator:ze,effect:async({payload:e},{dispatch:t})=>{t(vn(e))}});const En={progress:"not-started",instances:{},content:void 0},kn={svgs:{}},Rn=O({name:V,initialState:kn,reducers:{},extraReducers:e=>{e.addCase(_e,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!ee.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...En,instances:n}}}}),e.addCase(Tt,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(Fe,(t,{payload:{path:s,content:o}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(Nt,(t,{payload:{path:s,instanceName:o,id:n,styles:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:a}:{[n]:a}}}}}})),e.addCase(Gt,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(Ot,(t,{payload:{path:s,instanceName:o,x:n,y:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,a]}}}}})),e.addCase(Ue,(t,{payload:{path:s,instanceName:o,id:n,changes:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...a}:a}}}}}})),e.addCase(ze,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((a,[i,l])=>i===n?a:{...a,[i]:l},{})}}}}}))}}),Vn=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(V,Rn.reducer),e.functions.registerMiddleware(X)},Fn={name:V,version:Mn,depends_on:[],components:{SVGViewer:wn},hooks:{useSVGManager:jn,useSVG:$n},kernelCalls:{startModule:Vn,restartModule(){},shutdownModule(){}}},An=({initialPosition:e})=>{const[t,s]=d.useState(!1),[o,n]=d.useState({x:0,y:0}),[a,i]=d.useState(e),l=d.useCallback(p=>{s(!0),n({x:p.clientX,y:p.clientY}),p.stopPropagation()},[]),c=d.useCallback(p=>{if(!t)return;const C={x:p.clientX-o.x,y:p.clientY-o.y},y={x:a.x+C.x,y:a.y+C.y};i(y)},[t]),u=d.useCallback(p=>{s(!1),p.stopPropagation()},[]);return{position:a,setPosition:i,listeners:{onPointerDown:l,onPointerMove:c,onPointerUp:u}}},Dn=({children:e,component:t,actions:s,onClose:o})=>{const[n,a]=d.useState(!1),[i,l]=d.useState(!0),{innerWidth:c,innerHeight:u}=window,p=[c/2,u/2],{position:C,setPosition:y,listeners:M}=An({initialPosition:{x:p[0],y:p[1]}}),k=d.useCallback((j,D)=>{const v=j-p[0],x=D-p[1];return v<0?x<0?1:3:x<0?2:4},[p]),m=d.useMemo(()=>k(C.x,C.y),[C]),g=d.useRef(null);d.useEffect(()=>{if(n&&i&&g.current){const{clientWidth:j,clientHeight:D}=g.current;m%2==0?y(v=>({x:v.x-j,y:v.y-D})):m>2&&y(v=>({x:v.x,y:v.y-D})),l(!1)}n||l(!0)},[n,g.current]);const S=d.useCallback(j=>{a(!0),y({x:j.clientX,y:j.clientY}),j.stopPropagation()},[]),b=d.useCallback(j=>{a(!1),j.stopPropagation(),o?.(j)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(Ze,{open:n,keepMounted:!0,onClose:b,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...M,children:r.jsx(Je,{sx:{position:"fixed",margin:1,left:C.x,top:C.y},elevation:6,children:r.jsxs($,{ref:g,sx:{display:"flex",flexGrow:1,flexDirection:m%2==1?"row":"row-reverse"},children:[r.jsxs($,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",padding:0,flexGrow:2,justifyContent:"space-evenly",alignContent:"space-evenly",borderLeft:`1px solid rgba(0,0,0, ${m%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${m%2==1?.1:0})`},children:[r.jsx(I,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:r.jsx(Os,{})}),s.map(j=>d.cloneElement(j,{sx:{flexGrow:"inherit"},size:"small",closeContainer:b})),r.jsx(I,{color:"error",onClick:b,size:"small",id:"close-panel",children:r.jsx(J,{})},"reject")]}),r.jsx($,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:r.jsx(te,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:L.cloneElement(t,{isOpen:n})})})]})})}),d.cloneElement(e,{onClick:S})]})},Ln=({gestures:e,children:t})=>{const s=d.useRef(null),n=Gs(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return r.jsx($,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},Be="Pointer",Tn="0.0.1",On={},Gn=O({name:Be,initialState:On,reducers:{},extraReducers:e=>{}}),Nn=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(Be,Gn.reducer),console.info("Pointer module started"),console.groupEnd()},Pn=({closeContainer:e,handleConfirm:t,...s})=>d.createElement(I,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},r.jsx(Ns,{})),Bn={name:Be,version:Tn,depends_on:[],components:{MultiTouchPanel:Ln,PointerContainer:Dn,ConfirmAndCloseButton:Pn},hooks:{},store:{},kernelCalls:{startModule:Nn,restartModule(){},shutdownModule(){}}};export{f as A,Un as D,zn as L,_n as M,bn as S,Nt as a,ne as b,Ve as c,ut as d,Ue as e,re as f,ie as g,ce as h,So as i,ct as j,ae as k,at as l,ze as m,_e as n,Fn as o,Bn as p,ye as r,R as u};
