import{r as h,u as ls,a as us,R as G,c as x,b as L,_ as fe,d as T,e as I,l as se,f as pt,g as gt,s as Re,z as ht,h as ps,i as gs,j as hs,k as fs,m as ms,n as ft,o as r,p as mt,S as xs,q as rt,M as ws,A as ys,t as Ms,B as v,T as ge,v as Cs,w as Ve,I as B,x as he,E as me,y as bs,C as ks,D as Ss,F as $s,G as xt,P as wt,H as vs,J as js,K as xe,L as we,N as Q,O as J,Q as Es,U as As,V as Rs,W as Vs,X as Ds,Y as Ls,Z as Ns,$ as Os,a0 as Gs,a1 as Ts,a2 as yt,a3 as Ps,a4 as _s,a5 as Is,a6 as Fs,a7 as zs,a8 as Us,a9 as it,aa as Bs,ab as Ws,ac as Ys,ad as qs,ae as Mt,af as ee,ag as Hs,ah as Xs,ai as Ks,aj as Zs,ak as Qs,al as Js,am as eo,an as to,ao as so,ap as Ct,aq as oo,ar as no,as as ao,at as ro,au as io,av as co,aw as ct,ax as lo,ay as uo,az as po,aA as go,aB as ho,aC as fo,aD as mo,aE as xo,aF as bt,aG as kt}from"./vendor-14321f5b.js";const St="Store",wo="0.0.1",$t=h.createContext({currentReducers:{},loadReducers:e=>null,registerMiddleware:e=>null}),yo=()=>{const{loadReducers:e,registerMiddleware:t}=h.useContext($t);return{functions:{loadReducer:(o,n)=>{e({[o]:n})},registerMiddleware:o=>{t(o)}}}},vt=()=>ls(),Mo=us,jt=h.createContext({registries:{},createRegistry:()=>null,createRegistries:()=>null,getComponent:()=>G.memo(()=>null),registerComponents:()=>null}),Co=()=>{const{createRegistry:e,createRegistries:t,getComponent:s,registerComponents:o}=h.useContext(jt);return{functions:{createRegistry:e,createRegistries:t,registerComponents:o,getComponent:s}}},ue={name:St,version:wo,depends_on:[],managers:{store:yo,componentRegistry:Co},hooks:{useAppDispatch:vt,useAppSelector:Mo},kernelCalls:{startModule:()=>null,restartModule:()=>null,shutdownModule:()=>null}},De=h.createContext({modules:{},setModules:()=>null}),w={EVENT:"Event",COMMAND:"Command",DOCUMENT:"Document"},A="Graph",bo="0.0.1",ko=x(`[${A}:Instance:${w.EVENT}] Graph loaded`),So=x(`[${A}:Instance:${w.EVENT}] Node added`),$o=x(`[${A}:Instance:${w.EVENT}] Node removed`),vo=x(`[${A}:Instance:${w.EVENT}] Node updated`),jo=x(`[${A}:Instance:${w.EVENT}] Edge added`),Eo=x(`[${A}:Instance:${w.EVENT}] Edge removed`),Ee=x(`[${A}:Instance:${w.EVENT}] Search finished`),Ao=x(`[${A}:Instance:${w.EVENT}] Search invalidated`),Et=x(`[${A}:Instance:${w.COMMAND}] Load Graph`),At=x(`[${A}:Instance:${w.COMMAND}] Reset Graph`),ye=x(`[${A}:Instance:${w.COMMAND}] Add node`),Me=x(`[${A}:Instance:${w.COMMAND}] Remove node`),Ce=x(`[${A}:Instance:${w.COMMAND}] Update node`),oe=x(`[${A}:Instance:${w.COMMAND}] Add edge`),ne=x(`[${A}:Instance:${w.COMMAND}] Remove edge`),Rt=x(`[${A}:Instance:${w.COMMAND}] Search`),Vt=x(`[${A}:Instance:${w.COMMAND}] Invalidate Search`),D=e=>{const{modules:t}=h.useContext(De),s=t[e];if(!s)throw Error(`Module ${e} not found`);return s},Dt={inputs:{},outputs:{}},be=(e,t)=>{const s=D("Store"),o=s.hooks.useAppDispatch(),n=s.hooks.useAppSelector,a=L(d=>d?.Graph&&d.Graph.graphs[e],t),i=n(a),c=n(d=>d?.Graph&&d.Graph.graphs[e]);return{id:e,state:i,actions:{addNode:(d,u)=>{const l={...d,position:{x:0,y:0}};o(ye({graphId:e,node:l,edges:u??Dt}))},removeNode:d=>{o(Me({graphId:e,nodeId:d}))},updateNode:d=>{o(Ce({graphId:e,nodeId:d.id,changes:d}))},addEdge:d=>{o(oe({graphId:e,edge:d}))},updateEdge:(d,u)=>{const l=c?.edges[d];if(l){o(ne({graphId:e,edgeId:d}));const p={...l,...u};o(oe({graphId:e,edge:p}))}},removeEdge:d=>{o(ne({graphId:e,edgeId:d}))},nodeExists:d=>c?d in c.nodes:!1,search:(d,u,l,p,m,y,b,f)=>{const g=f??fe.uniqueId("search");return o(Rt({id:g,graphId:e,strategy:d,nodeStart:u,validate:l,stopCriteria:p,getNeighbours:m,depth:y,label:b??g})),g}}}},Le={nodes:{},edges:{},adjacencyList:{},searchResults:{}},Lt={graphs:{}};x(`[${A}:${w.EVENT}:Init] Graph Module loaded`);const Ro=x(`[${A}:GraphsManager:${w.EVENT}] Graph created`),Vo=x(`[${A}:GraphsManager:${w.EVENT}] Graph destroyed`),Ne=x(`[${A}:GraphsManager:${w.COMMAND}] Create graph`),Nt=x(`[${A}:GraphsManager:${w.COMMAND}] Destroy graph`),Do=T({name:A,initialState:Lt,reducers:{},extraReducers:e=>{e.addCase(Et,(t,{payload:{graphId:s,graph:o}})=>({...t,graphs:{...t.graphs,[s]:o}})),e.addCase(ye,(t,{payload:{graphId:s,node:o,edges:n}})=>{const a=t.graphs[s];if(!a)throw Error("Graph does not exist");if(a.nodes[o.id])throw Error("Node already exists");return{...t,graphs:{...t.graphs,[s]:{...a,nodes:{...a.nodes,[o.id]:o},edges:{...a.edges,...Object.entries(n.inputs).reduce((c,[d,u])=>({...c,[d]:u}),{}),...Object.entries(n.outputs).reduce((c,[d,u])=>({...c,[d]:u}),{})},adjacencyList:{...a.adjacencyList,[o.id]:{inputs:Object.keys(n.inputs),outputs:Object.keys(n.outputs)},...Object.entries(n.inputs).reduce((c,[d,u])=>({...c,[u.sourceId]:{...a.adjacencyList[u.sourceId],outputs:[...a.adjacencyList[u.sourceId].outputs,d]}}),{}),...Object.entries(n.outputs).reduce((c,[d,u])=>({...c,[u.targetId]:{...a.adjacencyList[u.targetId],inputs:[...a.adjacencyList[u.targetId].inputs,d]}}),{})}}}}}).addCase(Me,(t,{payload:{graphId:s,nodeId:o}})=>{const n=Object.entries(t.graphs[s].edges).filter(([a,i])=>i.sourceId===o||i.targetId===o).map(([a,i])=>a);return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],nodes:Object.values(t.graphs[s].nodes).reduce((a,i)=>i.id!==o?{...a,[i.id]:i}:a,{}),adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,c])=>i!==o?{...a,[i]:{inputs:c.inputs.filter(d=>!n.includes(d)),outputs:c.outputs.filter(d=>!n.includes(d))}}:a,{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,c])=>n.includes(i)?a:{...a,[i]:c},{})}}}}).addCase(Ce,(t,{payload:{graphId:s,nodeId:o,changes:n}})=>{const a=t.graphs[s],i=a.nodes[o];if(i===null)throw Error("Node does not exist");return a.nodes[o]={...i,...n},t}).addCase(oe,(t,{payload:{graphId:s,edge:o}})=>{o.type==="CONSUMES"&&console.log(o);const n=t.graphs[s];if(n.edges[o.id])throw Error("Edge already exists");return n.edges[o.id]=o,n.adjacencyList[o.sourceId].outputs.push(o.id),n.adjacencyList[o.targetId].inputs.push(o.id),t}).addCase(ne,(t,{payload:{graphId:s,edgeId:o}})=>{const n=t.graphs[s].edges[o];return{...t,graphs:{...t.graphs,[s]:{...t.graphs[s],adjacencyList:Object.entries(t.graphs[s].adjacencyList).reduce((a,[i,c])=>i===n.sourceId||i===n.targetId?{...a,[i]:{inputs:c.inputs.filter(d=>d!==o),outputs:c.outputs.filter(d=>d!==o)}}:{...a,[i]:c},{}),edges:Object.entries(t.graphs[s].edges).reduce((a,[i,c])=>i!==o?{...a,[i]:c}:a,{})}}}}).addCase(At,(t,{payload:{graphId:s}})=>({...t,graphs:{...t.graphs,[s]:{id:s,...Le}}})).addCase(Ee,(t,{payload:{graphId:s,searchId:o,results:n}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:n}}}})).addCase(Vt,(t,{payload:{graphId:s,searchId:o}})=>({...t,graphs:{...t.graphs,[s]:{...t.graphs[s],searchResults:{...t.graphs[s].searchResults,[o]:{...t.graphs[s].searchResults[o],outdated:!0}}}}}))}}),Lo=T({name:A,initialState:Lt,reducers:{},extraReducers:e=>{e.addCase(Ne,(t,{payload:{graphId:s}})=>{if(s in t.graphs)throw Error();return t.graphs[s]={...Le,id:s},t}).addCase(Nt,(t,{payload:{graphId:s}})=>{if(!(s in t.graphs))throw Error();return delete t.graphs[s],t}),e.addDefaultCase(Do.reducer)}}),Oe=I();Oe.startListening({actionCreator:Ne,effect:async(e,t)=>{const{dispatch:s}=t;s(Ro(e.payload))}});Oe.startListening({actionCreator:Nt,effect:async(e,t)=>{const{dispatch:s}=t;s(Vo(e.payload))}});const No=(e,t,s,o,n)=>{const a=[],i=[];let c=0;const d=[t];for(;d.length;){const u=d.shift();if(!u)break;const l=e.nodes[u];if(a.push(l),s(l,e,i,a)&&i.push(l),o(l,e,i,a))break;if(n&&c>=n)continue;const m=e.adjacencyList[u];d.push(...m.outputs.map(y=>e.edges[y].targetId)),d.push(...m.inputs.map(y=>e.edges[y].sourceId)),c+=1}return{findings:i,visited:a,path:[]}},Oo=(e,t,s,o,n=(i,c)=>[...c.adjacencyList[i.id].inputs,...c.adjacencyList[i.id].outputs],a)=>{const i=[],c=[];let d=0;const u=[t];let l={},p=t;for(;u.length;){const b=u.pop();if(!b)break;p=b;const f=e.nodes[b];if(i.push(f),s(f,e,c,i)){if(c.push(f),o(f,e,c,i))break;if(a&&d>=a){d-=1;continue}const k=n(f,e).filter(S=>!i.map(V=>V.id).includes(e.edges[S].targetId)).map(S=>e.edges[S].targetId);u.push(...k),l=k.reduce((S,V)=>({...S,[V]:b}),l),d+=1}}const m=[];let y=p;for(;y;)m.push(y),y=l[y];return m.reverse(),{findings:c,visited:i,path:m}},F=I();F.startListening({actionCreator:Et,effect:async({payload:{graphId:e,graph:t}},s)=>{const{dispatch:o}=s;o(ko({graphId:e,graph:t}))}});F.startListening({actionCreator:ye,effect:async({payload:{graphId:e,node:t,edges:s}},o)=>{const{dispatch:n}=o;n(So({graphId:e,node:t,edges:s}))}});F.startListening({actionCreator:Me,effect:async({payload:{graphId:e,nodeId:t}},s)=>{const{dispatch:o}=s;o($o({graphId:e,nodeId:t}))}});F.startListening({actionCreator:Ce,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(vo(e))}});F.startListening({actionCreator:oe,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(jo(e))}});F.startListening({actionCreator:ne,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Eo(e))}});F.startListening({actionCreator:Rt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t;let{Graph:{graphs:n}}=o(),a=n[e.graphId];if(a.searchResults&&e.id in a.searchResults&&!a.searchResults[e.id].outdated){s(Ee({graphId:e.graphId,searchId:e.id,results:a.searchResults[e.id]}));return}let i={findings:[],visited:[],path:[]};switch(e.strategy){case"dfs":i={...Oo(a,e.nodeStart,e.validate,e.stopCriteria,e.getNeighbours,e.depth)};break;case"bfs":i=No(a,e.nodeStart,e.validate,e.stopCriteria,e.depth);break}s(Ee({graphId:e.graphId,searchId:e.id,results:{...i,outdated:!1}}))}});F.startListening({actionCreator:Vt,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Ao(e))}});const $="Layout",Go="0.0.1",Ge="ribbonMenuSections",H="viewportTypes",Ot="settings-panel",Gt="details-panel",Tt="viewport-notifications-tray";function To(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t);let s="#";for(let o=0;o<3;o++){let n=t>>o*8&171;s+=("00"+n.toString(16)).slice(-2)}return s}const Po=({width:e,height:t,nodeBorder:s})=>{const o=se().domain([-1,e+1]).range([-1,e+1]),n=se().domain([-1,t+1]).range([-1,t+1]),a=pt(o).ticks((e+2)/(t+2)*10).tickSize(t).tickPadding(8-t),i=gt(n).ticks(10).tickSize(e).tickPadding(8-e);function c(p){p.append("circle").attr("r",m=>m.radius).attr("fill",m=>To(m.group.name??"")).attr("stroke",s),p.append("text").text(m=>m.nodeLabel).attr("text-anchor","middle").attr("fill",s)}function d(p){function m(f){f.active||p.alphaTarget(.3).restart(),f.subject.fx=f.subject.x,f.subject.fy=f.subject.y}function y(f){f.subject.fx=f.x,f.subject.fy=f.y}function b(f){f.active||p.alphaTarget(0),f.subject.fx=null,f.subject.fy=null}return ms().on("start",m).on("drag",y).on("end",b)}function u(p){p.append("line").attr("stroke-width","1em").attr("stroke","gray")}function l(p){p.each(m=>{p.attr("viewBox",[0,0,e,t]),p.selectAll("*").remove(),p.append("defs");const b=p.append("g").attr("role","grid"),f=p.append("g").attr("role","container"),g=b.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(a),M=b.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),k=ht().scaleExtent([-10,40]).filter(C=>(C.preventDefault(),(!C.ctrlKey||C.type==="wheel")&&!C.button)).on("zoom",({transform:C})=>{f.attr("transform",C),g.call(a.scale(C.rescaleX(o))),M.call(i.scale(C.rescaleY(n)))});p.call(k);const S=ps(m.nodes).force("links",gs(m.links).id(C=>C.id).distance(300).strength(1)).force("charge",hs().strength(C=>C.strength)).force("colide",fs(C=>C.radius)),V=f.append("g").attr("role","layer").attr("id","links-layer").selectAll("g[role='link']").data(m.links).join(C=>C.append("g").attr("role","link").attr("id",O=>O.id).call(u),C=>C,C=>C.remove()),j=f.append("g").attr("role","layer").attr("id","nodes-layer").selectAll("g[role='node']").data(m.nodes).join(C=>C.append("g").attr("role","node").attr("id",O=>O.id).call(d(S)).call(c),C=>C.select("circle").attr("cx",O=>O.x).attr("cy",O=>O.y),C=>C.remove());S.on("tick",()=>{j.attr("transform",C=>`translate(${C.x}, ${C.y})`),V.selectAll("line").attr("x1",C=>C.source.x).attr("y1",C=>C.source.y).attr("x2",C=>C.target.x).attr("y2",C=>C.target.y)}),S.alpha(1)})}return{render(p,m){Re(m).datum(p).call(l)}}},_o=({graphId:e})=>{const{hooks:{useResizeObserver:t}}=D("Layout"),s=h.useRef(null),o=h.useRef(null),n=t(o),a=be(e,u=>u),i=h.useMemo(()=>a?.state?.nodes?{nodes:Object.values(a.state.nodes).map(u=>({id:u.id,group:{id:`${u.id}-group`,name:u.type},nodeLabel:u?.label||u.id,strength:-400,x:u.position.x,y:u.position.y,radius:50})),links:Object.values(a.state.edges).map(u=>({id:u.id,type:u.type,source:u.sourceId,target:u.targetId,value:5}))}:{nodes:[],links:[]},[a]),c=ft(),d=Po({nodeBorder:c.palette.getContrastText(c.palette.background.default),width:n?.width??0,height:n?.height??0});return h.useLayoutEffect(()=>{!n||!s.current||d.render(i,s.current)},[i,n]),a.state?r.jsx("div",{ref:o,role:"graph-viewer",style:{height:"100%",width:"100%"},children:r.jsx("svg",{ref:s,id:`${a.id}`,width:"100%",height:"100%"})}):r.jsx(r.Fragment,{})},Pt=G.memo(_o),Io=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(A,Lo.reducer),e.functions.registerMiddleware(Oe),e.functions.registerMiddleware(F),t.functions.createRegistries({[Ge]:{},[H]:{graph:Pt}})},Fo=()=>{const e=vt();return{functions:{createGraph(t){return e(Ne({graphId:t})),{id:t,state:{id:t,...Le},actions:{addNode:(s,o)=>{const n={...s,position:{x:0,y:0}};e(ye({graphId:t,node:n,edges:o??Dt}))},removeNode:s=>{e(Me({graphId:t,nodeId:s}))},updateNode:s=>{e(Ce({graphId:t,nodeId:s.id,changes:s}))},addEdge:s=>{e(oe({graphId:t,edge:s}))},updateEdge:(s,o)=>{console.error("Not implemented yet")},removeEdge:s=>{e(ne({graphId:t,edgeId:s}))},nodeExists:s=>!1,search:()=>"null"}}},resetGraph(t){e(At({graphId:t}))}}}},zo=(e,t)=>{const o=t??(n=>n);return L(n=>n.Graph,n=>n&&o(n.graphs[e]))},Uo=(e,t)=>{const s=D("Graph"),{useGraph:o}=s.hooks,n=o(e,c=>c?.nodes[t]),a=o(e,c=>c?.adjacencyList[t]),i=o(e,c=>Object.values(c?.edges??{}).filter(d=>a.state?.inputs?.includes(d.id)||a.state?.outputs?.includes(d.id)).reduce((d,u)=>({...d,[u.id]:u}),{}));return{node:n.state,edges:i.state??{},adjacencyList:a.state??{inputs:[],outputs:[]}}},_t=(e,t)=>be(e,o=>o?.searchResults&&o.searchResults[t]).state,Bo=(e,t,s)=>{h.useEffect(()=>{s()},[]);const o=_t(e,t);return h.useEffect(()=>(o?.outdated&&s(),()=>console.warn("left search results hanging")),[o?.outdated]),o},dt={name:A,version:bo,depends_on:["Store"],components:{GraphViewer:Pt},managers:{graphs:Fo},hooks:{useGraph:be,useNodeInfo:Uo,useSearch:Bo,useSearchResult:_t},store:{selectors:{getGraphState:zo}},kernelCalls:{startModule:Io,restartModule(){},shutdownModule(){}}},ke=x(`[${$}:Theme:${w.COMMAND}] Switch theme`),Wo=x(`[${$}:Theme:${w.EVENT}] Theme switched`),It=I();It.startListening({actionCreator:ke,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Wo(e))}});const Te=x(`[${$}:Ribbon:${w.COMMAND}] Add tab`),Pe=x(`[${$}:Ribbon:${w.COMMAND}] Select tab`),Yo=x(`[${$}:Ribbon:${w.EVENT}] tab added`),qo=x(`[${$}:Ribbon:${w.EVENT}] tab selected`),_e=I();_e.startListening({actionCreator:Te,effect:async({payload:{tab:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(Yo({tab:n[e.name]}))}});_e.startListening({actionCreator:Pe,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{ribbonMenu:{tabs:n}}}=o();s(qo({tab:n[e]}))}});const Ie=x(`[${$}:Viewports:${w.COMMAND}] Add viewport`),Fe=x(`[${$}:Viewports:${w.COMMAND}] Select viewport`),ze=x(`[${$}:Viewports:${w.COMMAND}] Close viewport`),Ft=x(`[${$}:Viewports:${w.COMMAND}] Rename viewport`),Ue=x(`[${$}:Viewports:${w.COMMAND}] Add viewport to group`),Ae=x(`[${$}:Viewports:${w.COMMAND}] Viewport removed from group`),Ho=x(`[${$}:Viewports:${w.EVENT}] Viewport added`),Xo=x(`[${$}:Viewports:${w.EVENT}] Viewport selected`),Ko=x(`[${$}:Viewports:${w.EVENT}] Viewport closed`);x(`[${$}:Viewports:${w.EVENT}] Viewport renamed`);const Zo=x(`[${$}:Viewports:${w.EVENT}] Viewport added to group`);x(`[${$}:Viewports:${w.EVENT}] Viewport removed from group`);const X=I();X.startListening({actionCreator:Ie,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(Ho(n[e]))}});X.startListening({actionCreator:Fe,effect:async({payload:{name:e}},t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{viewports:n}}}=o();s(Xo(n[e]))}});X.startListening({actionCreator:ze,effect:async({payload:{name:e}},t)=>{const{dispatch:s}=t;s(Ko({name:e}))}});X.startListening({actionCreator:Ue,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Zo(e))}});X.startListening({actionCreator:Ae,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Ae(e))}});const Be=x(`[${$}:Viewports:${w.COMMAND}] Create group`),Qo=x(`[${$}:Viewports:${w.EVENT}] Group created`),zt=I();zt.startListening({actionCreator:Be,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(Qo(e))}});const We=x(`[${$}:Panels:${w.COMMAND}] Expand settings panel`),Ye=x(`[${$}:Panels:${w.COMMAND}] Collapse settings panel`),qe=x(`[${$}:Panels:${w.COMMAND}] Open details panel`),He=x(`[${$}:Panels:${w.COMMAND}] Close details panel`),Jo=x(`[${$}:Panels:${w.EVENT}] Settings panel expanded`),en=x(`[${$}:Panels:${w.EVENT}] Settings panel collapsed`),tn=x(`[${$}:Panels:${w.EVENT}] Details panel opened`),sn=x(`[${$}:Panels:${w.EVENT}] Details panel closed`),ae=I();ae.startListening({actionCreator:We,effect:async(e,t)=>{const{dispatch:s}=t;s(Jo())}});ae.startListening({actionCreator:Ye,effect:async(e,t)=>{const{dispatch:s}=t;s(en())}});ae.startListening({actionCreator:qe,effect:async(e,t)=>{const{dispatch:s}=t;s(tn())}});ae.startListening({actionCreator:He,effect:async(e,t)=>{const{dispatch:s,getState:o}=t,{Layout:{viewportManager:{activeViewport:n}}}=o();s(sn({viewportName:n}))}});const on=T({name:`${$}ViewportsGroups`,initialState:{},reducers:{},extraReducers:e=>{e.addCase(Be,(t,{payload:s})=>({...t,[s.name]:{name:s.name,color:s.color}}))}}),nn=T({name:`${$}Viewports`,initialState:{groups:{},activeViewport:"home",viewports:{}},reducers:{},extraReducers:e=>{e.addCase(Ie,(t,{payload:s})=>({...t,viewports:{...t.viewports,[s.name]:s}})),e.addCase(ze,(t,{payload:s})=>({...t,activeViewport:"home",viewports:Object.entries(t.viewports).reduce((o,[n,a])=>n===s.name?o:{...o,[n]:a},{})})),e.addCase(Fe,(t,{payload:s})=>({...t,activeViewport:s.name})),e.addCase(Ft,(t,{payload:{oldName:s,newName:o}})=>({...t,viewports:Object.entries(t.viewports).reduce((n,[a,i])=>a===s?{...n,[s]:{...i,title:o}}:{...n,[a]:i},{})})),e.addCase(Ue,(t,{payload:{viewportName:s,groupName:o}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:o}}})),e.addCase(Ae,(t,{payload:{viewportName:s}})=>({...t,viewports:{...t.viewports,[s]:{...t.viewports[s],group:void 0}}})),e.addDefaultCase((t,s)=>({...t,groups:on.reducer(t.groups,s)}))}}),an=T({name:`${$}RibbonMenu`,initialState:{activeTab:"home",tabs:{}},reducers:{},extraReducers:e=>{e.addCase(Te,(t,{payload:{tab:s}})=>{const{name:o}=s;return{...t,tabs:{...t.tabs,[o]:s}}}),e.addCase(Pe,(t,{payload:{name:s}})=>({...t,activeTab:s}))}}),Ut={settings:{state:"expanded"},details:{state:"closed"}},rn=T({name:$,initialState:Ut,reducers:{},extraReducers:e=>{e.addCase(We,t=>({...t,settings:{...t.settings,state:"expanded"}})),e.addCase(Ye,t=>({...t,settings:{...t.settings,state:"collapsed"}})),e.addCase(qe,t=>({...t,details:{...t.details,state:"opened"}})),e.addCase(He,t=>({...t,details:{...t.details,state:"closed"}}))}}),cn={theme:"light",ribbonMenu:{activeTab:"file",tabs:{file:{name:"file",type:"dropdown",active:!0,label:"Arquivo",loaded:!0,sectionNames:[]}}},panels:Ut,viewportManager:{activeViewport:"home",groups:{},viewports:{home:{name:"home",title:"",type:"home"}}}},dn=T({name:$,initialState:cn,reducers:{},extraReducers:e=>{e.addCase(ke,(t,{payload:{theme:s}})=>({...t,theme:s})),e.addDefaultCase((t,s)=>({...t,panels:rn.reducer(t.panels,s),ribbonMenu:an.reducer(t.ribbonMenu,s),viewportManager:nn.reducer(t.viewportManager,s)}))}}),pe=({name:e,icon:t,summary:s,expanded:o,state:n,children:a,sx:i,...c})=>{const d=mt("(min-width:1024px)");return n==="collapsed"?r.jsx(xs,{children:t??r.jsx(rt,{})}):r.jsxs(ws,{role:`accordion-${e}`,"aria-label":`accordion ${e}`,sx:{width:"max-content",minWidth:"100%",...i},...c,children:[r.jsx(ys,{expandIcon:r.jsx(Ms,{}),"aria-controls":`accordion-${e}-content`,children:r.jsxs(v,{sx:{display:"flex",overflow:"hidden",gap:2},children:[t??r.jsx(rt,{}),r.jsx(ge,{component:"div",sx:{width:"33%",flexShrink:0},children:e}),s&&d&&r.jsx(ge,{component:"div",sx:{color:"text.secondary"},children:s})]})}),r.jsx(Cs,{children:a})]})};function Xe(){const e=D("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{expandSettings(){s(We())},collapseSettings(){s(Ye())},openDetails(){s(qe())},closeDetails(){s(He())}}}}L(e=>e.Layout,e=>e&&e.panels);const ln=L(e=>e.Layout,e=>e&&e.panels.settings),un=L(e=>e.Layout,e=>e&&e.panels.details),Bt=({title:e,display:t,children:s,sx:o,...n})=>{const a=document.getElementById(Gt),i=mt("(orientation: portrait)"),c=D("Store"),{useAppSelector:d}=c.hooks,u=Xe(),l=d(un),p=h.useCallback(m=>{m.stopPropagation(),l&&l.state==="opened"&&u.functions.closeDetails()},[l?.state]);return!a||!l?null:Ve.createPortal(r.jsxs(v,{role:"details-panel","aria-label":"details panel",display:l.state==="opened"?"flex":"none",sx:{...o,flexDirection:"column",padding:1,gap:1,minWidth:"15vw"},...n,children:[r.jsxs(v,{role:"panel-header",sx:{display:"flex",alignItems:"center",gap:2},children:[!i&&r.jsx(B,{size:"small",component:"span",onClick:p,children:l.state==="opened"&&r.jsx(he,{})}),r.jsx("span",{children:e??"Detalhes"})]}),r.jsx(v,{role:"panel-content",sx:{overflow:"auto",height:"100%"},children:r.jsx(me,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:s})})]}),a)},Wt=({title:e,children:t})=>{const s=D("Store"),{useAppSelector:o}=s.hooks,n=Xe(),a=o(ln),i=document.getElementById(Ot),c=h.useCallback(d=>{d.stopPropagation(),a&&a.state==="collapsed"&&n.functions.expandSettings(),a&&a.state==="expanded"&&n.functions.collapseSettings()},[a?.state]);return!i||!a?null:Ve.createPortal(r.jsx(v,{sx:{position:"relative"},children:r.jsxs(v,{role:"settings-panel","aria-label":"settings panel",sx:{overflowX:"hidden","&::-webkit-scrollbar":{width:"0.4em"},padding:1,maxWidth:a.state==="collapsed"?"6vw":"100%",display:"flex",flexDirection:"column",gap:1,"@media (orientation: portrait)":{maxWidth:a.state==="collapsed"?"8vw":"100%"}},children:[r.jsxs(v,{role:"panel-header",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.state==="expanded"&&r.jsxs(r.Fragment,{children:[r.jsx(bs,{}),r.jsx("span",{children:e??"Configurações"})]}),r.jsx(B,{size:"small",component:"span",onClick:c,children:a.state==="collapsed"?r.jsx(ks,{sx:{transform:"rotate(90deg)"}}):r.jsx(Ss,{sx:{transform:"rotate(90deg)"}})})]}),r.jsx(v,{role:"panel-content",sx:{display:"flex",flexDirection:"column",placeSelf:"center",gap:a.state==="collapsed"?2:0,marginTop:4},children:r.jsx(me,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:t.map((d,u)=>h.cloneElement(d,{state:a.state,key:u}))})})]})}),i)},pn=({name:e,title:t,type:s,group:o})=>r.jsxs(r.Fragment,{children:[r.jsxs(Wt,{children:[r.jsx(pe,{name:"Agenda",icon:r.jsx($s,{}),expanded:!0,children:r.jsx(r.Fragment,{})}),r.jsx(pe,{name:"Recebimentos",summary:"Recebimentos do mês",children:r.jsx(r.Fragment,{})}),r.jsx(pe,{name:"Andamento",summary:"Pedidos em produção",children:r.jsx(r.Fragment,{})})]}),r.jsx(Bt,{children:r.jsx(r.Fragment,{children:"Detalhes"})})]}),gn=G.memo(pn),hn=({dispatch:e,managers:{storeManager:t,componentRegistryManager:s}})=>{t.functions.loadReducer($,dn.reducer),window.matchMedia("(prefers-color-scheme: dark)").matches&&e(ke({theme:"dark"})),t.functions.registerMiddleware(It),t.functions.registerMiddleware(_e),t.functions.registerMiddleware(X),t.functions.registerMiddleware(zt),t.functions.registerMiddleware(ae),s.functions.createRegistries({[Ge]:{},[H]:{home:gn}})};function Yt(){const e=D("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{setTheme(o){s(ke({theme:o}))}}}}const qt=h.createContext({sections:{},setSections:()=>null}),fn=({children:e,default_sections:t})=>{const[s,o]=h.useState(t??{});function n(i,c){o({...s,[i]:c})}const a=h.useMemo(()=>({sections:s,setSections:n}),[s]);return r.jsx(qt.Provider,{value:a,children:e})},Ht=e=>e&&e.Layout?.ribbonMenu,Xt=L(Ht,e=>e&&e.tabs),mn=L(Ht,e=>e&&e.activeTab);function Kt(){const e=D("Store"),{useAppSelector:t,useAppDispatch:s}=e.hooks,{componentRegistry:o}=e.managers,n=s(),a=t(Xt);return h.useContext(qt),o(),{functions:{tabExists(i){return a!=null&&i in a},addNewTab(i){const c=fe.uniqueId("tab-"),d={...i,name:c,active:!1};n(Te({tab:d}))},selectTab(i){n(Pe({name:i}))}}}}function Zt(){const e=D("Store"),{useAppDispatch:t}=e.hooks,{componentRegistry:s}=e.managers,o=t(),n=s();return{functions:{registerViewportTypes(a){n.functions.registerComponents({[H]:a})},getViewportTypeComponent(a){const i=n.functions.getComponent(H,a);if(!i)throw Error("Unknown viewport type");return i},addViewport(a,i,c,d="viewport"){if(!n.functions.getComponent(H,i))throw Error("Unknown viewport type");const l=fe.uniqueId(d);return o(Ie({name:l,title:a,type:i,group:c})),l},renameViewport(a,i){o(Ft({oldName:a,newName:i}))},selectViewport(a){o(Fe({name:a}))},closeViewport(a){o(ze({name:a}))},createGroup(a,i){o(Be({name:a,color:i}))},addToGroup(a,i){o(Ue({viewportName:a,groupName:i}))}}}}const Ke=L(e=>e.Layout.viewportManager,e=>e&&e.activeViewport),Qt=e=>e.Layout.viewportManager,xn=L(e=>e.Layout.viewportManager,e=>e?.groups),wn=L(Qt,e=>e&&e.viewports),Jt=(e,t)=>{const o=t??(n=>n);return L(Qt,n=>n&&o(n.viewports[e]))},yn=({children:e})=>{const t=document.getElementById(Tt);return t?Ve.createPortal(r.jsx(v,{sx:{position:"relative"},children:e}),t):null},Mn=({title:e,component:t,button:s,sx:o={}})=>{const[n,a]=h.useState(!1),i=h.useCallback(d=>{a(!0),d.stopPropagation()},[]),c=h.useCallback(()=>{a(!1)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{open:n,onClose:c,components:{Backdrop:void 0},children:r.jsxs(wt,{elevation:6,id:"modal-content",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",p:4,...o},draggable:!0,children:[e&&r.jsx(ge,{variant:"subtitle1",component:"span",children:e}),G.cloneElement(t,{closeModal:c})]})}),G.cloneElement(s,{onClick:i})]})},Ze=h.createContext({rows:[],setRows:()=>null}),Cn=({children:e,initialRows:t})=>{const[s,o]=h.useState((t??[]).map(a=>({...a,state:"untouched"}))),n=h.useMemo(()=>({rows:s,setRows:o}),[s]);return r.jsx(Ze.Provider,{value:n,children:e})},Se=(e,t)=>t==="dark"?xe(e,.7):we(e,.7),$e=(e,t)=>t==="dark"?xe(e,.6):we(e,.6),ve=(e,t)=>t==="dark"?xe(e,.5):we(e,.5),je=(e,t)=>t==="dark"?xe(e,.4):we(e,.4),bn=vs(js)(({theme:e})=>({"& .state--added":{backgroundColor:Se(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:$e(e.palette.success.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:ve(e.palette.success.main,e.palette.mode),"&:hover":{backgroundColor:je(e.palette.success.main,e.palette.mode)}}},"& .state--modified":{backgroundColor:Se(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:$e(e.palette.warning.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:ve(e.palette.warning.main,e.palette.mode),"&:hover":{backgroundColor:je(e.palette.warning.main,e.palette.mode)}}},"& .state--deleted":{backgroundColor:Se(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:$e(e.palette.error.main,e.palette.mode)},"&.Mui-selected":{backgroundColor:ve(e.palette.error.main,e.palette.mode),"&:hover":{backgroundColor:je(e.palette.error.main,e.palette.mode)}}}})),kn=()=>r.jsx(v,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",width:"100%"},children:r.jsx(ge,{variant:"body2",children:"Sem registros"})}),Sn=({handleAddRecord:e,addLabel:t})=>r.jsxs(Ls,{sx:{display:"flex",justifyContent:"space-around"},children:[r.jsx(Ns,{startIcon:r.jsx(Os,{}),onPointerUp:e,children:t||"Adicionar"}),r.jsx("div",{children:r.jsx(Gs,{})})]}),$n=({columns:e,addLabel:t,newRecord:s,...o})=>{const{rows:n,setRows:a}=h.useContext(Ze),[i,c]=h.useState({}),d=()=>{const g=s();a(M=>[...M,{...g,state:"added"}]),c(M=>({...M,[g.id]:{mode:Q.Edit,fieldToFocus:"id"}}))},u=h.useCallback(g=>()=>{c(M=>({...M,[g]:{mode:Q.Edit}}))},[]),l=g=>(a(M=>M.map(k=>k.id===g.id?{...g,old:{...k,old:null}}:k)),g),p=(g,M)=>{g.reason===Ts.rowFocusOut&&(M.defaultMuiPrevented=!0)},m=h.useCallback(g=>{const M=n.find(S=>S.id===g);if(!M)return;const k=M.state==="untouched"?"modified":M.state;a(S=>S.map(V=>V.id===g?{...V,state:k}:V)),c(S=>({...S,[g]:{mode:Q.View}}))},[n]),y=h.useCallback(g=>()=>{a(M=>M.map(k=>k.id===g?{...k,state:"deleted",oldState:k.state}:k).filter(k=>!(k.state==="deleted"&&k?.oldState==="added")))},[]),b=h.useCallback(g=>()=>{a(M=>M.map(k=>k.id===g?{...k,state:k.oldState,oldState:"deleted"}:k))},[]),f=h.useCallback(g=>()=>{c(k=>({...k,[g]:{mode:Q.View,ignoreModifications:!0}}));const M=n.find(k=>k.id===g);M&&M.state==="added"&&a(k=>k.filter(S=>S.id!==g))},[n]);return r.jsx(bn,{editMode:"row",hideFooter:!0,autoHeight:!0,rowModesModel:i,getRowClassName:g=>`state--${g.row.state}`,onRowEditStop:p,processRowUpdate:l,slotProps:{toolbar:{handleAddRecord:d,addLabel:t}},slots:{noRowsOverlay:kn,toolbar:Sn},columns:[...e,{field:"actions",type:"actions",headerName:"Actions",cellClassName:"actions",getActions:({id:g})=>{const M=n.find(S=>S.id===g);return M?i[g]?.mode===Q.Edit?[r.jsx(J,{icon:r.jsx(Es,{}),label:"Save",id:`save-${g}`,sx:{color:"primary.main"},onClick:()=>m(g)},"save"),r.jsx(J,{icon:r.jsx(As,{}),label:"Cancel",className:"textPrimary",onClick:f(g),color:"inherit"},"cancel")]:M.state==="deleted"?[r.jsx(J,{icon:r.jsx(Rs,{}),label:"Restore",className:"textPrimary",onClick:b(g),color:"inherit"},"restore")]:[r.jsx(J,{icon:r.jsx(Vs,{}),label:"Edit",className:"textPrimary",onClick:u(g),color:"inherit"},"edit"),r.jsx(J,{icon:r.jsx(Ds,{}),label:"Delete",onClick:y(g),color:"inherit"},"delete")]:[]}}],...o,rows:n})};function vn({id:e,value:t,field:s}){const o=yt(),n=a=>{const i=a.target.checked;o.current.setEditCellValue({id:e,field:s,value:i})};return r.jsx(Ps,{checked:t,onChange:n})}const jn=e=>{const[t,s]=h.useState();return h.useLayoutEffect(()=>{if(!e.current)return;const o=e.current,n=new ResizeObserver(a=>{a.forEach(i=>{s(i.contentRect)})});return n.observe(o),()=>n.unobserve(o)},[e]),t},de={100:"#DAECFF",200:"#b6daff",400:"#3399FF",500:"#007FFF",600:"#0072E5",900:"#003A75"},U={50:"#F3F6F9",100:"#E5EAF2",200:"#DAE2ED",300:"#C7D0DD",400:"#B0B8C4",500:"#9DA8B7",600:"#6B7A90",700:"#434D5B",800:"#303740",900:"#1C2025"},En=_s(Is)(({theme:e})=>`
    box-sizing: border-box;
    width: 100%;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 0.875rem;
    font-weight: 400;
    line-height: 1.5;
    padding: 8px 12px;
    border-radius: 8px;
    color: ${e.palette.mode==="dark"?U[300]:U[900]};
    background: ${e.palette.mode==="dark"?U[900]:"#fff"};
    border: 1px solid ${e.palette.mode==="dark"?U[700]:U[200]};
    box-shadow: 0px 2px 2px ${e.palette.mode==="dark"?U[900]:U[50]};

    &:hover {
      border-color: ${de[400]};
    }

    &:focus {
      border-color: ${de[400]};
      box-shadow: 0 0 0 3px ${e.palette.mode==="dark"?de[600]:de[200]};
    }

    // firefox
    &:focus-visible {
      outline: 0;
    }
  `);function An({wrapperProps:e,...t}){const s=ft();return r.jsx(v,{role:"textarea-wrapper",...e,children:r.jsx(En,{theme:s,"aria-label":"minimum height",minRows:3,placeholder:"Minimum 3 rows",...t})})}const Rn=e=>r.jsx(v,{sx:{position:"absolute"},children:r.jsx(Fs,{...e})});function Vn({colorChange:e,sx:t}){const[s,o]=h.useState("#ffffff"),[n,a]=h.useState(!1);return r.jsxs(v,{sx:{position:"relative"},children:[r.jsx(v,{sx:{...t,borderRadius:1,backgroundColor:s,minWidth:"10px",minHeight:"10px"},onClick:()=>a(i=>!i)}),n&&r.jsx(Rn,{onChange:(i,c)=>{o(i.hex),a(!1),e?.(i,c)}})]})}function Dn({id:e,value:t,field:s,...o}){const n=yt(),a=i=>{const c=i.target.value;n.current.setEditCellValue({id:e,field:s,value:c})};return r.jsx(zs,{value:t??"",onChange:a,sx:{padding:0},...o})}const es={name:$,version:Go,depends_on:[],components:{SettingsPanel:Wt,DetailsPanel:Bt,ViewportNotificationsTray:yn,Accordion:pe,SystemModal:Mn,CRUDGrid:$n,CRUDBooleanCell:vn,CRUDTextFieldCell:Dn,CRUDGridProvider:Cn,CustomTextArea:An,ColorPicker:Vn},contexts:{CRUDGridContext:Ze},hooks:{useLayoutManager:Yt,useRibbonMenuManager:Kt,useViewportManager:Zt,usePanelsManager:Xe,useResizeObserver:jn},store:{selectors:{selectActiveViewport:Ke,getViewportState:Jt,getViewportGroups:xn}},kernelCalls:{startModule:hn,restartModule(){},shutdownModule(){}}},re="Loader",Ln="0.0.1",te="modules",ts=x(`[${re}:${w.EVENT}] Module started`),Nn=x(`[${re}:${w.COMMAND}] Start module`),On={modulesCount:1,modulesGraph:te},Gn=T({name:re,initialState:On,reducers:{},extraReducers:e=>{e.addCase(ts,t=>(t.modulesCount+=1,t))}}),Tn=({managers:{storeManager:e}})=>{e.functions.loadReducer(re,Gn.reducer)};class lt extends Error{}class Pn extends Error{}const _n=e=>e.modulesCount,In=()=>{const{modules:e,setModules:t}=h.useContext(De),{useLayoutManager:s,useRibbonMenuManager:o,useViewportManager:n}=es.hooks,{store:a,componentRegistry:i}=ue.managers,c=s(),d=o(),u=n(),l=a(),p=i(),m=ue.hooks.useAppDispatch(),y=ue.hooks.useAppSelector;return{modulesLoaded:y(_n),functions:{isModuleLoaded:g=>g in e,loadModule(g){if(g.name in e)throw new Pn(`${g.name} is not registered. Consider using restartModule instead.`);t({...e,[g.name]:g}),m(Nn(g.name)),g.kernelCalls.startModule({dispatch:m,managers:{storeManager:l,componentRegistryManager:p,layoutManager:c,ribbonMenuManager:d,viewportManager:u}}),m(ts(g.name))},unloadModule(g){if(!(g in e))throw new lt(`${g} is not registered.`);e[g].kernelCalls.shutdownModule(l),delete e[g],t(e)},reloadModule(g){if(!(g in e))throw new lt(`${g} is not registered.`);const M=e[g];t(e),M.kernelCalls.restartModule(l)}}}},ut={name:re,version:Ln,depends_on:["Store","Graph"],managers:{modules:In},kernelCalls:{startModule:Tn,restartModule:()=>null,shutdownModule:()=>null}},Fn=({afterLoadComponent:e,extraModules:t={kernel:[],system:[]}})=>{const s=ut.managers.modules(),o=be(te,j=>j&&j.id),[n,a]=h.useState(!0),[i,c]=h.useState(!1),[d,u]=h.useState(0),[l,p]=h.useState(0),[m,y]=h.useState(0),b=h.useMemo(()=>[ut,dt,es],[]),f=dt.managers.graphs(),{createGraph:g,resetGraph:M}=f.functions;h.useEffect(()=>{const j=b[d];j&&!s.functions.isModuleLoaded(j.name)&&k(j)},[d]),h.useEffect(()=>{if(d===b.length){const j=t.kernel[l];j&&!s.functions.isModuleLoaded(j.name)&&S(j)}},[d,l]),h.useEffect(()=>{if(l===t.kernel.length){const j=t.system[m];j&&!s.functions.isModuleLoaded(j.name)&&V(j)}},[l,m]),h.useEffect(()=>{m===t.system.length&&a(!1)},[m]),h.useEffect(()=>{!n&&!o.state&&(g(te),c(!0))},[n]),h.useEffect(()=>{if(i&&!o.state&&g(te),!i)return;M(te);const j={id:"root",type:"ROOT"};o.actions.addNode(j),b.forEach(C=>o.actions.addNode({id:C.name,type:"STATIC_MODULE"},{inputs:{root:{id:`root->${C.name}`,type:"DEPENDS_ON",sourceId:"root",targetId:C.name}},outputs:{}})),t.kernel.forEach(C=>{C.depends_on.push("Loader");const O=C.depends_on.reduce((Y,_)=>{const K={id:`${_}->${C.name}`,type:"DEPENDS_ON",sourceId:_,targedId:C.name};return{...Y,[_]:K}},{});o.actions.addNode({id:C.name,type:"EXTRA_KERNEL_MODULE"},{inputs:O,outputs:{}})}),t.system.forEach(C=>{C.depends_on.push("Loader");const O=C.depends_on.reduce((Y,_)=>{const K={id:`${_}->${C.name}`,type:"DEPENDS_ON",sourceId:_,targedId:C.name};return{...Y,[_]:K}},{});o.actions.addNode({id:C.name,type:"EXTRA_SYSTEM_MODULE"},{inputs:O,outputs:{}})}),a(!1)},[i]);function k(j){s.functions.loadModule(j),u(d+1)}function S(j){s.functions.loadModule(j),p(l+1)}function V(j){s.functions.loadModule(j),y(m+1)}return n?r.jsx("div",{children:"Iniciando sistema"}):e},zn=({children:e,loadModules:t})=>{const[s,o]=h.useState({Store:ue}),n=h.useMemo(()=>({modules:s,setModules:o}),[s]);return r.jsx(De.Provider,{value:n,children:r.jsx(Fn,{extraModules:t,afterLoadComponent:e})})},za=G.memo(zn),Un={},le=T({name:St,initialState:Un,reducers:{},extraReducers:e=>{}}),Bn=({children:e,default_registries:t})=>{const[s,o]=h.useState(t??{}),n=h.useMemo(()=>({registries:s,createRegistry:a,createRegistries:i,getComponent:c,registerComponents:d}),[s]);function a(u){o({...s,[u]:{}})}function i(u){o({...s,...u})}function c(u,l){return s[u][l]}function d(u){const l=s,p=Object.entries(u).reduce((m,[y,b])=>y in m?{...m,[y]:{...m[y],...b}}:m,l);o(p)}return r.jsx(jt.Provider,{value:n,children:e})},Wn=({children:e})=>{const[t,s]=h.useState({[le.name]:le.reducer}),o=h.useMemo(()=>Us({reducer:it({[le.name]:le.reducer}),middleware:i=>i({serializableCheck:!1}).concat(Bs)}),[]),n=i=>{Ys(i.middleware)},a=h.useCallback(i=>{const c={...t,...i};s(c),o.replaceReducer(it(c))},[t]);return r.jsx(Ws,{store:o,children:r.jsx($t.Provider,{value:{currentReducers:t,loadReducers:a,registerMiddleware:n},children:r.jsx(Bn,{children:e})})})},Ua=G.memo(Wn),ss=L(e=>e.Layout,e=>e&&e.theme),Yn=({systemTray:e})=>{const t=D("Store"),{useAppSelector:s}=t.hooks,{componentRegistry:o}=t.managers,n=o(),a=Kt(),{selectTab:i}=a.functions,c=s(Xt),d=s(mn),u=h.useCallback(l=>{i(l)},[]);return!d||!c?r.jsx(r.Fragment,{}):r.jsxs(qs,{value:d,children:[r.jsxs(v,{sx:{display:"flex",justifyContent:"space-between"},role:"ribbon-menu-tabs","aria-label":"ribbon menu tabs",children:[r.jsx(Mt,{value:d,"aria-label":"ribbon menu tabs",role:"ribbon-menu-tabs",textColor:"secondary",indicatorColor:"secondary",children:Object.entries(c).map(([l,p])=>r.jsx(ee,{value:l,label:p.label,id:l,onClick:()=>u(l),wrapped:!0},l))}),r.jsx(v,{role:"system-tray","aria-label":"system tray",sx:{display:"flex",p:1,alignItems:"center"},children:e})]}),r.jsx(v,{role:"ribbon-menu-panels","aria-label":"ribbon menu panels",sx:{borderBottom:1,borderColor:"divider",minHeight:"10vh"},children:c&&Object.entries(c).map(([l,p])=>r.jsx(Hs,{value:l,children:p.sectionNames&&p.sectionNames.map(m=>{const y=n.functions.getComponent(Ge,m);return h.createElement(y,{key:`ribbon-panel-${l}-section-${m}`},[])})},`ribbon-panel-${l}`))})]})},qn=({children:e,...t})=>{const s=h.useMemo(()=>({file:[r.jsx("div",{children:"test"},"test")]}),[]);return r.jsx(fn,{default_sections:s,children:r.jsx(Yn,{...t,systemTray:e})})},Hn=G.memo(qn),Xn=()=>{const e=D("Store"),{useAppSelector:t}=e.hooks,s=e.managers.componentRegistry(),o=t(Ke),n=t(Jt(o));if(!n)return null;const a=s.functions.getComponent(H,n.type);return a?r.jsx(me,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:G.createElement(a,n,[])}):null},Kn=L(e=>e.Layout.viewportManager,e=>e&&e.groups),Zn=({sx:e,...t})=>{const s=D("Store"),{useAppSelector:o}=s.hooks,n=o(Kn),a=o(Ke),i=o(wn),c=h.useMemo(()=>Object.entries(i).reduce((y,[b,f])=>b==="home"?y:f.group?{...y,[f.group]:f.group in y?[...y[f.group],f]:[f]}:{...y,notGrouped:[...y.notGrouped,f]},{notGrouped:[]}),[i]),{functions:{addViewport:d,closeViewport:u,selectViewport:l}}=Zt(),p=h.useCallback(()=>{d("Nova aba","home",void 0,"new-")},[]),m=h.useCallback(y=>{u(y)},[]);return r.jsxs(v,{role:"viewport-manager",sx:{...e,height:"100%",display:"flex",flexDirection:"column"},...t,children:[r.jsxs(v,{sx:{display:"flex",justifyContent:"space-between"},children:[r.jsxs(Mt,{value:a,"aria-label":"viewport tabs",role:"viewport-tabs",sx:{maxWidth:"100%"},children:[r.jsx(ee,{value:"home",icon:r.jsx(Xs,{}),iconPosition:"start",onClick:()=>l("home"),id:"home",sx:{width:"fit-content",minWidth:0,p:1}},"home"),Object.entries(c).map(([y,b])=>y==="notGrouped"?b.map(f=>r.jsx(ee,{value:f.name,id:f.name,sx:{width:"fit-content",p:1},onClick:g=>g.button!=2?l(f.name):m(f.name),label:r.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(he,{sx:{width:.3,marginLeft:1,alignItems:"center"},onClick:g=>{g.stopPropagation(),m(f.name)}})]}),draggable:!0,wrapped:!0},`${f.name}-tab`)):b.map(f=>r.jsx(ee,{value:f.name,id:f.name,sx:{width:"fit-content",p:1,borderTop:2,borderColor:n[f.group].color},onClick:()=>l(f.name),label:r.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsx("span",{children:f.title}),r.jsx(B,{size:"small",component:"span",onClick:g=>{g.stopPropagation(),m(f.name)},children:r.jsx(he,{sx:{width:.5,marginLeft:1}})})]}),draggable:"true",wrapped:!0},`${f.name}-tab`))),r.jsx(ee,{value:"new",icon:r.jsx(Ks,{}),iconPosition:"start",role:"add viewport","aria-label":"Add viewport",id:"new-viewport",onClick:p,sx:{width:"fit-content",minWidth:0,p:1}},"new")]}),r.jsx(v,{id:Tt,role:"viewport-notifications","aria-label":"viewport notifications",sx:{display:"flex",p:1,gap:2,alignItems:"center"}})]}),r.jsx(v,{role:"viewport-content","aria-label":"viewport content",sx:{width:"100%",flexGrow:1,overflow:"auto"},children:r.jsx(Xn,{})})]})},Qn=G.memo(Zn),Jn=()=>{const e=D("Store"),{useAppSelector:t}=e.hooks,s=t(ss),o=Yt(),n=h.useCallback(()=>{o.functions.setTheme(s=="dark"?"light":"dark")},[s]);return r.jsx(v,{role:"system-tray-container",children:r.jsx(B,{color:"primary","aria-label":"switch theme button",onClick:n,children:s==="light"?r.jsx(Zs,{fontSize:"small"}):r.jsx(Qs,{fontSize:"small"})})})},ea=G.memo(Jn),ta=Js(v)`
  display: grid;
  height: 100vh;

  grid-template-rows: min-content auto;
  grid-template-areas:
    "ribbon ribbon ribbon"
    "settings viewport details";

  @media (orientation: portrait) {
    grid-template-rows: auto 2fr minmax(10px, 2fr);
    grid-template-areas:
      "ribbon ribbon"
      "viewport viewport"
      "settings details";
  }
`,sa=()=>{const e=D("Store"),{useAppSelector:t}=e.hooks,s=t(ss),o=h.useMemo(()=>eo({palette:{mode:s??"dark",contrastThreshold:3,tonalOffset:.2},typography:{fontSize:12,fontFamily:"Raleway, Arial"}}),[s]);return r.jsxs(to,{theme:o,children:[r.jsx(so,{}),r.jsx(v,{role:"layout-root",sx:{minHeight:"100vh"},children:r.jsxs(ta,{role:"content",sx:{gridTemplateColumns:"auto minmax(auto, 4fr) auto"},children:[r.jsx(v,{sx:{gridArea:"ribbon",width:"100%"},children:r.jsx(Hn,{children:r.jsx(ea,{})})}),r.jsx(v,{id:Ot,role:"settings-panel-container",sx:{gridArea:"settings",minHeight:"100%",borderTop:0,borderRight:1,borderColor:"divider","@media (orientation: portrait)":{borderTop:1,borderColor:"divider"}}}),r.jsx(Qn,{sx:{gridArea:"viewport",position:"relative",overflow:"auto","&::-webkit-scrollbar":{width:"0.4em"}}}),r.jsx(v,{id:Gt,role:"details-panel-container",sx:{gridArea:"details",width:"100%",borderLeft:1,borderColor:"divider",overflow:"auto","@media (orientation: portrait)":{borderLeft:0,borderTop:1,borderColor:"divider"}}})]})})]})},Ba=G.memo(sa),oa=({dataTransform:e})=>(t,s,o)=>{const{matrix:i,names:c}=e(o),d=Ct().innerRadius(200).outerRadius(210),l=oo().padAngle(5/200).sortSubgroups(no)(i),p=ao(ro,c.length+1),m=io().radius(200-1).padAngle(1/200),y=s.append("g").attr("id","chord-plot"),b=y.append("g").attr("role","groups-container"),f=y.append("g").attr("role","chords-container").attr("fill-opacity",.75),g=b.selectAll().data(l.groups).join("g").attr("id",M=>c[M.index]);g.append("path").attr("fill",M=>p[M.index]).attr("d",d),g.append("text").attr("dy","0.35em").attr("transform",M=>`
        rotate(${(M.startAngle+M.endAngle)/2*180/Math.PI-90})
        translate(${210+5})
        ${(M.startAngle+M.endAngle)/2>Math.PI?"rotate(180)":""}
      `).attr("text-anchor",M=>(M.startAngle+M.endAngle)/2>Math.PI?"end":null).text(M=>c[M.index]).attr("fill","white"),f.selectAll().data(l).join("path").style("mix-blend-mode","add").attr("fill",M=>p[M.target.index]).attr("d",m).append("title").text(M=>`${c[M.source.index]} → ${c[M.target.index]} ${M.source.value}`)},na=({xSettings:e,ySettings:t,dimensions:[s,o]})=>{const n=se().domain(e.domain).range(e.range),a=se().domain(t.domain).range(t.range),i=pt(n).ticks((s+2)/(o+2)*10).tickSize(o).tickPadding(8-o),c=gt(a).ticks(10).tickSize(s).tickPadding(8-s);let d=(l,p)=>{};function u(l,p,m){const y=p.selectAll("g").data([1]).join("g").attr("role","grid"),b=l.select("#content"),f=l.select("#overlays"),g=y.append("g").attr("class","axis axis--x").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(i),M=y.append("g").attr("class","axis axis--y").attr("stroke-opacity","0.3").attr("stroke-dasharray","6 1").attr("stroke-width","0.5px").call(c),k=ht().scaleExtent([-10,40]).filter(S=>(S.preventDefault(),(!S.ctrlKey||S.type==="wheel")&&!S.button)).on("zoom",({transform:S})=>{b.attr("transform",S),f.attr("transform",S),g.call(i.scale(S.rescaleX(n))),M.call(c.scale(S.rescaleY(a)))});d(l,k),l.call(k)}return u.transformZoom=l=>(d=l,u),u.build=u,u},aa=e=>e.SVG,ra=e=>L(aa,t=>t&&t.svgs[e]),ia=({path:e,instanceName:t,beforeInjection:s,sx:o,...n})=>{const a=D("Store"),{useAppSelector:i}=a.hooks,c=i(ra(e)),d=h.useCallback(l=>{if(l.setAttribute("id",`${e}-root`),l.setAttribute("width","100%"),l.setAttribute("height","100%"),t){if(!c?.instances[t])return;Object.entries(c?.instances[t].proxies??{}).forEach(([m,y])=>{const b=l.getElementById(m);b&&("fill"in y&&b.setAttribute("fill",y.fill),"stroke"in y&&b.setAttribute("stroke",y.stroke))})}s&&s(l)},[s,c?.content,t,c?.instances[t]]),u=h.useMemo(()=>c?.content&&window.URL.createObjectURL(new Blob([c.content],{type:"image/svg+xml"})),[c?.content]);return!c||!u?null:r.jsx(v,{...n,role:"svg-viewport",id:e,"aria-label":"SVG viewer",sx:{...o,width:"100%",display:"flex",alignItems:"top",justifyContent:"center"},children:r.jsx(co,{style:{width:"100%",overflow:"hidden"},src:u,height:"100%",width:"100%",beforeInjection:d})})},N="SVG",ca="0.0.1";function da(){let e=700,t=700,s=[],o=[],n=[];function a(c){c.each(d=>{c.attr("viewBox",[0,0,e,t]);const u=c.selectAll("#underlays").data([1]).join("g").attr("id","underlays"),l=c.selectAll("#content").data([1]).join("g").attr("id","content"),p=c.selectAll("#overlays").data([1]).join("g").attr("id","overlays");s.forEach(m=>m(c,u,d)),o.forEach(m=>m(c,l,d)),n.forEach(m=>m(c,p,d))})}function i(c,d){Re(d).datum(c).call(a)}return i.width=c=>c?(e=c,i):e,i.height=c=>c?(t=c,i):t,i.underlays=c=>c?(s=c,i):s,i.content=c=>c?(o=c,i):o,i.overlays=c=>c?(n=c,i):n,i.render=i,i}const Qe=x(`[${N}:SVG:${w.COMMAND}] Load SVG`),os=x(`[${N}:SVG:${w.COMMAND}] Fetch SVG`),ns=x(`[${N}:SVG:${w.COMMAND}] Set pan`),as=x(`[${N}:SVG:${w.COMMAND}] Set zoom`),rs=x(`[${N}:SVG:${w.COMMAND}] Add proxy`),Je=x(`[${N}:SVG:${w.COMMAND}] Update proxy`),et=x(`[${N}:SVG:${w.COMMAND}] Delete proxy`),tt=x(`[${N}:SVG:${w.EVENT}] SVG fetched`),la=x(`[${N}:SVG:${w.EVENT}] SVG loaded`);x(`[${N}:SVG:${w.COMMAND}] Proxy added`);const ua=x(`[${N}:SVG:${w.COMMAND}] Proxy updated`),pa=x(`[${N}:SVG:${w.COMMAND}] Proxy deleted`),ga=(e,t)=>{const s=D("Store"),{useAppDispatch:o}=s.hooks,n=o(),a=s.hooks.useAppSelector,i=L(d=>d&&d.SVG.svgs[e],t);return{state:a(i),actions:{setPan(d,u,l){n(ns({path:e,instanceName:d,x:u*-10,y:l*-10}))},setZoom(d,u){n(as({path:e,instanceName:d,zoom:u}))},addProxy(d,u,l){n(rs({path:e,instanceName:u,id:d,styles:l}))},deleteProxy(d,u){n(et({path:e,instanceName:u,id:d}))},updateProxy(d,u,l){n(Je({path:e,instanceName:u,id:d,changes:l}))}}}},ha=()=>{const e=D("Store"),{useAppDispatch:t}=e.hooks,s=t();return{functions:{loadSVG(o,n){s(Qe({path:o,instanceName:n}))}}}},ie=I();ie.startListening({actionCreator:Qe,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(os({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(tt({path:e.path,content:n}))}});ie.startListening({actionCreator:tt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(la(n[e.path]))}});ie.startListening({actionCreator:Je,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{SVG:{svgs:n}}=o();s(ua(n[e.path].instances[e.instanceName].proxies))}});ie.startListening({actionCreator:et,effect:async({payload:e},{dispatch:t})=>{t(pa(e))}});const fa={progress:"not-started",instances:{},content:void 0},ma={svgs:{}},xa=T({name:N,initialState:ma,reducers:{},extraReducers:e=>{e.addCase(Qe,(t,{payload:{path:s,instanceName:o}})=>{let n={[o]:{zoom:1,pan:[500,500],proxies:{}}};return t.svgs[s]&&!fe.isEmpty(t.svgs[s].instances)&&(n={...n,...t.svgs[s].instances}),{...t,svgs:{[s]:{path:s,...fa,instances:n}}}}),e.addCase(os,(t,{payload:{path:s}})=>({...t,svgs:{[s]:{...t.svgs[s],progress:"started"}}})),e.addCase(tt,(t,{payload:{path:s,content:o}})=>({...t,svgs:{...t.svgs,[s]:{...t.svgs[s],progress:"completed",content:o}}})),e.addCase(rs,(t,{payload:{path:s,instanceName:o,id:n,styles:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:t.svgs[s].instances[o]?{...t.svgs[s].instances[o].proxies,[n]:a}:{[n]:a}}}}}})),e.addCase(as,(t,{payload:{path:s,instanceName:o,zoom:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],zoom:n}}}}})),e.addCase(ns,(t,{payload:{path:s,instanceName:o,x:n,y:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],pan:[n,a]}}}}})),e.addCase(Je,(t,{payload:{path:s,instanceName:o,id:n,changes:a}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:{...t.svgs[s].instances[o].proxies,[n]:t.svgs[s].instances[o].proxies?{...t.svgs[s].instances[o].proxies[n],...a}:a}}}}}})),e.addCase(et,(t,{payload:{path:s,instanceName:o,id:n}})=>({...t,svgs:{[s]:{...t.svgs[s],instances:{...t.svgs[s].instances,[o]:{...t.svgs[s].instances[o],proxies:Object.entries(t.svgs[s].instances[o].proxies).reduce((a,[i,c])=>i===n?a:{...a,[i]:c},{})}}}}}))}}),wa=({managers:{storeManager:e,componentRegistryManager:t}})=>{e.functions.loadReducer(N,xa.reducer),e.functions.registerMiddleware(ie)},ya=()=>{let e=50,t=52,s="group",o=p=>p,n="dark",a=p=>!!p,i=p=>!!p,c=(p,m,y)=>{p.append("text").text(b=>b.nodeLabel).attr("fill",b=>y(b.group)).attr("text-anchor","middle")},d=(p,m,y,b,f,g,M)=>{p.selectAll("path").data([m]).join("path").attr("class","group-arc").attr("fill",k=>b(m.name)).attr("d",(k,S)=>f(y)),p.selectAll("text").data([m]).join("text").attr("class","group-text").text(k=>k.name).attr("fill",k=>b(k.name)).attr("text-anchor",(k,S)=>(y.endAngle+y.startAngle)/2>Math.PI?"end":"start").attr("transform",(k,S)=>{const[V,j]=f.centroid(y),C=Math.sqrt(V*V+j*j);return`translate(${V/C*e*1.3}, ${j/C*e*1.3})`})},u=(p,m,y)=>{const b=ct().curve(ho.beta(.35));p.append("path").attr("data-source",f=>f.source).attr("data-target",f=>f.target).attr("d",f=>b([[(e-10)*Math.sin(m(f.sourceOffset)),(e-10)*-Math.cos(m(f.sourceOffset))],[0,0],[(e-10)*Math.sin(m(f.targetOffset)),(e-10)*-Math.cos(m(f.targetOffset))]])).attr("fill","none").attr("stroke-width",1).attr("stroke","white")};function l(p,m,y){p.selectAll("defs").data([1]).join(E=>{let R=E.append("defs"),P=R.append("linearGradient").attr("id","convertion-gradient").attr("x1","0%").attr("x2","100%").attr("y1","0%").attr("y2","0%");R.append("marker").attr("id","arrow").attr("viewBox",[0,0,5,5]).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto-start-reverse").append("path").attr("d",ct()([[0,0],[0,5],[5,5]])).attr("stroke","white");const q=[{color:"steelblue",offset:"0%"},{color:"red",offset:"100%"}];return P.selectAll("stop").data(q).join("stop").attr("stop-color",ce=>ce.color).attr("offset",ce=>ce.offset),P});const b=m.selectAll(".dependency-circle").data([1]).join("g").attr("class","dependency-circle"),f=o(y),g=f.nodes.filter(a);g.sort((E,R)=>E.group.name>=R.group.name?-1:1);const M=f.links.filter(i),k=g.reduce((E,R,P)=>R.group.name in E?{...E,[R.group.name]:{id:R.group.id,name:R.group.name,nodes:[...E[R.group.name].nodes,{...R,idx:P,offset:0}]}}:{...E,[R.group.name]:{id:R.group.id,name:R.group.name,nodes:[{...R,idx:P,offset:0}]}},{});console.log(k);const S=Object.entries(k).map(([E,R])=>({id:R.id,name:E,nodes:R.nodes,size:R.nodes.length})),V=lo().domain(Object.keys(k)).range(uo),j=se().domain([0,g.length]).range([0,2*Math.PI]),C=po(),O=S.map(({size:E})=>E),Y=C(O),_=Ct().innerRadius(e*1.1).outerRadius(e*1.2).startAngle(E=>E.startAngle).endAngle(E=>E.endAngle),K=b.selectAll(".links").data([1]).join("g").attr("class","links");b.selectAll(".groups").data([1]).join("g").attr("class","groups").selectAll(".group").data(S).join("g").attr("id",E=>E.id??"other").attr("class","group"),Y.forEach((E,R)=>{const P=go.sum(Y.filter((z,Z)=>z.index<E.index).map(z=>z.value)),q=S[R];Re(`g[id="${q.id}"]`).call(d,q,E,V,_,e,t).selectAll(".nodes-container").data([q]).join("g").attr("class","nodes-container").selectAll(".node").data(q.nodes).join("g").attr("class","node").attr("id",z=>z.id).attr("data-offset",(z,Z)=>P+Z).attr("transform",(z,Z)=>`translate(${e*Math.sin(j(P+Z))}, ${e*-Math.cos(j(P+Z))}) `).call(c,j,V)}),K.selectAll(".link").data(M.map(E=>{const R=b.select(`g[id="${E.source}"]`),P=b.select(`g[id="${E.target}"]`);return{...E,sourceOffset:+R.attr("data-offset"),targetOffset:+P.attr("data-offset")}})).join("g",E=>(E.select("*").remove(),E),E=>E.remove()).attr("class","link").attr("id",E=>E.id).call(u,j,V)}return l.innerRadius=p=>p?(e=p,l):e,l.groupBy=p=>p?(s=p,l):s,l.graph=p=>p?(o=p,l):o,l.theme=p=>p?(n=p,l):n,l.renderNode=p=>(c=p,l),l.renderLink=p=>(u=p,l),l.renderGroup=p=>(d=p,l),l.filterNode=p=>(a=p,l),l.filterLink=p=>(i=p,l),l.build=l,l},Wa={name:N,version:ca,depends_on:[],components:{SVGViewer:ia},d3Components:{Grid:na,ChordPlot:oa,DependencyCircle:ya},hooks:{useD3Container:da,useSVGManager:ha,useSVG:ga},kernelCalls:{startModule:wa,restartModule(){},shutdownModule(){}}},Ma=({initialPosition:e})=>{const[t,s]=h.useState(!1),[o,n]=h.useState({x:0,y:0}),[a,i]=h.useState(e),c=h.useCallback(l=>{s(!0),n({x:l.clientX,y:l.clientY}),l.stopPropagation()},[]),d=h.useCallback(l=>{if(!t)return;const p={x:l.clientX-o.x,y:l.clientY-o.y},m={x:a.x+p.x,y:a.y+p.y};i(m)},[t]),u=h.useCallback(l=>{s(!1),l.stopPropagation()},[]);return{position:a,setPosition:i,listeners:{onPointerDown:c,onPointerMove:d,onPointerUp:u}}},Ca=({children:e,component:t,actions:s,onClose:o})=>{const[n,a]=h.useState(!1),{innerWidth:i,innerHeight:c}=window,d=[i/2,c/2],{position:u,setPosition:l,listeners:p}=Ma({initialPosition:{x:d[0],y:d[1]}}),m=h.useCallback((g,M)=>{const k=g-d[0],S=M-d[1];return k<0?S<0?1:3:S<0?2:4},[d]),y=h.useMemo(()=>m(u.x,u.y),[u]),b=h.useCallback(g=>{a(!0),l({x:g.clientX,y:g.clientY}),g.stopPropagation()},[]),f=h.useCallback(g=>{a(!1),g.stopPropagation(),o?.(g)},[]);return r.jsxs(r.Fragment,{children:[r.jsx(xt,{open:n,keepMounted:!0,onClose:f,disableEnforceFocus:!0,role:"pointer-panel",sx:{width:"min-content",touchAction:"none"},slotProps:{backdrop:{}},slots:{backdrop:()=>null},...p,children:r.jsx(wt,{sx:{position:"fixed",margin:1,left:u.x,top:u.y,transform:`translate(${y%2===0?"-100%":"0"}, ${y>2?"-100%":"0"})`,transition:"width 1s ease-in-out",transformOrigin:"bottom right"},elevation:6,children:r.jsxs(v,{sx:{display:"flex",flexGrow:1,flexDirection:y%2==1?"row":"row-reverse"},onClick:g=>g.stopPropagation(),children:[r.jsxs(v,{role:"pointer-panel-actions",sx:{display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignContent:"space-between",borderLeft:`1px solid rgba(0,0,0, ${y%2==1?0:.1})`,borderRight:`1px solid rgba(0,0,0, ${y%2==1?.1:0})`},children:[r.jsx(B,{sx:{cursor:"grab"},size:"small",id:"drag-panel",children:r.jsx(fo,{})}),s.map(g=>h.cloneElement(g,{size:"small",closeContainer:f})),r.jsx(B,{color:"error",onClick:f,size:"small",id:"close-panel",children:r.jsx(he,{})},"reject")]}),r.jsx(v,{role:"pointer-panel-content",sx:{padding:1,display:"flex",justifyContent:"center",alignContent:"center"},children:n?r.jsx(me,{fallback:r.jsx("div",{children:"Ocorreu um erro"}),children:t}):null})]})})}),h.cloneElement(e,{onClick:b})]})},ba=({gestures:e,children:t})=>{const s=h.useRef(null),n=mo(e,{drag:{filterTaps:!0,triggerAllEvents:!0}})();return r.jsx(v,{role:"multi-touch-panel",ref:s,...n,sx:{position:"relative",touchAction:"none"},children:t})},st="Pointer",ka="0.0.1",Sa={},$a=T({name:st,initialState:Sa,reducers:{},extraReducers:e=>{}}),va=({managers:{storeManager:e,componentRegistryManager:t}})=>{console.group("Starting pointer module"),e.functions.loadReducer(st,$a.reducer),console.info("Pointer module started"),console.groupEnd()},ja=({closeContainer:e,handleConfirm:t,...s})=>h.createElement(B,{...s,color:"success",key:"accept",onClick:o=>{t(),e&&e(o)}},r.jsx(xo,{})),Ya={name:st,version:ka,depends_on:[],components:{MultiTouchPanel:ba,PointerContainer:Ca,ConfirmAndCloseButton:ja},hooks:{},store:{},kernelCalls:{startModule:va,restartModule(){},shutdownModule(){}}},W="Markdown",Ea="0.0.1",ot=x(`[${W}:SVG:${w.COMMAND}] Load Markdown`),is=x(`[${W}:SVG:${w.COMMAND}] Fetch Markdown`),nt=x(`[${W}:SVG:${w.EVENT}] Markdown fetched`),cs=x(`[${W}:SVG:${w.EVENT}] Markdown loaded`),Aa=()=>{const e=D("Store"),{hooks:{useAppDispatch:t}}=e,s=t();return{loadMarkdown(o){s(ot({path:o}))}}},Ra=e=>e.Markdown,Va=e=>L(Ra,t=>t&&t.markdowns[e]),ds=e=>{const t=D("Store"),{useAppSelector:s}=t.hooks;return s(Va(e))},Da=({path:e,...t})=>{const s=Aa();h.useLayoutEffect(()=>{e&&s.loadMarkdown(e)},[e]);const o=ds(e);return!o||o.progress!=="completed"?r.jsx(r.Fragment,{}):r.jsx(bt,{...t,remarkPlugins:[kt],children:o.content})},La=({content:e,...t})=>r.jsx(bt,{...t,remarkPlugins:[kt],children:e}),Na=e=>"path"in e?r.jsx(Da,{...e}):r.jsx(La,{...e}),at=I();at.startListening({actionCreator:ot,effect:async({payload:e},t)=>{const{dispatch:s}=t;s(is({path:e.path}));const n=await(await(await fetch(e.path)).blob()).text();s(nt({path:e.path,content:n}))}});at.startListening({actionCreator:nt,effect:async({payload:e},t)=>{const{dispatch:s,getState:o}=t,{Markdown:{markdowns:n}}=o();s(cs(n[e.path]))}});const Oa={progress:"not-started",content:null},Ga={markdowns:{}},Ta=T({name:W,initialState:Ga,reducers:{},extraReducers:e=>{e.addCase(ot,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...Oa,path:s}}})),e.addCase(is,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"started"}}})),e.addCase(nt,(t,{payload:{path:s,content:o}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],content:o}}})),e.addCase(cs,(t,{payload:{path:s}})=>({...t,markdowns:{...t.markdowns,[s]:{...t.markdowns[s],progress:"completed"}}}))}}),Pa=({managers:{storeManager:e}})=>{e.functions.loadReducer(W,Ta.reducer),e.functions.registerMiddleware(at)},qa={name:W,version:Ea,depends_on:[],components:{MarkdownReader:Na},hooks:{useMarkdown:ds},kernelCalls:{startModule:Pa,restartModule(){},shutdownModule(){}}};export{w as A,Ua as D,Ba as L,za as M,la as S,rs as a,ye as b,ze as c,Nt as d,Ce as e,oe as f,ne as g,sn as h,Vt as i,Me as j,et as k,Et as l,Qe as m,D as n,qe as o,Ne as p,Oo as q,Ae as r,Wa as s,Ya as t,Je as u,qa as v};
